





<!DOCTYPE html>
<html lang="en" data-color-mode="auto" data-light-theme="light" data-dark-theme="dark" >
  <head>
    <meta charset="utf-8">
  <link rel="dns-prefetch" href="https://github.githubassets.com">
  <link rel="dns-prefetch" href="https://avatars.githubusercontent.com">
  <link rel="dns-prefetch" href="https://github-cloud.s3.amazonaws.com">
  <link rel="dns-prefetch" href="https://user-images.githubusercontent.com/">
  <link rel="preconnect" href="https://github.githubassets.com" crossorigin>
  <link rel="preconnect" href="https://avatars.githubusercontent.com">



  <link crossorigin="anonymous" media="all" integrity="sha512-sD8zc/Dn1lguLc4FdbeVhD2gfxFCTXGr/y+MpJG3oX1vkAyaFf/7BHPtvv1dAHA0KG4bDEW3Ex1EPrzGTMtN2Q==" rel="stylesheet" href="https://github.githubassets.com/assets/light-b03f3373f0e7.css" /><link crossorigin="anonymous" media="all" integrity="sha512-V0872pNNqPTaPQFzdwX9tHIzJvB4F1Foi6VYDciZAMo/qHgBC8PvN2d/SkMweiNDbR6eF3cXcG0aPVrEtC8zqw==" rel="stylesheet" href="https://github.githubassets.com/assets/dark-574f3bda934d.css" /><link data-color-theme="dark_dimmed" crossorigin="anonymous" media="all" integrity="sha512-PzuUWYSTZfXfFMEstZYF7zd5TnBiunweYKf7SA0USRWwzNBPELoB8ZhGVGTwcMSwF5ff9kyBAdGzEbfJ2/4cig==" rel="stylesheet" data-href="https://github.githubassets.com/assets/dark_dimmed-3f3b94598493.css" /><link data-color-theme="dark_high_contrast" crossorigin="anonymous" media="all" integrity="sha512-PDguTqV/sgFBBIdGLWGe50pI4GUQjVg3NQIm1ue9+6Wtn5qdx122aGJ1/M6IydIYhVs1tRfeLBl8P+7lNRRHlg==" rel="stylesheet" data-href="https://github.githubassets.com/assets/dark_high_contrast-3c382e4ea57f.css" /><link data-color-theme="dark_colorblind" crossorigin="anonymous" media="all" integrity="sha512-PZ0pkh4DltajJswDsmdCrHotI3eS5qb+etb48dcRDxUuiy0g2YP+kw5sQi04CE7AO+J33JXg86PAQoivVKkdKg==" rel="stylesheet" data-href="https://github.githubassets.com/assets/dark_colorblind-3d9d29921e03.css" /><link data-color-theme="light_colorblind" crossorigin="anonymous" media="all" integrity="sha512-P+VDoZFVyqfAb06foA/ZLUzHkdMPqEQq1d1B0VSzEzOF3fidwKWULgI+b1E+OoF7VnC5HXRS4lMJPKKc6wrc8g==" rel="stylesheet" data-href="https://github.githubassets.com/assets/light_colorblind-3fe543a19155.css" /><link data-color-theme="light_high_contrast" crossorigin="anonymous" media="all" integrity="sha512-33ulzUgAM4pZv65KAcvjwZLHiC4bQaF61LiK9BiAQ/kuCG/+LtNi2clT1gfb72sa9SOsiu4fs4bEBL543Ms3Iw==" rel="stylesheet" data-href="https://github.githubassets.com/assets/light_high_contrast-df7ba5cd4800.css" />
    <link crossorigin="anonymous" media="all" integrity="sha512-5ITBENg+F5FPizqEsxN2bcmczO46aikzj/TypfSsMeBhfQdvrwp+exPchAMYBksYmjzlK9JZ57G9b1EiEklI5A==" rel="stylesheet" href="https://github.githubassets.com/assets/frameworks-e484c110d83e.css" />
    <link crossorigin="anonymous" media="all" integrity="sha512-Q1pxMwbjf9TRvtZHxthjG2H2cG3oIZYMlJ1H0+LneQ/TwZf+CbwdS+DgpKaia34ugCjSJH92VUhslZFzhgUlng==" rel="stylesheet" href="https://github.githubassets.com/assets/behaviors-435a713306e3.css" />
  <link crossorigin="anonymous" media="all" integrity="sha512-ayXlm8B066mM6BR2iSgRpYbKYRC9Enh0HnzRlf9no0/GyLOyJc61eboyu0zHCz3ZGu4xJo0nuyOCunSRTjMRFA==" rel="stylesheet" href="https://github.githubassets.com/assets/github-6b25e59bc074.css" />

    <meta name="optimizely-datafile" content="{&quot;version&quot;: &quot;4&quot;, &quot;rollouts&quot;: [], &quot;typedAudiences&quot;: [], &quot;anonymizeIP&quot;: true, &quot;projectId&quot;: &quot;16737760170&quot;, &quot;variables&quot;: [], &quot;featureFlags&quot;: [], &quot;experiments&quot;: [{&quot;status&quot;: &quot;Running&quot;, &quot;audienceIds&quot;: [], &quot;variations&quot;: [{&quot;variables&quot;: [], &quot;id&quot;: &quot;20438636352&quot;, &quot;key&quot;: &quot;control&quot;}, {&quot;variables&quot;: [], &quot;id&quot;: &quot;20484957397&quot;, &quot;key&quot;: &quot;treatment&quot;}], &quot;id&quot;: &quot;20479227424&quot;, &quot;key&quot;: &quot;growth_ghec_onboarding_experience&quot;, &quot;layerId&quot;: &quot;20467848595&quot;, &quot;trafficAllocation&quot;: [{&quot;entityId&quot;: &quot;20484957397&quot;, &quot;endOfRange&quot;: 1000}, {&quot;entityId&quot;: &quot;20484957397&quot;, &quot;endOfRange&quot;: 3000}, {&quot;entityId&quot;: &quot;20484957397&quot;, &quot;endOfRange&quot;: 5000}, {&quot;entityId&quot;: &quot;20484957397&quot;, &quot;endOfRange&quot;: 6000}, {&quot;entityId&quot;: &quot;20484957397&quot;, &quot;endOfRange&quot;: 8000}, {&quot;entityId&quot;: &quot;20484957397&quot;, &quot;endOfRange&quot;: 10000}], &quot;forcedVariations&quot;: {&quot;85e2238ce2b9074907d7a3d91d6feeae&quot;: &quot;control&quot;}}, {&quot;status&quot;: &quot;Running&quot;, &quot;audienceIds&quot;: [], &quot;variations&quot;: [{&quot;variables&quot;: [], &quot;id&quot;: &quot;20667381018&quot;, &quot;key&quot;: &quot;control&quot;}, {&quot;variables&quot;: [], &quot;id&quot;: &quot;20680930759&quot;, &quot;key&quot;: &quot;treatment&quot;}], &quot;id&quot;: &quot;20652570897&quot;, &quot;key&quot;: &quot;project_genesis&quot;, &quot;layerId&quot;: &quot;20672300363&quot;, &quot;trafficAllocation&quot;: [{&quot;entityId&quot;: &quot;20667381018&quot;, &quot;endOfRange&quot;: 5000}, {&quot;entityId&quot;: &quot;20680930759&quot;, &quot;endOfRange&quot;: 10000}], &quot;forcedVariations&quot;: {&quot;83356e17066d336d1803024138ecb683&quot;: &quot;treatment&quot;, &quot;18e31c8a9b2271332466133162a4aa0d&quot;: &quot;treatment&quot;, &quot;10f8ab3fbc5ebe989a36a05f79d48f32&quot;: &quot;treatment&quot;, &quot;1686089f6d540cd2deeaec60ee43ecf7&quot;: &quot;treatment&quot;}}, {&quot;status&quot;: &quot;Running&quot;, &quot;audienceIds&quot;: [], &quot;variations&quot;: [{&quot;variables&quot;: [], &quot;id&quot;: &quot;20898546114&quot;, &quot;key&quot;: &quot;control&quot;}, {&quot;variables&quot;: [], &quot;id&quot;: &quot;20923036705&quot;, &quot;key&quot;: &quot;treatment_a&quot;}, {&quot;variables&quot;: [], &quot;id&quot;: &quot;20965581308&quot;, &quot;key&quot;: &quot;treatment_b&quot;}], &quot;id&quot;: &quot;20902325119&quot;, &quot;key&quot;: &quot;contact_sales_page_optimizations&quot;, &quot;layerId&quot;: &quot;20969031091&quot;, &quot;trafficAllocation&quot;: [{&quot;entityId&quot;: &quot;20965581308&quot;, &quot;endOfRange&quot;: 3330}, {&quot;entityId&quot;: &quot;20965581308&quot;, &quot;endOfRange&quot;: 5000}, {&quot;entityId&quot;: &quot;20965581308&quot;, &quot;endOfRange&quot;: 6670}, {&quot;entityId&quot;: &quot;20965581308&quot;, &quot;endOfRange&quot;: 10000}], &quot;forcedVariations&quot;: {}}], &quot;audiences&quot;: [{&quot;conditions&quot;: &quot;[\&quot;or\&quot;, {\&quot;match\&quot;: \&quot;exact\&quot;, \&quot;name\&quot;: \&quot;$opt_dummy_attribute\&quot;, \&quot;type\&quot;: \&quot;custom_attribute\&quot;, \&quot;value\&quot;: \&quot;$opt_dummy_value\&quot;}]&quot;, &quot;id&quot;: &quot;$opt_dummy_audience&quot;, &quot;name&quot;: &quot;Optimizely-Generated Audience for Backwards Compatibility&quot;}], &quot;groups&quot;: [], &quot;sdkKey&quot;: &quot;WTc6awnGuYDdG98CYRban&quot;, &quot;environmentKey&quot;: &quot;production&quot;, &quot;attributes&quot;: [{&quot;id&quot;: &quot;16822470375&quot;, &quot;key&quot;: &quot;user_id&quot;}, {&quot;id&quot;: &quot;17143601254&quot;, &quot;key&quot;: &quot;spammy&quot;}, {&quot;id&quot;: &quot;18175660309&quot;, &quot;key&quot;: &quot;organization_plan&quot;}, {&quot;id&quot;: &quot;18813001570&quot;, &quot;key&quot;: &quot;is_logged_in&quot;}, {&quot;id&quot;: &quot;19073851829&quot;, &quot;key&quot;: &quot;geo&quot;}, {&quot;id&quot;: &quot;20175462351&quot;, &quot;key&quot;: &quot;requestedCurrency&quot;}, {&quot;id&quot;: &quot;20785470195&quot;, &quot;key&quot;: &quot;country_code&quot;}], &quot;botFiltering&quot;: false, &quot;accountId&quot;: &quot;16737760170&quot;, &quot;events&quot;: [{&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;17911811441&quot;, &quot;key&quot;: &quot;hydro_click.dashboard.teacher_toolbox_cta&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;18124116703&quot;, &quot;key&quot;: &quot;submit.organizations.complete_sign_up&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;18145892387&quot;, &quot;key&quot;: &quot;no_metric.tracked_outside_of_optimizely&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;18178755568&quot;, &quot;key&quot;: &quot;click.org_onboarding_checklist.add_repo&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;18180553241&quot;, &quot;key&quot;: &quot;submit.repository_imports.create&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;18186103728&quot;, &quot;key&quot;: &quot;click.help.learn_more_about_repository_creation&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;18188530140&quot;, &quot;key&quot;: &quot;test_event&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;18191963644&quot;, &quot;key&quot;: &quot;click.empty_org_repo_cta.transfer_repository&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;18195612788&quot;, &quot;key&quot;: &quot;click.empty_org_repo_cta.import_repository&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;18210945499&quot;, &quot;key&quot;: &quot;click.org_onboarding_checklist.invite_members&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;18211063248&quot;, &quot;key&quot;: &quot;click.empty_org_repo_cta.create_repository&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;18215721889&quot;, &quot;key&quot;: &quot;click.org_onboarding_checklist.update_profile&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;18224360785&quot;, &quot;key&quot;: &quot;click.org_onboarding_checklist.dismiss&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;18234832286&quot;, &quot;key&quot;: &quot;submit.organization_activation.complete&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;18252392383&quot;, &quot;key&quot;: &quot;submit.org_repository.create&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;18257551537&quot;, &quot;key&quot;: &quot;submit.org_member_invitation.create&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;18259522260&quot;, &quot;key&quot;: &quot;submit.organization_profile.update&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;18564603625&quot;, &quot;key&quot;: &quot;view.classroom_select_organization&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;18568612016&quot;, &quot;key&quot;: &quot;click.classroom_sign_in_click&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;18572592540&quot;, &quot;key&quot;: &quot;view.classroom_name&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;18574203855&quot;, &quot;key&quot;: &quot;click.classroom_create_organization&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;18582053415&quot;, &quot;key&quot;: &quot;click.classroom_select_organization&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;18589463420&quot;, &quot;key&quot;: &quot;click.classroom_create_classroom&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;18591323364&quot;, &quot;key&quot;: &quot;click.classroom_create_first_classroom&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;18591652321&quot;, &quot;key&quot;: &quot;click.classroom_grant_access&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;18607131425&quot;, &quot;key&quot;: &quot;view.classroom_creation&quot;}, {&quot;experimentIds&quot;: [&quot;20479227424&quot;], &quot;id&quot;: &quot;18831680583&quot;, &quot;key&quot;: &quot;upgrade_account_plan&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;19064064515&quot;, &quot;key&quot;: &quot;click.signup&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;19075373687&quot;, &quot;key&quot;: &quot;click.view_account_billing_page&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;19077355841&quot;, &quot;key&quot;: &quot;click.dismiss_signup_prompt&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;19079713938&quot;, &quot;key&quot;: &quot;click.contact_sales&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;19120963070&quot;, &quot;key&quot;: &quot;click.compare_account_plans&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;19151690317&quot;, &quot;key&quot;: &quot;click.upgrade_account_cta&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;19424193129&quot;, &quot;key&quot;: &quot;click.open_account_switcher&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;19520330825&quot;, &quot;key&quot;: &quot;click.visit_account_profile&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;19540970635&quot;, &quot;key&quot;: &quot;click.switch_account_context&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;19730198868&quot;, &quot;key&quot;: &quot;submit.homepage_signup&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;19820830627&quot;, &quot;key&quot;: &quot;click.homepage_signup&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;19988571001&quot;, &quot;key&quot;: &quot;click.create_enterprise_trial&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;20036538294&quot;, &quot;key&quot;: &quot;click.create_organization_team&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;20040653299&quot;, &quot;key&quot;: &quot;click.input_enterprise_trial_form&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;20062030003&quot;, &quot;key&quot;: &quot;click.continue_with_team&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;20068947153&quot;, &quot;key&quot;: &quot;click.create_organization_free&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;20086636658&quot;, &quot;key&quot;: &quot;click.signup_continue.username&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;20091648988&quot;, &quot;key&quot;: &quot;click.signup_continue.create_account&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;20103637615&quot;, &quot;key&quot;: &quot;click.signup_continue.email&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;20111574253&quot;, &quot;key&quot;: &quot;click.signup_continue.password&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;20120044111&quot;, &quot;key&quot;: &quot;view.pricing_page&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;20152062109&quot;, &quot;key&quot;: &quot;submit.create_account&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;20165800992&quot;, &quot;key&quot;: &quot;submit.upgrade_payment_form&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;20171520319&quot;, &quot;key&quot;: &quot;submit.create_organization&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;20222645674&quot;, &quot;key&quot;: &quot;click.recommended_plan_in_signup.discuss_your_needs&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;20227443657&quot;, &quot;key&quot;: &quot;submit.verify_primary_user_email&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;20234607160&quot;, &quot;key&quot;: &quot;click.recommended_plan_in_signup.try_enterprise&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;20238175784&quot;, &quot;key&quot;: &quot;click.recommended_plan_in_signup.team&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;20239847212&quot;, &quot;key&quot;: &quot;click.recommended_plan_in_signup.continue_free&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;20251097193&quot;, &quot;key&quot;: &quot;recommended_plan&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;20438619534&quot;, &quot;key&quot;: &quot;click.pricing_calculator.1_member&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;20456699683&quot;, &quot;key&quot;: &quot;click.pricing_calculator.15_members&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;20467868331&quot;, &quot;key&quot;: &quot;click.pricing_calculator.10_members&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;20476267432&quot;, &quot;key&quot;: &quot;click.trial_days_remaining&quot;}, {&quot;experimentIds&quot;: [&quot;20479227424&quot;], &quot;id&quot;: &quot;20476357660&quot;, &quot;key&quot;: &quot;click.discover_feature&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;20479287901&quot;, &quot;key&quot;: &quot;click.pricing_calculator.custom_members&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;20481107083&quot;, &quot;key&quot;: &quot;click.recommended_plan_in_signup.apply_teacher_benefits&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;20483089392&quot;, &quot;key&quot;: &quot;click.pricing_calculator.5_members&quot;}, {&quot;experimentIds&quot;: [&quot;20479227424&quot;, &quot;20652570897&quot;], &quot;id&quot;: &quot;20484283944&quot;, &quot;key&quot;: &quot;click.onboarding_task&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;20484996281&quot;, &quot;key&quot;: &quot;click.recommended_plan_in_signup.apply_student_benefits&quot;}, {&quot;experimentIds&quot;: [&quot;20479227424&quot;], &quot;id&quot;: &quot;20486713726&quot;, &quot;key&quot;: &quot;click.onboarding_task_breadcrumb&quot;}, {&quot;experimentIds&quot;: [&quot;20479227424&quot;], &quot;id&quot;: &quot;20490791319&quot;, &quot;key&quot;: &quot;click.upgrade_to_enterprise&quot;}, {&quot;experimentIds&quot;: [&quot;20479227424&quot;], &quot;id&quot;: &quot;20491786766&quot;, &quot;key&quot;: &quot;click.talk_to_us&quot;}, {&quot;experimentIds&quot;: [&quot;20479227424&quot;], &quot;id&quot;: &quot;20494144087&quot;, &quot;key&quot;: &quot;click.dismiss_enterprise_trial&quot;}, {&quot;experimentIds&quot;: [&quot;20479227424&quot;, &quot;20652570897&quot;], &quot;id&quot;: &quot;20499722759&quot;, &quot;key&quot;: &quot;completed_all_tasks&quot;}, {&quot;experimentIds&quot;: [&quot;20479227424&quot;, &quot;20652570897&quot;], &quot;id&quot;: &quot;20500710104&quot;, &quot;key&quot;: &quot;completed_onboarding_tasks&quot;}, {&quot;experimentIds&quot;: [&quot;20479227424&quot;], &quot;id&quot;: &quot;20513160672&quot;, &quot;key&quot;: &quot;click.read_doc&quot;}, {&quot;experimentIds&quot;: [&quot;20652570897&quot;], &quot;id&quot;: &quot;20516196762&quot;, &quot;key&quot;: &quot;actions_enabled&quot;}, {&quot;experimentIds&quot;: [&quot;20479227424&quot;], &quot;id&quot;: &quot;20518980986&quot;, &quot;key&quot;: &quot;click.dismiss_trial_banner&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;20535446721&quot;, &quot;key&quot;: &quot;click.issue_actions_prompt.dismiss_prompt&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;20557002247&quot;, &quot;key&quot;: &quot;click.issue_actions_prompt.setup_workflow&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;20595070227&quot;, &quot;key&quot;: &quot;click.pull_request_setup_workflow&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;20626600314&quot;, &quot;key&quot;: &quot;click.seats_input&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;20642310305&quot;, &quot;key&quot;: &quot;click.decrease_seats_number&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;20662990045&quot;, &quot;key&quot;: &quot;click.increase_seats_number&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;20679620969&quot;, &quot;key&quot;: &quot;click.public_product_roadmap&quot;}, {&quot;experimentIds&quot;: [&quot;20479227424&quot;], &quot;id&quot;: &quot;20761240940&quot;, &quot;key&quot;: &quot;click.dismiss_survey_banner&quot;}, {&quot;experimentIds&quot;: [&quot;20479227424&quot;], &quot;id&quot;: &quot;20767210721&quot;, &quot;key&quot;: &quot;click.take_survey&quot;}, {&quot;experimentIds&quot;: [&quot;20652570897&quot;], &quot;id&quot;: &quot;20795281201&quot;, &quot;key&quot;: &quot;click.archive_list&quot;}, {&quot;experimentIds&quot;: [&quot;20902325119&quot;], &quot;id&quot;: &quot;20966790249&quot;, &quot;key&quot;: &quot;contact_sales.submit&quot;}, {&quot;experimentIds&quot;: [&quot;20902325119&quot;], &quot;id&quot;: &quot;20996500333&quot;, &quot;key&quot;: &quot;contact_sales.existing_customer&quot;}, {&quot;experimentIds&quot;: [&quot;20902325119&quot;], &quot;id&quot;: &quot;20996890162&quot;, &quot;key&quot;: &quot;contact_sales.blank_message_field&quot;}, {&quot;experimentIds&quot;: [&quot;20902325119&quot;], &quot;id&quot;: &quot;21000470317&quot;, &quot;key&quot;: &quot;contact_sales.personal_email&quot;}, {&quot;experimentIds&quot;: [&quot;20902325119&quot;], &quot;id&quot;: &quot;21002790172&quot;, &quot;key&quot;: &quot;contact_sales.blank_phone_field&quot;}], &quot;revision&quot;: &quot;1096&quot;}" />


  <script crossorigin="anonymous" defer="defer" type="application/javascript" integrity="sha512-qkgfEY57hTU0/9FJxNzLO+BYc1/r4GjkeogfQfboCh2NFpb5ZKfgqhWSbi7eRVJyEL/CqKaIdFKUfh97t5h0QA==" src="https://github.githubassets.com/assets/runtime-aa481f118e7b.js"></script>
<script crossorigin="anonymous" defer="defer" type="application/javascript" integrity="sha512-32HPOwJkACFD9bjimEKNoj+NjB1UldIjZP5QxXOr6huISt7QYQxWwT23JQ1DoSy7hGfGRtDsthh0NmfzX3DyMg==" src="https://github.githubassets.com/assets/environment-df61cf3b0264.js"></script>
<script crossorigin="anonymous" defer="defer" type="application/javascript" integrity="sha512-rB/EVqzuiKzqcb6RaaDSx+i7s/HApAXhuINThOQOfSCzOsY0zTZf2Ba2GjECWMqWsDjDbJBMP23O6Lc83vygpg==" src="https://github.githubassets.com/assets/9048-ac1fc456acee.js"></script>
<script crossorigin="anonymous" defer="defer" type="application/javascript" integrity="sha512-HGeV9MtF7qlJk/b5sDswl5jAS3cfQncdrcrvwSIjS0FoGJanQ+P9873q4kkIRjiWs/98fqkXbbY/RoXHUCmSbA==" src="https://github.githubassets.com/assets/9758-1c6795f4cb45.js"></script>
<script crossorigin="anonymous" defer="defer" type="application/javascript" integrity="sha512-jjPr0ZAftDw2p5OPu0DRLB9f7B5l1lZmKij0neI7TQquIKCMD6ZZTVqZTYimRo6PPUyegWiGbJmygZsiwlS43g==" src="https://github.githubassets.com/assets/6038-8e33ebd1901f.js"></script>
<script crossorigin="anonymous" defer="defer" type="application/javascript" integrity="sha512-+u8TeLdruMiWvmBpQNA4PToUts/HCYj6PPiDiVyAnWqVJqwcf8AifE6ulyXVXn3kdRBkue6o8KUb0mhSbSakiw==" src="https://github.githubassets.com/assets/github-elements-faef1378b76b.js"></script>
<script crossorigin="anonymous" defer="defer" type="application/javascript" integrity="sha512-1CFZIk8lImt34iQUo/3HIFBe1+1Vd0IizOZfrPZ7Od05aERgFuD7//t9q+PGhke3mf3Orz3ZQS7RjS17NwONyQ==" src="https://github.githubassets.com/assets/element-registry-d42159224f25.js"></script>
<script crossorigin="anonymous" defer="defer" type="application/javascript" integrity="sha512-Qv2lL056rpQocE0oqgYds356Kr0VteNXu+I2H+xqjO5p0YJ7aBCngsWeS1IszuUIaiEmDoOp7umaTcXQ5P75+w==" src="https://github.githubassets.com/assets/762-42fda52f4e7a.js"></script>
<script crossorigin="anonymous" defer="defer" type="application/javascript" integrity="sha512-kyutNFnVyXNirOp6jgLzir/lHojSmZRtKkCvj/18DUnh7DOxXyxa1uE7JKsGnXyDFvyDXAz0P76liKUpyrl5+A==" src="https://github.githubassets.com/assets/8933-932bad3459d5.js"></script>
<script crossorigin="anonymous" defer="defer" type="application/javascript" integrity="sha512-WOGryZiEX4rxCv+yzuST7+eEDb+yYgZI0/JXge0gHDt36/QbHlCyIukOTeTEcV5Owb10K6CZPzYkyRZrCIAmKA==" src="https://github.githubassets.com/assets/52-58e1abc99884.js"></script>
<script crossorigin="anonymous" defer="defer" type="application/javascript" integrity="sha512-4LnNDBotTstM2Et+yZ2gqy7JvdmdSzxgBNgYXyMwcTBLSioeQ22M8v0V7Sj+TlUCJaPlk0kQjTwItcZ4NlMTXg==" src="https://github.githubassets.com/assets/7105-e0b9cd0c1a2d.js"></script>
<script crossorigin="anonymous" defer="defer" type="application/javascript" integrity="sha512-y0Ky7pWSieHl1aMPGzJ4HjAkahyiqC7ILqLq33fCkVXV/7s7AXm4y9vUMTjAsz4Kk6ASA3x/T/M67vaQUgmN3A==" src="https://github.githubassets.com/assets/2308-cb42b2ee9592.js"></script>
<script crossorigin="anonymous" defer="defer" type="application/javascript" integrity="sha512-UQioBOJDApdwFc+p3sk/gCC7/AeniZ1u/g98H/QeeqYiYg5fivFgpe4L1q1y2OO5VjnB/CC/JpOU38OR1zsrOg==" src="https://github.githubassets.com/assets/2662-5108a804e243.js"></script>
<script crossorigin="anonymous" defer="defer" type="application/javascript" integrity="sha512-s8ZmDpZrxT8b1b3xoPqoItmEV9dwiAYUuEMXY8O27eWNfzNxxCAgU355HQ+Mw2y5bqdyCI5T9LTfm9jKZBmFZQ==" src="https://github.githubassets.com/assets/9579-b3c6660e966b.js"></script>
<script crossorigin="anonymous" defer="defer" type="application/javascript" integrity="sha512-/1Z+khw7i2eXHZO7nOUu8YqEpGNyOuTkQ4jH3olyybtuvY74E1Vl1KtdVHpGEJtGX0j7Rp/WHtPW+34mp5m8iA==" src="https://github.githubassets.com/assets/1201-ff567e921c3b.js"></script>
<script crossorigin="anonymous" defer="defer" type="application/javascript" integrity="sha512-MdAQnAIjkk36D6nf7khPxr37ryAaxRMZNAN47p+kePGU+xMi8jjXwpUhGuPvKeGeGhdHgNzTF7BK+NdgMnn6+A==" src="https://github.githubassets.com/assets/9508-31d0109c0223.js"></script>
<script crossorigin="anonymous" defer="defer" type="application/javascript" integrity="sha512-d4G8CfA1nGLZ/x0iiKJ8KLjQdRINrecwBFPO3jrRjLlhGi85eXrns5d83iTh1MMZqX1YxWECCxYAKzlV0SO62A==" src="https://github.githubassets.com/assets/7595-7781bc09f035.js"></script>
<script crossorigin="anonymous" defer="defer" type="application/javascript" integrity="sha512-tUmB+1MiatT/pKPCcCrp0W072U5zchoa94IGcRebc9q+npwEnS8n4Gs/mIIsX+3IBydAMdFJBJvKOUAFHb3vnw==" src="https://github.githubassets.com/assets/behaviors-b54981fb5322.js"></script>
<script crossorigin="anonymous" defer="defer" type="application/javascript" integrity="sha512-vZv147xO15/NwrEoMon2Lor5F4tSROpvyfxSqmUkr5RguhmLN7dhL6WaqFtGe+MapYypxQgz3XTi8RdZKiEfQw==" src="https://github.githubassets.com/assets/1953-bd9bf5e3bc4e.js"></script>
<script crossorigin="anonymous" defer="defer" type="application/javascript" integrity="sha512-IaY3UJcRfqlIzwYLtDadcx3zVFiC2jDv0G0lBr3xiHBDdODgQupD26gSVjZc0edSMPJhkHT5v8EzX2uNmkHD1g==" src="https://github.githubassets.com/assets/notifications-global-21a637509711.js"></script>
<script crossorigin="anonymous" defer="defer" type="application/javascript" integrity="sha512-kNTLYzLf9OE8/Gw3vPbafw6pC1O0V4A6r70qDTTzAVfPUf9br533nwmwYJ/FEJzLiWq4Kj98y5o2Nfcs1Mxp8w==" src="https://github.githubassets.com/assets/2975-90d4cb6332df.js"></script>
<script crossorigin="anonymous" defer="defer" type="application/javascript" integrity="sha512-OUOcgpolKq37ix3n+1MwDJGSVqZ5IIrYLcN7g0nRm0CBKrddoXAAdpT7fjWWte/6GUgD35qZBcNNPiwcGaW8ZQ==" src="https://github.githubassets.com/assets/optimizely-39439c829a25.js"></script>
<script crossorigin="anonymous" defer="defer" type="application/javascript" integrity="sha512-xxAQo8UuHY7yQyM3UUNUUffL9a1iqePJ/et0uLTcIZ+nO/ensbzeT44PLq54Gxnc7kF2xwV6RsfkDWeRDLZaLQ==" src="https://github.githubassets.com/assets/7429-c71010a3c52e.js"></script>
<script crossorigin="anonymous" defer="defer" type="application/javascript" integrity="sha512-7tglo0ern9xE7zRfdh51LLnRSjQ3JfpX1t38tYICwiNrd+TNcSehyiDeFW+T5JAT9kqCLoTcAdsW3dbw4uydSg==" src="https://github.githubassets.com/assets/3578-eed825a347ab.js"></script>
<script crossorigin="anonymous" defer="defer" type="application/javascript" integrity="sha512-Sdwc3+z/WPKJn72KWAnQ6kRBxE5fePZR8idB0QDEAEFL8NGySe0iXZoVfKymgjPGcIWO3jv+wZ4PV1nptAg7ZA==" src="https://github.githubassets.com/assets/7460-49dc1cdfecff.js"></script>
<script crossorigin="anonymous" defer="defer" type="application/javascript" integrity="sha512-JVgWk1Zv08LwYW1JrEQguNIE/6hcdJQMfZGG/u2HUpNzl3znv2t8/7DzPkZ1a4S/0CABw/qdsSFJ+X3QSnNo0A==" src="https://github.githubassets.com/assets/5283-25581693566f.js"></script>
<script crossorigin="anonymous" defer="defer" type="application/javascript" integrity="sha512-9H6wcshr4rCQGX+2vY6/0dXQZLF8UifLVJEv1XsmUu1AGEJAOsM0JD0eYJdbz7A3i6uGxjt9ZMW1MDf/7vIyWw==" src="https://github.githubassets.com/assets/repositories-f47eb072c86b.js"></script>
<script crossorigin="anonymous" defer="defer" type="application/javascript" integrity="sha512-UmQ0f5IIecsS2u18MoEbBzH2rch0V51PGjI3354Th21Q7kfV4q8SEQokEcPOTT+xuZazv3jxoKCeMl8V+1SbcA==" src="https://github.githubassets.com/assets/diffs-5264347f9208.js"></script>
  

  <meta name="viewport" content="width=device-width">
  
  <title>petclinic-microservice-private/README.md at main · adursunoglu16/petclinic-microservice-private</title>
    <meta name="description" content="Contribute to adursunoglu16/petclinic-microservice-private development by creating an account on GitHub.">
    <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="GitHub">
  <link rel="fluid-icon" href="https://github.com/fluidicon.png" title="GitHub">
  <meta property="fb:app_id" content="1401488693436528">
  <meta name="apple-itunes-app" content="app-id=1477376905" />
    <meta name="twitter:image:src" content="https://opengraph.githubassets.com/3b9f9743d5fade0217f862301a0cd7e99ab3dca2fbc515ab36bec753f803995f/adursunoglu16/petclinic-microservice-private" /><meta name="twitter:site" content="@github" /><meta name="twitter:card" content="summary_large_image" /><meta name="twitter:title" content="petclinic-microservice-private/README.md at main · adursunoglu16/petclinic-microservice-private" /><meta name="twitter:description" content="Contribute to adursunoglu16/petclinic-microservice-private development by creating an account on GitHub." />
    <meta property="og:image" content="https://opengraph.githubassets.com/3b9f9743d5fade0217f862301a0cd7e99ab3dca2fbc515ab36bec753f803995f/adursunoglu16/petclinic-microservice-private" /><meta property="og:image:alt" content="Contribute to adursunoglu16/petclinic-microservice-private development by creating an account on GitHub." /><meta property="og:image:width" content="1200" /><meta property="og:image:height" content="600" /><meta property="og:site_name" content="GitHub" /><meta property="og:type" content="object" /><meta property="og:title" content="petclinic-microservice-private/README.md at main · adursunoglu16/petclinic-microservice-private" /><meta property="og:url" content="https://github.com/adursunoglu16/petclinic-microservice-private" /><meta property="og:description" content="Contribute to adursunoglu16/petclinic-microservice-private development by creating an account on GitHub." />
    



    

  <link rel="assets" href="https://github.githubassets.com/">
    <link rel="shared-web-socket" href="wss://alive.github.com/_sockets/u/90970136/ws?session=eyJ2IjoiVjMiLCJ1Ijo5MDk3MDEzNiwicyI6ODQ1NjgyMjUwLCJjIjoxNjY1OTM2MDE4LCJ0IjoxNjQ4MDM1NjI0fQ==--38dcf2e6e2f7e09502d2b8ac3a0a903c64cd1044299300a991b322563f772071" data-refresh-url="/_alive" data-session-id="ca2db9a20753ebc465752c039ad891da51a6b05a6e59ecce6afc424a4851ac59">
    <link rel="shared-web-socket-src" href="/assets-cdn/worker/socket-worker-dae024e51136.js">
  <link rel="sudo-modal" href="/sessions/sudo_modal">

  <meta name="request-id" content="8E88:069D:25D4102:28CBA4F:623B071E" data-pjax-transient="true" /><meta name="html-safe-nonce" content="874cd5c261b4905049b8483d8e92d871b426c390e40fc9d42377ac8c93e09528" data-pjax-transient="true" /><meta name="visitor-payload" content="eyJyZWZlcnJlciI6Imh0dHBzOi8vZ2l0aHViLmNvbS9hZHVyc3Vub2dsdTE2L3BldGNsaW5pYy1taWNyb3NlcnZpY2UtcHJpdmF0ZS90cmVlL21haW4vNTAzLW1pY3Jvc2VydmljZXMtY2ktY2QtcGlwZWxpbmUtd2l0aC1oZWxtIiwicmVxdWVzdF9pZCI6IjhFODg6MDY5RDoyNUQ0MTAyOjI4Q0JBNEY6NjIzQjA3MUUiLCJ2aXNpdG9yX2lkIjoiMjY2ODg0MzI3NDM3MjU5OTExOCIsInJlZ2lvbl9lZGdlIjoiZnJhIiwicmVnaW9uX3JlbmRlciI6ImlhZCJ9" data-pjax-transient="true" /><meta name="visitor-hmac" content="ac8a066b0a0a3346c11d05a5f5a4248c460d7b41c13b5caddb2c9aeec2e962fa" data-pjax-transient="true" />

    <meta name="hovercard-subject-tag" content="repository:465416313" data-pjax-transient>


  <meta name="github-keyboard-shortcuts" content="repository,source-code" data-pjax-transient="true" />

  

  <meta name="selected-link" value="repo_source" data-pjax-transient>

    <meta name="google-site-verification" content="c1kuD-K2HIVF635lypcsWPoD4kilo5-jA_wBFyT4uMY">
  <meta name="google-site-verification" content="KT5gs8h0wvaagLKAVWq8bbeNwnZZK1r1XQysX3xurLU">
  <meta name="google-site-verification" content="ZzhVyEFwb7w3e0-uOTltm8Jsck2F5StVihD0exw2fsA">
  <meta name="google-site-verification" content="GXs5KoUUkNCoaAZn7wPN-t01Pywp9M3sEjnt_3_ZWPc">

<meta name="octolytics-url" content="https://collector.github.com/github/collect" /><meta name="octolytics-actor-id" content="90970136" /><meta name="octolytics-actor-login" content="EmreYsrc" /><meta name="octolytics-actor-hash" content="449233b33926516aeb8717cc5645f07a797b2d90c1cf7eceb1ad0480c22af6a8" />

  <meta name="analytics-location" content="/&lt;user-name&gt;/&lt;repo-name&gt;/blob/show" data-pjax-transient="true" />

  




  

      <meta name="hostname" content="github.com">
    <meta name="user-login" content="EmreYsrc">


    <meta name="keyboard-shortcuts-preference" content="all">
    <script type="application/json" id="memex_keyboard_shortcuts_preference">"all"</script>

      <meta name="expected-hostname" content="github.com">

      <meta name="js-proxy-site-detection-payload" content="ZjYyYmMwZGM2YTI0YWNiODg1ZmVlMDdkMmMwYWZhNDdhOTU4YTM3ZGE3ZTAwNjBhMGZlNWUwMzEzZDZhZDJlZnx7InJlbW90ZV9hZGRyZXNzIjoiOTQuNTQuMzAuMTIiLCJyZXF1ZXN0X2lkIjoiOEU4ODowNjlEOjI1RDQxMDI6MjhDQkE0Rjo2MjNCMDcxRSIsInRpbWVzdGFtcCI6MTY0ODAzNTYyNCwiaG9zdCI6ImdpdGh1Yi5jb20ifQ==">

    <meta name="enabled-features" content="ACTIONS_CALLABLE_WORKFLOWS,MARKETPLACE_PENDING_INSTALLATIONS,PRESENCE_IDLE">


  <meta http-equiv="x-pjax-version" content="e42ed31cef6c914b94a52a5c4d513b951271ecc205f9467bcf9f8e8a4e2a49cb" data-turbo-track="reload">
  <meta http-equiv="x-pjax-csp-version" content="ad743a89372c421844ffcba4fd906096b07b7fd7c2a57617ff2d2f0fdf463e56" data-turbo-track="reload">
  <meta http-equiv="x-pjax-css-version" content="86d2d4ea10a220ddb623a8bb048d6dc4179303cad0c435c106140a1347c4628f" data-turbo-track="reload">
  <meta http-equiv="x-pjax-js-version" content="9e8b64d7562e08d840bf22ed941b2251cce95de98e767a68d31cff529555ba68" data-turbo-track="reload">
  

    
  <meta name="go-import" content="github.com/adursunoglu16/petclinic-microservice-private git https://github.com/adursunoglu16/petclinic-microservice-private.git">

  <meta name="octolytics-dimension-user_id" content="84190639" /><meta name="octolytics-dimension-user_login" content="adursunoglu16" /><meta name="octolytics-dimension-repository_id" content="465416313" /><meta name="octolytics-dimension-repository_nwo" content="adursunoglu16/petclinic-microservice-private" /><meta name="octolytics-dimension-repository_public" content="true" /><meta name="octolytics-dimension-repository_is_fork" content="false" /><meta name="octolytics-dimension-repository_network_root_id" content="465416313" /><meta name="octolytics-dimension-repository_network_root_nwo" content="adursunoglu16/petclinic-microservice-private" />



    <link rel="canonical" href="https://github.com/adursunoglu16/petclinic-microservice-private/blob/main/503-microservices-ci-cd-pipeline-with-helm/README.md" data-pjax-transient>


  <meta name="browser-stats-url" content="https://api.github.com/_private/browser/stats">

  <meta name="browser-errors-url" content="https://api.github.com/_private/browser/errors">

  <meta name="browser-optimizely-client-errors-url" content="https://api.github.com/_private/browser/optimizely_client/errors">

  <link rel="mask-icon" href="https://github.githubassets.com/pinned-octocat.svg" color="#000000">
  <link rel="alternate icon" class="js-site-favicon" type="image/png" href="https://github.githubassets.com/favicons/favicon.png">
  <link rel="icon" class="js-site-favicon" type="image/svg+xml" href="https://github.githubassets.com/favicons/favicon.svg">

<meta name="theme-color" content="#1e2327">
<meta name="color-scheme" content="light dark" />


  <link rel="manifest" href="/manifest.json" crossOrigin="use-credentials">

  </head>

  <body class="logged-in env-production page-responsive page-blob" style="word-wrap: break-word;">
    

    <div class="position-relative js-header-wrapper ">
      <a href="#start-of-content" class="p-3 color-bg-accent-emphasis color-fg-on-emphasis show-on-focus js-skip-to-content">Skip to content</a>
      <span data-view-component="true" class="progress-pjax-loader js-pjax-loader-bar Progress position-fixed width-full">
    <span style="width: 0%;" data-view-component="true" class="Progress-item progress-pjax-loader-bar left-0 top-0 color-bg-accent-emphasis"></span>
</span>      
      


        <script crossorigin="anonymous" defer="defer" type="application/javascript" integrity="sha512-+EkHyTyMKL4C3n8EfuoQu/99gJNPozXTtAfaYO3xdHa8BGJeiLMjZZpkxSJIn/oUN42hSKuLNGezsLNZSMWwqQ==" src="https://github.githubassets.com/assets/2403-f84907c93c8c.js"></script>
<script crossorigin="anonymous" defer="defer" type="application/javascript" integrity="sha512-9EJuJYdCh6MaxAhNcj0MpJh/fu33M4MaiAFNsiG9zES+EpCmDPotg257ZgEz5jaDI//MlhdKFq4i4JNMgoMY+A==" src="https://github.githubassets.com/assets/2243-f4426e258742.js"></script>
<script crossorigin="anonymous" defer="defer" type="application/javascript" integrity="sha512-cb0IVhqsSVJ4KicfGlV9sgVFhGklISyQ8I6C+XGo12qll/Yhy8kb2hESJmLdz4UZskMW4K9vfjkYxaa+Q/phEA==" src="https://github.githubassets.com/assets/7818-71bd08561aac.js"></script>
<script crossorigin="anonymous" defer="defer" type="application/javascript" integrity="sha512-hYj4NA24ytssbd1h0zme9H9zorv/QWIwQM+RwGGH733l9FIa54famzF/4dFU5t9g3I5FOZEMor3zTNxsxvJJBg==" src="https://github.githubassets.com/assets/command-palette-8588f8340db8.js"></script>

            <header class="Header js-details-container Details px-3 px-md-4 px-lg-5 flex-wrap flex-md-nowrap" role="banner" >
    <div class="Header-item mt-n1 mb-n1  d-none d-md-flex">
      <a
  class="Header-link "
  href="https://github.com/"
  data-hotkey="g d"
  aria-label="Homepage "
  data-turbo="false"
  data-analytics-event="{&quot;category&quot;:&quot;Header&quot;,&quot;action&quot;:&quot;go to dashboard&quot;,&quot;label&quot;:&quot;icon:logo&quot;}"
>
  <svg height="32" aria-hidden="true" viewBox="0 0 16 16" version="1.1" width="32" data-view-component="true" class="octicon octicon-mark-github v-align-middle">
    <path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path>
</svg>
</a>

    </div>

    <div class="Header-item d-md-none">
      <button aria-label="Toggle navigation" aria-expanded="false" type="button" data-view-component="true" class="Header-link js-details-target btn-link">  <svg aria-hidden="true" height="24" viewBox="0 0 16 16" version="1.1" width="24" data-view-component="true" class="octicon octicon-three-bars">
    <path fill-rule="evenodd" d="M1 2.75A.75.75 0 011.75 2h12.5a.75.75 0 110 1.5H1.75A.75.75 0 011 2.75zm0 5A.75.75 0 011.75 7h12.5a.75.75 0 110 1.5H1.75A.75.75 0 011 7.75zM1.75 12a.75.75 0 100 1.5h12.5a.75.75 0 100-1.5H1.75z"></path>
</svg>
</button>    </div>

    <div class="Header-item Header-item--full flex-column flex-md-row width-full flex-order-2 flex-md-order-none mr-0 mr-md-3 mt-3 mt-md-0 Details-content--hidden-not-important d-md-flex">
          



<div class="header-search flex-auto js-site-search position-relative flex-self-stretch flex-md-self-auto mb-3 mb-md-0 mr-0 mr-md-3 scoped-search site-scoped-search js-jump-to"
>
  <div class="position-relative">
    <!-- '"` --><!-- </textarea></xmp> --></option></form><form class="js-site-search-form" role="search" aria-label="Site" data-scope-type="Repository" data-scope-id="465416313" data-scoped-search-url="/adursunoglu16/petclinic-microservice-private/search" data-owner-scoped-search-url="/users/adursunoglu16/search" data-unscoped-search-url="/search" data-turbo="false" action="/adursunoglu16/petclinic-microservice-private/search" accept-charset="UTF-8" method="get">
      <label class="form-control input-sm header-search-wrapper p-0 js-chromeless-input-container header-search-wrapper-jump-to position-relative d-flex flex-justify-between flex-items-center">
        <input type="text"
          class="form-control input-sm header-search-input jump-to-field js-jump-to-field js-site-search-focus js-site-search-field is-clearable"
          data-hotkey=s,/
          name="q"
          data-test-selector="nav-search-input"
          placeholder="Search or jump to…"
          data-unscoped-placeholder="Search or jump to…"
          data-scoped-placeholder="Search or jump to…"
          autocapitalize="off"
          role="combobox"
          aria-haspopup="listbox"
          aria-expanded="false"
          aria-autocomplete="list"
          aria-controls="jump-to-results"
          aria-label="Search or jump to…"
          data-jump-to-suggestions-path="/_graphql/GetSuggestedNavigationDestinations"
          spellcheck="false"
          autocomplete="off"
        >
        <input type="hidden" value="-N1FFkEtkwlfGfFsppTplUoaSUoCiX6F62TXsoHe20J0GZxVUL7rG0KOClD9jO33OysbKyzToeGKsbJq8zDHDg" data-csrf="true" class="js-data-jump-to-suggestions-path-csrf" />
        <input type="hidden" class="js-site-search-type-field" name="type" >
            <svg xmlns="http://www.w3.org/2000/svg" width="22" height="20" aria-hidden="true" class="mr-1 header-search-key-slash"><path fill="none" stroke="#979A9C" opacity=".4" d="M3.5.5h12c1.7 0 3 1.3 3 3v13c0 1.7-1.3 3-3 3h-12c-1.7 0-3-1.3-3-3v-13c0-1.7 1.3-3 3-3z"></path><path fill="#979A9C" d="M11.8 6L8 15.1h-.9L10.8 6h1z"></path></svg>


          <div class="Box position-absolute overflow-hidden d-none jump-to-suggestions js-jump-to-suggestions-container">
            
<ul class="d-none js-jump-to-suggestions-template-container">
  

<li class="d-flex flex-justify-start flex-items-center p-0 f5 navigation-item js-navigation-item js-jump-to-suggestion" role="option">
  <a tabindex="-1" class="no-underline d-flex flex-auto flex-items-center jump-to-suggestions-path js-jump-to-suggestion-path js-navigation-open p-2" href="" data-item-type="suggestion">
    <div class="jump-to-octicon js-jump-to-octicon flex-shrink-0 mr-2 text-center d-none">
      <svg title="Repository" aria-label="Repository" role="img" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-repo js-jump-to-octicon-repo d-none flex-shrink-0">
    <path fill-rule="evenodd" d="M2 2.5A2.5 2.5 0 014.5 0h8.75a.75.75 0 01.75.75v12.5a.75.75 0 01-.75.75h-2.5a.75.75 0 110-1.5h1.75v-2h-8a1 1 0 00-.714 1.7.75.75 0 01-1.072 1.05A2.495 2.495 0 012 11.5v-9zm10.5-1V9h-8c-.356 0-.694.074-1 .208V2.5a1 1 0 011-1h8zM5 12.25v3.25a.25.25 0 00.4.2l1.45-1.087a.25.25 0 01.3 0L8.6 15.7a.25.25 0 00.4-.2v-3.25a.25.25 0 00-.25-.25h-3.5a.25.25 0 00-.25.25z"></path>
</svg>
      <svg title="Project" aria-label="Project" role="img" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-project js-jump-to-octicon-project d-none flex-shrink-0">
    <path fill-rule="evenodd" d="M1.75 0A1.75 1.75 0 000 1.75v12.5C0 15.216.784 16 1.75 16h12.5A1.75 1.75 0 0016 14.25V1.75A1.75 1.75 0 0014.25 0H1.75zM1.5 1.75a.25.25 0 01.25-.25h12.5a.25.25 0 01.25.25v12.5a.25.25 0 01-.25.25H1.75a.25.25 0 01-.25-.25V1.75zM11.75 3a.75.75 0 00-.75.75v7.5a.75.75 0 001.5 0v-7.5a.75.75 0 00-.75-.75zm-8.25.75a.75.75 0 011.5 0v5.5a.75.75 0 01-1.5 0v-5.5zM8 3a.75.75 0 00-.75.75v3.5a.75.75 0 001.5 0v-3.5A.75.75 0 008 3z"></path>
</svg>
      <svg title="Search" aria-label="Search" role="img" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-search js-jump-to-octicon-search d-none flex-shrink-0">
    <path fill-rule="evenodd" d="M11.5 7a4.499 4.499 0 11-8.998 0A4.499 4.499 0 0111.5 7zm-.82 4.74a6 6 0 111.06-1.06l3.04 3.04a.75.75 0 11-1.06 1.06l-3.04-3.04z"></path>
</svg>
    </div>

    <img class="avatar mr-2 flex-shrink-0 js-jump-to-suggestion-avatar d-none" alt="" aria-label="Team" src="" width="28" height="28">

    <div class="jump-to-suggestion-name js-jump-to-suggestion-name flex-auto overflow-hidden text-left no-wrap css-truncate css-truncate-target">
    </div>

    <div class="border rounded-2 flex-shrink-0 color-bg-subtle px-1 color-fg-muted ml-1 f6 d-none js-jump-to-badge-search">
      <span class="js-jump-to-badge-search-text-default d-none" aria-label="in this repository">
        In this repository
      </span>
      <span class="js-jump-to-badge-search-text-global d-none" aria-label="in all of GitHub">
        All GitHub
      </span>
      <span aria-hidden="true" class="d-inline-block ml-1 v-align-middle">↵</span>
    </div>

    <div aria-hidden="true" class="border rounded-2 flex-shrink-0 color-bg-subtle px-1 color-fg-muted ml-1 f6 d-none d-on-nav-focus js-jump-to-badge-jump">
      Jump to
      <span class="d-inline-block ml-1 v-align-middle">↵</span>
    </div>
  </a>
</li>

</ul>

<ul class="d-none js-jump-to-no-results-template-container">
  <li class="d-flex flex-justify-center flex-items-center f5 d-none js-jump-to-suggestion p-2">
    <span class="color-fg-muted">No suggested jump to results</span>
  </li>
</ul>

<ul id="jump-to-results" role="listbox" class="p-0 m-0 js-navigation-container jump-to-suggestions-results-container js-jump-to-suggestions-results-container">
  

<li class="d-flex flex-justify-start flex-items-center p-0 f5 navigation-item js-navigation-item js-jump-to-scoped-search d-none" role="option">
  <a tabindex="-1" class="no-underline d-flex flex-auto flex-items-center jump-to-suggestions-path js-jump-to-suggestion-path js-navigation-open p-2" href="" data-item-type="scoped_search">
    <div class="jump-to-octicon js-jump-to-octicon flex-shrink-0 mr-2 text-center d-none">
      <svg title="Repository" aria-label="Repository" role="img" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-repo js-jump-to-octicon-repo d-none flex-shrink-0">
    <path fill-rule="evenodd" d="M2 2.5A2.5 2.5 0 014.5 0h8.75a.75.75 0 01.75.75v12.5a.75.75 0 01-.75.75h-2.5a.75.75 0 110-1.5h1.75v-2h-8a1 1 0 00-.714 1.7.75.75 0 01-1.072 1.05A2.495 2.495 0 012 11.5v-9zm10.5-1V9h-8c-.356 0-.694.074-1 .208V2.5a1 1 0 011-1h8zM5 12.25v3.25a.25.25 0 00.4.2l1.45-1.087a.25.25 0 01.3 0L8.6 15.7a.25.25 0 00.4-.2v-3.25a.25.25 0 00-.25-.25h-3.5a.25.25 0 00-.25.25z"></path>
</svg>
      <svg title="Project" aria-label="Project" role="img" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-project js-jump-to-octicon-project d-none flex-shrink-0">
    <path fill-rule="evenodd" d="M1.75 0A1.75 1.75 0 000 1.75v12.5C0 15.216.784 16 1.75 16h12.5A1.75 1.75 0 0016 14.25V1.75A1.75 1.75 0 0014.25 0H1.75zM1.5 1.75a.25.25 0 01.25-.25h12.5a.25.25 0 01.25.25v12.5a.25.25 0 01-.25.25H1.75a.25.25 0 01-.25-.25V1.75zM11.75 3a.75.75 0 00-.75.75v7.5a.75.75 0 001.5 0v-7.5a.75.75 0 00-.75-.75zm-8.25.75a.75.75 0 011.5 0v5.5a.75.75 0 01-1.5 0v-5.5zM8 3a.75.75 0 00-.75.75v3.5a.75.75 0 001.5 0v-3.5A.75.75 0 008 3z"></path>
</svg>
      <svg title="Search" aria-label="Search" role="img" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-search js-jump-to-octicon-search d-none flex-shrink-0">
    <path fill-rule="evenodd" d="M11.5 7a4.499 4.499 0 11-8.998 0A4.499 4.499 0 0111.5 7zm-.82 4.74a6 6 0 111.06-1.06l3.04 3.04a.75.75 0 11-1.06 1.06l-3.04-3.04z"></path>
</svg>
    </div>

    <img class="avatar mr-2 flex-shrink-0 js-jump-to-suggestion-avatar d-none" alt="" aria-label="Team" src="" width="28" height="28">

    <div class="jump-to-suggestion-name js-jump-to-suggestion-name flex-auto overflow-hidden text-left no-wrap css-truncate css-truncate-target">
    </div>

    <div class="border rounded-2 flex-shrink-0 color-bg-subtle px-1 color-fg-muted ml-1 f6 d-none js-jump-to-badge-search">
      <span class="js-jump-to-badge-search-text-default d-none" aria-label="in this repository">
        In this repository
      </span>
      <span class="js-jump-to-badge-search-text-global d-none" aria-label="in all of GitHub">
        All GitHub
      </span>
      <span aria-hidden="true" class="d-inline-block ml-1 v-align-middle">↵</span>
    </div>

    <div aria-hidden="true" class="border rounded-2 flex-shrink-0 color-bg-subtle px-1 color-fg-muted ml-1 f6 d-none d-on-nav-focus js-jump-to-badge-jump">
      Jump to
      <span class="d-inline-block ml-1 v-align-middle">↵</span>
    </div>
  </a>
</li>

  

<li class="d-flex flex-justify-start flex-items-center p-0 f5 navigation-item js-navigation-item js-jump-to-owner-scoped-search d-none" role="option">
  <a tabindex="-1" class="no-underline d-flex flex-auto flex-items-center jump-to-suggestions-path js-jump-to-suggestion-path js-navigation-open p-2" href="" data-item-type="owner_scoped_search">
    <div class="jump-to-octicon js-jump-to-octicon flex-shrink-0 mr-2 text-center d-none">
      <svg title="Repository" aria-label="Repository" role="img" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-repo js-jump-to-octicon-repo d-none flex-shrink-0">
    <path fill-rule="evenodd" d="M2 2.5A2.5 2.5 0 014.5 0h8.75a.75.75 0 01.75.75v12.5a.75.75 0 01-.75.75h-2.5a.75.75 0 110-1.5h1.75v-2h-8a1 1 0 00-.714 1.7.75.75 0 01-1.072 1.05A2.495 2.495 0 012 11.5v-9zm10.5-1V9h-8c-.356 0-.694.074-1 .208V2.5a1 1 0 011-1h8zM5 12.25v3.25a.25.25 0 00.4.2l1.45-1.087a.25.25 0 01.3 0L8.6 15.7a.25.25 0 00.4-.2v-3.25a.25.25 0 00-.25-.25h-3.5a.25.25 0 00-.25.25z"></path>
</svg>
      <svg title="Project" aria-label="Project" role="img" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-project js-jump-to-octicon-project d-none flex-shrink-0">
    <path fill-rule="evenodd" d="M1.75 0A1.75 1.75 0 000 1.75v12.5C0 15.216.784 16 1.75 16h12.5A1.75 1.75 0 0016 14.25V1.75A1.75 1.75 0 0014.25 0H1.75zM1.5 1.75a.25.25 0 01.25-.25h12.5a.25.25 0 01.25.25v12.5a.25.25 0 01-.25.25H1.75a.25.25 0 01-.25-.25V1.75zM11.75 3a.75.75 0 00-.75.75v7.5a.75.75 0 001.5 0v-7.5a.75.75 0 00-.75-.75zm-8.25.75a.75.75 0 011.5 0v5.5a.75.75 0 01-1.5 0v-5.5zM8 3a.75.75 0 00-.75.75v3.5a.75.75 0 001.5 0v-3.5A.75.75 0 008 3z"></path>
</svg>
      <svg title="Search" aria-label="Search" role="img" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-search js-jump-to-octicon-search d-none flex-shrink-0">
    <path fill-rule="evenodd" d="M11.5 7a4.499 4.499 0 11-8.998 0A4.499 4.499 0 0111.5 7zm-.82 4.74a6 6 0 111.06-1.06l3.04 3.04a.75.75 0 11-1.06 1.06l-3.04-3.04z"></path>
</svg>
    </div>

    <img class="avatar mr-2 flex-shrink-0 js-jump-to-suggestion-avatar d-none" alt="" aria-label="Team" src="" width="28" height="28">

    <div class="jump-to-suggestion-name js-jump-to-suggestion-name flex-auto overflow-hidden text-left no-wrap css-truncate css-truncate-target">
    </div>

    <div class="border rounded-2 flex-shrink-0 color-bg-subtle px-1 color-fg-muted ml-1 f6 d-none js-jump-to-badge-search">
      <span class="js-jump-to-badge-search-text-default d-none" aria-label="in this user">
        In this user
      </span>
      <span class="js-jump-to-badge-search-text-global d-none" aria-label="in all of GitHub">
        All GitHub
      </span>
      <span aria-hidden="true" class="d-inline-block ml-1 v-align-middle">↵</span>
    </div>

    <div aria-hidden="true" class="border rounded-2 flex-shrink-0 color-bg-subtle px-1 color-fg-muted ml-1 f6 d-none d-on-nav-focus js-jump-to-badge-jump">
      Jump to
      <span class="d-inline-block ml-1 v-align-middle">↵</span>
    </div>
  </a>
</li>

  

<li class="d-flex flex-justify-start flex-items-center p-0 f5 navigation-item js-navigation-item js-jump-to-global-search d-none" role="option">
  <a tabindex="-1" class="no-underline d-flex flex-auto flex-items-center jump-to-suggestions-path js-jump-to-suggestion-path js-navigation-open p-2" href="" data-item-type="global_search">
    <div class="jump-to-octicon js-jump-to-octicon flex-shrink-0 mr-2 text-center d-none">
      <svg title="Repository" aria-label="Repository" role="img" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-repo js-jump-to-octicon-repo d-none flex-shrink-0">
    <path fill-rule="evenodd" d="M2 2.5A2.5 2.5 0 014.5 0h8.75a.75.75 0 01.75.75v12.5a.75.75 0 01-.75.75h-2.5a.75.75 0 110-1.5h1.75v-2h-8a1 1 0 00-.714 1.7.75.75 0 01-1.072 1.05A2.495 2.495 0 012 11.5v-9zm10.5-1V9h-8c-.356 0-.694.074-1 .208V2.5a1 1 0 011-1h8zM5 12.25v3.25a.25.25 0 00.4.2l1.45-1.087a.25.25 0 01.3 0L8.6 15.7a.25.25 0 00.4-.2v-3.25a.25.25 0 00-.25-.25h-3.5a.25.25 0 00-.25.25z"></path>
</svg>
      <svg title="Project" aria-label="Project" role="img" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-project js-jump-to-octicon-project d-none flex-shrink-0">
    <path fill-rule="evenodd" d="M1.75 0A1.75 1.75 0 000 1.75v12.5C0 15.216.784 16 1.75 16h12.5A1.75 1.75 0 0016 14.25V1.75A1.75 1.75 0 0014.25 0H1.75zM1.5 1.75a.25.25 0 01.25-.25h12.5a.25.25 0 01.25.25v12.5a.25.25 0 01-.25.25H1.75a.25.25 0 01-.25-.25V1.75zM11.75 3a.75.75 0 00-.75.75v7.5a.75.75 0 001.5 0v-7.5a.75.75 0 00-.75-.75zm-8.25.75a.75.75 0 011.5 0v5.5a.75.75 0 01-1.5 0v-5.5zM8 3a.75.75 0 00-.75.75v3.5a.75.75 0 001.5 0v-3.5A.75.75 0 008 3z"></path>
</svg>
      <svg title="Search" aria-label="Search" role="img" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-search js-jump-to-octicon-search d-none flex-shrink-0">
    <path fill-rule="evenodd" d="M11.5 7a4.499 4.499 0 11-8.998 0A4.499 4.499 0 0111.5 7zm-.82 4.74a6 6 0 111.06-1.06l3.04 3.04a.75.75 0 11-1.06 1.06l-3.04-3.04z"></path>
</svg>
    </div>

    <img class="avatar mr-2 flex-shrink-0 js-jump-to-suggestion-avatar d-none" alt="" aria-label="Team" src="" width="28" height="28">

    <div class="jump-to-suggestion-name js-jump-to-suggestion-name flex-auto overflow-hidden text-left no-wrap css-truncate css-truncate-target">
    </div>

    <div class="border rounded-2 flex-shrink-0 color-bg-subtle px-1 color-fg-muted ml-1 f6 d-none js-jump-to-badge-search">
      <span class="js-jump-to-badge-search-text-default d-none" aria-label="in this repository">
        In this repository
      </span>
      <span class="js-jump-to-badge-search-text-global d-none" aria-label="in all of GitHub">
        All GitHub
      </span>
      <span aria-hidden="true" class="d-inline-block ml-1 v-align-middle">↵</span>
    </div>

    <div aria-hidden="true" class="border rounded-2 flex-shrink-0 color-bg-subtle px-1 color-fg-muted ml-1 f6 d-none d-on-nav-focus js-jump-to-badge-jump">
      Jump to
      <span class="d-inline-block ml-1 v-align-middle">↵</span>
    </div>
  </a>
</li>


    <li class="d-flex flex-justify-center flex-items-center p-0 f5 js-jump-to-suggestion">
      <svg style="box-sizing: content-box; color: var(--color-icon-primary);" width="32" height="32" viewBox="0 0 16 16" fill="none" data-view-component="true" class="m-3 anim-rotate">
  <circle cx="8" cy="8" r="7" stroke="currentColor" stroke-opacity="0.25" stroke-width="2" vector-effect="non-scaling-stroke" />
  <path d="M15 8a7.002 7.002 0 00-7-7" stroke="currentColor" stroke-width="2" stroke-linecap="round" vector-effect="non-scaling-stroke" />
</svg>
    </li>
</ul>

          </div>
      </label>
</form>  </div>
</div>

        <nav class="d-flex flex-column flex-md-row flex-self-stretch flex-md-self-auto" aria-label="Global">
      <a class="Header-link py-md-3 d-block d-md-none py-2 border-top border-md-top-0 border-white-fade" data-ga-click="Header, click, Nav menu - item:dashboard:user" aria-label="Dashboard" data-turbo="false" href="/dashboard">Dashboard</a>

    <a class="js-selected-navigation-item Header-link mt-md-n3 mb-md-n3 py-2 py-md-3 mr-0 mr-md-3 border-top border-md-top-0 border-white-fade" data-hotkey="g p" data-ga-click="Header, click, Nav menu - item:pulls context:user" aria-label="Pull requests you created" data-turbo="false" data-selected-links="/pulls /pulls/assigned /pulls/mentioned /pulls" href="/pulls">
        Pull<span class="d-inline d-md-none d-lg-inline"> request</span>s
</a>
    <a class="js-selected-navigation-item Header-link mt-md-n3 mb-md-n3 py-2 py-md-3 mr-0 mr-md-3 border-top border-md-top-0 border-white-fade" data-hotkey="g i" data-ga-click="Header, click, Nav menu - item:issues context:user" aria-label="Issues you created" data-turbo="false" data-selected-links="/issues /issues/assigned /issues/mentioned /issues" href="/issues">Issues</a>

      <div class="d-flex position-relative">
        <a class="js-selected-navigation-item Header-link flex-auto mt-md-n3 mb-md-n3 py-2 py-md-3 mr-0 mr-md-3 border-top border-md-top-0 border-white-fade" data-ga-click="Header, click, Nav menu - item:marketplace context:user" data-octo-click="marketplace_click" data-octo-dimensions="location:nav_bar" data-turbo="false" data-selected-links=" /marketplace" href="/marketplace">Marketplace</a>
      </div>

    <a class="js-selected-navigation-item Header-link mt-md-n3 mb-md-n3 py-2 py-md-3 mr-0 mr-md-3 border-top border-md-top-0 border-white-fade" data-ga-click="Header, click, Nav menu - item:explore" data-turbo="false" data-selected-links="/explore /trending /trending/developers /integrations /integrations/feature/code /integrations/feature/collaborate /integrations/feature/ship showcases showcases_search showcases_landing /explore" href="/explore">Explore</a>

    <a class="js-selected-navigation-item Header-link d-block d-md-none py-2 py-md-3 border-top border-md-top-0 border-white-fade" data-ga-click="Header, click, Nav menu - item:workspaces context:user" data-turbo="false" data-selected-links="/codespaces /codespaces" href="/codespaces">Codespaces</a>

      <a class="js-selected-navigation-item Header-link d-block d-md-none py-2 py-md-3 border-top border-md-top-0 border-white-fade" data-ga-click="Header, click, Nav menu - item:Sponsors" data-hydro-click="{&quot;event_type&quot;:&quot;sponsors.button_click&quot;,&quot;payload&quot;:{&quot;button&quot;:&quot;HEADER_SPONSORS_DASHBOARD&quot;,&quot;sponsorable_login&quot;:&quot;EmreYsrc&quot;,&quot;originating_url&quot;:&quot;https://github.com/adursunoglu16/petclinic-microservice-private/blob/main/503-microservices-ci-cd-pipeline-with-helm/README.md&quot;,&quot;user_id&quot;:90970136}}" data-hydro-click-hmac="a6e4b5d7964f473f9863dfdbc3a6b7b38824fa60beb05483f45bb6d673f6e5e9" data-turbo="false" data-selected-links=" /sponsors/accounts" href="/sponsors/accounts">Sponsors</a>

    <a class="Header-link d-block d-md-none mr-0 mr-md-3 py-2 py-md-3 border-top border-md-top-0 border-white-fade" data-turbo="false" href="/settings/profile">Settings</a>

    <a class="Header-link d-block d-md-none mr-0 mr-md-3 py-2 py-md-3 border-top border-md-top-0 border-white-fade" data-turbo="false" href="/EmreYsrc">
      <img class="avatar avatar-user" loading="lazy" decoding="async" src="https://avatars.githubusercontent.com/u/90970136?s=40&amp;v=4" width="20" height="20" alt="@EmreYsrc" />
      EmreYsrc
</a>
    <!-- '"` --><!-- </textarea></xmp> --></option></form><form data-turbo="false" action="/logout" accept-charset="UTF-8" method="post"><input type="hidden" name="authenticity_token" value="khUAFymfBmxPAKkjG1IZCbKmmgdS5jU9dXNqEpu2pP8Y7KayxQBaGmi9WmXHeK6oe2um2YvEtgzirZ37mEnwdw" />
      <button
        type="submit"
        class="Header-link mr-0 mr-md-3 py-2 py-md-3 border-top border-md-top-0 border-white-fade d-md-none btn-link d-block width-full text-left"
        style="padding-left: 2px;"
        data-analytics-event="{&quot;category&quot;:&quot;Header&quot;,&quot;action&quot;:&quot;sign out&quot;,&quot;label&quot;:&quot;icon:logout&quot;}"
      >
        <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-sign-out v-align-middle">
    <path fill-rule="evenodd" d="M2 2.75C2 1.784 2.784 1 3.75 1h2.5a.75.75 0 010 1.5h-2.5a.25.25 0 00-.25.25v10.5c0 .138.112.25.25.25h2.5a.75.75 0 010 1.5h-2.5A1.75 1.75 0 012 13.25V2.75zm10.44 4.5H6.75a.75.75 0 000 1.5h5.69l-1.97 1.97a.75.75 0 101.06 1.06l3.25-3.25a.75.75 0 000-1.06l-3.25-3.25a.75.75 0 10-1.06 1.06l1.97 1.97z"></path>
</svg>
        Sign out
      </button>
</form></nav>

    </div>

    <div class="Header-item Header-item--full flex-justify-center d-md-none position-relative">
        <a
  class="Header-link "
  href="https://github.com/"
  data-hotkey="g d"
  aria-label="Homepage "
  data-turbo="false"
  data-analytics-event="{&quot;category&quot;:&quot;Header&quot;,&quot;action&quot;:&quot;go to dashboard&quot;,&quot;label&quot;:&quot;icon:logo&quot;}"
>
  <svg height="32" aria-hidden="true" viewBox="0 0 16 16" version="1.1" width="32" data-view-component="true" class="octicon octicon-mark-github v-align-middle">
    <path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path>
</svg>
</a>

    </div>

    <div class="Header-item mr-0 mr-md-3 flex-order-1 flex-md-order-none">
        


      <notification-indicator
        class="js-socket-channel"
        data-test-selector="notifications-indicator"
        data-channel="eyJjIjoibm90aWZpY2F0aW9uLWNoYW5nZWQ6OTA5NzAxMzYiLCJ0IjoxNjQ4MDM1NjI0fQ==--3245b0749a7d7a9d862686d6b848bb8808ad43153a3de024cef0c8907afe6b31">
        <a href="/notifications"
          data-turbo=false
          class="Header-link notification-indicator position-relative tooltipped tooltipped-sw"
          
          aria-label="You have no unread notifications"
          data-hotkey="g n"
          data-ga-click="Header, go to notifications, icon:read"
          data-target="notification-indicator.link">
          <span class="mail-status  " data-target="notification-indicator.modifier"></span>
          <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-bell">
    <path d="M8 16a2 2 0 001.985-1.75c.017-.137-.097-.25-.235-.25h-3.5c-.138 0-.252.113-.235.25A2 2 0 008 16z"></path><path fill-rule="evenodd" d="M8 1.5A3.5 3.5 0 004.5 5v2.947c0 .346-.102.683-.294.97l-1.703 2.556a.018.018 0 00-.003.01l.001.006c0 .002.002.004.004.006a.017.017 0 00.006.004l.007.001h10.964l.007-.001a.016.016 0 00.006-.004.016.016 0 00.004-.006l.001-.007a.017.017 0 00-.003-.01l-1.703-2.554a1.75 1.75 0 01-.294-.97V5A3.5 3.5 0 008 1.5zM3 5a5 5 0 0110 0v2.947c0 .05.015.098.042.139l1.703 2.555A1.518 1.518 0 0113.482 13H2.518a1.518 1.518 0 01-1.263-2.36l1.703-2.554A.25.25 0 003 7.947V5z"></path>
</svg>
        </a>
      </notification-indicator>

    </div>


    <div class="Header-item position-relative d-none d-md-flex">
        <details class="details-overlay details-reset">
  <summary
    class="Header-link"
    aria-label="Create new…"
    data-analytics-event="{&quot;category&quot;:&quot;Header&quot;,&quot;action&quot;:&quot;create new&quot;,&quot;label&quot;:&quot;icon:add&quot;}"
  >
      <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-plus">
    <path fill-rule="evenodd" d="M7.75 2a.75.75 0 01.75.75V7h4.25a.75.75 0 110 1.5H8.5v4.25a.75.75 0 11-1.5 0V8.5H2.75a.75.75 0 010-1.5H7V2.75A.75.75 0 017.75 2z"></path>
</svg> <span class="dropdown-caret"></span>
  </summary>
  <details-menu class="dropdown-menu dropdown-menu-sw">
    
<a role="menuitem" class="dropdown-item" href="/new" data-ga-click="Header, create new repository">
  New repository
</a>

  <a role="menuitem" class="dropdown-item" href="/new/import" data-ga-click="Header, import a repository">
    Import repository
  </a>

<a role="menuitem" class="dropdown-item" href="https://gist.github.com/" data-ga-click="Header, create new gist">
  New gist
</a>

  <a role="menuitem" class="dropdown-item" href="/organizations/new" data-ga-click="Header, create new organization">
    New organization
  </a>



  </details-menu>
</details>

    </div>

    <div class="Header-item position-relative mr-0 d-none d-md-flex">
        
  <details class="details-overlay details-reset js-feature-preview-indicator-container" data-feature-preview-indicator-src="/users/EmreYsrc/feature_preview/indicator_check">

  <summary
    class="Header-link"
    aria-label="View profile and more"
    data-analytics-event="{&quot;category&quot;:&quot;Header&quot;,&quot;action&quot;:&quot;show menu&quot;,&quot;label&quot;:&quot;icon:avatar&quot;}"
  >
    <img src="https://avatars.githubusercontent.com/u/90970136?s=40&amp;v=4" alt="@EmreYsrc" size="20" height="20" width="20" data-view-component="true" class="avatar avatar-small circle" />
      <span class="feature-preview-indicator js-feature-preview-indicator" style="top: 1px;" hidden></span>
    <span class="dropdown-caret"></span>
  </summary>
  <details-menu
      class="dropdown-menu dropdown-menu-sw"
      style="width: 180px"
      
      preload>
      <include-fragment src="/users/90970136/menu" loading="lazy">
        <p class="text-center mt-3" data-hide-on-error>
          <svg style="box-sizing: content-box; color: var(--color-icon-primary);" width="32" height="32" viewBox="0 0 16 16" fill="none" data-view-component="true" class="anim-rotate">
  <circle cx="8" cy="8" r="7" stroke="currentColor" stroke-opacity="0.25" stroke-width="2" vector-effect="non-scaling-stroke" />
  <path d="M15 8a7.002 7.002 0 00-7-7" stroke="currentColor" stroke-width="2" stroke-linecap="round" vector-effect="non-scaling-stroke" />
</svg>
        </p>
        <p class="ml-1 mb-2 mt-2 color-fg-default" data-show-on-error>
          <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-alert">
    <path fill-rule="evenodd" d="M8.22 1.754a.25.25 0 00-.44 0L1.698 13.132a.25.25 0 00.22.368h12.164a.25.25 0 00.22-.368L8.22 1.754zm-1.763-.707c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0114.082 15H1.918a1.75 1.75 0 01-1.543-2.575L6.457 1.047zM9 11a1 1 0 11-2 0 1 1 0 012 0zm-.25-5.25a.75.75 0 00-1.5 0v2.5a.75.75 0 001.5 0v-2.5z"></path>
</svg>
          Sorry, something went wrong.
        </p>
      </include-fragment>
  </details-menu>
</details>

    </div>
</header>

            
    </div>

  <div id="start-of-content" class="show-on-focus"></div>







    <div data-pjax-replace id="js-flash-container">


  <template class="js-flash-template">
    <div class="flash flash-full  {{ className }}">
  <div class="px-2" >
    <button class="flash-close js-flash-close" type="button" aria-label="Dismiss this message">
      <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-x">
    <path fill-rule="evenodd" d="M3.72 3.72a.75.75 0 011.06 0L8 6.94l3.22-3.22a.75.75 0 111.06 1.06L9.06 8l3.22 3.22a.75.75 0 11-1.06 1.06L8 9.06l-3.22 3.22a.75.75 0 01-1.06-1.06L6.94 8 3.72 4.78a.75.75 0 010-1.06z"></path>
</svg>
    </button>
    
      <div>{{ message }}</div>

  </div>
</div>
  </template>
</div>


    

  <include-fragment class="js-notification-shelf-include-fragment" data-base-src="https://github.com/notifications/beta/shelf"></include-fragment>




      <details class="details-reset details-overlay details-overlay-dark js-command-palette-dialog">
  <summary class="command-palette-details-summary" aria-label="command palette trigger">
  </summary>
  <details-dialog class="command-palette-details-dialog d-flex flex-column flex-justify-center height-fit" aria-label="command palette">
    <command-palette
      class="command-palette color-bg-default rounded-3 border color-shadow-small"
      data-return-to=/adursunoglu16/petclinic-microservice-private/blob/main/503-microservices-ci-cd-pipeline-with-helm/README.md
      data-user-id="90970136"
      data-activation-hotkey="Mod+k,Mod+Alt+k"
      data-command-mode-hotkey="Mod+Shift+k"
        data-action="
          keydown:command-palette#onKeydown
          loadingStateChanged:command-palette#loadingStateChanged
          selectedItemChanged:command-palette#selectedItemChanged
        "
      >


      <input type="hidden" name="color-mode-path" id="color-mode-path" value="/settings/appearance/color_mode" class="js-color-mode-path" autocomplete="off" />
      <input type="hidden" value="8uuhcYyf1Dv2puF_VWUS6R-jkXUGR_HcFAUd77fSzEruyTaCBQ0uOi2Yi_ox5iaHTUiTbjSy5QGFTvAq9DHPfg" data-csrf="true" class="js-color-mode-csrf" />

        <command-palette-mode
          data-char="#"
            data-scope-types="[&quot;&quot;]"
            data-placeholder="Search issues and pull requests"
        ></command-palette-mode>
        <command-palette-mode
          data-char="#"
            data-scope-types="[&quot;owner&quot;,&quot;repository&quot;]"
            data-placeholder="Search issues, pull requests, discussions, and projects"
        ></command-palette-mode>
        <command-palette-mode
          data-char="!"
            data-scope-types="[&quot;owner&quot;,&quot;repository&quot;]"
            data-placeholder="Search projects"
        ></command-palette-mode>
        <command-palette-mode
          data-char="@"
            data-scope-types="[&quot;&quot;]"
            data-placeholder="Search or jump to a user, organization, or repository"
        ></command-palette-mode>
        <command-palette-mode
          data-char="@"
            data-scope-types="[&quot;owner&quot;]"
            data-placeholder="Search or jump to a repository"
        ></command-palette-mode>
        <command-palette-mode
          data-char="/"
            data-scope-types="[&quot;repository&quot;]"
            data-placeholder="Search files"
        ></command-palette-mode>
        <command-palette-mode
          data-char="?"
        ></command-palette-mode>
        <command-palette-mode
          data-char="&gt;"
            data-placeholder="Run a command"
        ></command-palette-mode>
        <command-palette-mode
          data-char=""
            data-scope-types="[&quot;owner&quot;]"
            data-placeholder="Search or jump to..."
        ></command-palette-mode>
      <command-palette-mode
        class="js-command-palette-default-mode"
        data-char=""
        data-placeholder="Search or jump to..."
      ></command-palette-mode>

      <command-palette-input placeholder="Search or jump to..."
        data-action="
          command-palette-input:command-palette#onInput
          command-palette-select:command-palette#onSelect
          command-palette-descope:command-palette#onDescope
          command-palette-cleared:command-palette#onInputClear
        "
      >
        <div class="js-search-icon d-flex flex-items-center mr-2" style="height: 26px">
          <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-search color-fg-muted">
    <path fill-rule="evenodd" d="M11.5 7a4.499 4.499 0 11-8.998 0A4.499 4.499 0 0111.5 7zm-.82 4.74a6 6 0 111.06-1.06l3.04 3.04a.75.75 0 11-1.06 1.06l-3.04-3.04z"></path>
</svg>
        </div>
        <div class="js-spinner d-flex flex-items-center mr-2 color-fg-muted" hidden>
          <svg aria-label="Loading" class="anim-rotate" viewBox="0 0 16 16" fill="none" width="16" height="16">
            <circle
              cx="8"
              cy="8"
              r="7"
              stroke="currentColor"
              stroke-opacity="0.25"
              stroke-width="2"
              vector-effect="non-scaling-stroke"
            ></circle>
            <path
              d="M15 8a7.002 7.002 0 00-7-7"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              vector-effect="non-scaling-stroke"
            ></path>
          </svg>
        </div>
        <command-palette-scope >
          <div data-target="command-palette-scope.placeholder" hidden class="color-fg-subtle">/&nbsp;&nbsp;<span class="text-semibold color-fg-default">...</span>&nbsp;&nbsp;/&nbsp;&nbsp;</div>
              <command-palette-token
                data-text="adursunoglu16"
                data-id="MDQ6VXNlcjg0MTkwNjM5"
                data-type="owner"
                data-value="adursunoglu16"
                data-targets="command-palette-scope.tokens"
                class="color-fg-default text-semibold"
                style="white-space:nowrap;line-height:20px;"
                >adursunoglu16<span class="color-fg-subtle text-normal">&nbsp;&nbsp;/&nbsp;&nbsp;</span></command-palette-token>
              <command-palette-token
                data-text="petclinic-microservice-private"
                data-id="R_kgDOG72weQ"
                data-type="repository"
                data-value="petclinic-microservice-private"
                data-targets="command-palette-scope.tokens"
                class="color-fg-default text-semibold"
                style="white-space:nowrap;line-height:20px;"
                >petclinic-microse...<span class="color-fg-subtle text-normal">&nbsp;&nbsp;/&nbsp;&nbsp;</span></command-palette-token>
        </command-palette-scope>
        <div class="command-palette-input-group flex-1 form-control border-0 box-shadow-none" style="z-index: 0">
          <div class="command-palette-typeahead position-absolute d-flex flex-items-center Truncate">
            <span class="typeahead-segment input-mirror" data-target="command-palette-input.mirror"></span>
            <span class="Truncate-text" data-target="command-palette-input.typeaheadText"></span>
            <span class="typeahead-segment" data-target="command-palette-input.typeaheadPlaceholder"></span>
          </div>
          <input
            class="js-overlay-input typeahead-input d-none"
            disabled
            tabindex="-1"
            aria-label="Hidden input for typeahead"
          >
          <input
            type="text"
            autocomplete="off"
            autocorrect="off"
            autocapitalize="off"
            spellcheck="false"
            class="js-input typeahead-input form-control border-0 box-shadow-none input-block width-full"
            aria-label="Command palette input"
            aria-haspopup="listbox"
            aria-expanded="false"
            aria-autocomplete="list"
            aria-controls="command-palette-item-stack"
            role="combobox"
            data-action="
              input:command-palette-input#onInput
              keydown:command-palette-input#onKeydown
            "
          >
        </div>
        <button aria-label="clear command palette" aria-keyshortcuts="Control+Backspace" data-action="click:command-palette-input#onClear keydown:command-palette-input#onClear" id="command-palette-clear-button" type="button" data-view-component="true" class="btn-octicon js-clear command-palette-input-clear-button"><svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-x-circle-fill">
    <path fill-rule="evenodd" d="M2.343 13.657A8 8 0 1113.657 2.343 8 8 0 012.343 13.657zM6.03 4.97a.75.75 0 00-1.06 1.06L6.94 8 4.97 9.97a.75.75 0 101.06 1.06L8 9.06l1.97 1.97a.75.75 0 101.06-1.06L9.06 8l1.97-1.97a.75.75 0 10-1.06-1.06L8 6.94 6.03 4.97z"></path>
</svg></button>
        <primer-tooltip hidden="hidden" for="command-palette-clear-button" data-direction="w" data-type="description" data-view-component="true">Clear</primer-tooltip>
      </command-palette-input>

        <command-palette-item-stack
          id="command-palette-item-stack"
          class="item-stack-transition-height"
          
          role="listbox"
          aria-label="Command palette results"
          data-action="itemsUpdated:command-palette#itemsUpdated"
        >
            <command-palette-tip
              class="color-fg-muted f6 px-3 py-1 my-2"
              data-mode=""
              data-value="">
              <div class="d-flex flex-items-start flex-justify-between">
                <div>
                  <span class="text-bold">Tip:</span>
                    Type <kbd class="hx_kbd">#</kbd> to search pull requests
                </div>
                <div class="ml-2 flex-shrink-0">
                  Type <kbd class="hx_kbd">?</kbd> for help and tips
                </div>
              </div>
            </command-palette-tip>
            <command-palette-tip
              class="color-fg-muted f6 px-3 py-1 my-2"
              data-mode=""
              data-value="">
              <div class="d-flex flex-items-start flex-justify-between">
                <div>
                  <span class="text-bold">Tip:</span>
                    Type <kbd class="hx_kbd">#</kbd> to search issues
                </div>
                <div class="ml-2 flex-shrink-0">
                  Type <kbd class="hx_kbd">?</kbd> for help and tips
                </div>
              </div>
            </command-palette-tip>
            <command-palette-tip
              class="color-fg-muted f6 px-3 py-1 my-2"
                data-scope-types="[&quot;owner&quot;,&quot;repository&quot;]"
              data-mode=""
              data-value="">
              <div class="d-flex flex-items-start flex-justify-between">
                <div>
                  <span class="text-bold">Tip:</span>
                    Type <kbd class="hx_kbd">#</kbd> to search discussions
                </div>
                <div class="ml-2 flex-shrink-0">
                  Type <kbd class="hx_kbd">?</kbd> for help and tips
                </div>
              </div>
            </command-palette-tip>
            <command-palette-tip
              class="color-fg-muted f6 px-3 py-1 my-2"
                data-scope-types="[&quot;owner&quot;,&quot;repository&quot;]"
              data-mode=""
              data-value="">
              <div class="d-flex flex-items-start flex-justify-between">
                <div>
                  <span class="text-bold">Tip:</span>
                    Type <kbd class="hx_kbd">!</kbd> to search projects
                </div>
                <div class="ml-2 flex-shrink-0">
                  Type <kbd class="hx_kbd">?</kbd> for help and tips
                </div>
              </div>
            </command-palette-tip>
            <command-palette-tip
              class="color-fg-muted f6 px-3 py-1 my-2"
                data-scope-types="[&quot;owner&quot;]"
              data-mode=""
              data-value="">
              <div class="d-flex flex-items-start flex-justify-between">
                <div>
                  <span class="text-bold">Tip:</span>
                    Type <kbd class="hx_kbd">@</kbd> to search teams
                </div>
                <div class="ml-2 flex-shrink-0">
                  Type <kbd class="hx_kbd">?</kbd> for help and tips
                </div>
              </div>
            </command-palette-tip>
            <command-palette-tip
              class="color-fg-muted f6 px-3 py-1 my-2"
                data-scope-types="[&quot;&quot;]"
              data-mode=""
              data-value="">
              <div class="d-flex flex-items-start flex-justify-between">
                <div>
                  <span class="text-bold">Tip:</span>
                    Type <kbd class="hx_kbd">@</kbd> to search people and organizations
                </div>
                <div class="ml-2 flex-shrink-0">
                  Type <kbd class="hx_kbd">?</kbd> for help and tips
                </div>
              </div>
            </command-palette-tip>
            <command-palette-tip
              class="color-fg-muted f6 px-3 py-1 my-2"
              data-mode=""
              data-value="">
              <div class="d-flex flex-items-start flex-justify-between">
                <div>
                  <span class="text-bold">Tip:</span>
                    Type <kbd class="hx_kbd">&gt;</kbd> to activate command mode
                </div>
                <div class="ml-2 flex-shrink-0">
                  Type <kbd class="hx_kbd">?</kbd> for help and tips
                </div>
              </div>
            </command-palette-tip>
            <command-palette-tip
              class="color-fg-muted f6 px-3 py-1 my-2"
              data-mode=""
              data-value="">
              <div class="d-flex flex-items-start flex-justify-between">
                <div>
                  <span class="text-bold">Tip:</span>
                    Go to your accessibility settings to change your keyboard shortcuts
                </div>
                <div class="ml-2 flex-shrink-0">
                  Type <kbd class="hx_kbd">?</kbd> for help and tips
                </div>
              </div>
            </command-palette-tip>
            <command-palette-tip
              class="color-fg-muted f6 px-3 py-1 my-2"
              data-mode="#"
              data-value="">
              <div class="d-flex flex-items-start flex-justify-between">
                <div>
                  <span class="text-bold">Tip:</span>
                    Type author:@me to search your content
                </div>
                <div class="ml-2 flex-shrink-0">
                  Type <kbd class="hx_kbd">?</kbd> for help and tips
                </div>
              </div>
            </command-palette-tip>
            <command-palette-tip
              class="color-fg-muted f6 px-3 py-1 my-2"
              data-mode="#"
              data-value="">
              <div class="d-flex flex-items-start flex-justify-between">
                <div>
                  <span class="text-bold">Tip:</span>
                    Type is:pr to filter to pull requests
                </div>
                <div class="ml-2 flex-shrink-0">
                  Type <kbd class="hx_kbd">?</kbd> for help and tips
                </div>
              </div>
            </command-palette-tip>
            <command-palette-tip
              class="color-fg-muted f6 px-3 py-1 my-2"
              data-mode="#"
              data-value="">
              <div class="d-flex flex-items-start flex-justify-between">
                <div>
                  <span class="text-bold">Tip:</span>
                    Type is:issue to filter to issues
                </div>
                <div class="ml-2 flex-shrink-0">
                  Type <kbd class="hx_kbd">?</kbd> for help and tips
                </div>
              </div>
            </command-palette-tip>
            <command-palette-tip
              class="color-fg-muted f6 px-3 py-1 my-2"
                data-scope-types="[&quot;owner&quot;,&quot;repository&quot;]"
              data-mode="#"
              data-value="">
              <div class="d-flex flex-items-start flex-justify-between">
                <div>
                  <span class="text-bold">Tip:</span>
                    Type is:project to filter to projects
                </div>
                <div class="ml-2 flex-shrink-0">
                  Type <kbd class="hx_kbd">?</kbd> for help and tips
                </div>
              </div>
            </command-palette-tip>
            <command-palette-tip
              class="color-fg-muted f6 px-3 py-1 my-2"
              data-mode="#"
              data-value="">
              <div class="d-flex flex-items-start flex-justify-between">
                <div>
                  <span class="text-bold">Tip:</span>
                    Type is:open to filter to open content
                </div>
                <div class="ml-2 flex-shrink-0">
                  Type <kbd class="hx_kbd">?</kbd> for help and tips
                </div>
              </div>
            </command-palette-tip>
          <command-palette-tip class="mx-3 my-2 flash flash-error d-flex flex-items-center" data-on-error>
            <div>
              <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-alert">
    <path fill-rule="evenodd" d="M8.22 1.754a.25.25 0 00-.44 0L1.698 13.132a.25.25 0 00.22.368h12.164a.25.25 0 00.22-.368L8.22 1.754zm-1.763-.707c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0114.082 15H1.918a1.75 1.75 0 01-1.543-2.575L6.457 1.047zM9 11a1 1 0 11-2 0 1 1 0 012 0zm-.25-5.25a.75.75 0 00-1.5 0v2.5a.75.75 0 001.5 0v-2.5z"></path>
</svg>
            </div>
            <div class="px-2">
              We’ve encountered an error and some results aren't available at this time. Type a new search or try again later.
            </div>
          </command-palette-tip>
          <command-palette-tip class="h4 color-fg-default pl-3 pb-2 pt-3" data-on-empty data-match-mode="[^?]|^$">
            No results matched your search
          </command-palette-tip>

            <command-palette-item-group
              data-group-id="top"
              data-group-title="Top result"
              data-group-hint=""
              data-group-limits="{}"
              data-targets="command-palette-item-stack.groups"
            >
            </command-palette-item-group>
            <command-palette-item-group
              data-group-id="commands"
              data-group-title="Commands"
              data-group-hint="Type &gt; to filter"
              data-group-limits="{}"
              data-targets="command-palette-item-stack.groups"
            >
            </command-palette-item-group>
            <command-palette-item-group
              data-group-id="global_commands"
              data-group-title="Global Commands"
              data-group-hint="Type &gt; to filter"
              data-group-limits="{}"
              data-targets="command-palette-item-stack.groups"
            >
            </command-palette-item-group>
            <command-palette-item-group
              data-group-id="files"
              data-group-title="Files"
              data-group-hint=""
              data-group-limits="{}"
              data-targets="command-palette-item-stack.groups"
            >
            </command-palette-item-group>
            <command-palette-item-group
              data-group-id="pages"
              data-group-title="Pages"
              data-group-hint=""
              data-group-limits="{&quot;repository&quot;:10}"
              data-targets="command-palette-item-stack.groups"
            >
            </command-palette-item-group>
            <command-palette-item-group
              data-group-id="access_policies"
              data-group-title="Access Policies"
              data-group-hint=""
              data-group-limits="{}"
              data-targets="command-palette-item-stack.groups"
            >
            </command-palette-item-group>
            <command-palette-item-group
              data-group-id="organizations"
              data-group-title="Organizations"
              data-group-hint=""
              data-group-limits="{}"
              data-targets="command-palette-item-stack.groups"
            >
            </command-palette-item-group>
            <command-palette-item-group
              data-group-id="repositories"
              data-group-title="Repositories"
              data-group-hint=""
              data-group-limits="{}"
              data-targets="command-palette-item-stack.groups"
            >
            </command-palette-item-group>
            <command-palette-item-group
              data-group-id="references"
              data-group-title="Issues, pull requests, and discussions"
              data-group-hint="Type # to filter"
              data-group-limits="{}"
              data-targets="command-palette-item-stack.groups"
            >
            </command-palette-item-group>
            <command-palette-item-group
              data-group-id="teams"
              data-group-title="Teams"
              data-group-hint=""
              data-group-limits="{}"
              data-targets="command-palette-item-stack.groups"
            >
            </command-palette-item-group>
            <command-palette-item-group
              data-group-id="users"
              data-group-title="Users"
              data-group-hint=""
              data-group-limits="{}"
              data-targets="command-palette-item-stack.groups"
            >
            </command-palette-item-group>
            <command-palette-item-group
              data-group-id="projects"
              data-group-title="Projects"
              data-group-hint=""
              data-group-limits="{}"
              data-targets="command-palette-item-stack.groups"
            >
            </command-palette-item-group>
            <command-palette-item-group
              data-group-id="footer"
              data-group-title="Footer"
              data-group-hint=""
              data-group-limits="{}"
              data-targets="command-palette-item-stack.groups"
            >
            </command-palette-item-group>
            <command-palette-item-group
              data-group-id="modes_help"
              data-group-title="Modes"
              data-group-hint=""
              data-group-limits="{}"
              data-targets="command-palette-item-stack.groups"
            >
            </command-palette-item-group>
            <command-palette-item-group
              data-group-id="filters_help"
              data-group-title="Use filters in issues, pull requests, discussions, and projects"
              data-group-hint=""
              data-group-limits="{}"
              data-targets="command-palette-item-stack.groups"
            >
            </command-palette-item-group>
        </command-palette-item-stack>

      <div class="js-command-local-provider-octicons" hidden>
          <div data-local-provider-octicon-id="arrow-right-color-fg-muted">
            <svg height="16" class="octicon octicon-arrow-right color-fg-muted" viewBox="0 0 16 16" version="1.1" width="16" aria-hidden="true"><path fill-rule="evenodd" d="M8.22 2.97a.75.75 0 011.06 0l4.25 4.25a.75.75 0 010 1.06l-4.25 4.25a.75.75 0 01-1.06-1.06l2.97-2.97H3.75a.75.75 0 010-1.5h7.44L8.22 4.03a.75.75 0 010-1.06z"></path></svg>
          </div>
          <div data-local-provider-octicon-id="arrow-right-color-fg-default">
            <svg height="16" class="octicon octicon-arrow-right color-fg-default" viewBox="0 0 16 16" version="1.1" width="16" aria-hidden="true"><path fill-rule="evenodd" d="M8.22 2.97a.75.75 0 011.06 0l4.25 4.25a.75.75 0 010 1.06l-4.25 4.25a.75.75 0 01-1.06-1.06l2.97-2.97H3.75a.75.75 0 010-1.5h7.44L8.22 4.03a.75.75 0 010-1.06z"></path></svg>
          </div>
          <div data-local-provider-octicon-id="codespaces-color-fg-muted">
            <svg height="16" class="octicon octicon-codespaces color-fg-muted" viewBox="0 0 16 16" version="1.1" width="16" aria-hidden="true"><path fill-rule="evenodd" d="M2 1.75C2 .784 2.784 0 3.75 0h8.5C13.216 0 14 .784 14 1.75v5a1.75 1.75 0 01-1.75 1.75h-8.5A1.75 1.75 0 012 6.75v-5zm1.75-.25a.25.25 0 00-.25.25v5c0 .138.112.25.25.25h8.5a.25.25 0 00.25-.25v-5a.25.25 0 00-.25-.25h-8.5zM0 11.25c0-.966.784-1.75 1.75-1.75h12.5c.966 0 1.75.784 1.75 1.75v3A1.75 1.75 0 0114.25 16H1.75A1.75 1.75 0 010 14.25v-3zM1.75 11a.25.25 0 00-.25.25v3c0 .138.112.25.25.25h12.5a.25.25 0 00.25-.25v-3a.25.25 0 00-.25-.25H1.75z"></path><path fill-rule="evenodd" d="M3 12.75a.75.75 0 01.75-.75h.5a.75.75 0 010 1.5h-.5a.75.75 0 01-.75-.75zm4 0a.75.75 0 01.75-.75h4.5a.75.75 0 010 1.5h-4.5a.75.75 0 01-.75-.75z"></path></svg>
          </div>
          <div data-local-provider-octicon-id="copy-color-fg-muted">
            <svg height="16" class="octicon octicon-copy color-fg-muted" viewBox="0 0 16 16" version="1.1" width="16" aria-hidden="true"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg>
          </div>
          <div data-local-provider-octicon-id="dash-color-fg-muted">
            <svg height="16" class="octicon octicon-dash color-fg-muted" viewBox="0 0 16 16" version="1.1" width="16" aria-hidden="true"><path fill-rule="evenodd" d="M2 7.75A.75.75 0 012.75 7h10a.75.75 0 010 1.5h-10A.75.75 0 012 7.75z"></path></svg>
          </div>
          <div data-local-provider-octicon-id="file-color-fg-muted">
            <svg height="16" class="octicon octicon-file color-fg-muted" viewBox="0 0 16 16" version="1.1" width="16" aria-hidden="true"><path fill-rule="evenodd" d="M3.75 1.5a.25.25 0 00-.25.25v11.5c0 .138.112.25.25.25h8.5a.25.25 0 00.25-.25V6H9.75A1.75 1.75 0 018 4.25V1.5H3.75zm5.75.56v2.19c0 .138.112.25.25.25h2.19L9.5 2.06zM2 1.75C2 .784 2.784 0 3.75 0h5.086c.464 0 .909.184 1.237.513l3.414 3.414c.329.328.513.773.513 1.237v8.086A1.75 1.75 0 0112.25 15h-8.5A1.75 1.75 0 012 13.25V1.75z"></path></svg>
          </div>
          <div data-local-provider-octicon-id="lock-color-fg-muted">
            <svg height="16" class="octicon octicon-lock color-fg-muted" viewBox="0 0 16 16" version="1.1" width="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 4v2h-.25A1.75 1.75 0 002 7.75v5.5c0 .966.784 1.75 1.75 1.75h8.5A1.75 1.75 0 0014 13.25v-5.5A1.75 1.75 0 0012.25 6H12V4a4 4 0 10-8 0zm6.5 2V4a2.5 2.5 0 00-5 0v2h5zM12 7.5h.25a.25.25 0 01.25.25v5.5a.25.25 0 01-.25.25h-8.5a.25.25 0 01-.25-.25v-5.5a.25.25 0 01.25-.25H12z"></path></svg>
          </div>
          <div data-local-provider-octicon-id="moon-color-fg-muted">
            <svg height="16" class="octicon octicon-moon color-fg-muted" viewBox="0 0 16 16" version="1.1" width="16" aria-hidden="true"><path fill-rule="evenodd" d="M9.598 1.591a.75.75 0 01.785-.175 7 7 0 11-8.967 8.967.75.75 0 01.961-.96 5.5 5.5 0 007.046-7.046.75.75 0 01.175-.786zm1.616 1.945a7 7 0 01-7.678 7.678 5.5 5.5 0 107.678-7.678z"></path></svg>
          </div>
          <div data-local-provider-octicon-id="person-color-fg-muted">
            <svg height="16" class="octicon octicon-person color-fg-muted" viewBox="0 0 16 16" version="1.1" width="16" aria-hidden="true"><path fill-rule="evenodd" d="M10.5 5a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0zm.061 3.073a4 4 0 10-5.123 0 6.004 6.004 0 00-3.431 5.142.75.75 0 001.498.07 4.5 4.5 0 018.99 0 .75.75 0 101.498-.07 6.005 6.005 0 00-3.432-5.142z"></path></svg>
          </div>
          <div data-local-provider-octicon-id="pencil-color-fg-muted">
            <svg height="16" class="octicon octicon-pencil color-fg-muted" viewBox="0 0 16 16" version="1.1" width="16" aria-hidden="true"><path fill-rule="evenodd" d="M11.013 1.427a1.75 1.75 0 012.474 0l1.086 1.086a1.75 1.75 0 010 2.474l-8.61 8.61c-.21.21-.47.364-.756.445l-3.251.93a.75.75 0 01-.927-.928l.929-3.25a1.75 1.75 0 01.445-.758l8.61-8.61zm1.414 1.06a.25.25 0 00-.354 0L10.811 3.75l1.439 1.44 1.263-1.263a.25.25 0 000-.354l-1.086-1.086zM11.189 6.25L9.75 4.81l-6.286 6.287a.25.25 0 00-.064.108l-.558 1.953 1.953-.558a.249.249 0 00.108-.064l6.286-6.286z"></path></svg>
          </div>
          <div data-local-provider-octicon-id="issue-opened-open">
            <svg height="16" class="octicon octicon-issue-opened open" viewBox="0 0 16 16" version="1.1" width="16" aria-hidden="true"><path d="M8 9.5a1.5 1.5 0 100-3 1.5 1.5 0 000 3z"></path><path fill-rule="evenodd" d="M8 0a8 8 0 100 16A8 8 0 008 0zM1.5 8a6.5 6.5 0 1113 0 6.5 6.5 0 01-13 0z"></path></svg>
          </div>
          <div data-local-provider-octicon-id="git-pull-request-draft-color-fg-muted">
            <svg height="16" class="octicon octicon-git-pull-request-draft color-fg-muted" viewBox="0 0 16 16" version="1.1" width="16" aria-hidden="true"><path fill-rule="evenodd" d="M2.5 3.25a.75.75 0 111.5 0 .75.75 0 01-1.5 0zM3.25 1a2.25 2.25 0 00-.75 4.372v5.256a2.251 2.251 0 101.5 0V5.372A2.25 2.25 0 003.25 1zm0 11a.75.75 0 100 1.5.75.75 0 000-1.5zm9.5 3a2.25 2.25 0 100-4.5 2.25 2.25 0 000 4.5zm0-3a.75.75 0 100 1.5.75.75 0 000-1.5z"></path><path d="M14 7.5a1.25 1.25 0 11-2.5 0 1.25 1.25 0 012.5 0zm0-4.25a1.25 1.25 0 11-2.5 0 1.25 1.25 0 012.5 0z"></path></svg>
          </div>
          <div data-local-provider-octicon-id="search-color-fg-muted">
            <svg height="16" class="octicon octicon-search color-fg-muted" viewBox="0 0 16 16" version="1.1" width="16" aria-hidden="true"><path fill-rule="evenodd" d="M11.5 7a4.499 4.499 0 11-8.998 0A4.499 4.499 0 0111.5 7zm-.82 4.74a6 6 0 111.06-1.06l3.04 3.04a.75.75 0 11-1.06 1.06l-3.04-3.04z"></path></svg>
          </div>
          <div data-local-provider-octicon-id="sun-color-fg-muted">
            <svg height="16" class="octicon octicon-sun color-fg-muted" viewBox="0 0 16 16" version="1.1" width="16" aria-hidden="true"><path fill-rule="evenodd" d="M8 10.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5zM8 12a4 4 0 100-8 4 4 0 000 8zM8 0a.75.75 0 01.75.75v1.5a.75.75 0 01-1.5 0V.75A.75.75 0 018 0zm0 13a.75.75 0 01.75.75v1.5a.75.75 0 01-1.5 0v-1.5A.75.75 0 018 13zM2.343 2.343a.75.75 0 011.061 0l1.06 1.061a.75.75 0 01-1.06 1.06l-1.06-1.06a.75.75 0 010-1.06zm9.193 9.193a.75.75 0 011.06 0l1.061 1.06a.75.75 0 01-1.06 1.061l-1.061-1.06a.75.75 0 010-1.061zM16 8a.75.75 0 01-.75.75h-1.5a.75.75 0 010-1.5h1.5A.75.75 0 0116 8zM3 8a.75.75 0 01-.75.75H.75a.75.75 0 010-1.5h1.5A.75.75 0 013 8zm10.657-5.657a.75.75 0 010 1.061l-1.061 1.06a.75.75 0 11-1.06-1.06l1.06-1.06a.75.75 0 011.06 0zm-9.193 9.193a.75.75 0 010 1.06l-1.06 1.061a.75.75 0 11-1.061-1.06l1.06-1.061a.75.75 0 011.061 0z"></path></svg>
          </div>
          <div data-local-provider-octicon-id="sync-color-fg-muted">
            <svg height="16" class="octicon octicon-sync color-fg-muted" viewBox="0 0 16 16" version="1.1" width="16" aria-hidden="true"><path fill-rule="evenodd" d="M8 2.5a5.487 5.487 0 00-4.131 1.869l1.204 1.204A.25.25 0 014.896 6H1.25A.25.25 0 011 5.75V2.104a.25.25 0 01.427-.177l1.38 1.38A7.001 7.001 0 0114.95 7.16a.75.75 0 11-1.49.178A5.501 5.501 0 008 2.5zM1.705 8.005a.75.75 0 01.834.656 5.501 5.501 0 009.592 2.97l-1.204-1.204a.25.25 0 01.177-.427h3.646a.25.25 0 01.25.25v3.646a.25.25 0 01-.427.177l-1.38-1.38A7.001 7.001 0 011.05 8.84a.75.75 0 01.656-.834z"></path></svg>
          </div>
          <div data-local-provider-octicon-id="trash-color-fg-muted">
            <svg height="16" class="octicon octicon-trash color-fg-muted" viewBox="0 0 16 16" version="1.1" width="16" aria-hidden="true"><path fill-rule="evenodd" d="M6.5 1.75a.25.25 0 01.25-.25h2.5a.25.25 0 01.25.25V3h-3V1.75zm4.5 0V3h2.25a.75.75 0 010 1.5H2.75a.75.75 0 010-1.5H5V1.75C5 .784 5.784 0 6.75 0h2.5C10.216 0 11 .784 11 1.75zM4.496 6.675a.75.75 0 10-1.492.15l.66 6.6A1.75 1.75 0 005.405 15h5.19c.9 0 1.652-.681 1.741-1.576l.66-6.6a.75.75 0 00-1.492-.149l-.66 6.6a.25.25 0 01-.249.225h-5.19a.25.25 0 01-.249-.225l-.66-6.6z"></path></svg>
          </div>
          <div data-local-provider-octicon-id="key-color-fg-muted">
            <svg height="16" class="octicon octicon-key color-fg-muted" viewBox="0 0 16 16" version="1.1" width="16" aria-hidden="true"><path fill-rule="evenodd" d="M6.5 5.5a4 4 0 112.731 3.795.75.75 0 00-.768.18L7.44 10.5H6.25a.75.75 0 00-.75.75v1.19l-.06.06H4.25a.75.75 0 00-.75.75v1.19l-.06.06H1.75a.25.25 0 01-.25-.25v-1.69l5.024-5.023a.75.75 0 00.181-.768A3.995 3.995 0 016.5 5.5zm4-5.5a5.5 5.5 0 00-5.348 6.788L.22 11.72a.75.75 0 00-.22.53v2C0 15.216.784 16 1.75 16h2a.75.75 0 00.53-.22l.5-.5a.75.75 0 00.22-.53V14h.75a.75.75 0 00.53-.22l.5-.5a.75.75 0 00.22-.53V12h.75a.75.75 0 00.53-.22l.932-.932A5.5 5.5 0 1010.5 0zm.5 6a1 1 0 100-2 1 1 0 000 2z"></path></svg>
          </div>
          <div data-local-provider-octicon-id="comment-discussion-color-fg-muted">
            <svg height="16" class="octicon octicon-comment-discussion color-fg-muted" viewBox="0 0 16 16" version="1.1" width="16" aria-hidden="true"><path fill-rule="evenodd" d="M1.5 2.75a.25.25 0 01.25-.25h8.5a.25.25 0 01.25.25v5.5a.25.25 0 01-.25.25h-3.5a.75.75 0 00-.53.22L3.5 11.44V9.25a.75.75 0 00-.75-.75h-1a.25.25 0 01-.25-.25v-5.5zM1.75 1A1.75 1.75 0 000 2.75v5.5C0 9.216.784 10 1.75 10H2v1.543a1.457 1.457 0 002.487 1.03L7.061 10h3.189A1.75 1.75 0 0012 8.25v-5.5A1.75 1.75 0 0010.25 1h-8.5zM14.5 4.75a.25.25 0 00-.25-.25h-.5a.75.75 0 110-1.5h.5c.966 0 1.75.784 1.75 1.75v5.5A1.75 1.75 0 0114.25 12H14v1.543a1.457 1.457 0 01-2.487 1.03L9.22 12.28a.75.75 0 111.06-1.06l2.22 2.22v-2.19a.75.75 0 01.75-.75h1a.25.25 0 00.25-.25v-5.5z"></path></svg>
          </div>
          <div data-local-provider-octicon-id="bell-color-fg-muted">
            <svg height="16" class="octicon octicon-bell color-fg-muted" viewBox="0 0 16 16" version="1.1" width="16" aria-hidden="true"><path d="M8 16a2 2 0 001.985-1.75c.017-.137-.097-.25-.235-.25h-3.5c-.138 0-.252.113-.235.25A2 2 0 008 16z"></path><path fill-rule="evenodd" d="M8 1.5A3.5 3.5 0 004.5 5v2.947c0 .346-.102.683-.294.97l-1.703 2.556a.018.018 0 00-.003.01l.001.006c0 .002.002.004.004.006a.017.017 0 00.006.004l.007.001h10.964l.007-.001a.016.016 0 00.006-.004.016.016 0 00.004-.006l.001-.007a.017.017 0 00-.003-.01l-1.703-2.554a1.75 1.75 0 01-.294-.97V5A3.5 3.5 0 008 1.5zM3 5a5 5 0 0110 0v2.947c0 .05.015.098.042.139l1.703 2.555A1.518 1.518 0 0113.482 13H2.518a1.518 1.518 0 01-1.263-2.36l1.703-2.554A.25.25 0 003 7.947V5z"></path></svg>
          </div>
          <div data-local-provider-octicon-id="bell-slash-color-fg-muted">
            <svg height="16" class="octicon octicon-bell-slash color-fg-muted" viewBox="0 0 16 16" version="1.1" width="16" aria-hidden="true"><path fill-rule="evenodd" d="M8 1.5c-.997 0-1.895.416-2.534 1.086A.75.75 0 014.38 1.55 5 5 0 0113 5v2.373a.75.75 0 01-1.5 0V5A3.5 3.5 0 008 1.5zM4.182 4.31L1.19 2.143a.75.75 0 10-.88 1.214L3 5.305v2.642a.25.25 0 01-.042.139L1.255 10.64A1.518 1.518 0 002.518 13h11.108l1.184.857a.75.75 0 10.88-1.214l-1.375-.996a1.196 1.196 0 00-.013-.01L4.198 4.321a.733.733 0 00-.016-.011zm7.373 7.19L4.5 6.391v1.556c0 .346-.102.683-.294.97l-1.703 2.556a.018.018 0 00-.003.01.015.015 0 00.005.012.017.017 0 00.006.004l.007.001h9.037zM8 16a2 2 0 001.985-1.75c.017-.137-.097-.25-.235-.25h-3.5c-.138 0-.252.113-.235.25A2 2 0 008 16z"></path></svg>
          </div>
          <div data-local-provider-octicon-id="paintbrush-color-fg-muted">
            <svg height="16" class="octicon octicon-paintbrush color-fg-muted" viewBox="0 0 16 16" version="1.1" width="16" aria-hidden="true"><path fill-rule="evenodd" d="M11.134 1.535C9.722 2.562 8.16 4.057 6.889 5.312 5.8 6.387 5.041 7.401 4.575 8.294a3.745 3.745 0 00-3.227 1.054c-.43.431-.69 1.066-.86 1.657a11.982 11.982 0 00-.358 1.914A21.263 21.263 0 000 15.203v.054l.75-.007-.007.75h.054a14.404 14.404 0 00.654-.012 21.243 21.243 0 001.63-.118c.62-.07 1.3-.18 1.914-.357.592-.17 1.226-.43 1.657-.861a3.745 3.745 0 001.055-3.217c.908-.461 1.942-1.216 3.04-2.3 1.279-1.262 2.764-2.825 3.775-4.249.501-.706.923-1.428 1.125-2.096.2-.659.235-1.469-.368-2.07-.606-.607-1.42-.55-2.069-.34-.66.213-1.376.646-2.076 1.155zm-3.95 8.48a3.76 3.76 0 00-1.19-1.192 9.758 9.758 0 011.161-1.607l1.658 1.658a9.853 9.853 0 01-1.63 1.142zM.742 16l.007-.75-.75.008A.75.75 0 00.743 16zM12.016 2.749c-1.224.89-2.605 2.189-3.822 3.384l1.718 1.718c1.21-1.205 2.51-2.597 3.387-3.833.47-.662.78-1.227.912-1.662.134-.444.032-.551.009-.575h-.001V1.78c-.014-.014-.112-.113-.548.027-.432.14-.995.462-1.655.942zM1.62 13.089a19.56 19.56 0 00-.104 1.395 19.55 19.55 0 001.396-.104 10.528 10.528 0 001.668-.309c.526-.151.856-.325 1.011-.48a2.25 2.25 0 00-3.182-3.182c-.155.155-.329.485-.48 1.01a10.515 10.515 0 00-.309 1.67z"></path></svg>
          </div>
      </div>

      <server-defined-provider data-type="search-links" data-targets="command-palette.serverDefinedProviderElements"></server-defined-provider>
      <server-defined-provider data-type="help" data-targets="command-palette.serverDefinedProviderElements">
          <command-palette-help
            data-group="modes_help"
              data-prefix="#"
              data-scope-types="[&quot;&quot;]"
          >
            <span data-target="command-palette-help.titleElement">Search for <strong>issues</strong> and <strong>pull requests</strong></span>
              <span data-target="command-palette-help.hintElement">
                <kbd class="hx_kbd">#</kbd>
              </span>
          </command-palette-help>
          <command-palette-help
            data-group="modes_help"
              data-prefix="#"
              data-scope-types="[&quot;owner&quot;,&quot;repository&quot;]"
          >
            <span data-target="command-palette-help.titleElement">Search for <strong>issues, pull requests, discussions,</strong> and <strong>projects</strong></span>
              <span data-target="command-palette-help.hintElement">
                <kbd class="hx_kbd">#</kbd>
              </span>
          </command-palette-help>
          <command-palette-help
            data-group="modes_help"
              data-prefix="@"
              data-scope-types="[&quot;&quot;]"
          >
            <span data-target="command-palette-help.titleElement">Search for <strong>organizations, repositories,</strong> and <strong>users</strong></span>
              <span data-target="command-palette-help.hintElement">
                <kbd class="hx_kbd">@</kbd>
              </span>
          </command-palette-help>
          <command-palette-help
            data-group="modes_help"
              data-prefix="!"
              data-scope-types="[&quot;owner&quot;,&quot;repository&quot;]"
          >
            <span data-target="command-palette-help.titleElement">Search for <strong>projects</strong></span>
              <span data-target="command-palette-help.hintElement">
                <kbd class="hx_kbd">!</kbd>
              </span>
          </command-palette-help>
          <command-palette-help
            data-group="modes_help"
              data-prefix="/"
              data-scope-types="[&quot;repository&quot;]"
          >
            <span data-target="command-palette-help.titleElement">Search for <strong>files</strong></span>
              <span data-target="command-palette-help.hintElement">
                <kbd class="hx_kbd">/</kbd>
              </span>
          </command-palette-help>
          <command-palette-help
            data-group="modes_help"
              data-prefix="&gt;"
          >
            <span data-target="command-palette-help.titleElement">Activate <strong>command mode</strong></span>
              <span data-target="command-palette-help.hintElement">
                <kbd class="hx_kbd">&gt;</kbd>
              </span>
          </command-palette-help>
          <command-palette-help
            data-group="filters_help"
              data-prefix="# author:@me"
          >
            <span data-target="command-palette-help.titleElement">Search your issues, pull requests, and discussions</span>
              <span data-target="command-palette-help.hintElement">
                <kbd class="hx_kbd"># author:@me</kbd>
              </span>
          </command-palette-help>
          <command-palette-help
            data-group="filters_help"
              data-prefix="# author:@me"
          >
            <span data-target="command-palette-help.titleElement">Search your issues, pull requests, and discussions</span>
              <span data-target="command-palette-help.hintElement">
                <kbd class="hx_kbd"># author:@me</kbd>
              </span>
          </command-palette-help>
          <command-palette-help
            data-group="filters_help"
              data-prefix="# is:pr"
          >
            <span data-target="command-palette-help.titleElement">Filter to pull requests</span>
              <span data-target="command-palette-help.hintElement">
                <kbd class="hx_kbd"># is:pr</kbd>
              </span>
          </command-palette-help>
          <command-palette-help
            data-group="filters_help"
              data-prefix="# is:issue"
          >
            <span data-target="command-palette-help.titleElement">Filter to issues</span>
              <span data-target="command-palette-help.hintElement">
                <kbd class="hx_kbd"># is:issue</kbd>
              </span>
          </command-palette-help>
          <command-palette-help
            data-group="filters_help"
              data-prefix="# is:discussion"
              data-scope-types="[&quot;owner&quot;,&quot;repository&quot;]"
          >
            <span data-target="command-palette-help.titleElement">Filter to discussions</span>
              <span data-target="command-palette-help.hintElement">
                <kbd class="hx_kbd"># is:discussion</kbd>
              </span>
          </command-palette-help>
          <command-palette-help
            data-group="filters_help"
              data-prefix="# is:project"
              data-scope-types="[&quot;owner&quot;,&quot;repository&quot;]"
          >
            <span data-target="command-palette-help.titleElement">Filter to projects</span>
              <span data-target="command-palette-help.hintElement">
                <kbd class="hx_kbd"># is:project</kbd>
              </span>
          </command-palette-help>
          <command-palette-help
            data-group="filters_help"
              data-prefix="# is:open"
          >
            <span data-target="command-palette-help.titleElement">Filter to open issues, pull requests, and discussions</span>
              <span data-target="command-palette-help.hintElement">
                <kbd class="hx_kbd"># is:open</kbd>
              </span>
          </command-palette-help>
      </server-defined-provider>

        <server-defined-provider
          data-type="prefetched"
          data-fetch-debounce="0"
            data-src="/command_palette/commands"
          data-supported-modes="[&quot;&gt;&quot;]"
            data-supports-commands
          
          data-targets="command-palette.serverDefinedProviderElements"
          ></server-defined-provider>
        <server-defined-provider
          data-type="prefetched"
          data-fetch-debounce="0"
            data-src="/command_palette/jump_to_page_navigation"
          data-supported-modes="[&quot;&quot;]"
          
          data-targets="command-palette.serverDefinedProviderElements"
          ></server-defined-provider>
        <server-defined-provider
          data-type="remote"
          data-fetch-debounce="200"
            data-src="/command_palette/issues"
          data-supported-modes="[&quot;#&quot;,&quot;#&quot;]"
            data-supported-scope-types="[&quot;owner&quot;,&quot;repository&quot;,&quot;&quot;]"
          
          data-targets="command-palette.serverDefinedProviderElements"
          ></server-defined-provider>
        <server-defined-provider
          data-type="remote"
          data-fetch-debounce="200"
            data-src="/command_palette/jump_to"
          data-supported-modes="[&quot;@&quot;,&quot;@&quot;]"
            data-supported-scope-types="[&quot;&quot;,&quot;owner&quot;]"
          
          data-targets="command-palette.serverDefinedProviderElements"
          ></server-defined-provider>
        <server-defined-provider
          data-type="remote"
          data-fetch-debounce="200"
            data-src="/command_palette/jump_to_members_only"
          data-supported-modes="[&quot;&quot;]"
          
          data-targets="command-palette.serverDefinedProviderElements"
          ></server-defined-provider>
        <server-defined-provider
          data-type="prefetched"
          data-fetch-debounce="0"
            data-src="/command_palette/jump_to_members_only_prefetched"
          data-supported-modes="[&quot;@&quot;,&quot;@&quot;,&quot;&quot;]"
            data-supported-scope-types="[&quot;&quot;,&quot;owner&quot;]"
          
          data-targets="command-palette.serverDefinedProviderElements"
          ></server-defined-provider>
        <server-defined-provider
          data-type="files"
          data-fetch-debounce="0"
            data-src="/command_palette/files"
          data-supported-modes="[&quot;/&quot;]"
            data-supported-scope-types="[&quot;repository&quot;]"
          
          data-targets="command-palette.serverDefinedProviderElements"
          ></server-defined-provider>
        <server-defined-provider
          data-type="remote"
          data-fetch-debounce="200"
            data-src="/command_palette/discussions"
          data-supported-modes="[&quot;#&quot;]"
            data-supported-scope-types="[&quot;owner&quot;,&quot;repository&quot;]"
          
          data-targets="command-palette.serverDefinedProviderElements"
          ></server-defined-provider>
        <server-defined-provider
          data-type="remote"
          data-fetch-debounce="200"
            data-src="/command_palette/projects"
          data-supported-modes="[&quot;#&quot;,&quot;!&quot;]"
            data-supported-scope-types="[&quot;owner&quot;,&quot;repository&quot;]"
          
          data-targets="command-palette.serverDefinedProviderElements"
          ></server-defined-provider>
        <server-defined-provider
          data-type="prefetched"
          data-fetch-debounce="0"
            data-src="/command_palette/recent_issues"
          data-supported-modes="[&quot;#&quot;,&quot;#&quot;]"
            data-supported-scope-types="[&quot;owner&quot;,&quot;repository&quot;,&quot;&quot;]"
          
          data-targets="command-palette.serverDefinedProviderElements"
          ></server-defined-provider>
        <server-defined-provider
          data-type="remote"
          data-fetch-debounce="200"
            data-src="/command_palette/teams"
          data-supported-modes="[&quot;@&quot;,&quot;&quot;]"
            data-supported-scope-types="[&quot;owner&quot;]"
          
          data-targets="command-palette.serverDefinedProviderElements"
          ></server-defined-provider>
        <server-defined-provider
          data-type="remote"
          data-fetch-debounce="200"
            data-src="/command_palette/name_with_owner_repository"
          data-supported-modes="[&quot;&quot;]"
          
          data-targets="command-palette.serverDefinedProviderElements"
          ></server-defined-provider>
    </command-palette>
  </details-dialog>
</details>

<div class="position-fixed bottom-0 left-0 ml-5 mb-5 js-command-palette-toasts" style="z-index: 1000">
  <div hidden class="Toast Toast--loading">
    <span class="Toast-icon">
      <svg class="Toast--spinner" viewBox="0 0 32 32" width="18" height="18" aria-hidden="true">
        <path
          fill="#959da5"
          d="M16 0 A16 16 0 0 0 16 32 A16 16 0 0 0 16 0 M16 4 A12 12 0 0 1 16 28 A12 12 0 0 1 16 4"
        />
        <path fill="#ffffff" d="M16 0 A16 16 0 0 1 32 16 L28 16 A12 12 0 0 0 16 4z"></path>
      </svg>
    </span>
    <span class="Toast-content"></span>
  </div>

  <div hidden class="anim-fade-in fast Toast Toast--error">
    <span class="Toast-icon">
      <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-stop">
    <path fill-rule="evenodd" d="M4.47.22A.75.75 0 015 0h6a.75.75 0 01.53.22l4.25 4.25c.141.14.22.331.22.53v6a.75.75 0 01-.22.53l-4.25 4.25A.75.75 0 0111 16H5a.75.75 0 01-.53-.22L.22 11.53A.75.75 0 010 11V5a.75.75 0 01.22-.53L4.47.22zm.84 1.28L1.5 5.31v5.38l3.81 3.81h5.38l3.81-3.81V5.31L10.69 1.5H5.31zM8 4a.75.75 0 01.75.75v3.5a.75.75 0 01-1.5 0v-3.5A.75.75 0 018 4zm0 8a1 1 0 100-2 1 1 0 000 2z"></path>
</svg>
    </span>
    <span class="Toast-content"></span>
  </div>

  <div hidden class="anim-fade-in fast Toast Toast--warning">
    <span class="Toast-icon">
      <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-alert">
    <path fill-rule="evenodd" d="M8.22 1.754a.25.25 0 00-.44 0L1.698 13.132a.25.25 0 00.22.368h12.164a.25.25 0 00.22-.368L8.22 1.754zm-1.763-.707c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0114.082 15H1.918a1.75 1.75 0 01-1.543-2.575L6.457 1.047zM9 11a1 1 0 11-2 0 1 1 0 012 0zm-.25-5.25a.75.75 0 00-1.5 0v2.5a.75.75 0 001.5 0v-2.5z"></path>
</svg>
    </span>
    <span class="Toast-content"></span>
  </div>


  <div hidden class="anim-fade-in fast Toast Toast--success">
    <span class="Toast-icon">
      <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-check">
    <path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path>
</svg>
    </span>
    <span class="Toast-content"></span>
  </div>

  <div hidden class="anim-fade-in fast Toast">
    <span class="Toast-icon">
      <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-info">
    <path fill-rule="evenodd" d="M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z"></path>
</svg>
    </span>
    <span class="Toast-content"></span>
  </div>
</div>

        <command-palette-pjax-metadata hidden class="js-command-palette-pjax-metadata" data-pjax-replace id="command-palette-pjax-metadata"
  data-default-scope-id="R_kgDOG72weQ"
  data-default-scope-type="Repository"
>
</command-palette-pjax-metadata>


  <div
    class="application-main "
    data-commit-hovercards-enabled
    data-discussion-hovercards-enabled
    data-issue-and-pr-hovercards-enabled
  >
        <div itemscope itemtype="http://schema.org/SoftwareSourceCode" class="">
    <main id="js-repo-pjax-container" data-pjax-container >
      

    






  <div id="repository-container-header" class="pt-3 hide-full-screen" style="background-color: var(--color-page-header-bg);" data-pjax-replace>

      <div class="d-flex mb-3 px-3 px-md-4 px-lg-5">

        <div class="flex-auto min-width-0 width-fit mr-3">
            <h1 class=" d-flex flex-wrap flex-items-center wb-break-word f3 text-normal">
    <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-repo color-fg-muted mr-2">
    <path fill-rule="evenodd" d="M2 2.5A2.5 2.5 0 014.5 0h8.75a.75.75 0 01.75.75v12.5a.75.75 0 01-.75.75h-2.5a.75.75 0 110-1.5h1.75v-2h-8a1 1 0 00-.714 1.7.75.75 0 01-1.072 1.05A2.495 2.495 0 012 11.5v-9zm10.5-1V9h-8c-.356 0-.694.074-1 .208V2.5a1 1 0 011-1h8zM5 12.25v3.25a.25.25 0 00.4.2l1.45-1.087a.25.25 0 01.3 0L8.6 15.7a.25.25 0 00.4-.2v-3.25a.25.25 0 00-.25-.25h-3.5a.25.25 0 00-.25.25z"></path>
</svg>
  <span class="author flex-self-stretch" itemprop="author">
    <a class="url fn" rel="author" data-hovercard-type="user" data-hovercard-url="/users/adursunoglu16/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="/adursunoglu16">adursunoglu16</a>
  </span>
  <span class="mx-1 flex-self-stretch color-fg-muted">/</span>
  <strong itemprop="name" class="mr-2 flex-self-stretch">
    <a data-pjax="#repo-content-pjax-container" href="/adursunoglu16/petclinic-microservice-private">petclinic-microservice-private</a>
  </strong>

  <span></span><span class="Label Label--secondary v-align-middle mr-1">Public</span>
</h1>

        </div>

          <ul class="pagehead-actions flex-shrink-0 d-none d-md-inline" style="padding: 2px 0;">

  

  <li>
        <notifications-list-subscription-form
      data-action="notifications-dialog-label-toggled:notifications-list-subscription-form#handleDialogLabelToggle"
      class="f5 position-relative"
    >
      <details
        class="details-reset details-overlay f5 position-relative"
        data-target="notifications-list-subscription-form.details"
        data-action="toggle:notifications-list-subscription-form#detailsToggled"
      >

      <summary data-hydro-click="{&quot;event_type&quot;:&quot;repository.click&quot;,&quot;payload&quot;:{&quot;target&quot;:&quot;WATCH_BUTTON&quot;,&quot;repository_id&quot;:465416313,&quot;originating_url&quot;:&quot;https://github.com/adursunoglu16/petclinic-microservice-private/blob/main/503-microservices-ci-cd-pipeline-with-helm/README.md&quot;,&quot;user_id&quot;:90970136}}" data-hydro-click-hmac="603e1900f5def13434ae9ef8a47370e3a896c813715405e58b8010b8abbdf209" data-ga-click="Repository, click Watch settings, action:blob#show" aria-label="Notification settings" data-view-component="true" class="btn-sm btn">  <span data-menu-button>
            <span
              hidden
              
              data-target="notifications-list-subscription-form.unwatchButtonCopy"
            >
              <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-eye">
    <path fill-rule="evenodd" d="M1.679 7.932c.412-.621 1.242-1.75 2.366-2.717C5.175 4.242 6.527 3.5 8 3.5c1.473 0 2.824.742 3.955 1.715 1.124.967 1.954 2.096 2.366 2.717a.119.119 0 010 .136c-.412.621-1.242 1.75-2.366 2.717C10.825 11.758 9.473 12.5 8 12.5c-1.473 0-2.824-.742-3.955-1.715C2.92 9.818 2.09 8.69 1.679 8.068a.119.119 0 010-.136zM8 2c-1.981 0-3.67.992-4.933 2.078C1.797 5.169.88 6.423.43 7.1a1.619 1.619 0 000 1.798c.45.678 1.367 1.932 2.637 3.024C4.329 13.008 6.019 14 8 14c1.981 0 3.67-.992 4.933-2.078 1.27-1.091 2.187-2.345 2.637-3.023a1.619 1.619 0 000-1.798c-.45-.678-1.367-1.932-2.637-3.023C11.671 2.992 9.981 2 8 2zm0 8a2 2 0 100-4 2 2 0 000 4z"></path>
</svg>
              Unwatch
            </span>
            <span
              hidden
              
              data-target="notifications-list-subscription-form.stopIgnoringButtonCopy"
            >
              <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-bell-slash">
    <path fill-rule="evenodd" d="M8 1.5c-.997 0-1.895.416-2.534 1.086A.75.75 0 014.38 1.55 5 5 0 0113 5v2.373a.75.75 0 01-1.5 0V5A3.5 3.5 0 008 1.5zM4.182 4.31L1.19 2.143a.75.75 0 10-.88 1.214L3 5.305v2.642a.25.25 0 01-.042.139L1.255 10.64A1.518 1.518 0 002.518 13h11.108l1.184.857a.75.75 0 10.88-1.214l-1.375-.996a1.196 1.196 0 00-.013-.01L4.198 4.321a.733.733 0 00-.016-.011zm7.373 7.19L4.5 6.391v1.556c0 .346-.102.683-.294.97l-1.703 2.556a.018.018 0 00-.003.01.015.015 0 00.005.012.017.017 0 00.006.004l.007.001h9.037zM8 16a2 2 0 001.985-1.75c.017-.137-.097-.25-.235-.25h-3.5c-.138 0-.252.113-.235.25A2 2 0 008 16z"></path>
</svg>
              Stop ignoring
            </span>
            <span
              
              
              data-target="notifications-list-subscription-form.watchButtonCopy"
            >
              <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-eye">
    <path fill-rule="evenodd" d="M1.679 7.932c.412-.621 1.242-1.75 2.366-2.717C5.175 4.242 6.527 3.5 8 3.5c1.473 0 2.824.742 3.955 1.715 1.124.967 1.954 2.096 2.366 2.717a.119.119 0 010 .136c-.412.621-1.242 1.75-2.366 2.717C10.825 11.758 9.473 12.5 8 12.5c-1.473 0-2.824-.742-3.955-1.715C2.92 9.818 2.09 8.69 1.679 8.068a.119.119 0 010-.136zM8 2c-1.981 0-3.67.992-4.933 2.078C1.797 5.169.88 6.423.43 7.1a1.619 1.619 0 000 1.798c.45.678 1.367 1.932 2.637 3.024C4.329 13.008 6.019 14 8 14c1.981 0 3.67-.992 4.933-2.078 1.27-1.091 2.187-2.345 2.637-3.023a1.619 1.619 0 000-1.798c-.45-.678-1.367-1.932-2.637-3.023C11.671 2.992 9.981 2 8 2zm0 8a2 2 0 100-4 2 2 0 000 4z"></path>
</svg>
              Watch
            </span>
          </span>
            <span id="repo-notifications-counter" data-target="notifications-list-subscription-form.socialCount" data-pjax-replace="true" title="1" data-view-component="true" class="Counter">1</span>
          <span class="dropdown-caret"></span>
</summary>
        <details-menu
          class="SelectMenu  "
          role="menu"
          data-target="notifications-list-subscription-form.menu"
          
        >
          <div class="SelectMenu-modal notifications-component-menu-modal">
            <header class="SelectMenu-header">
              <h3 class="SelectMenu-title">Notifications</h3>
              <button class="SelectMenu-closeButton" type="button" aria-label="Close menu" data-action="click:notifications-list-subscription-form#closeMenu">
                <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-x">
    <path fill-rule="evenodd" d="M3.72 3.72a.75.75 0 011.06 0L8 6.94l3.22-3.22a.75.75 0 111.06 1.06L9.06 8l3.22 3.22a.75.75 0 11-1.06 1.06L8 9.06l-3.22 3.22a.75.75 0 01-1.06-1.06L6.94 8 3.72 4.78a.75.75 0 010-1.06z"></path>
</svg>
              </button>
            </header>

            <div class="SelectMenu-list">
              <form data-target="notifications-list-subscription-form.form" data-action="submit:notifications-list-subscription-form#submitForm" data-turbo="false" action="/notifications/subscribe" accept-charset="UTF-8" method="post"><input type="hidden" name="authenticity_token" value="idmdVWuvKe4Fm3PzOVVKDSlNvY9nNDpQAIr1UA3OCBwC22pAl9ujmneWObFrt-tNygJpP1n3fofM1i9zpLp8kg" autocomplete="off" />

                <input type="hidden" name="repository_id" value="465416313">

                <button
                  type="submit"
                  name="do"
                  value="included"
                  class="SelectMenu-item flex-items-start"
                  role="menuitemradio"
                  aria-checked="true"
                  data-targets="notifications-list-subscription-form.subscriptionButtons"
                  
                >
                  <span class="f5">
                    <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-check SelectMenu-icon SelectMenu-icon--check">
    <path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path>
</svg>
                  </span>
                  <div>
                    <div class="f5 text-bold">
                      Participating and @mentions
                    </div>
                    <div class="text-small color-fg-muted text-normal pb-1">
                      Only receive notifications from this repository when participating or @mentioned.
                    </div>
                  </div>
                </button>

                <button
                  type="submit"
                  name="do"
                  value="subscribed"
                  class="SelectMenu-item flex-items-start"
                  role="menuitemradio"
                  aria-checked="false"
                  data-targets="notifications-list-subscription-form.subscriptionButtons"
                >
                  <span class="f5">
                    <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-check SelectMenu-icon SelectMenu-icon--check">
    <path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path>
</svg>
                  </span>
                  <div>
                    <div class="f5 text-bold">
                      All Activity
                    </div>
                    <div class="text-small color-fg-muted text-normal pb-1">
                      Notified of all notifications on this repository.
                    </div>
                  </div>
                </button>

                <button
                  type="submit"
                  name="do"
                  value="ignore"
                  class="SelectMenu-item flex-items-start"
                  role="menuitemradio"
                  aria-checked="false"
                  data-targets="notifications-list-subscription-form.subscriptionButtons"
                >
                  <span class="f5">
                    <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-check SelectMenu-icon SelectMenu-icon--check">
    <path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path>
</svg>
                  </span>
                  <div>
                    <div class="f5 text-bold">
                      Ignore
                    </div>
                    <div class="text-small color-fg-muted text-normal pb-1">
                      Never be notified.
                    </div>
                  </div>
                </button>
</form>
              <button
                class="SelectMenu-item flex-items-start pr-3"
                type="button"
                role="menuitemradio"
                data-target="notifications-list-subscription-form.customButton"
                data-action="click:notifications-list-subscription-form#openCustomDialog"
                aria-haspopup="true"
                aria-checked="false"
                
              >
                <span class="f5">
                  <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-check SelectMenu-icon SelectMenu-icon--check">
    <path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path>
</svg>
                </span>
                <div>
                  <div class="d-flex flex-items-start flex-justify-between">
                    <div class="f5 text-bold">Custom</div>
                    <div class="f5 pr-1">
                      <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-arrow-right">
    <path fill-rule="evenodd" d="M8.22 2.97a.75.75 0 011.06 0l4.25 4.25a.75.75 0 010 1.06l-4.25 4.25a.75.75 0 01-1.06-1.06l2.97-2.97H3.75a.75.75 0 010-1.5h7.44L8.22 4.03a.75.75 0 010-1.06z"></path>
</svg>
                    </div>
                  </div>
                  <div class="text-small color-fg-muted text-normal pb-1">
                    Select events you want to be notified of in addition to participating and @mentions.
                  </div>
                </div>
              </button>

                <div class="px-3 py-2 d-flex color-bg-subtle flex-items-center">
                  <span class="f5">
                    <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-device-mobile SelectMenu-icon SelectMenu-icon--device-mobile">
    <path fill-rule="evenodd" d="M3.75 0A1.75 1.75 0 002 1.75v12.5c0 .966.784 1.75 1.75 1.75h8.5A1.75 1.75 0 0014 14.25V1.75A1.75 1.75 0 0012.25 0h-8.5zM3.5 1.75a.25.25 0 01.25-.25h8.5a.25.25 0 01.25.25v12.5a.25.25 0 01-.25.25h-8.5a.25.25 0 01-.25-.25V1.75zM8 13a1 1 0 100-2 1 1 0 000 2z"></path>
</svg>
                  </span>
                  <span className="text-small color-fg-muted text-normal pb-1">
                    Get push notifications on <a target="_blank" rel="noopener noreferrer" href="https://apps.apple.com/app/apple-store/id1477376905?ct=watch-dropdown&amp;mt=8&amp;pt=524675">iOS</a> or <a target="_blank" rel="noopener noreferrer" href="https://play.google.com/store/apps/details?id=com.github.android&amp;referrer=utm_campaign%3Dwatch-dropdown%26utm_medium%3Dweb%26utm_source%3Dgithub">Android</a>.
                  </span>
                </div>
            </div>
          </div>
        </details-menu>

        <details-dialog
          class="notifications-component-dialog "
          data-target="notifications-list-subscription-form.customDialog"
          aria-label="Custom dialog"
          hidden
        >
          <div class="SelectMenu-modal notifications-component-dialog-modal overflow-visible">
            <form data-target="notifications-list-subscription-form.customform" data-action="submit:notifications-list-subscription-form#submitCustomForm" data-turbo="false" action="/notifications/subscribe" accept-charset="UTF-8" method="post"><input type="hidden" name="authenticity_token" value="G_k8Hqz0xUNic8zYZZtz_f_7vbt3yFyD-1Gf5GcigW6Q-8sLUIBPNxB-hpo3edK9HLRpC0kLGFQ3DUXHzlb14A" autocomplete="off" />

              <input type="hidden" name="repository_id" value="465416313">

              <header class="d-sm-none SelectMenu-header pb-0 border-bottom-0 px-2 px-sm-3">
                <h1 class="f3 SelectMenu-title d-inline-flex">
                  <button
                    class="color-bg-default border-0 px-2 py-0 m-0 Link--secondary f5"
                    aria-label="Return to menu"
                    type="button"
                    data-action="click:notifications-list-subscription-form#closeCustomDialog"
                  >
                    <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-arrow-left">
    <path fill-rule="evenodd" d="M7.78 12.53a.75.75 0 01-1.06 0L2.47 8.28a.75.75 0 010-1.06l4.25-4.25a.75.75 0 011.06 1.06L4.81 7h7.44a.75.75 0 010 1.5H4.81l2.97 2.97a.75.75 0 010 1.06z"></path>
</svg>
                  </button>
                  Custom
                </h1>
              </header>

              <header class="d-none d-sm-flex flex-items-start pt-1">
                <button
                  class="border-0 px-2 pt-1 m-0 Link--secondary f5"
                  style="background-color: transparent;"
                  aria-label="Return to menu"
                  type="button"
                  data-action="click:notifications-list-subscription-form#closeCustomDialog"
                >
                  <svg style="position: relative; left: 2px; top: 1px" aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-arrow-left">
    <path fill-rule="evenodd" d="M7.78 12.53a.75.75 0 01-1.06 0L2.47 8.28a.75.75 0 010-1.06l4.25-4.25a.75.75 0 011.06 1.06L4.81 7h7.44a.75.75 0 010 1.5H4.81l2.97 2.97a.75.75 0 010 1.06z"></path>
</svg>
                </button>

                <h1 class="pt-1 pr-4 pb-0 pl-0 f5 text-bold">
                  Custom
                </h1>
              </header>

              <fieldset>
                <legend>
                  <div class="text-small color-fg-muted pt-0 pr-3 pb-3 pl-6 pl-sm-5 border-bottom mb-3">
                    Select events you want to be notified of in addition to participating and @mentions.
                  </div>
                </legend>
                <div data-target="notifications-list-subscription-form.labelInputs">
                </div>
                  <div class="form-checkbox mr-3 ml-6 ml-sm-5 mb-2 mt-0">
                    <label class="f5 text-normal">
                      <input
                        type="checkbox"
                        name="thread_types[]"
                        value="Issue"
                        data-targets="notifications-list-subscription-form.threadTypeCheckboxes"
                        data-action="change:notifications-list-subscription-form#threadTypeCheckboxesUpdated"
                        
                      >
                      Issues
                    </label>

                  </div>
                  <div class="form-checkbox mr-3 ml-6 ml-sm-5 mb-2 mt-0">
                    <label class="f5 text-normal">
                      <input
                        type="checkbox"
                        name="thread_types[]"
                        value="PullRequest"
                        data-targets="notifications-list-subscription-form.threadTypeCheckboxes"
                        data-action="change:notifications-list-subscription-form#threadTypeCheckboxesUpdated"
                        
                      >
                      Pull requests
                    </label>

                  </div>
                  <div class="form-checkbox mr-3 ml-6 ml-sm-5 mb-2 mt-0">
                    <label class="f5 text-normal">
                      <input
                        type="checkbox"
                        name="thread_types[]"
                        value="Release"
                        data-targets="notifications-list-subscription-form.threadTypeCheckboxes"
                        data-action="change:notifications-list-subscription-form#threadTypeCheckboxesUpdated"
                        
                      >
                      Releases
                    </label>

                  </div>
                  <div class="form-checkbox mr-3 ml-6 ml-sm-5 mb-2 mt-0">
                    <label class="f5 text-normal">
                      <input
                        type="checkbox"
                        name="thread_types[]"
                        value="Discussion"
                        data-targets="notifications-list-subscription-form.threadTypeCheckboxes"
                        data-action="change:notifications-list-subscription-form#threadTypeCheckboxesUpdated"
                        
                      >
                      Discussions
                    </label>

                      <span
                        class="tooltipped tooltipped-nw mr-2 p-1 float-right"
                        
                        aria-label="Discussions are not enabled for this repo">
                        <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-info color-fg-muted">
    <path fill-rule="evenodd" d="M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z"></path>
</svg>
                      </span>
                  </div>
                  <div class="form-checkbox mr-3 ml-6 ml-sm-5 mb-2 mt-0">
                    <label class="f5 text-normal">
                      <input
                        type="checkbox"
                        name="thread_types[]"
                        value="SecurityAlert"
                        data-targets="notifications-list-subscription-form.threadTypeCheckboxes"
                        data-action="change:notifications-list-subscription-form#threadTypeCheckboxesUpdated"
                        
                      >
                      Security alerts
                    </label>

                  </div>
              </fieldset>
              <div class="pt-2 pb-3 px-3 d-flex flex-justify-start flex-row-reverse">
                <button name="do" value="custom" data-target="notifications-list-subscription-form.customSubmit" disabled="disabled" type="submit" data-view-component="true" class="btn-primary btn-sm btn ml-2">  Apply
</button>

                <button data-action="click:notifications-list-subscription-form#resetForm" data-close-dialog="" type="button" data-view-component="true" class="btn-sm btn">  Cancel
</button>
              </div>
</form>          </div>
        </details-dialog>


        <div class="notifications-component-dialog-overlay"></div>
      </details>
    </notifications-list-subscription-form>



  </li>

  <li>
            <form class="btn-with-count" data-turbo="false" action="/adursunoglu16/petclinic-microservice-private/fork" accept-charset="UTF-8" method="post"><input type="hidden" name="authenticity_token" value="5COLDJC-XydIRxQAF_6V6qdq_O8RqmzmjsYh8s4VVfDesGVjOYGyF4m4I2saw64in2zQI_ITy3e4GeWqmSjp_g" autocomplete="off" />
        <button data-hydro-click="{&quot;event_type&quot;:&quot;repository.click&quot;,&quot;payload&quot;:{&quot;target&quot;:&quot;FORK_BUTTON&quot;,&quot;repository_id&quot;:465416313,&quot;originating_url&quot;:&quot;https://github.com/adursunoglu16/petclinic-microservice-private/blob/main/503-microservices-ci-cd-pipeline-with-helm/README.md&quot;,&quot;user_id&quot;:90970136}}" data-hydro-click-hmac="2870479e8d7449c31e2f752b0ff0cce8fb7af27240910a3bbb6d5be2a4373e19" data-ga-click="Repository, show fork modal, action:blob#show; text:Fork" aria-label="Fork your own copy of adursunoglu16/petclinic-microservice-private to your account" type="submit" data-view-component="true" class="btn-sm btn">  <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-repo-forked mr-2">
    <path fill-rule="evenodd" d="M5 3.25a.75.75 0 11-1.5 0 .75.75 0 011.5 0zm0 2.122a2.25 2.25 0 10-1.5 0v.878A2.25 2.25 0 005.75 8.5h1.5v2.128a2.251 2.251 0 101.5 0V8.5h1.5a2.25 2.25 0 002.25-2.25v-.878a2.25 2.25 0 10-1.5 0v.878a.75.75 0 01-.75.75h-4.5A.75.75 0 015 6.25v-.878zm3.75 7.378a.75.75 0 11-1.5 0 .75.75 0 011.5 0zm3-8.75a.75.75 0 100-1.5.75.75 0 000 1.5z"></path>
</svg>Fork
          <span id="repo-network-counter" data-pjax-replace="true" title="0" data-view-component="true" class="Counter">0</span>
</button></form>
  </li>

  <li>
        <template class="js-unstar-confirmation-dialog-template">
  <div class="Box-header">
    <h2 class="Box-title">Unstar this repository?</h2>
  </div>
  <div class="Box-body">
    <p class="mb-3">
      This will remove {{ repoNameWithOwner }} from the {{ listsWithCount }} that it's been added to.
    </p>
    <div class="form-actions">
      <form class="js-social-confirmation-form" data-turbo="false" action="{{ confirmUrl }}" accept-charset="UTF-8" method="post">
        <input type="hidden" name="authenticity_token" value="{{ confirmCsrfToken }}">
        <input type="hidden" name="confirm" value="true">
        <button data-close-dialog="true" type="submit" data-view-component="true" class="btn-danger btn width-full">  Unstar
</button>
</form>    </div>
  </div>
</template>

  <div data-view-component="true" class="js-toggler-container js-social-container starring-container BtnGroup d-flex">
    <form class="starred js-social-form BtnGroup-parent flex-auto js-deferred-toggler-target" data-turbo="false" action="/adursunoglu16/petclinic-microservice-private/unstar" accept-charset="UTF-8" method="post"><input type="hidden" name="authenticity_token" value="_1M_POmGsGG3fwqBQemSCjS3RlP1nRiIrxHM2-iJvooTArwyt8wsv3M4yN4Za0brERVVcNPTLTQ_g7H-hpQucg" autocomplete="off" />
        <input type="hidden" value="4ba0A_cRATQ1I-ghB5opv7X5ZxG8-ufjhqDdDdLONAkN5zcNqVud6vFkKn5fGP1ekFt0Mpq00l8WMqAovNOk8Q" data-csrf="true" class="js-confirm-csrf-token" />
      <input type="hidden" name="context" value="repository">
      <button data-hydro-click="{&quot;event_type&quot;:&quot;repository.click&quot;,&quot;payload&quot;:{&quot;target&quot;:&quot;UNSTAR_BUTTON&quot;,&quot;repository_id&quot;:465416313,&quot;originating_url&quot;:&quot;https://github.com/adursunoglu16/petclinic-microservice-private/blob/main/503-microservices-ci-cd-pipeline-with-helm/README.md&quot;,&quot;user_id&quot;:90970136}}" data-hydro-click-hmac="0bb54c98963617ce66a12cde4a3296f6d83b80a321cd6f06dfd0bd53e7ac6be9" data-ga-click="Repository, click unstar button, action:blob#show; text:Unstar" aria-label="Unstar this repository" type="submit" data-view-component="true" class="rounded-left-2 border-right-0 btn-sm btn BtnGroup-item">  <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-star-fill starred-button-icon d-inline-block mr-2">
    <path fill-rule="evenodd" d="M8 .25a.75.75 0 01.673.418l1.882 3.815 4.21.612a.75.75 0 01.416 1.279l-3.046 2.97.719 4.192a.75.75 0 01-1.088.791L8 12.347l-3.766 1.98a.75.75 0 01-1.088-.79l.72-4.194L.818 6.374a.75.75 0 01.416-1.28l4.21-.611L7.327.668A.75.75 0 018 .25z"></path>
</svg><span data-view-component="true" class="d-inline">
          Starred
</span>          <span id="repo-stars-counter-unstar" aria-label="0 users starred this repository" data-singular-suffix="user starred this repository" data-plural-suffix="users starred this repository" data-pjax-replace="true" title="0" data-view-component="true" class="Counter js-social-count">0</span>
</button></form>
    <form class="unstarred js-social-form BtnGroup-parent flex-auto" data-turbo="false" action="/adursunoglu16/petclinic-microservice-private/star" accept-charset="UTF-8" method="post"><input type="hidden" name="authenticity_token" value="lE-7h-TC9VWQN6wK0ormH877N3-2mq3fYgBxa5XSe8U9LeOc6j4Ck38VJLWBCev8b0nMejWbBxU12givbTWVgg" autocomplete="off" />
      <input type="hidden" name="context" value="repository">
      <button data-hydro-click="{&quot;event_type&quot;:&quot;repository.click&quot;,&quot;payload&quot;:{&quot;target&quot;:&quot;STAR_BUTTON&quot;,&quot;repository_id&quot;:465416313,&quot;originating_url&quot;:&quot;https://github.com/adursunoglu16/petclinic-microservice-private/blob/main/503-microservices-ci-cd-pipeline-with-helm/README.md&quot;,&quot;user_id&quot;:90970136}}" data-hydro-click-hmac="e1f9be8120225ec958932971878e8860c936e0d92623aa1a5c2f2461fc2dc367" data-ga-click="Repository, click star button, action:blob#show; text:Star" aria-label="Star this repository" type="submit" data-view-component="true" class="js-toggler-target rounded-left-2 btn-sm btn BtnGroup-item">  <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-star d-inline-block mr-2">
    <path fill-rule="evenodd" d="M8 .25a.75.75 0 01.673.418l1.882 3.815 4.21.612a.75.75 0 01.416 1.279l-3.046 2.97.719 4.192a.75.75 0 01-1.088.791L8 12.347l-3.766 1.98a.75.75 0 01-1.088-.79l.72-4.194L.818 6.374a.75.75 0 01.416-1.28l4.21-.611L7.327.668A.75.75 0 018 .25zm0 2.445L6.615 5.5a.75.75 0 01-.564.41l-3.097.45 2.24 2.184a.75.75 0 01.216.664l-.528 3.084 2.769-1.456a.75.75 0 01.698 0l2.77 1.456-.53-3.084a.75.75 0 01.216-.664l2.24-2.183-3.096-.45a.75.75 0 01-.564-.41L8 2.694v.001z"></path>
</svg><span data-view-component="true" class="d-inline">
          Star
</span>          <span id="repo-stars-counter-star" aria-label="0 users starred this repository" data-singular-suffix="user starred this repository" data-plural-suffix="users starred this repository" data-pjax-replace="true" title="0" data-view-component="true" class="Counter js-social-count">0</span>
</button></form>
      <details id="details-user-list-465416313" data-view-component="true" class="details-reset details-overlay BtnGroup-parent js-user-list-menu d-inline-block position-relative">
      <summary aria-label="Add this repository to a list" data-view-component="true" class="btn-sm btn BtnGroup-item px-2 float-none">  <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-triangle-down">
    <path d="M4.427 7.427l3.396 3.396a.25.25 0 00.354 0l3.396-3.396A.25.25 0 0011.396 7H4.604a.25.25 0 00-.177.427z"></path>
</svg>
</summary>
  <details-menu
    class="SelectMenu right-0"
      src="/adursunoglu16/petclinic-microservice-private/lists"
      
      role="menu"
      
>
    <div class="SelectMenu-modal">
        <button class="SelectMenu-closeButton position-absolute right-0 m-2" type="button" aria-label="Close menu" data-toggle-for="details-c3f5aa">
          <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-x">
    <path fill-rule="evenodd" d="M3.72 3.72a.75.75 0 011.06 0L8 6.94l3.22-3.22a.75.75 0 111.06 1.06L9.06 8l3.22 3.22a.75.75 0 11-1.06 1.06L8 9.06l-3.22 3.22a.75.75 0 01-1.06-1.06L6.94 8 3.72 4.78a.75.75 0 010-1.06z"></path>
</svg>
        </button>
      <div
        id="filter-menu-c3f5aa"
        class="d-flex flex-column flex-1 overflow-hidden"
>
        <div
          class="SelectMenu-list"
          >

            <include-fragment class="SelectMenu-loading" aria-label="Loading">
              <svg style="box-sizing: content-box; color: var(--color-icon-primary);" width="32" height="32" viewBox="0 0 16 16" fill="none" data-view-component="true" class="anim-rotate">
  <circle cx="8" cy="8" r="7" stroke="currentColor" stroke-opacity="0.25" stroke-width="2" vector-effect="non-scaling-stroke" />
  <path d="M15 8a7.002 7.002 0 00-7-7" stroke="currentColor" stroke-width="2" stroke-linecap="round" vector-effect="non-scaling-stroke" />
</svg>
            </include-fragment>
        </div>
        
      </div>
    </div>
  </details-menu>
</details>
</div>
  </li>

  

</ul>

      </div>

      <div id="responsive-meta-container" data-pjax-replace>
</div>


        
<nav data-pjax="#js-repo-pjax-container" aria-label="Repository" data-view-component="true" class="js-repo-nav js-sidenav-container-pjax js-responsive-underlinenav overflow-hidden UnderlineNav px-3 px-md-4 px-lg-5">

  <ul data-view-component="true" class="UnderlineNav-body list-style-none">
      <li data-view-component="true" class="d-inline-flex">
  <a id="code-tab" href="/adursunoglu16/petclinic-microservice-private" data-tab-item="i0code-tab" data-selected-links="repo_source repo_downloads repo_commits repo_releases repo_tags repo_branches repo_packages repo_deployments /adursunoglu16/petclinic-microservice-private" data-pjax="#repo-content-pjax-container" data-hotkey="g c" data-ga-click="Repository, Navigation click, Code tab" aria-current="page" data-view-component="true" class="UnderlineNav-item hx_underlinenav-item no-wrap js-responsive-underlinenav-item js-selected-navigation-item selected">
    
                  <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-code UnderlineNav-octicon d-none d-sm-inline">
    <path fill-rule="evenodd" d="M4.72 3.22a.75.75 0 011.06 1.06L2.06 8l3.72 3.72a.75.75 0 11-1.06 1.06L.47 8.53a.75.75 0 010-1.06l4.25-4.25zm6.56 0a.75.75 0 10-1.06 1.06L13.94 8l-3.72 3.72a.75.75 0 101.06 1.06l4.25-4.25a.75.75 0 000-1.06l-4.25-4.25z"></path>
</svg>
          <span data-content="Code">Code</span>
            <span id="code-repo-tab-count" data-pjax-replace="" title="Not available" data-view-component="true" class="Counter"></span>


    
</a></li>
      <li data-view-component="true" class="d-inline-flex">
  <a id="issues-tab" href="/adursunoglu16/petclinic-microservice-private/issues" data-tab-item="i1issues-tab" data-selected-links="repo_issues repo_labels repo_milestones /adursunoglu16/petclinic-microservice-private/issues" data-pjax="#repo-content-pjax-container" data-hotkey="g i" data-ga-click="Repository, Navigation click, Issues tab" data-view-component="true" class="UnderlineNav-item hx_underlinenav-item no-wrap js-responsive-underlinenav-item js-selected-navigation-item">
    
                  <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-issue-opened UnderlineNav-octicon d-none d-sm-inline">
    <path d="M8 9.5a1.5 1.5 0 100-3 1.5 1.5 0 000 3z"></path><path fill-rule="evenodd" d="M8 0a8 8 0 100 16A8 8 0 008 0zM1.5 8a6.5 6.5 0 1113 0 6.5 6.5 0 01-13 0z"></path>
</svg>
          <span data-content="Issues">Issues</span>
            <span id="issues-repo-tab-count" data-pjax-replace="" title="0" hidden="hidden" data-view-component="true" class="Counter">0</span>


    
</a></li>
      <li data-view-component="true" class="d-inline-flex">
  <a id="pull-requests-tab" href="/adursunoglu16/petclinic-microservice-private/pulls" data-tab-item="i2pull-requests-tab" data-selected-links="repo_pulls checks /adursunoglu16/petclinic-microservice-private/pulls" data-pjax="#repo-content-pjax-container" data-hotkey="g p" data-ga-click="Repository, Navigation click, Pull requests tab" data-view-component="true" class="UnderlineNav-item hx_underlinenav-item no-wrap js-responsive-underlinenav-item js-selected-navigation-item">
    
                  <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-git-pull-request UnderlineNav-octicon d-none d-sm-inline">
    <path fill-rule="evenodd" d="M7.177 3.073L9.573.677A.25.25 0 0110 .854v4.792a.25.25 0 01-.427.177L7.177 3.427a.25.25 0 010-.354zM3.75 2.5a.75.75 0 100 1.5.75.75 0 000-1.5zm-2.25.75a2.25 2.25 0 113 2.122v5.256a2.251 2.251 0 11-1.5 0V5.372A2.25 2.25 0 011.5 3.25zM11 2.5h-1V4h1a1 1 0 011 1v5.628a2.251 2.251 0 101.5 0V5A2.5 2.5 0 0011 2.5zm1 10.25a.75.75 0 111.5 0 .75.75 0 01-1.5 0zM3.75 12a.75.75 0 100 1.5.75.75 0 000-1.5z"></path>
</svg>
          <span data-content="Pull requests">Pull requests</span>
            <span id="pull-requests-repo-tab-count" data-pjax-replace="" title="0" hidden="hidden" data-view-component="true" class="Counter">0</span>


    
</a></li>
      <li data-view-component="true" class="d-inline-flex">
  <a id="actions-tab" href="/adursunoglu16/petclinic-microservice-private/actions" data-tab-item="i3actions-tab" data-selected-links="repo_actions /adursunoglu16/petclinic-microservice-private/actions" data-pjax="#repo-content-pjax-container" data-hotkey="g a" data-ga-click="Repository, Navigation click, Actions tab" data-view-component="true" class="UnderlineNav-item hx_underlinenav-item no-wrap js-responsive-underlinenav-item js-selected-navigation-item">
    
                  <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-play UnderlineNav-octicon d-none d-sm-inline">
    <path fill-rule="evenodd" d="M1.5 8a6.5 6.5 0 1113 0 6.5 6.5 0 01-13 0zM8 0a8 8 0 100 16A8 8 0 008 0zM6.379 5.227A.25.25 0 006 5.442v5.117a.25.25 0 00.379.214l4.264-2.559a.25.25 0 000-.428L6.379 5.227z"></path>
</svg>
          <span data-content="Actions">Actions</span>
            <span id="actions-repo-tab-count" data-pjax-replace="" title="Not available" data-view-component="true" class="Counter"></span>


    
</a></li>
      <li data-view-component="true" class="d-inline-flex">
  <a id="projects-tab" href="/adursunoglu16/petclinic-microservice-private/projects?type=beta" data-tab-item="i4projects-tab" data-selected-links="repo_projects new_repo_project repo_project /adursunoglu16/petclinic-microservice-private/projects?type=beta" data-pjax="#repo-content-pjax-container" data-hotkey="g b" data-ga-click="Repository, Navigation click, Projects tab" data-view-component="true" class="UnderlineNav-item hx_underlinenav-item no-wrap js-responsive-underlinenav-item js-selected-navigation-item">
    
                  <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-table UnderlineNav-octicon d-none d-sm-inline">
    <path fill-rule="evenodd" d="M0 1.75C0 .784.784 0 1.75 0h12.5C15.216 0 16 .784 16 1.75v3.585a.746.746 0 010 .83v8.085A1.75 1.75 0 0114.25 16H6.309a.748.748 0 01-1.118 0H1.75A1.75 1.75 0 010 14.25V6.165a.746.746 0 010-.83V1.75zM1.5 6.5v7.75c0 .138.112.25.25.25H5v-8H1.5zM5 5H1.5V1.75a.25.25 0 01.25-.25H5V5zm1.5 1.5v8h7.75a.25.25 0 00.25-.25V6.5h-8zm8-1.5h-8V1.5h7.75a.25.25 0 01.25.25V5z"></path>
</svg>
          <span data-content="Projects">Projects</span>
            <span id="projects-repo-tab-count" data-pjax-replace="" title="0" hidden="hidden" data-view-component="true" class="Counter">0</span>


    
</a></li>
      <li data-view-component="true" class="d-inline-flex">
  <a id="wiki-tab" href="/adursunoglu16/petclinic-microservice-private/wiki" data-tab-item="i5wiki-tab" data-selected-links="repo_wiki /adursunoglu16/petclinic-microservice-private/wiki" data-pjax="#repo-content-pjax-container" data-hotkey="g w" data-ga-click="Repository, Navigation click, Wikis tab" data-view-component="true" class="UnderlineNav-item hx_underlinenav-item no-wrap js-responsive-underlinenav-item js-selected-navigation-item">
    
                  <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-book UnderlineNav-octicon d-none d-sm-inline">
    <path fill-rule="evenodd" d="M0 1.75A.75.75 0 01.75 1h4.253c1.227 0 2.317.59 3 1.501A3.744 3.744 0 0111.006 1h4.245a.75.75 0 01.75.75v10.5a.75.75 0 01-.75.75h-4.507a2.25 2.25 0 00-1.591.659l-.622.621a.75.75 0 01-1.06 0l-.622-.621A2.25 2.25 0 005.258 13H.75a.75.75 0 01-.75-.75V1.75zm8.755 3a2.25 2.25 0 012.25-2.25H14.5v9h-3.757c-.71 0-1.4.201-1.992.572l.004-7.322zm-1.504 7.324l.004-5.073-.002-2.253A2.25 2.25 0 005.003 2.5H1.5v9h3.757a3.75 3.75 0 011.994.574z"></path>
</svg>
          <span data-content="Wiki">Wiki</span>
            <span id="wiki-repo-tab-count" data-pjax-replace="" title="Not available" data-view-component="true" class="Counter"></span>


    
</a></li>
      <li data-view-component="true" class="d-inline-flex">
  <a id="security-tab" href="/adursunoglu16/petclinic-microservice-private/security" data-tab-item="i6security-tab" data-selected-links="security overview alerts policy token_scanning code_scanning /adursunoglu16/petclinic-microservice-private/security" data-pjax="#repo-content-pjax-container" data-hotkey="g s" data-ga-click="Repository, Navigation click, Security tab" data-view-component="true" class="UnderlineNav-item hx_underlinenav-item no-wrap js-responsive-underlinenav-item js-selected-navigation-item">
    
                  <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-shield UnderlineNav-octicon d-none d-sm-inline">
    <path fill-rule="evenodd" d="M7.467.133a1.75 1.75 0 011.066 0l5.25 1.68A1.75 1.75 0 0115 3.48V7c0 1.566-.32 3.182-1.303 4.682-.983 1.498-2.585 2.813-5.032 3.855a1.7 1.7 0 01-1.33 0c-2.447-1.042-4.049-2.357-5.032-3.855C1.32 10.182 1 8.566 1 7V3.48a1.75 1.75 0 011.217-1.667l5.25-1.68zm.61 1.429a.25.25 0 00-.153 0l-5.25 1.68a.25.25 0 00-.174.238V7c0 1.358.275 2.666 1.057 3.86.784 1.194 2.121 2.34 4.366 3.297a.2.2 0 00.154 0c2.245-.956 3.582-2.104 4.366-3.298C13.225 9.666 13.5 8.36 13.5 7V3.48a.25.25 0 00-.174-.237l-5.25-1.68zM9 10.5a1 1 0 11-2 0 1 1 0 012 0zm-.25-5.75a.75.75 0 10-1.5 0v3a.75.75 0 001.5 0v-3z"></path>
</svg>
          <span data-content="Security">Security</span>
            <include-fragment src="/adursunoglu16/petclinic-microservice-private/security/overall-count" accept="text/fragment+html"></include-fragment>

    
</a></li>
      <li data-view-component="true" class="d-inline-flex">
  <a id="insights-tab" href="/adursunoglu16/petclinic-microservice-private/pulse" data-tab-item="i7insights-tab" data-selected-links="repo_graphs repo_contributors dependency_graph dependabot_updates pulse people community /adursunoglu16/petclinic-microservice-private/pulse" data-pjax="#repo-content-pjax-container" data-ga-click="Repository, Navigation click, Insights tab" data-view-component="true" class="UnderlineNav-item hx_underlinenav-item no-wrap js-responsive-underlinenav-item js-selected-navigation-item">
    
                  <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-graph UnderlineNav-octicon d-none d-sm-inline">
    <path fill-rule="evenodd" d="M1.5 1.75a.75.75 0 00-1.5 0v12.5c0 .414.336.75.75.75h14.5a.75.75 0 000-1.5H1.5V1.75zm14.28 2.53a.75.75 0 00-1.06-1.06L10 7.94 7.53 5.47a.75.75 0 00-1.06 0L3.22 8.72a.75.75 0 001.06 1.06L7 7.06l2.47 2.47a.75.75 0 001.06 0l5.25-5.25z"></path>
</svg>
          <span data-content="Insights">Insights</span>
            <span id="insights-repo-tab-count" data-pjax-replace="" title="Not available" data-view-component="true" class="Counter"></span>


    
</a></li>
</ul>
    <div style="visibility:hidden;" data-view-component="true" class="UnderlineNav-actions js-responsive-underlinenav-overflow position-absolute pr-3 pr-md-4 pr-lg-5 right-0">      <details data-view-component="true" class="details-overlay details-reset position-relative">
  <summary role="button" data-view-component="true">          <div class="UnderlineNav-item mr-0 border-0">
            <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-kebab-horizontal">
    <path d="M8 9a1.5 1.5 0 100-3 1.5 1.5 0 000 3zM1.5 9a1.5 1.5 0 100-3 1.5 1.5 0 000 3zm13 0a1.5 1.5 0 100-3 1.5 1.5 0 000 3z"></path>
</svg>
            <span class="sr-only">More</span>
          </div>
</summary>
  <div data-view-component="true">          <details-menu role="menu" data-view-component="true" class="dropdown-menu dropdown-menu-sw">
  
            <ul>
                <li data-menu-item="i0code-tab" hidden>
                  <a role="menuitem" class="js-selected-navigation-item selected dropdown-item" aria-current="page" data-selected-links="repo_source repo_downloads repo_commits repo_releases repo_tags repo_branches repo_packages repo_deployments /adursunoglu16/petclinic-microservice-private" href="/adursunoglu16/petclinic-microservice-private">
                    Code
</a>                </li>
                <li data-menu-item="i1issues-tab" hidden>
                  <a role="menuitem" class="js-selected-navigation-item dropdown-item" data-selected-links="repo_issues repo_labels repo_milestones /adursunoglu16/petclinic-microservice-private/issues" href="/adursunoglu16/petclinic-microservice-private/issues">
                    Issues
</a>                </li>
                <li data-menu-item="i2pull-requests-tab" hidden>
                  <a role="menuitem" class="js-selected-navigation-item dropdown-item" data-selected-links="repo_pulls checks /adursunoglu16/petclinic-microservice-private/pulls" href="/adursunoglu16/petclinic-microservice-private/pulls">
                    Pull requests
</a>                </li>
                <li data-menu-item="i3actions-tab" hidden>
                  <a role="menuitem" class="js-selected-navigation-item dropdown-item" data-selected-links="repo_actions /adursunoglu16/petclinic-microservice-private/actions" href="/adursunoglu16/petclinic-microservice-private/actions">
                    Actions
</a>                </li>
                <li data-menu-item="i4projects-tab" hidden>
                  <a role="menuitem" class="js-selected-navigation-item dropdown-item" data-selected-links="repo_projects new_repo_project repo_project /adursunoglu16/petclinic-microservice-private/projects?type=beta" href="/adursunoglu16/petclinic-microservice-private/projects?type=beta">
                    Projects
</a>                </li>
                <li data-menu-item="i5wiki-tab" hidden>
                  <a role="menuitem" class="js-selected-navigation-item dropdown-item" data-selected-links="repo_wiki /adursunoglu16/petclinic-microservice-private/wiki" href="/adursunoglu16/petclinic-microservice-private/wiki">
                    Wiki
</a>                </li>
                <li data-menu-item="i6security-tab" hidden>
                  <a role="menuitem" class="js-selected-navigation-item dropdown-item" data-selected-links="security overview alerts policy token_scanning code_scanning /adursunoglu16/petclinic-microservice-private/security" href="/adursunoglu16/petclinic-microservice-private/security">
                    Security
</a>                </li>
                <li data-menu-item="i7insights-tab" hidden>
                  <a role="menuitem" class="js-selected-navigation-item dropdown-item" data-selected-links="repo_graphs repo_contributors dependency_graph dependabot_updates pulse people community /adursunoglu16/petclinic-microservice-private/pulse" href="/adursunoglu16/petclinic-microservice-private/pulse">
                    Insights
</a>                </li>
            </ul>

</details-menu></div>
</details></div>
</nav>
  </div>



<div id="repo-content-pjax-container" class="repository-content " >
    <a href="https://github.dev/" class="d-none js-github-dev-shortcut" data-hotkey=".">Open in github.dev</a>
  <a href="https://github.dev/" class="d-none js-github-dev-new-tab-shortcut" data-hotkey="Shift+.,Shift+&gt;,&gt;" target="_blank">Open in a new github.dev tab</a>

  


  
      
  <div class="clearfix container-xl px-3 px-md-4 px-lg-5 mt-4">
    
    
<div>
  




    
<a class="d-none js-permalink-shortcut" data-hotkey="y" href="/adursunoglu16/petclinic-microservice-private/blob/9ee109408761880e7191ca9ed524d4bb8b85e03c/503-microservices-ci-cd-pipeline-with-helm/README.md">Permalink</a>

<div class="d-flex flex-items-start flex-shrink-0 pb-3 flex-wrap flex-md-nowrap flex-justify-between flex-md-justify-start">
  
<div class="position-relative">
  <details class="details-reset details-overlay mr-0 mb-0 " id="branch-select-menu">
    <summary class="btn css-truncate"
            data-hotkey="w"
            title="Switch branches or tags">
      <svg text="gray" aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-git-branch">
    <path fill-rule="evenodd" d="M11.75 2.5a.75.75 0 100 1.5.75.75 0 000-1.5zm-2.25.75a2.25 2.25 0 113 2.122V6A2.5 2.5 0 0110 8.5H6a1 1 0 00-1 1v1.128a2.251 2.251 0 11-1.5 0V5.372a2.25 2.25 0 111.5 0v1.836A2.492 2.492 0 016 7h4a1 1 0 001-1v-.628A2.25 2.25 0 019.5 3.25zM4.25 12a.75.75 0 100 1.5.75.75 0 000-1.5zM3.5 3.25a.75.75 0 111.5 0 .75.75 0 01-1.5 0z"></path>
</svg>
      <span class="css-truncate-target" data-menu-button>main</span>
      <span class="dropdown-caret"></span>
    </summary>

      
<div class="SelectMenu">
  <div class="SelectMenu-modal">
    <header class="SelectMenu-header">
      <span class="SelectMenu-title">Switch branches/tags</span>
      <button class="SelectMenu-closeButton" type="button" data-toggle-for="branch-select-menu"><svg aria-label="Close menu" aria-hidden="false" role="img" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-x">
    <path fill-rule="evenodd" d="M3.72 3.72a.75.75 0 011.06 0L8 6.94l3.22-3.22a.75.75 0 111.06 1.06L9.06 8l3.22 3.22a.75.75 0 11-1.06 1.06L8 9.06l-3.22 3.22a.75.75 0 01-1.06-1.06L6.94 8 3.72 4.78a.75.75 0 010-1.06z"></path>
</svg></button>
    </header>

    <input-demux data-action="tab-container-change:input-demux#storeInput tab-container-changed:input-demux#updateInput">
      <tab-container class="d-flex flex-column js-branches-tags-tabs" style="min-height: 0;">
        <div class="SelectMenu-filter">
          <input data-target="input-demux.source"
                 id="context-commitish-filter-field"
                 class="SelectMenu-input form-control"
                 aria-owns="ref-list-branches"
                 data-controls-ref-menu-id="ref-list-branches"
                 autofocus
                 autocomplete="off"
                 aria-label="Filter branches/tags"
                 placeholder="Filter branches/tags"
                 type="text"
          >
        </div>

        <div class="SelectMenu-tabs" role="tablist" data-target="input-demux.control" >
          <button class="SelectMenu-tab" type="button" role="tab" aria-selected="true">Branches</button>
          <button class="SelectMenu-tab" type="button" role="tab">Tags</button>
        </div>

        <div role="tabpanel" id="ref-list-branches" data-filter-placeholder="Filter branches/tags" tabindex="" class="d-flex flex-column flex-auto overflow-auto">
          <ref-selector
            type="branch"
            data-targets="input-demux.sinks"
            data-action="
              input-entered:ref-selector#inputEntered
              tab-selected:ref-selector#tabSelected
              focus-list:ref-selector#focusFirstListMember
            "
            query-endpoint="/adursunoglu16/petclinic-microservice-private/refs"
            
            cache-key="v0:1647683412.550334"
            current-committish="bWFpbg=="
            default-branch="bWFpbg=="
            name-with-owner="YWR1cnN1bm9nbHUxNi9wZXRjbGluaWMtbWljcm9zZXJ2aWNlLXByaXZhdGU="
            prefetch-on-mouseover
          >

            <template data-target="ref-selector.fetchFailedTemplate">
              <div class="SelectMenu-message" data-index="{{ index }}">Could not load branches</div>
            </template>

              <template data-target="ref-selector.noMatchTemplate">
    <div class="SelectMenu-message">Nothing to show</div>
</template>


            <!-- TODO: this max-height is necessary or else the branch list won't scroll.  why? -->
            <div data-target="ref-selector.listContainer" role="menu" class="SelectMenu-list " style="max-height: 330px" data-pjax="#repo-content-pjax-container">
              <div class="SelectMenu-loading pt-3 pb-0 overflow-hidden" aria-label="Menu is loading">
                <svg style="box-sizing: content-box; color: var(--color-icon-primary);" width="32" height="32" viewBox="0 0 16 16" fill="none" data-view-component="true" class="anim-rotate">
  <circle cx="8" cy="8" r="7" stroke="currentColor" stroke-opacity="0.25" stroke-width="2" vector-effect="non-scaling-stroke" />
  <path d="M15 8a7.002 7.002 0 00-7-7" stroke="currentColor" stroke-width="2" stroke-linecap="round" vector-effect="non-scaling-stroke" />
</svg>
              </div>
            </div>

              <template data-target="ref-selector.itemTemplate">
  <a href="https://github.com/adursunoglu16/petclinic-microservice-private/blob/{{ urlEncodedRefName }}/503-microservices-ci-cd-pipeline-with-helm/README.md" class="SelectMenu-item" role="menuitemradio" rel="nofollow" aria-checked="{{ isCurrent }}" data-index="{{ index }}">
    <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-check SelectMenu-icon SelectMenu-icon--check">
    <path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path>
</svg>
    <span class="flex-1 css-truncate css-truncate-overflow {{ isFilteringClass }}">{{ refName }}</span>
    <span hidden="{{ isNotDefault }}" class="Label Label--secondary flex-self-start">default</span>
  </a>
</template>


              <footer class="SelectMenu-footer"><a href="/adursunoglu16/petclinic-microservice-private/branches">View all branches</a></footer>
          </ref-selector>

        </div>

        <div role="tabpanel" id="tags-menu" data-filter-placeholder="Find a tag" tabindex="" hidden class="d-flex flex-column flex-auto overflow-auto">
          <ref-selector
            type="tag"
            data-action="
              input-entered:ref-selector#inputEntered
              tab-selected:ref-selector#tabSelected
              focus-list:ref-selector#focusFirstListMember
            "
            data-targets="input-demux.sinks"
            query-endpoint="/adursunoglu16/petclinic-microservice-private/refs"
            cache-key="v0:1647683412.550334"
            current-committish="bWFpbg=="
            default-branch="bWFpbg=="
            name-with-owner="YWR1cnN1bm9nbHUxNi9wZXRjbGluaWMtbWljcm9zZXJ2aWNlLXByaXZhdGU="
          >

            <template data-target="ref-selector.fetchFailedTemplate">
              <div class="SelectMenu-message" data-index="{{ index }}">Could not load tags</div>
            </template>

            <template data-target="ref-selector.noMatchTemplate">
              <div class="SelectMenu-message" data-index="{{ index }}">Nothing to show</div>
            </template>

              <template data-target="ref-selector.itemTemplate">
  <a href="https://github.com/adursunoglu16/petclinic-microservice-private/blob/{{ urlEncodedRefName }}/503-microservices-ci-cd-pipeline-with-helm/README.md" class="SelectMenu-item" role="menuitemradio" rel="nofollow" aria-checked="{{ isCurrent }}" data-index="{{ index }}">
    <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-check SelectMenu-icon SelectMenu-icon--check">
    <path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path>
</svg>
    <span class="flex-1 css-truncate css-truncate-overflow {{ isFilteringClass }}">{{ refName }}</span>
    <span hidden="{{ isNotDefault }}" class="Label Label--secondary flex-self-start">default</span>
  </a>
</template>


            <div data-target="ref-selector.listContainer" role="menu" class="SelectMenu-list" style="max-height: 330px" data-pjax="#repo-content-pjax-container">
              <div class="SelectMenu-loading pt-3 pb-0 overflow-hidden" aria-label="Menu is loading">
                <svg style="box-sizing: content-box; color: var(--color-icon-primary);" width="32" height="32" viewBox="0 0 16 16" fill="none" data-view-component="true" class="anim-rotate">
  <circle cx="8" cy="8" r="7" stroke="currentColor" stroke-opacity="0.25" stroke-width="2" vector-effect="non-scaling-stroke" />
  <path d="M15 8a7.002 7.002 0 00-7-7" stroke="currentColor" stroke-width="2" stroke-linecap="round" vector-effect="non-scaling-stroke" />
</svg>
              </div>
            </div>
              <footer class="SelectMenu-footer"><a href="/adursunoglu16/petclinic-microservice-private/tags">View all tags</a></footer>
          </ref-selector>
        </div>
      </tab-container>
    </input-demux>
  </div>
</div>

  </details>

</div>

  <h2 id="blob-path" class="breadcrumb flex-auto flex-self-center min-width-0 text-normal mx-2 width-full width-md-auto flex-order-1 flex-md-order-none mt-3 mt-md-0">
    <span class="js-repo-root text-bold"><span class="js-path-segment d-inline-block wb-break-all"><a data-pjax="#repo-content-pjax-container" href="/adursunoglu16/petclinic-microservice-private"><span>petclinic-microservice-private</span></a></span></span><span class="separator">/</span><span class="js-path-segment d-inline-block wb-break-all"><a data-pjax="#repo-content-pjax-container" href="/adursunoglu16/petclinic-microservice-private/tree/main/503-microservices-ci-cd-pipeline-with-helm"><span>503-microservices-ci-cd-pipeline-with-helm</span></a></span><span class="separator">/</span><strong class="final-path">README.md</strong>
  </h2>
  <a href="/adursunoglu16/petclinic-microservice-private/find/main" data-pjax="" data-hotkey="t" data-view-component="true" class="js-pjax-capture-input btn mr-2 d-none d-md-block">  Go to file
</a>
  <details id="blob-more-options-details" data-view-component="true" class="details-overlay details-reset position-relative">
  <summary role="button" data-view-component="true" class="btn">  <svg aria-label="More options" role="img" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-kebab-horizontal">
    <path d="M8 9a1.5 1.5 0 100-3 1.5 1.5 0 000 3zM1.5 9a1.5 1.5 0 100-3 1.5 1.5 0 000 3zm13 0a1.5 1.5 0 100-3 1.5 1.5 0 000 3z"></path>
</svg>
</summary>
  <div data-view-component="true">      <ul class="dropdown-menu dropdown-menu-sw">
        <li class="d-block d-md-none">
          <a class="dropdown-item d-flex flex-items-baseline" data-hydro-click="{&quot;event_type&quot;:&quot;repository.click&quot;,&quot;payload&quot;:{&quot;target&quot;:&quot;FIND_FILE_BUTTON&quot;,&quot;repository_id&quot;:465416313,&quot;originating_url&quot;:&quot;https://github.com/adursunoglu16/petclinic-microservice-private/blob/main/503-microservices-ci-cd-pipeline-with-helm/README.md&quot;,&quot;user_id&quot;:90970136}}" data-hydro-click-hmac="855ae78795308363fec4d56caa6101db74ac3dc4c585698afab293ab98500cb4" data-ga-click="Repository, find file, location:repo overview" data-hotkey="t" data-pjax="true" href="/adursunoglu16/petclinic-microservice-private/find/main">
            <span class="flex-auto">Go to file</span>
            <span class="text-small color-fg-muted" aria-hidden="true">T</span>
</a>        </li>
        <li data-toggle-for="blob-more-options-details">
          <button data-toggle-for="jumpto-line-details-dialog" type="button" data-view-component="true" class="dropdown-item btn-link">  <span class="d-flex flex-items-baseline">
              <span class="flex-auto">Go to line</span>
              <span class="text-small color-fg-muted" aria-hidden="true">L</span>
            </span>
</button>        </li>
        <li class="dropdown-divider" role="none"></li>
        <li>
          <clipboard-copy data-toggle-for="blob-more-options-details" aria-label="Copy path" value="503-microservices-ci-cd-pipeline-with-helm/README.md" data-view-component="true" class="dropdown-item cursor-pointer">
    
            Copy path

</clipboard-copy>        </li>
        <li>
          <clipboard-copy data-toggle-for="blob-more-options-details" aria-label="Copy permalink" value="https://github.com/adursunoglu16/petclinic-microservice-private/blob/9ee109408761880e7191ca9ed524d4bb8b85e03c/503-microservices-ci-cd-pipeline-with-helm/README.md" data-view-component="true" class="dropdown-item cursor-pointer">
    
            <span class="d-flex flex-items-baseline">
              <span class="flex-auto">Copy permalink</span>
            </span>

</clipboard-copy>        </li>
      </ul>
</div>
</details></div>





    <div id="spoof-warning" class="mt-0 pb-3" hidden aria-hidden>
  <div data-view-component="true" class="flash flash-warn mt-0 clearfix">
  
  
    <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-alert float-left mt-1">
    <path fill-rule="evenodd" d="M8.22 1.754a.25.25 0 00-.44 0L1.698 13.132a.25.25 0 00.22.368h12.164a.25.25 0 00.22-.368L8.22 1.754zm-1.763-.707c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0114.082 15H1.918a1.75 1.75 0 01-1.543-2.575L6.457 1.047zM9 11a1 1 0 11-2 0 1 1 0 012 0zm-.25-5.25a.75.75 0 00-1.5 0v2.5a.75.75 0 001.5 0v-2.5z"></path>
</svg>

      <div class="overflow-hidden">This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.</div>


  
</div></div>

    <include-fragment src="/adursunoglu16/petclinic-microservice-private/spoofed_commit_check/9ee109408761880e7191ca9ed524d4bb8b85e03c" data-test-selector="spoofed-commit-check"></include-fragment>

    <div class="Box d-flex flex-column flex-shrink-0 mb-3">
  <include-fragment src="/adursunoglu16/petclinic-microservice-private/contributors/main/503-microservices-ci-cd-pipeline-with-helm/README.md" class="commit-loader">
    <div class="Box-header d-flex flex-items-center">
      <div class="Skeleton avatar avatar-user flex-shrink-0 ml-n1 mr-n1 mt-n1 mb-n1" style="width:24px;height:24px;"></div>
      <div class="Skeleton Skeleton--text col-5 ml-2">&nbsp;</div>
    </div>

    <div class="Box-body d-flex flex-items-center" >
      <div class="Skeleton Skeleton--text col-1">&nbsp;</div>
      <span class="color-fg-danger h6 loader-error">Cannot retrieve contributors at this time</span>
    </div>
</include-fragment></div>



      







    <readme-toc>

    <div data-target="readme-toc.content" class="Box mt-3 position-relative">
      
  <div
    class="Box-header js-blob-header blob-header js-sticky js-position-sticky top-0 p-2 d-flex flex-shrink-0 flex-md-row flex-items-center"
    style="position: sticky; z-index: 1;"
  >

      <details
  data-target="readme-toc.trigger"
  data-menu-hydro-click="{&quot;event_type&quot;:&quot;repository_toc_menu.click&quot;,&quot;payload&quot;:{&quot;target&quot;:&quot;trigger&quot;,&quot;repository_id&quot;:465416313,&quot;originating_url&quot;:&quot;https://github.com/adursunoglu16/petclinic-microservice-private/blob/main/503-microservices-ci-cd-pipeline-with-helm/README.md&quot;,&quot;user_id&quot;:90970136}}"
  data-menu-hydro-click-hmac="0199ed4dfa07a7df330c298d873681a48a055b5f532c806d75c61a8b6b1273d6"
  class="dropdown details-reset details-overlay"
>
  <summary
    class="btn btn-octicon m-0 mr-2 p-2"
    aria-haspopup="true"
    aria-label="Table of Contents">
    <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-list-unordered">
    <path fill-rule="evenodd" d="M2 4a1 1 0 100-2 1 1 0 000 2zm3.75-1.5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zm0 5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zm0 5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zM3 8a1 1 0 11-2 0 1 1 0 012 0zm-1 6a1 1 0 100-2 1 1 0 000 2z"></path>
</svg>
  </summary>


  <details-menu class="SelectMenu" role="menu">
    <div class="SelectMenu-modal rounded-3 mt-1" style="max-height:340px;">

        <div class="SelectMenu-filter">
          <input
            class="SelectMenu-input form-control js-filterable-field"
            id="toc-filter-field"
            type="text"
            autocomplete="off"
            spellcheck="false"
            autofocus
            placeholder="Filter headings"
            aria-label="Filter headings">
        </div>

      <div class="SelectMenu-list SelectMenu-list--borderless p-2" style="overscroll-behavior: contain;" data-filterable-for="toc-filter-field" data-filterable-type="substring">
          <a role="menuitem" class="filter-item SelectMenu-item ws-normal wb-break-word line-clamp-2 py-1 text-emphasized" style="-webkit-box-orient: vertical; padding-left: 12px;" data-action="click:readme-toc#blur" data-targets="readme-toc.entries" data-hydro-click="{&quot;event_type&quot;:&quot;repository_toc_menu.click&quot;,&quot;payload&quot;:{&quot;target&quot;:&quot;entry&quot;,&quot;repository_id&quot;:465416313,&quot;originating_url&quot;:&quot;https://github.com/adursunoglu16/petclinic-microservice-private/blob/main/503-microservices-ci-cd-pipeline-with-helm/README.md&quot;,&quot;user_id&quot;:90970136}}" data-hydro-click-hmac="fc14076e554699b63ff812b52ee2bee9ec6281f6de1cfeba7fac5cb5f99a61d0" href="#project-503-microservices-cicd-pipeline">Project 503: Microservices CI/CD Pipeline</a>
          <a role="menuitem" class="filter-item SelectMenu-item ws-normal wb-break-word line-clamp-2 py-1 " style="-webkit-box-orient: vertical; padding-left: 24px;" data-action="click:readme-toc#blur" data-targets="readme-toc.entries" data-hydro-click="{&quot;event_type&quot;:&quot;repository_toc_menu.click&quot;,&quot;payload&quot;:{&quot;target&quot;:&quot;entry&quot;,&quot;repository_id&quot;:465416313,&quot;originating_url&quot;:&quot;https://github.com/adursunoglu16/petclinic-microservice-private/blob/main/503-microservices-ci-cd-pipeline-with-helm/README.md&quot;,&quot;user_id&quot;:90970136}}" data-hydro-click-hmac="fc14076e554699b63ff812b52ee2bee9ec6281f6de1cfeba7fac5cb5f99a61d0" href="#description">Description</a>
          <a role="menuitem" class="filter-item SelectMenu-item ws-normal wb-break-word line-clamp-2 py-1 " style="-webkit-box-orient: vertical; padding-left: 24px;" data-action="click:readme-toc#blur" data-targets="readme-toc.entries" data-hydro-click="{&quot;event_type&quot;:&quot;repository_toc_menu.click&quot;,&quot;payload&quot;:{&quot;target&quot;:&quot;entry&quot;,&quot;repository_id&quot;:465416313,&quot;originating_url&quot;:&quot;https://github.com/adursunoglu16/petclinic-microservice-private/blob/main/503-microservices-ci-cd-pipeline-with-helm/README.md&quot;,&quot;user_id&quot;:90970136}}" data-hydro-click-hmac="fc14076e554699b63ff812b52ee2bee9ec6281f6de1cfeba7fac5cb5f99a61d0" href="#devops-pipelines">DevOps Pipelines</a>
          <a role="menuitem" class="filter-item SelectMenu-item ws-normal wb-break-word line-clamp-2 py-1 " style="-webkit-box-orient: vertical; padding-left: 36px;" data-action="click:readme-toc#blur" data-targets="readme-toc.entries" data-hydro-click="{&quot;event_type&quot;:&quot;repository_toc_menu.click&quot;,&quot;payload&quot;:{&quot;target&quot;:&quot;entry&quot;,&quot;repository_id&quot;:465416313,&quot;originating_url&quot;:&quot;https://github.com/adursunoglu16/petclinic-microservice-private/blob/main/503-microservices-ci-cd-pipeline-with-helm/README.md&quot;,&quot;user_id&quot;:90970136}}" data-hydro-click-hmac="fc14076e554699b63ff812b52ee2bee9ec6281f6de1cfeba7fac5cb5f99a61d0" href="#development-diagram">Development Diagram</a>
          <a role="menuitem" class="filter-item SelectMenu-item ws-normal wb-break-word line-clamp-2 py-1 " style="-webkit-box-orient: vertical; padding-left: 36px;" data-action="click:readme-toc#blur" data-targets="readme-toc.entries" data-hydro-click="{&quot;event_type&quot;:&quot;repository_toc_menu.click&quot;,&quot;payload&quot;:{&quot;target&quot;:&quot;entry&quot;,&quot;repository_id&quot;:465416313,&quot;originating_url&quot;:&quot;https://github.com/adursunoglu16/petclinic-microservice-private/blob/main/503-microservices-ci-cd-pipeline-with-helm/README.md&quot;,&quot;user_id&quot;:90970136}}" data-hydro-click-hmac="fc14076e554699b63ff812b52ee2bee9ec6281f6de1cfeba7fac5cb5f99a61d0" href="#pipelines-configurations">Pipelines Configurations</a>
          <a role="menuitem" class="filter-item SelectMenu-item ws-normal wb-break-word line-clamp-2 py-1 " style="-webkit-box-orient: vertical; padding-left: 24px;" data-action="click:readme-toc#blur" data-targets="readme-toc.entries" data-hydro-click="{&quot;event_type&quot;:&quot;repository_toc_menu.click&quot;,&quot;payload&quot;:{&quot;target&quot;:&quot;entry&quot;,&quot;repository_id&quot;:465416313,&quot;originating_url&quot;:&quot;https://github.com/adursunoglu16/petclinic-microservice-private/blob/main/503-microservices-ci-cd-pipeline-with-helm/README.md&quot;,&quot;user_id&quot;:90970136}}" data-hydro-click-hmac="fc14076e554699b63ff812b52ee2bee9ec6281f6de1cfeba7fac5cb5f99a61d0" href="#flow-of-tasks-for-project-realization">Flow of Tasks for Project Realization</a>
          <a role="menuitem" class="filter-item SelectMenu-item ws-normal wb-break-word line-clamp-2 py-1 " style="-webkit-box-orient: vertical; padding-left: 24px;" data-action="click:readme-toc#blur" data-targets="readme-toc.entries" data-hydro-click="{&quot;event_type&quot;:&quot;repository_toc_menu.click&quot;,&quot;payload&quot;:{&quot;target&quot;:&quot;entry&quot;,&quot;repository_id&quot;:465416313,&quot;originating_url&quot;:&quot;https://github.com/adursunoglu16/petclinic-microservice-private/blob/main/503-microservices-ci-cd-pipeline-with-helm/README.md&quot;,&quot;user_id&quot;:90970136}}" data-hydro-click-hmac="fc14076e554699b63ff812b52ee2bee9ec6281f6de1cfeba7fac5cb5f99a61d0" href="#msp-1---prepare-development-server-manually-on-ec2-instance">MSP 1 - Prepare Development Server Manually on EC2 Instance</a>
          <a role="menuitem" class="filter-item SelectMenu-item ws-normal wb-break-word line-clamp-2 py-1 " style="-webkit-box-orient: vertical; padding-left: 24px;" data-action="click:readme-toc#blur" data-targets="readme-toc.entries" data-hydro-click="{&quot;event_type&quot;:&quot;repository_toc_menu.click&quot;,&quot;payload&quot;:{&quot;target&quot;:&quot;entry&quot;,&quot;repository_id&quot;:465416313,&quot;originating_url&quot;:&quot;https://github.com/adursunoglu16/petclinic-microservice-private/blob/main/503-microservices-ci-cd-pipeline-with-helm/README.md&quot;,&quot;user_id&quot;:90970136}}" data-hydro-click-hmac="fc14076e554699b63ff812b52ee2bee9ec6281f6de1cfeba7fac5cb5f99a61d0" href="#msp-2---prepare-github-repository-for-the-project">MSP 2 - Prepare GitHub Repository for the Project</a>
          <a role="menuitem" class="filter-item SelectMenu-item ws-normal wb-break-word line-clamp-2 py-1 " style="-webkit-box-orient: vertical; padding-left: 24px;" data-action="click:readme-toc#blur" data-targets="readme-toc.entries" data-hydro-click="{&quot;event_type&quot;:&quot;repository_toc_menu.click&quot;,&quot;payload&quot;:{&quot;target&quot;:&quot;entry&quot;,&quot;repository_id&quot;:465416313,&quot;originating_url&quot;:&quot;https://github.com/adursunoglu16/petclinic-microservice-private/blob/main/503-microservices-ci-cd-pipeline-with-helm/README.md&quot;,&quot;user_id&quot;:90970136}}" data-hydro-click-hmac="fc14076e554699b63ff812b52ee2bee9ec6281f6de1cfeba7fac5cb5f99a61d0" href="#msp-3---check-the-maven-build-setup-on-dev-branch">MSP 3 - Check the Maven Build Setup on Dev Branch</a>
          <a role="menuitem" class="filter-item SelectMenu-item ws-normal wb-break-word line-clamp-2 py-1 " style="-webkit-box-orient: vertical; padding-left: 24px;" data-action="click:readme-toc#blur" data-targets="readme-toc.entries" data-hydro-click="{&quot;event_type&quot;:&quot;repository_toc_menu.click&quot;,&quot;payload&quot;:{&quot;target&quot;:&quot;entry&quot;,&quot;repository_id&quot;:465416313,&quot;originating_url&quot;:&quot;https://github.com/adursunoglu16/petclinic-microservice-private/blob/main/503-microservices-ci-cd-pipeline-with-helm/README.md&quot;,&quot;user_id&quot;:90970136}}" data-hydro-click-hmac="fc14076e554699b63ff812b52ee2bee9ec6281f6de1cfeba7fac5cb5f99a61d0" href="#msp-4---prepare-a-script-for-packaging-the-application">MSP 4 - Prepare a Script for Packaging the Application</a>
          <a role="menuitem" class="filter-item SelectMenu-item ws-normal wb-break-word line-clamp-2 py-1 " style="-webkit-box-orient: vertical; padding-left: 24px;" data-action="click:readme-toc#blur" data-targets="readme-toc.entries" data-hydro-click="{&quot;event_type&quot;:&quot;repository_toc_menu.click&quot;,&quot;payload&quot;:{&quot;target&quot;:&quot;entry&quot;,&quot;repository_id&quot;:465416313,&quot;originating_url&quot;:&quot;https://github.com/adursunoglu16/petclinic-microservice-private/blob/main/503-microservices-ci-cd-pipeline-with-helm/README.md&quot;,&quot;user_id&quot;:90970136}}" data-hydro-click-hmac="fc14076e554699b63ff812b52ee2bee9ec6281f6de1cfeba7fac5cb5f99a61d0" href="#msp-5---prepare-development-server-cloudformation-template">MSP 5 - Prepare Development Server Cloudformation Template</a>
          <a role="menuitem" class="filter-item SelectMenu-item ws-normal wb-break-word line-clamp-2 py-1 " style="-webkit-box-orient: vertical; padding-left: 24px;" data-action="click:readme-toc#blur" data-targets="readme-toc.entries" data-hydro-click="{&quot;event_type&quot;:&quot;repository_toc_menu.click&quot;,&quot;payload&quot;:{&quot;target&quot;:&quot;entry&quot;,&quot;repository_id&quot;:465416313,&quot;originating_url&quot;:&quot;https://github.com/adursunoglu16/petclinic-microservice-private/blob/main/503-microservices-ci-cd-pipeline-with-helm/README.md&quot;,&quot;user_id&quot;:90970136}}" data-hydro-click-hmac="fc14076e554699b63ff812b52ee2bee9ec6281f6de1cfeba7fac5cb5f99a61d0" href="#msp-6---prepare-dockerfiles-for-microservices">MSP 6 - Prepare Dockerfiles for Microservices</a>
          <a role="menuitem" class="filter-item SelectMenu-item ws-normal wb-break-word line-clamp-2 py-1 " style="-webkit-box-orient: vertical; padding-left: 24px;" data-action="click:readme-toc#blur" data-targets="readme-toc.entries" data-hydro-click="{&quot;event_type&quot;:&quot;repository_toc_menu.click&quot;,&quot;payload&quot;:{&quot;target&quot;:&quot;entry&quot;,&quot;repository_id&quot;:465416313,&quot;originating_url&quot;:&quot;https://github.com/adursunoglu16/petclinic-microservice-private/blob/main/503-microservices-ci-cd-pipeline-with-helm/README.md&quot;,&quot;user_id&quot;:90970136}}" data-hydro-click-hmac="fc14076e554699b63ff812b52ee2bee9ec6281f6de1cfeba7fac5cb5f99a61d0" href="#msp-7---prepare-script-for-building-docker-images">MSP 7 - Prepare Script for Building Docker Images</a>
          <a role="menuitem" class="filter-item SelectMenu-item ws-normal wb-break-word line-clamp-2 py-1 " style="-webkit-box-orient: vertical; padding-left: 24px;" data-action="click:readme-toc#blur" data-targets="readme-toc.entries" data-hydro-click="{&quot;event_type&quot;:&quot;repository_toc_menu.click&quot;,&quot;payload&quot;:{&quot;target&quot;:&quot;entry&quot;,&quot;repository_id&quot;:465416313,&quot;originating_url&quot;:&quot;https://github.com/adursunoglu16/petclinic-microservice-private/blob/main/503-microservices-ci-cd-pipeline-with-helm/README.md&quot;,&quot;user_id&quot;:90970136}}" data-hydro-click-hmac="fc14076e554699b63ff812b52ee2bee9ec6281f6de1cfeba7fac5cb5f99a61d0" href="#msp-8---create-docker-compose-file-for-local-development">MSP 8 - Create Docker Compose File for Local Development</a>
          <a role="menuitem" class="filter-item SelectMenu-item ws-normal wb-break-word line-clamp-2 py-1 " style="-webkit-box-orient: vertical; padding-left: 24px;" data-action="click:readme-toc#blur" data-targets="readme-toc.entries" data-hydro-click="{&quot;event_type&quot;:&quot;repository_toc_menu.click&quot;,&quot;payload&quot;:{&quot;target&quot;:&quot;entry&quot;,&quot;repository_id&quot;:465416313,&quot;originating_url&quot;:&quot;https://github.com/adursunoglu16/petclinic-microservice-private/blob/main/503-microservices-ci-cd-pipeline-with-helm/README.md&quot;,&quot;user_id&quot;:90970136}}" data-hydro-click-hmac="fc14076e554699b63ff812b52ee2bee9ec6281f6de1cfeba7fac5cb5f99a61d0" href="#msp-9---setup-unit-tests-and-configure-code-coverage-report">MSP 9 - Setup Unit Tests and Configure Code Coverage Report</a>
          <a role="menuitem" class="filter-item SelectMenu-item ws-normal wb-break-word line-clamp-2 py-1 " style="-webkit-box-orient: vertical; padding-left: 24px;" data-action="click:readme-toc#blur" data-targets="readme-toc.entries" data-hydro-click="{&quot;event_type&quot;:&quot;repository_toc_menu.click&quot;,&quot;payload&quot;:{&quot;target&quot;:&quot;entry&quot;,&quot;repository_id&quot;:465416313,&quot;originating_url&quot;:&quot;https://github.com/adursunoglu16/petclinic-microservice-private/blob/main/503-microservices-ci-cd-pipeline-with-helm/README.md&quot;,&quot;user_id&quot;:90970136}}" data-hydro-click-hmac="fc14076e554699b63ff812b52ee2bee9ec6281f6de1cfeba7fac5cb5f99a61d0" href="#msp-10---prepare-and-implement-selenium-tests">MSP 10 - Prepare and Implement Selenium Tests</a>
          <a role="menuitem" class="filter-item SelectMenu-item ws-normal wb-break-word line-clamp-2 py-1 " style="-webkit-box-orient: vertical; padding-left: 24px;" data-action="click:readme-toc#blur" data-targets="readme-toc.entries" data-hydro-click="{&quot;event_type&quot;:&quot;repository_toc_menu.click&quot;,&quot;payload&quot;:{&quot;target&quot;:&quot;entry&quot;,&quot;repository_id&quot;:465416313,&quot;originating_url&quot;:&quot;https://github.com/adursunoglu16/petclinic-microservice-private/blob/main/503-microservices-ci-cd-pipeline-with-helm/README.md&quot;,&quot;user_id&quot;:90970136}}" data-hydro-click-hmac="fc14076e554699b63ff812b52ee2bee9ec6281f6de1cfeba7fac5cb5f99a61d0" href="#msp-11---prepare-jenkins-server-for-cicd-pipeline">MSP 11 - Prepare Jenkins Server for CI/CD Pipeline</a>
          <a role="menuitem" class="filter-item SelectMenu-item ws-normal wb-break-word line-clamp-2 py-1 " style="-webkit-box-orient: vertical; padding-left: 24px;" data-action="click:readme-toc#blur" data-targets="readme-toc.entries" data-hydro-click="{&quot;event_type&quot;:&quot;repository_toc_menu.click&quot;,&quot;payload&quot;:{&quot;target&quot;:&quot;entry&quot;,&quot;repository_id&quot;:465416313,&quot;originating_url&quot;:&quot;https://github.com/adursunoglu16/petclinic-microservice-private/blob/main/503-microservices-ci-cd-pipeline-with-helm/README.md&quot;,&quot;user_id&quot;:90970136}}" data-hydro-click-hmac="fc14076e554699b63ff812b52ee2bee9ec6281f6de1cfeba7fac5cb5f99a61d0" href="#msp-12---configure-jenkins-server-for-project">MSP 12 - Configure Jenkins Server for Project</a>
          <a role="menuitem" class="filter-item SelectMenu-item ws-normal wb-break-word line-clamp-2 py-1 " style="-webkit-box-orient: vertical; padding-left: 24px;" data-action="click:readme-toc#blur" data-targets="readme-toc.entries" data-hydro-click="{&quot;event_type&quot;:&quot;repository_toc_menu.click&quot;,&quot;payload&quot;:{&quot;target&quot;:&quot;entry&quot;,&quot;repository_id&quot;:465416313,&quot;originating_url&quot;:&quot;https://github.com/adursunoglu16/petclinic-microservice-private/blob/main/503-microservices-ci-cd-pipeline-with-helm/README.md&quot;,&quot;user_id&quot;:90970136}}" data-hydro-click-hmac="fc14076e554699b63ff812b52ee2bee9ec6281f6de1cfeba7fac5cb5f99a61d0" href="#msp-13---prepare-continuous-integration-ci-pipeline">MSP 13 - Prepare Continuous Integration (CI) Pipeline</a>
          <a role="menuitem" class="filter-item SelectMenu-item ws-normal wb-break-word line-clamp-2 py-1 " style="-webkit-box-orient: vertical; padding-left: 24px;" data-action="click:readme-toc#blur" data-targets="readme-toc.entries" data-hydro-click="{&quot;event_type&quot;:&quot;repository_toc_menu.click&quot;,&quot;payload&quot;:{&quot;target&quot;:&quot;entry&quot;,&quot;repository_id&quot;:465416313,&quot;originating_url&quot;:&quot;https://github.com/adursunoglu16/petclinic-microservice-private/blob/main/503-microservices-ci-cd-pipeline-with-helm/README.md&quot;,&quot;user_id&quot;:90970136}}" data-hydro-click-hmac="fc14076e554699b63ff812b52ee2bee9ec6281f6de1cfeba7fac5cb5f99a61d0" href="#msp-14---create-docker-registry-for-dev-manually">MSP 14 - Create Docker Registry for Dev Manually</a>
          <a role="menuitem" class="filter-item SelectMenu-item ws-normal wb-break-word line-clamp-2 py-1 " style="-webkit-box-orient: vertical; padding-left: 24px;" data-action="click:readme-toc#blur" data-targets="readme-toc.entries" data-hydro-click="{&quot;event_type&quot;:&quot;repository_toc_menu.click&quot;,&quot;payload&quot;:{&quot;target&quot;:&quot;entry&quot;,&quot;repository_id&quot;:465416313,&quot;originating_url&quot;:&quot;https://github.com/adursunoglu16/petclinic-microservice-private/blob/main/503-microservices-ci-cd-pipeline-with-helm/README.md&quot;,&quot;user_id&quot;:90970136}}" data-hydro-click-hmac="fc14076e554699b63ff812b52ee2bee9ec6281f6de1cfeba7fac5cb5f99a61d0" href="#msp-15---prepare-script-for-development-docker-registry">MSP 15 - Prepare Script for Development Docker Registry</a>
          <a role="menuitem" class="filter-item SelectMenu-item ws-normal wb-break-word line-clamp-2 py-1 " style="-webkit-box-orient: vertical; padding-left: 24px;" data-action="click:readme-toc#blur" data-targets="readme-toc.entries" data-hydro-click="{&quot;event_type&quot;:&quot;repository_toc_menu.click&quot;,&quot;payload&quot;:{&quot;target&quot;:&quot;entry&quot;,&quot;repository_id&quot;:465416313,&quot;originating_url&quot;:&quot;https://github.com/adursunoglu16/petclinic-microservice-private/blob/main/503-microservices-ci-cd-pipeline-with-helm/README.md&quot;,&quot;user_id&quot;:90970136}}" data-hydro-click-hmac="fc14076e554699b63ff812b52ee2bee9ec6281f6de1cfeba7fac5cb5f99a61d0" href="#msp-16---create-a-qa-automation-environment-with-docker-swarm">MSP 16 - Create a QA Automation Environment with Docker Swarm</a>
          <a role="menuitem" class="filter-item SelectMenu-item ws-normal wb-break-word line-clamp-2 py-1 " style="-webkit-box-orient: vertical; padding-left: 24px;" data-action="click:readme-toc#blur" data-targets="readme-toc.entries" data-hydro-click="{&quot;event_type&quot;:&quot;repository_toc_menu.click&quot;,&quot;payload&quot;:{&quot;target&quot;:&quot;entry&quot;,&quot;repository_id&quot;:465416313,&quot;originating_url&quot;:&quot;https://github.com/adursunoglu16/petclinic-microservice-private/blob/main/503-microservices-ci-cd-pipeline-with-helm/README.md&quot;,&quot;user_id&quot;:90970136}}" data-hydro-click-hmac="fc14076e554699b63ff812b52ee2bee9ec6281f6de1cfeba7fac5cb5f99a61d0" href="#msp-17---prepare-a-qa-automation-pipeline-for-nightly-builds">MSP 17 - Prepare a QA Automation Pipeline for Nightly Builds</a>
          <a role="menuitem" class="filter-item SelectMenu-item ws-normal wb-break-word line-clamp-2 py-1 " style="-webkit-box-orient: vertical; padding-left: 24px;" data-action="click:readme-toc#blur" data-targets="readme-toc.entries" data-hydro-click="{&quot;event_type&quot;:&quot;repository_toc_menu.click&quot;,&quot;payload&quot;:{&quot;target&quot;:&quot;entry&quot;,&quot;repository_id&quot;:465416313,&quot;originating_url&quot;:&quot;https://github.com/adursunoglu16/petclinic-microservice-private/blob/main/503-microservices-ci-cd-pipeline-with-helm/README.md&quot;,&quot;user_id&quot;:90970136}}" data-hydro-click-hmac="fc14076e554699b63ff812b52ee2bee9ec6281f6de1cfeba7fac5cb5f99a61d0" href="#msp-18---create-a-qa-environment-on-docker-swarm-with-cloudformation-and-ansible">MSP 18 - Create a QA Environment on Docker Swarm with Cloudformation and Ansible</a>
          <a role="menuitem" class="filter-item SelectMenu-item ws-normal wb-break-word line-clamp-2 py-1 " style="-webkit-box-orient: vertical; padding-left: 24px;" data-action="click:readme-toc#blur" data-targets="readme-toc.entries" data-hydro-click="{&quot;event_type&quot;:&quot;repository_toc_menu.click&quot;,&quot;payload&quot;:{&quot;target&quot;:&quot;entry&quot;,&quot;repository_id&quot;:465416313,&quot;originating_url&quot;:&quot;https://github.com/adursunoglu16/petclinic-microservice-private/blob/main/503-microservices-ci-cd-pipeline-with-helm/README.md&quot;,&quot;user_id&quot;:90970136}}" data-hydro-click-hmac="fc14076e554699b63ff812b52ee2bee9ec6281f6de1cfeba7fac5cb5f99a61d0" href="#msp-19---prepare-build-scripts-for-qa-environment">MSP 19 - Prepare Build Scripts for QA Environment</a>
          <a role="menuitem" class="filter-item SelectMenu-item ws-normal wb-break-word line-clamp-2 py-1 " style="-webkit-box-orient: vertical; padding-left: 24px;" data-action="click:readme-toc#blur" data-targets="readme-toc.entries" data-hydro-click="{&quot;event_type&quot;:&quot;repository_toc_menu.click&quot;,&quot;payload&quot;:{&quot;target&quot;:&quot;entry&quot;,&quot;repository_id&quot;:465416313,&quot;originating_url&quot;:&quot;https://github.com/adursunoglu16/petclinic-microservice-private/blob/main/503-microservices-ci-cd-pipeline-with-helm/README.md&quot;,&quot;user_id&quot;:90970136}}" data-hydro-click-hmac="fc14076e554699b63ff812b52ee2bee9ec6281f6de1cfeba7fac5cb5f99a61d0" href="#msp-20---build-and-deploy-app-on-qa-environment-manually">MSP 20 - Build and Deploy App on QA Environment Manually</a>
          <a role="menuitem" class="filter-item SelectMenu-item ws-normal wb-break-word line-clamp-2 py-1 " style="-webkit-box-orient: vertical; padding-left: 24px;" data-action="click:readme-toc#blur" data-targets="readme-toc.entries" data-hydro-click="{&quot;event_type&quot;:&quot;repository_toc_menu.click&quot;,&quot;payload&quot;:{&quot;target&quot;:&quot;entry&quot;,&quot;repository_id&quot;:465416313,&quot;originating_url&quot;:&quot;https://github.com/adursunoglu16/petclinic-microservice-private/blob/main/503-microservices-ci-cd-pipeline-with-helm/README.md&quot;,&quot;user_id&quot;:90970136}}" data-hydro-click-hmac="fc14076e554699b63ff812b52ee2bee9ec6281f6de1cfeba7fac5cb5f99a61d0" href="#msp-21---prepare-a-qa-pipeline">MSP 21 - Prepare a QA Pipeline</a>
          <a role="menuitem" class="filter-item SelectMenu-item ws-normal wb-break-word line-clamp-2 py-1 " style="-webkit-box-orient: vertical; padding-left: 24px;" data-action="click:readme-toc#blur" data-targets="readme-toc.entries" data-hydro-click="{&quot;event_type&quot;:&quot;repository_toc_menu.click&quot;,&quot;payload&quot;:{&quot;target&quot;:&quot;entry&quot;,&quot;repository_id&quot;:465416313,&quot;originating_url&quot;:&quot;https://github.com/adursunoglu16/petclinic-microservice-private/blob/main/503-microservices-ci-cd-pipeline-with-helm/README.md&quot;,&quot;user_id&quot;:90970136}}" data-hydro-click-hmac="fc14076e554699b63ff812b52ee2bee9ec6281f6de1cfeba7fac5cb5f99a61d0" href="#msp-22---prepare-high-availability-rke-kubernetes-cluster-on-aws-ec2">MSP 22 - Prepare High-availability RKE Kubernetes Cluster on AWS EC2</a>
          <a role="menuitem" class="filter-item SelectMenu-item ws-normal wb-break-word line-clamp-2 py-1 " style="-webkit-box-orient: vertical; padding-left: 24px;" data-action="click:readme-toc#blur" data-targets="readme-toc.entries" data-hydro-click="{&quot;event_type&quot;:&quot;repository_toc_menu.click&quot;,&quot;payload&quot;:{&quot;target&quot;:&quot;entry&quot;,&quot;repository_id&quot;:465416313,&quot;originating_url&quot;:&quot;https://github.com/adursunoglu16/petclinic-microservice-private/blob/main/503-microservices-ci-cd-pipeline-with-helm/README.md&quot;,&quot;user_id&quot;:90970136}}" data-hydro-click-hmac="fc14076e554699b63ff812b52ee2bee9ec6281f6de1cfeba7fac5cb5f99a61d0" href="#msp-23---install-rancher-app-on-rke-kubernetes-cluster">MSP 23 - Install Rancher App on RKE Kubernetes Cluster</a>
          <a role="menuitem" class="filter-item SelectMenu-item ws-normal wb-break-word line-clamp-2 py-1 " style="-webkit-box-orient: vertical; padding-left: 24px;" data-action="click:readme-toc#blur" data-targets="readme-toc.entries" data-hydro-click="{&quot;event_type&quot;:&quot;repository_toc_menu.click&quot;,&quot;payload&quot;:{&quot;target&quot;:&quot;entry&quot;,&quot;repository_id&quot;:465416313,&quot;originating_url&quot;:&quot;https://github.com/adursunoglu16/petclinic-microservice-private/blob/main/503-microservices-ci-cd-pipeline-with-helm/README.md&quot;,&quot;user_id&quot;:90970136}}" data-hydro-click-hmac="fc14076e554699b63ff812b52ee2bee9ec6281f6de1cfeba7fac5cb5f99a61d0" href="#msp-24---prepare-petlinic-kubernetes-yaml-files">MSP 24 - Prepare Petlinic Kubernetes YAML Files</a>
          <a role="menuitem" class="filter-item SelectMenu-item ws-normal wb-break-word line-clamp-2 py-1 " style="-webkit-box-orient: vertical; padding-left: 36px;" data-action="click:readme-toc#blur" data-targets="readme-toc.entries" data-hydro-click="{&quot;event_type&quot;:&quot;repository_toc_menu.click&quot;,&quot;payload&quot;:{&quot;target&quot;:&quot;entry&quot;,&quot;repository_id&quot;:465416313,&quot;originating_url&quot;:&quot;https://github.com/adursunoglu16/petclinic-microservice-private/blob/main/503-microservices-ci-cd-pipeline-with-helm/README.md&quot;,&quot;user_id&quot;:90970136}}" data-hydro-click-hmac="fc14076e554699b63ff812b52ee2bee9ec6281f6de1cfeba7fac5cb5f99a61d0" href="#set-up-a-helm-v3-chart-repository-in-amazon-s3">Set up a Helm v3 chart repository in Amazon S3</a>
          <a role="menuitem" class="filter-item SelectMenu-item ws-normal wb-break-word line-clamp-2 py-1 " style="-webkit-box-orient: vertical; padding-left: 24px;" data-action="click:readme-toc#blur" data-targets="readme-toc.entries" data-hydro-click="{&quot;event_type&quot;:&quot;repository_toc_menu.click&quot;,&quot;payload&quot;:{&quot;target&quot;:&quot;entry&quot;,&quot;repository_id&quot;:465416313,&quot;originating_url&quot;:&quot;https://github.com/adursunoglu16/petclinic-microservice-private/blob/main/503-microservices-ci-cd-pipeline-with-helm/README.md&quot;,&quot;user_id&quot;:90970136}}" data-hydro-click-hmac="fc14076e554699b63ff812b52ee2bee9ec6281f6de1cfeba7fac5cb5f99a61d0" href="#msp-25---create-staging-and-production-environment-with-rancher">MSP 25 - Create Staging and Production Environment with Rancher</a>
          <a role="menuitem" class="filter-item SelectMenu-item ws-normal wb-break-word line-clamp-2 py-1 " style="-webkit-box-orient: vertical; padding-left: 24px;" data-action="click:readme-toc#blur" data-targets="readme-toc.entries" data-hydro-click="{&quot;event_type&quot;:&quot;repository_toc_menu.click&quot;,&quot;payload&quot;:{&quot;target&quot;:&quot;entry&quot;,&quot;repository_id&quot;:465416313,&quot;originating_url&quot;:&quot;https://github.com/adursunoglu16/petclinic-microservice-private/blob/main/503-microservices-ci-cd-pipeline-with-helm/README.md&quot;,&quot;user_id&quot;:90970136}}" data-hydro-click-hmac="fc14076e554699b63ff812b52ee2bee9ec6281f6de1cfeba7fac5cb5f99a61d0" href="#msp-26---prepare-a-staging-pipeline">MSP 26 - Prepare a Staging Pipeline</a>
          <a role="menuitem" class="filter-item SelectMenu-item ws-normal wb-break-word line-clamp-2 py-1 " style="-webkit-box-orient: vertical; padding-left: 24px;" data-action="click:readme-toc#blur" data-targets="readme-toc.entries" data-hydro-click="{&quot;event_type&quot;:&quot;repository_toc_menu.click&quot;,&quot;payload&quot;:{&quot;target&quot;:&quot;entry&quot;,&quot;repository_id&quot;:465416313,&quot;originating_url&quot;:&quot;https://github.com/adursunoglu16/petclinic-microservice-private/blob/main/503-microservices-ci-cd-pipeline-with-helm/README.md&quot;,&quot;user_id&quot;:90970136}}" data-hydro-click-hmac="fc14076e554699b63ff812b52ee2bee9ec6281f6de1cfeba7fac5cb5f99a61d0" href="#msp-27---prepare-a-production-pipeline">MSP 27 - Prepare a Production Pipeline</a>
          <a role="menuitem" class="filter-item SelectMenu-item ws-normal wb-break-word line-clamp-2 py-1 " style="-webkit-box-orient: vertical; padding-left: 24px;" data-action="click:readme-toc#blur" data-targets="readme-toc.entries" data-hydro-click="{&quot;event_type&quot;:&quot;repository_toc_menu.click&quot;,&quot;payload&quot;:{&quot;target&quot;:&quot;entry&quot;,&quot;repository_id&quot;:465416313,&quot;originating_url&quot;:&quot;https://github.com/adursunoglu16/petclinic-microservice-private/blob/main/503-microservices-ci-cd-pipeline-with-helm/README.md&quot;,&quot;user_id&quot;:90970136}}" data-hydro-click-hmac="fc14076e554699b63ff812b52ee2bee9ec6281f6de1cfeba7fac5cb5f99a61d0" href="#msp-28---setting-domain-name-and-tls-for-production-pipeline-with-route-53">MSP 28 - Setting Domain Name and TLS for Production Pipeline with Route 53</a>
          <a role="menuitem" class="filter-item SelectMenu-item ws-normal wb-break-word line-clamp-2 py-1 " style="-webkit-box-orient: vertical; padding-left: 24px;" data-action="click:readme-toc#blur" data-targets="readme-toc.entries" data-hydro-click="{&quot;event_type&quot;:&quot;repository_toc_menu.click&quot;,&quot;payload&quot;:{&quot;target&quot;:&quot;entry&quot;,&quot;repository_id&quot;:465416313,&quot;originating_url&quot;:&quot;https://github.com/adursunoglu16/petclinic-microservice-private/blob/main/503-microservices-ci-cd-pipeline-with-helm/README.md&quot;,&quot;user_id&quot;:90970136}}" data-hydro-click-hmac="fc14076e554699b63ff812b52ee2bee9ec6281f6de1cfeba7fac5cb5f99a61d0" href="#msp-29---monitoring-with-prometheus-and-grafana">MSP 29 - Monitoring with Prometheus and Grafana</a>
      </div>
    </div>
  </details-menu>
</details>


  <div class="text-mono f6 flex-auto pr-3 flex-order-2 flex-md-order-1">

      3954 lines (3320 sloc)
      <span class="file-info-divider"></span>
    158 KB
  </div>

  <div class="d-flex py-1 py-md-0 flex-auto flex-order-1 flex-md-order-2 flex-sm-grow-0 flex-justify-between hide-sm hide-md">
        <div class="BtnGroup">
    <a href="/adursunoglu16/petclinic-microservice-private/blob/main/503-microservices-ci-cd-pipeline-with-helm/README.md?plain=1" data-permalink-href="/adursunoglu16/petclinic-microservice-private/blob/9ee109408761880e7191ca9ed524d4bb8b85e03c/503-microservices-ci-cd-pipeline-with-helm/README.md?plain=1" aria-label="Display the source blob" data-view-component="true" class="source tooltipped tooltipped tooltipped-n  js-permalink-replaceable-link btn-sm btn BtnGroup-item">  <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-code">
    <path fill-rule="evenodd" d="M4.72 3.22a.75.75 0 011.06 1.06L2.06 8l3.72 3.72a.75.75 0 11-1.06 1.06L.47 8.53a.75.75 0 010-1.06l4.25-4.25zm6.56 0a.75.75 0 10-1.06 1.06L13.94 8l-3.72 3.72a.75.75 0 101.06 1.06l4.25-4.25a.75.75 0 000-1.06l-4.25-4.25z"></path>
</svg>
</a>    <a href="/adursunoglu16/petclinic-microservice-private/blob/main/503-microservices-ci-cd-pipeline-with-helm/README.md" data-permalink-href="/adursunoglu16/petclinic-microservice-private/blob/9ee109408761880e7191ca9ed524d4bb8b85e03c/503-microservices-ci-cd-pipeline-with-helm/README.md" aria-label="Display the rendered blob" data-view-component="true" class="rendered tooltipped tooltipped tooltipped-n selected js-permalink-replaceable-link btn-sm btn BtnGroup-item">  <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-file">
    <path fill-rule="evenodd" d="M3.75 1.5a.25.25 0 00-.25.25v11.5c0 .138.112.25.25.25h8.5a.25.25 0 00.25-.25V6H9.75A1.75 1.75 0 018 4.25V1.5H3.75zm5.75.56v2.19c0 .138.112.25.25.25h2.19L9.5 2.06zM2 1.75C2 .784 2.784 0 3.75 0h5.086c.464 0 .909.184 1.237.513l3.414 3.414c.329.328.513.773.513 1.237v8.086A1.75 1.75 0 0112.25 15h-8.5A1.75 1.75 0 012 13.25V1.75z"></path>
</svg>
</a>  </div>


    <div class="BtnGroup">
      <a data-permalink-href="/adursunoglu16/petclinic-microservice-private/raw/9ee109408761880e7191ca9ed524d4bb8b85e03c/503-microservices-ci-cd-pipeline-with-helm/README.md" href="/adursunoglu16/petclinic-microservice-private/raw/main/503-microservices-ci-cd-pipeline-with-helm/README.md" id="raw-url" data-view-component="true" class="js-permalink-replaceable-link btn-sm btn BtnGroup-item">  Raw
</a>        <a data-permalink-href="/adursunoglu16/petclinic-microservice-private/blame/9ee109408761880e7191ca9ed524d4bb8b85e03c/503-microservices-ci-cd-pipeline-with-helm/README.md" href="/adursunoglu16/petclinic-microservice-private/blame/main/503-microservices-ci-cd-pipeline-with-helm/README.md" data-hotkey="b" data-view-component="true" class="js-update-url-with-hash js-permalink-replaceable-link btn-sm btn BtnGroup-item">  Blame
</a>    </div>

    <div>
          <a class="btn-octicon tooltipped tooltipped-nw js-remove-unless-platform"
             data-platforms="windows,mac"
             href="x-github-client://openRepo/https://github.com/adursunoglu16/petclinic-microservice-private?branch=main&amp;filepath=503-microservices-ci-cd-pipeline-with-helm%2FREADME.md"
             aria-label="Open this file in GitHub Desktop"
             data-ga-click="Repository, open with desktop">
              <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-device-desktop">
    <path fill-rule="evenodd" d="M1.75 2.5h12.5a.25.25 0 01.25.25v7.5a.25.25 0 01-.25.25H1.75a.25.25 0 01-.25-.25v-7.5a.25.25 0 01.25-.25zM14.25 1H1.75A1.75 1.75 0 000 2.75v7.5C0 11.216.784 12 1.75 12h3.727c-.1 1.041-.52 1.872-1.292 2.757A.75.75 0 004.75 16h6.5a.75.75 0 00.565-1.243c-.772-.885-1.193-1.716-1.292-2.757h3.727A1.75 1.75 0 0016 10.25v-7.5A1.75 1.75 0 0014.25 1zM9.018 12H6.982a5.72 5.72 0 01-.765 2.5h3.566a5.72 5.72 0 01-.765-2.5z"></path>
</svg>
          </a>

        <remote-clipboard-copy class="d-inline-block btn-octicon" style="height: 26px" data-src="/adursunoglu16/petclinic-microservice-private/raw/main/503-microservices-ci-cd-pipeline-with-helm/README.md" data-action="click:remote-clipboard-copy#remoteCopy">
  


  <span data-target="remote-clipboard-copy.idle">            <span class="tooltipped tooltipped-nw cursor-pointer" data-hydro-click="{&quot;event_type&quot;:&quot;repository.click&quot;,&quot;payload&quot;:{&quot;target&quot;:&quot;COPY_RAW_CONTENTS_BUTTON&quot;,&quot;repository_id&quot;:465416313,&quot;originating_url&quot;:&quot;https://github.com/adursunoglu16/petclinic-microservice-private/blob/main/503-microservices-ci-cd-pipeline-with-helm/README.md&quot;,&quot;user_id&quot;:90970136}}" data-hydro-click-hmac="b6176534d07f8194922647076ceacd3e9bbab9b9dcd39e98e5b831b06e9ac2bf" aria-label="Copy raw contents">
              <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-copy">
    <path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path>
</svg>
</span></span>
  <span data-target="remote-clipboard-copy.fetching" hidden="hidden">            <svg style="box-sizing: content-box; color: var(--color-icon-primary);" width="16" height="16" viewBox="0 0 16 16" fill="none" data-view-component="true" class="anim-rotate">
  <circle cx="8" cy="8" r="7" stroke="currentColor" stroke-opacity="0.25" stroke-width="2" vector-effect="non-scaling-stroke" />
  <path d="M15 8a7.002 7.002 0 00-7-7" stroke="currentColor" stroke-width="2" stroke-linecap="round" vector-effect="non-scaling-stroke" />
</svg>
</span>
  <span data-target="remote-clipboard-copy.success" hidden="hidden">            <span class="tooltipped tooltipped-nw" aria-label="Copied!">
              <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-check color-fg-success">
    <path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path>
</svg>
            </span>
</span>
  <span data-target="remote-clipboard-copy.error" hidden="hidden">            <span class="tooltipped tooltipped-nw" aria-label="Something went wrong. Try again.">
              <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-alert color-fg-attention">
    <path fill-rule="evenodd" d="M8.22 1.754a.25.25 0 00-.44 0L1.698 13.132a.25.25 0 00.22.368h12.164a.25.25 0 00.22-.368L8.22 1.754zm-1.763-.707c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0114.082 15H1.918a1.75 1.75 0 01-1.543-2.575L6.457 1.047zM9 11a1 1 0 11-2 0 1 1 0 012 0zm-.25-5.25a.75.75 0 00-1.5 0v2.5a.75.75 0 001.5 0v-2.5z"></path>
</svg>
            </span>
</span>
</remote-clipboard-copy>
          <!-- '"` --><!-- </textarea></xmp> --></option></form><form class="inline-form js-update-url-with-hash" data-turbo="false" action="/adursunoglu16/petclinic-microservice-private/edit/main/503-microservices-ci-cd-pipeline-with-helm/README.md" accept-charset="UTF-8" method="post"><input type="hidden" name="authenticity_token" value="TCU5aqXcoEawcGOJbYGok2B8sosEUmgnqj4Ivm3wPGZpkpjUI-WB64y6GElErc_c0-t6goxefXQPZsov7UwzyQ" />
            <button class="btn-octicon tooltipped tooltipped-nw" type="submit"
              aria-label="Fork this project and edit the file" data-hotkey="e" data-disable-with>
              <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-pencil">
    <path fill-rule="evenodd" d="M11.013 1.427a1.75 1.75 0 012.474 0l1.086 1.086a1.75 1.75 0 010 2.474l-8.61 8.61c-.21.21-.47.364-.756.445l-3.251.93a.75.75 0 01-.927-.928l.929-3.25a1.75 1.75 0 01.445-.758l8.61-8.61zm1.414 1.06a.25.25 0 00-.354 0L10.811 3.75l1.439 1.44 1.263-1.263a.25.25 0 000-.354l-1.086-1.086zM11.189 6.25L9.75 4.81l-6.286 6.287a.25.25 0 00-.064.108l-.558 1.953 1.953-.558a.249.249 0 00.108-.064l6.286-6.286z"></path>
</svg>
            </button>
</form>
          <!-- '"` --><!-- </textarea></xmp> --></option></form><form class="inline-form" data-turbo="false" action="/adursunoglu16/petclinic-microservice-private/delete/main/503-microservices-ci-cd-pipeline-with-helm/README.md" accept-charset="UTF-8" method="post"><input type="hidden" name="authenticity_token" value="zWZoxxFFj8EecolWj59qsfSSKZrUbpFwdlaB-QN6-HJaso-kXO4EdjNXYl4NIVNkjUToCmDb2bIl6f386B-xcA" />
            <button class="btn-octicon btn-octicon-danger tooltipped tooltipped-nw" type="submit"
              aria-label="Fork this project and delete the file" data-disable-with>
              <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-trash">
    <path fill-rule="evenodd" d="M6.5 1.75a.25.25 0 01.25-.25h2.5a.25.25 0 01.25.25V3h-3V1.75zm4.5 0V3h2.25a.75.75 0 010 1.5H2.75a.75.75 0 010-1.5H5V1.75C5 .784 5.784 0 6.75 0h2.5C10.216 0 11 .784 11 1.75zM4.496 6.675a.75.75 0 10-1.492.15l.66 6.6A1.75 1.75 0 005.405 15h5.19c.9 0 1.652-.681 1.741-1.576l.66-6.6a.75.75 0 00-1.492-.149l-.66 6.6a.25.25 0 01-.249.225h-5.19a.25.25 0 01-.249-.225l-.66-6.6z"></path>
</svg>
            </button>
</form>    </div>
  </div>

    <div class="d-flex hide-lg hide-xl flex-order-2 flex-grow-0">
      <details class="dropdown details-reset details-overlay d-inline-block">
        <summary class="btn-octicon p-2" aria-haspopup="true" aria-label="possible actions">
          <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-kebab-horizontal">
    <path d="M8 9a1.5 1.5 0 100-3 1.5 1.5 0 000 3zM1.5 9a1.5 1.5 0 100-3 1.5 1.5 0 000 3zm13 0a1.5 1.5 0 100-3 1.5 1.5 0 000 3z"></path>
</svg>
        </summary>

        <ul class="dropdown-menu dropdown-menu-sw" style="width: 175px">
            <li>
                <a class="dropdown-item tooltipped tooltipped-nw js-remove-unless-platform"
                   data-platforms="windows,mac"
                   href="x-github-client://openRepo/https://github.com/adursunoglu16/petclinic-microservice-private?branch=main&amp;filepath=503-microservices-ci-cd-pipeline-with-helm%2FREADME.md"
                   data-ga-click="Repository, open with desktop">
                  Open with Desktop
                </a>
            </li>
          <li>
            <a class="dropdown-item" href="/adursunoglu16/petclinic-microservice-private/raw/main/503-microservices-ci-cd-pipeline-with-helm/README.md">
              View raw
            </a>
          </li>
            <li>
              <remote-clipboard-copy class="dropdown-item" data-src="/adursunoglu16/petclinic-microservice-private/raw/main/503-microservices-ci-cd-pipeline-with-helm/README.md" data-action="click:remote-clipboard-copy#remoteCopy">
  

  <span data-target="remote-clipboard-copy.idle">                  <span class="cursor-pointer" data-hydro-click="{&quot;event_type&quot;:&quot;repository.click&quot;,&quot;payload&quot;:{&quot;target&quot;:&quot;COPY_RAW_CONTENTS_BUTTON&quot;,&quot;repository_id&quot;:465416313,&quot;originating_url&quot;:&quot;https://github.com/adursunoglu16/petclinic-microservice-private/blob/main/503-microservices-ci-cd-pipeline-with-helm/README.md&quot;,&quot;user_id&quot;:90970136}}" data-hydro-click-hmac="b6176534d07f8194922647076ceacd3e9bbab9b9dcd39e98e5b831b06e9ac2bf">
                    Copy raw contents
</span></span>
  <span data-target="remote-clipboard-copy.fetching" hidden="hidden">                  Copy raw contents
                  <span class="d-inline-block position-relative" style="top: 3px">
                    <svg aria-label="fetching contents…" style="box-sizing: content-box; color: var(--color-icon-primary);" width="16" height="16" viewBox="0 0 16 16" fill="none" data-view-component="true" class="anim-rotate">
  <circle cx="8" cy="8" r="7" stroke="currentColor" stroke-opacity="0.25" stroke-width="2" vector-effect="non-scaling-stroke" />
  <path d="M15 8a7.002 7.002 0 00-7-7" stroke="currentColor" stroke-width="2" stroke-linecap="round" vector-effect="non-scaling-stroke" />
</svg>
                  </span>
</span>
  <span data-target="remote-clipboard-copy.success" hidden="hidden">                  Copy raw contents
                  <svg aria-label="Copied!" role="img" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-check color-fg-success">
    <path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path>
</svg>
</span>
  <span data-target="remote-clipboard-copy.error" hidden="hidden">                  Copy raw contents
                  <svg aria-label="Something went wrong. Try again." role="img" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-alert color-fg-attention">
    <path fill-rule="evenodd" d="M8.22 1.754a.25.25 0 00-.44 0L1.698 13.132a.25.25 0 00.22.368h12.164a.25.25 0 00.22-.368L8.22 1.754zm-1.763-.707c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0114.082 15H1.918a1.75 1.75 0 01-1.543-2.575L6.457 1.047zM9 11a1 1 0 11-2 0 1 1 0 012 0zm-.25-5.25a.75.75 0 00-1.5 0v2.5a.75.75 0 001.5 0v-2.5z"></path>
</svg>
</span>
</remote-clipboard-copy>            </li>
            <li>
              <a class="dropdown-item" href="/adursunoglu16/petclinic-microservice-private/blame/main/503-microservices-ci-cd-pipeline-with-helm/README.md">
                View blame
              </a>
            </li>

              <li class="dropdown-divider" role="none"></li>
              <li>
                <a class="dropdown-item" href="/adursunoglu16/petclinic-microservice-private/edit/main/503-microservices-ci-cd-pipeline-with-helm/README.md">Edit file</a>
              </li>
              <li>
                <a class="dropdown-item menu-item-danger" href="/adursunoglu16/petclinic-microservice-private/delete/main/503-microservices-ci-cd-pipeline-with-helm/README.md">Delete file</a>
              </li>
        </ul>
      </details>
    </div>
</div>


        <div id="readme" class="Box-body readme blob js-code-block-container p-5 p-xl-6 gist-border-0">
    <article class="markdown-body entry-content container-lg" itemprop="text"><h1 dir="auto"><a id="user-content-project-503-microservices-cicd-pipeline" class="anchor" aria-hidden="true" href="#project-503-microservices-cicd-pipeline"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Project 503: Microservices CI/CD Pipeline</h1>
<h2 dir="auto"><a id="user-content-description" class="anchor" aria-hidden="true" href="#description"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Description</h2>
<p dir="auto">This project aims to create full CI/CD Pipeline for microservice based applications using <a href="https://github.com/spring-petclinic/spring-petclinic-microservices">Spring Petclinic Microservices Application</a>. Jenkins Server deployed on Elastic Compute Cloud (EC2) Instance is used as CI/CD Server to build pipelines.</p>
<h2 dir="auto"><a id="user-content-devops-pipelines" class="anchor" aria-hidden="true" href="#devops-pipelines"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>DevOps Pipelines</h2>
<h3 dir="auto"><a id="user-content-development-diagram" class="anchor" aria-hidden="true" href="#development-diagram"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Development Diagram</h3>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="/adursunoglu16/petclinic-microservice-private/blob/main/503-microservices-ci-cd-pipeline-with-helm/project-503-dev-diagram.png"><img src="/adursunoglu16/petclinic-microservice-private/raw/main/503-microservices-ci-cd-pipeline-with-helm/project-503-dev-diagram.png" alt="Development Diagram" style="max-width: 100%;"></a></p>
<h3 dir="auto"><a id="user-content-pipelines-configurations" class="anchor" aria-hidden="true" href="#pipelines-configurations"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Pipelines Configurations</h3>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="/adursunoglu16/petclinic-microservice-private/blob/main/503-microservices-ci-cd-pipeline-with-helm/project-503-pipelines.png"><img src="/adursunoglu16/petclinic-microservice-private/raw/main/503-microservices-ci-cd-pipeline-with-helm/project-503-pipelines.png" alt="Pipelines to be configured" style="max-width: 100%;"></a></p>
<h2 dir="auto"><a id="user-content-flow-of-tasks-for-project-realization" class="anchor" aria-hidden="true" href="#flow-of-tasks-for-project-realization"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Flow of Tasks for Project Realization</h2>
<table>
<thead>
<tr>
<th>Epic</th>
<th align="left">Task</th>
<th>Task #</th>
<th align="left">Task Definition</th>
<th align="left">Branch</th>
</tr>
</thead>
<tbody>
<tr>
<td>Local Development Environment</td>
<td align="left">Prepare Development Server Manually on EC2 Instance</td>
<td>MSP-1</td>
<td align="left">Prepare development server manually on Amazon Linux 2 for developers, enabled with <code>Docker</code> , <code>Docker-Compose</code> , <code>Java 11</code> , <code>Git</code> .</td>
<td align="left"></td>
</tr>
<tr>
<td>Local Development Environment</td>
<td align="left">Prepare GitHub Repository for the Project</td>
<td>MSP-2-1</td>
<td align="left">Clone the Petclinic app from the Clarusway repository <a href="https://github.com/clarusway/petclinic-microservices.git">Petclinic Microservices Application</a></td>
<td align="left"></td>
</tr>
<tr>
<td>Local Development Environment</td>
<td align="left">Prepare GitHub Repository for the Project</td>
<td>MSP-2-2</td>
<td align="left">Prepare base branches namely <code>main</code> , <code>dev</code> , <code>release</code> for DevOps cycle.</td>
<td align="left"></td>
</tr>
<tr>
<td>Local Development Environment</td>
<td align="left">Check the Maven Build Setup on Dev Branch</td>
<td>MSP-3</td>
<td align="left">Check the Maven builds for <code>test</code> , <code>package</code> , and <code>install</code> phases on <code>dev</code> branch</td>
<td align="left"></td>
</tr>
<tr>
<td>Local Development Environment</td>
<td align="left">Prepare a Script for Packaging the Application</td>
<td>MSP-4</td>
<td align="left">Prepare a script to package the application with Maven wrapper</td>
<td align="left">feature/msp-4</td>
</tr>
<tr>
<td>Local Development Environment</td>
<td align="left">Prepare Development Server Cloudformation Template</td>
<td>MSP-5</td>
<td align="left">Prepare development server script with Cloudformation template for developers, enabled with <code>Docker</code> , <code>Docker-Compose</code> , <code>Java 11</code> , <code>Git</code> .</td>
<td align="left">feature/msp-5</td>
</tr>
<tr>
<td>Local Development Build</td>
<td align="left">Prepare Dockerfiles for Microservices</td>
<td>MSP-6</td>
<td align="left"></td>
<td align="left">Prepare Dockerfiles for each microservices.</td>
</tr>
<tr>
<td>Local Development Environment</td>
<td align="left">Prepare Script for Building Docker Images</td>
<td>MSP-7</td>
<td align="left">Prepare a script to package and build the docker images for all microservices.</td>
<td align="left">feature/msp-7</td>
</tr>
<tr>
<td>Local Development Build</td>
<td align="left">Create Docker Compose File for Local Development</td>
<td>MSP-8-1</td>
<td align="left">Prepare docker compose file to deploy the application locally.</td>
<td align="left">feature/msp-8</td>
</tr>
<tr>
<td>Local Development Build</td>
<td align="left">Create Docker Compose File for Local Development</td>
<td>MSP-8-2</td>
<td align="left">Prepare a script to test the deployment of the app locally.</td>
<td align="left">feature/msp-8</td>
</tr>
<tr>
<td>Testing Environment Setup</td>
<td align="left">Implement Unit Tests</td>
<td>MSP-9-1</td>
<td align="left">Implement 3 Unit Tests locally.</td>
<td align="left">feature/msp-9</td>
</tr>
<tr>
<td>Testing Environment Setup</td>
<td align="left">Setup Code Coverage Tool</td>
<td>MSP-9-2</td>
<td align="left">Update POM file for Code Coverage Report.</td>
<td align="left">feature/msp-9</td>
</tr>
<tr>
<td>Testing Environment Setup</td>
<td align="left">Implement Code Coverage</td>
<td>MSP-9-3</td>
<td align="left">Generate Code Coverage Report manually.</td>
<td align="left">feature/msp-9</td>
</tr>
<tr>
<td>Testing Environment Setup</td>
<td align="left">Prepare Selenium Tests</td>
<td>MSP-10-1</td>
<td align="left">Prepare 3 Selenium Jobs for QA Automation Tests.</td>
<td align="left">feature/msp-10</td>
</tr>
<tr>
<td>Testing Environment Setup</td>
<td align="left">Implement Selenium Tests</td>
<td>MSP-10-2</td>
<td align="left">Run 3 Selenium Tests against local environment.</td>
<td align="left">feature/msp-10</td>
</tr>
<tr>
<td>CI Server Setup</td>
<td align="left">Prepare Jenkins Server</td>
<td>MSP-11</td>
<td align="left"></td>
<td align="left">Prepare Jenkins Server for CI/CD Pipeline.</td>
</tr>
<tr>
<td>CI Server Setup</td>
<td align="left">Configure Jenkins Server for Project</td>
<td>MSP-12</td>
<td align="left">Configure Jenkins Server for Project Setup.</td>
<td align="left"></td>
</tr>
<tr>
<td>CI Server Setup</td>
<td align="left">Prepare CI Pipeline</td>
<td>MSP-13</td>
<td align="left"></td>
<td align="left">Prepare CI pipeline (UT only) for all <code>dev</code> , <code>feature</code> and <code>bugfix</code> branches.</td>
</tr>
<tr>
<td>Registry Setup for Development</td>
<td align="left">Create Docker Registry for Dev Manually</td>
<td>MSP-14</td>
<td align="left">Create Docker Registry on AWS ECR manually using Jenkins job.</td>
<td align="left"></td>
</tr>
<tr>
<td>Registry Setup for Development</td>
<td align="left">Prepare Script for Docker Registry</td>
<td>MSP-15</td>
<td align="left">Prepare a script to create Docker Registry on AWS ECR using Jenkins job.</td>
<td align="left">feature/msp-15</td>
</tr>
<tr>
<td>QA Automation Setup for Development</td>
<td align="left">Create a QA Automation Environment</td>
<td>MSP-16</td>
<td align="left">Create a QA Automation Environment with Docker Swarm.</td>
<td align="left">feature/msp-16</td>
</tr>
<tr>
<td>QA Automation Setup for Development</td>
<td align="left">Prepare a QA Automation Pipeline</td>
<td>MSP-17</td>
<td align="left">Prepare a QA Automation Pipeline on <code>dev</code> branch for Nightly Builds.</td>
<td align="left">feature/msp-17</td>
</tr>
<tr>
<td>QA Setup for Release</td>
<td align="left">Create a Key Pair for QA Environment</td>
<td>MSP-18-1</td>
<td align="left">Create a permanent Key Pair for Ansible to be used in QA Environment on Release.</td>
<td align="left">feature/msp-18</td>
</tr>
<tr>
<td>QA Setup for Release</td>
<td align="left">Create a QA Infrastructure with AWS Cloudformation</td>
<td>MSP-18-2</td>
<td align="left">Create a Permanent QA Infrastructure for Docker Swarm with AWS Cloudformation.</td>
<td align="left">feature/msp-18</td>
</tr>
<tr>
<td>QA Setup for Release</td>
<td align="left">Create a QA Environment with Docker Swarm</td>
<td>MSP-18-3</td>
<td align="left">Create a QA Environment for Release with Docker Swarm.</td>
<td align="left">feature/msp-18</td>
</tr>
<tr>
<td>QA Setup for Release</td>
<td align="left">Prepare Build Scripts for QA Environment</td>
<td>MSP-19</td>
<td align="left">Prepare Build Scripts for creating ECR Repo for QA, building QA Docker images, deploying app with Docker Compose.</td>
<td align="left">feature/msp-19</td>
</tr>
<tr>
<td>QA Setup for Release</td>
<td align="left">Build and Deploy App on QA Environment Manually</td>
<td>MSP-20</td>
<td align="left">Build and Deploy App for QA Environment Manually using Jenkins Jobs.</td>
<td align="left">feature/msp-20</td>
</tr>
<tr>
<td>QA Setup for Release</td>
<td align="left">Prepare a QA Pipeline</td>
<td>MSP-21</td>
<td align="left">Prepare a QA Pipeline using Jenkins on <code>release</code> branch for Weekly Builds.</td>
<td align="left">feature/msp-21</td>
</tr>
<tr>
<td>Staging and Production Setup</td>
<td align="left">Prepare HA RKE Kubernetes Cluster</td>
<td>MSP-22</td>
<td align="left">Prepare High-availability RKE Kubernetes Cluster on AWS EC2</td>
<td align="left">feature/msp-22</td>
</tr>
<tr>
<td>Staging and Production Setup</td>
<td align="left">Install Rancher App on RKE K8s Cluster</td>
<td>MSP-23</td>
<td align="left">Install Rancher App on RKE Kubernetes Cluster</td>
<td align="left"></td>
</tr>
<tr>
<td>Staging and Production Setup</td>
<td align="left">Prepare Petlinic Kubernetes YAML Files</td>
<td>MSP-24</td>
<td align="left">Prepare Petlinic Kubernetes YAML Files for Staging and Production Pipelines.</td>
<td align="left">feature/msp-24</td>
</tr>
<tr>
<td>Staging and Production Setup</td>
<td align="left">Create Staging and Production Environment with Rancher</td>
<td>MSP-25</td>
<td align="left">Create Staging and Production Environment with Rancher by creating new cluster for Petclinic</td>
<td align="left"></td>
</tr>
<tr>
<td>Staging Deployment Setup</td>
<td align="left">Prepare a Staging Pipeline</td>
<td>MSP-26</td>
<td align="left">Prepare a Staging Pipeline on Jenkins Server</td>
<td align="left">feature/msp-26</td>
</tr>
<tr>
<td>Production Deployment Setup</td>
<td align="left">Prepare a Production Pipeline</td>
<td>MSP-27</td>
<td align="left">Prepare a Production Pipeline on Jenkins Server</td>
<td align="left">feature/msp-27</td>
</tr>
<tr>
<td>Production Deployment Setup</td>
<td align="left">Set Domain Name and TLS for Production</td>
<td>MSP-28</td>
<td align="left">Set Domain Name and TLS for Production Pipeline with Route 53</td>
<td align="left">feature/msp-28</td>
</tr>
<tr>
<td>Production Deployment Setup</td>
<td align="left">Set Monitoring Tools</td>
<td>MSP-29</td>
<td align="left">Set Monitoring tools, Prometheus and Grafana</td>
<td align="left"></td>
</tr>
</tbody>
</table>
<h2 dir="auto"><a id="user-content-msp-1---prepare-development-server-manually-on-ec2-instance" class="anchor" aria-hidden="true" href="#msp-1---prepare-development-server-manually-on-ec2-instance"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>MSP 1 - Prepare Development Server Manually on EC2 Instance</h2>
<ul dir="auto">
<li>Prepare development server manually on Amazon Linux 2 (t3a.medium) for developers, enabled with <code>Docker</code>,  <code>Docker-Compose</code>,  <code>Java 11</code>,  <code>Git</code>.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="#! /bin/bash
yum update -y
hostnamectl set-hostname petclinic-dev-server
amazon-linux-extras install docker -y
systemctl start docker
systemctl enable docker
usermod -a -G docker ec2-user
newgrp docker
curl -L &quot;https://github.com/docker/compose/releases/download/1.26.2/docker-compose-$(uname -s)-$(uname -m)&quot; \
-o /usr/local/bin/docker-compose
chmod +x /usr/local/bin/docker-compose
yum install git -y
yum install java-11-amazon-corretto -y"><pre><span class="pl-c"><span class="pl-c">#!</span> /bin/bash</span>
yum update -y
hostnamectl set-hostname petclinic-dev-server
amazon-linux-extras install docker -y
systemctl start docker
systemctl <span class="pl-c1">enable</span> docker
usermod -a -G docker ec2-user
newgrp docker
curl -L <span class="pl-s"><span class="pl-pds">"</span>https://github.com/docker/compose/releases/download/1.26.2/docker-compose-<span class="pl-s"><span class="pl-pds">$(</span>uname -s<span class="pl-pds">)</span></span>-<span class="pl-s"><span class="pl-pds">$(</span>uname -m<span class="pl-pds">)</span></span><span class="pl-pds">"</span></span> \
-o /usr/local/bin/docker-compose
chmod +x /usr/local/bin/docker-compose
yum install git -y
yum install java-11-amazon-corretto -y</pre></div>
<h2 dir="auto"><a id="user-content-msp-2---prepare-github-repository-for-the-project" class="anchor" aria-hidden="true" href="#msp-2---prepare-github-repository-for-the-project"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>MSP 2 - Prepare GitHub Repository for the Project</h2>
<ul dir="auto">
<li>Connect to your Development Server via <code>ssh</code> and clone the petclinic app from the repository <a href="https://github.com/clarusway/petclinic-microservices-with-db.git">Spring Petclinic Microservices App</a>.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="git clone https://github.com/clarusway/petclinic-microservices-with-db.git"><pre>git clone https://github.com/clarusway/petclinic-microservices-with-db.git</pre></div>
<ul dir="auto">
<li>Change your working directory to <strong>petclinic-microservices</strong> and delete the <strong>.git</strong> directory.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="cd petclinic-microservices
rm -rf .git"><pre><span class="pl-c1">cd</span> petclinic-microservices
rm -rf .git</pre></div>
<ul dir="auto">
<li>
<p dir="auto">Create a new repository on your Github account with the name <strong>petclinic-microservices-with-db</strong>.</p>
</li>
<li>
<p dir="auto">Initiate the cloned repository to make it a git repository and push the local repository to your remote repository.</p>
</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="git init
git add .
git commit -m &quot;first commit&quot;
git branch -M main
git remote add origin https://[your-token]@github.com/[your-git-account]/[your-repo-name-petclinic-microservices-with-db.git]
git push origin main"><pre>git init
git add <span class="pl-c1">.</span>
git commit -m <span class="pl-s"><span class="pl-pds">"</span>first commit<span class="pl-pds">"</span></span>
git branch -M main
git remote add origin https://[your-token]@github.com/[your-git-account]/[your-repo-name-petclinic-microservices-with-db.git]
git push origin main</pre></div>
<ul dir="auto">
<li>
<p dir="auto">Prepare base branches namely <code>main</code>,  <code>dev</code>,  <code>release</code> for DevOps cycle.</p>
<ul dir="auto">
<li>
<p dir="auto">Create <code>dev</code> base branch.</p>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="git checkout main
git branch dev
git checkout dev
git push --set-upstream origin dev"><pre>git checkout main
git branch dev
git checkout dev
git push --set-upstream origin dev</pre></div>
</li>
<li>
<p dir="auto">Create <code>release</code> base branch.</p>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="git checkout main
git branch release
git checkout release
git push --set-upstream origin release"><pre>git checkout main
git branch release
git checkout release
git push --set-upstream origin release</pre></div>
</li>
</ul>
</li>
</ul>
<h2 dir="auto"><a id="user-content-msp-3---check-the-maven-build-setup-on-dev-branch" class="anchor" aria-hidden="true" href="#msp-3---check-the-maven-build-setup-on-dev-branch"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>MSP 3 - Check the Maven Build Setup on Dev Branch</h2>
<ul dir="auto">
<li>Switch to <code>dev</code> branch.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="git checkout dev"><pre>git checkout dev</pre></div>
<ul dir="auto">
<li>Test the compiled source code.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="./mvnw clean test"><pre>./mvnw clean <span class="pl-c1">test</span></pre></div>
<blockquote>
<p dir="auto">Note: If you get <code>permission denied</code> error, try to give execution permission to <strong>mvnw</strong>.</p>
</blockquote>
<div class="snippet-clipboard-content position-relative overflow-auto" data-snippet-clipboard-copy-content="chmod +x mvnw"><pre><code>chmod +x mvnw
</code></pre></div>
<ul dir="auto">
<li>Take the compiled code and package it in its distributable <code>JAR</code> format.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="./mvnw clean package"><pre>./mvnw clean package</pre></div>
<ul dir="auto">
<li>Install distributable <code>JAR</code>s into local repository.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="./mvnw clean install"><pre>./mvnw clean install</pre></div>
<h2 dir="auto"><a id="user-content-msp-4---prepare-a-script-for-packaging-the-application" class="anchor" aria-hidden="true" href="#msp-4---prepare-a-script-for-packaging-the-application"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>MSP 4 - Prepare a Script for Packaging the Application</h2>
<ul dir="auto">
<li>Create <code>feature/msp-4</code> branch from <code>dev</code>.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="git checkout dev
git branch feature/msp-4
git checkout feature/msp-4"><pre>git checkout dev
git branch feature/msp-4
git checkout feature/msp-4</pre></div>
<ul dir="auto">
<li>Prepare a script to package the application with maven wrapper and save it as <code>package-with-mvn-wrapper.sh</code> under <code>petclinic-microservices-with-db</code> folder.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="./mvnw clean package"><pre>./mvnw clean package</pre></div>
<ul dir="auto">
<li>Commit and push the new script to remote repo.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="git add .
git commit -m 'added packaging script'
git push --set-upstream origin feature/msp-4
git checkout dev
git merge feature/msp-4
git push origin dev"><pre>git add <span class="pl-c1">.</span>
git commit -m <span class="pl-s"><span class="pl-pds">'</span>added packaging script<span class="pl-pds">'</span></span>
git push --set-upstream origin feature/msp-4
git checkout dev
git merge feature/msp-4
git push origin dev</pre></div>
<h2 dir="auto"><a id="user-content-msp-5---prepare-development-server-cloudformation-template" class="anchor" aria-hidden="true" href="#msp-5---prepare-development-server-cloudformation-template"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>MSP 5 - Prepare Development Server Cloudformation Template</h2>
<ul dir="auto">
<li>Create <code>feature/msp-5</code> branch from <code>dev</code>.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="git checkout dev
git branch feature/msp-5
git checkout feature/msp-5"><pre>git checkout dev
git branch feature/msp-5
git checkout feature/msp-5</pre></div>
<ul dir="auto">
<li>Create a folder for infrastructure setup with the name of <code>infrastructure</code>.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="mkdir infrastructure"><pre>mkdir infrastructure</pre></div>
<ul dir="auto">
<li>Prepare development server script with <a href="/adursunoglu16/petclinic-microservice-private/blob/main/503-microservices-ci-cd-pipeline-with-helm/msp-5-dev-server-for-petclinic-app-cfn-template.yml">Cloudformation template</a> for developers, enabled with <code>Docker</code>,  <code>Docker-Compose</code>,  <code>Java 11</code>,  <code>Git</code> and save it as <code>dev-server-for-petclinic-app-cfn-template.yml</code> under <code>infrastructure</code> folder.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="#! /bin/bash
yum update -y
hostnamectl set-hostname petclinic-dev-server
amazon-linux-extras install docker -y
systemctl start docker
systemctl enable docker
usermod -a -G docker ec2-user
curl -L &quot;https://github.com/docker/compose/releases/download/1.26.2/docker-compose-$(uname -s)-$(uname -m)&quot; \
-o /usr/local/bin/docker-compose
chmod +x /usr/local/bin/docker-compose
yum install git -y
yum install java-11-amazon-corretto -y
git clone https://github.com/clarusway/petclinic-microservices.git
cd petclinic-microservices
git fetch
git checkout dev"><pre><span class="pl-c"><span class="pl-c">#!</span> /bin/bash</span>
yum update -y
hostnamectl set-hostname petclinic-dev-server
amazon-linux-extras install docker -y
systemctl start docker
systemctl <span class="pl-c1">enable</span> docker
usermod -a -G docker ec2-user
curl -L <span class="pl-s"><span class="pl-pds">"</span>https://github.com/docker/compose/releases/download/1.26.2/docker-compose-<span class="pl-s"><span class="pl-pds">$(</span>uname -s<span class="pl-pds">)</span></span>-<span class="pl-s"><span class="pl-pds">$(</span>uname -m<span class="pl-pds">)</span></span><span class="pl-pds">"</span></span> \
-o /usr/local/bin/docker-compose
chmod +x /usr/local/bin/docker-compose
yum install git -y
yum install java-11-amazon-corretto -y
git clone https://github.com/clarusway/petclinic-microservices.git
<span class="pl-c1">cd</span> petclinic-microservices
git fetch
git checkout dev</pre></div>
<ul dir="auto">
<li>Commit and push the new script to remote repo.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="git add .
git commit -m 'added cloudformation template for dev server'
git push --set-upstream origin feature/msp-5
git checkout dev
git merge feature/msp-5
git push origin dev"><pre>git add <span class="pl-c1">.</span>
git commit -m <span class="pl-s"><span class="pl-pds">'</span>added cloudformation template for dev server<span class="pl-pds">'</span></span>
git push --set-upstream origin feature/msp-5
git checkout dev
git merge feature/msp-5
git push origin dev</pre></div>
<h2 dir="auto"><a id="user-content-msp-6---prepare-dockerfiles-for-microservices" class="anchor" aria-hidden="true" href="#msp-6---prepare-dockerfiles-for-microservices"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>MSP 6 - Prepare Dockerfiles for Microservices</h2>
<ul dir="auto">
<li>Create <code>feature/msp-6</code> branch from <code>dev</code>.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="git checkout dev
git branch feature/msp-6
git checkout feature/msp-6"><pre>git checkout dev
git branch feature/msp-6
git checkout feature/msp-6</pre></div>
<ul dir="auto">
<li>Prepare a Dockerfile for the <code>admin-server</code> microservice with following content and save it under <code>spring-petclinic-admin-server</code>.</li>
</ul>
<div class="highlight highlight-source-dockerfile position-relative overflow-auto" data-snippet-clipboard-copy-content="FROM openjdk:11-jre
ARG DOCKERIZE_VERSION=v0.6.1
ARG EXPOSED_PORT=9090
ENV SPRING_PROFILES_ACTIVE docker,mysql
ADD https://github.com/jwilder/dockerize/releases/download/${DOCKERIZE_VERSION}/dockerize-alpine-linux-amd64-${DOCKERIZE_VERSION}.tar.gz dockerize.tar.gz
RUN tar -xzf dockerize.tar.gz
RUN chmod +x dockerize
ADD ./target/*.jar /app.jar
EXPOSE ${EXPOSED_PORT}
ENTRYPOINT [&quot;java&quot;, &quot;-Djava.security.egd=file:/dev/./urandom&quot;,&quot;-jar&quot;,&quot;/app.jar&quot;]"><pre><span class="pl-k">FROM</span> openjdk:11-jre
<span class="pl-k">ARG</span> DOCKERIZE_VERSION=v0.6.1
<span class="pl-k">ARG</span> EXPOSED_PORT=9090
<span class="pl-k">ENV</span> SPRING_PROFILES_ACTIVE docker,mysql
<span class="pl-k">ADD</span> https://github.com/jwilder/dockerize/releases/download/${DOCKERIZE_VERSION}/dockerize-alpine-linux-amd64-${DOCKERIZE_VERSION}.tar.gz dockerize.tar.gz
<span class="pl-k">RUN</span> tar -xzf dockerize.tar.gz
<span class="pl-k">RUN</span> chmod +x dockerize
<span class="pl-k">ADD</span> ./target/*.jar /app.jar
<span class="pl-k">EXPOSE</span> ${EXPOSED_PORT}
<span class="pl-k">ENTRYPOINT</span> [<span class="pl-s">"java"</span>, <span class="pl-s">"-Djava.security.egd=file:/dev/./urandom"</span>,<span class="pl-s">"-jar"</span>,<span class="pl-s">"/app.jar"</span>]</pre></div>
<ul dir="auto">
<li>Prepare a Dockerfile for the <code>api-gateway</code> microservice with the following content and save it under <code>spring-petclinic-api-gateway</code>.</li>
</ul>
<div class="highlight highlight-source-dockerfile position-relative overflow-auto" data-snippet-clipboard-copy-content="FROM openjdk:11-jre
ARG DOCKERIZE_VERSION=v0.6.1
ARG EXPOSED_PORT=8080
ENV SPRING_PROFILES_ACTIVE docker,mysql
ADD https://github.com/jwilder/dockerize/releases/download/${DOCKERIZE_VERSION}/dockerize-alpine-linux-amd64-${DOCKERIZE_VERSION}.tar.gz dockerize.tar.gz
RUN tar -xzf dockerize.tar.gz
RUN chmod +x dockerize
ADD ./target/*.jar /app.jar
EXPOSE ${EXPOSED_PORT}
ENTRYPOINT [&quot;java&quot;, &quot;-Djava.security.egd=file:/dev/./urandom&quot;,&quot;-jar&quot;,&quot;/app.jar&quot;]"><pre><span class="pl-k">FROM</span> openjdk:11-jre
<span class="pl-k">ARG</span> DOCKERIZE_VERSION=v0.6.1
<span class="pl-k">ARG</span> EXPOSED_PORT=8080
<span class="pl-k">ENV</span> SPRING_PROFILES_ACTIVE docker,mysql
<span class="pl-k">ADD</span> https://github.com/jwilder/dockerize/releases/download/${DOCKERIZE_VERSION}/dockerize-alpine-linux-amd64-${DOCKERIZE_VERSION}.tar.gz dockerize.tar.gz
<span class="pl-k">RUN</span> tar -xzf dockerize.tar.gz
<span class="pl-k">RUN</span> chmod +x dockerize
<span class="pl-k">ADD</span> ./target/*.jar /app.jar
<span class="pl-k">EXPOSE</span> ${EXPOSED_PORT}
<span class="pl-k">ENTRYPOINT</span> [<span class="pl-s">"java"</span>, <span class="pl-s">"-Djava.security.egd=file:/dev/./urandom"</span>,<span class="pl-s">"-jar"</span>,<span class="pl-s">"/app.jar"</span>]</pre></div>
<ul dir="auto">
<li>Prepare a Dockerfile for the <code>config-server</code> microservice with the following content and save it under <code>spring-petclinic-config-server</code>.</li>
</ul>
<div class="highlight highlight-source-dockerfile position-relative overflow-auto" data-snippet-clipboard-copy-content="FROM openjdk:11-jre
ARG DOCKERIZE_VERSION=v0.6.1
ARG EXPOSED_PORT=8888
ENV SPRING_PROFILES_ACTIVE docker,mysql
ADD https://github.com/jwilder/dockerize/releases/download/${DOCKERIZE_VERSION}/dockerize-alpine-linux-amd64-${DOCKERIZE_VERSION}.tar.gz dockerize.tar.gz
RUN tar -xzf dockerize.tar.gz
RUN chmod +x dockerize
ADD ./target/*.jar /app.jar
EXPOSE ${EXPOSED_PORT}
ENTRYPOINT [&quot;java&quot;, &quot;-Djava.security.egd=file:/dev/./urandom&quot;,&quot;-jar&quot;,&quot;/app.jar&quot;]"><pre><span class="pl-k">FROM</span> openjdk:11-jre
<span class="pl-k">ARG</span> DOCKERIZE_VERSION=v0.6.1
<span class="pl-k">ARG</span> EXPOSED_PORT=8888
<span class="pl-k">ENV</span> SPRING_PROFILES_ACTIVE docker,mysql
<span class="pl-k">ADD</span> https://github.com/jwilder/dockerize/releases/download/${DOCKERIZE_VERSION}/dockerize-alpine-linux-amd64-${DOCKERIZE_VERSION}.tar.gz dockerize.tar.gz
<span class="pl-k">RUN</span> tar -xzf dockerize.tar.gz
<span class="pl-k">RUN</span> chmod +x dockerize
<span class="pl-k">ADD</span> ./target/*.jar /app.jar
<span class="pl-k">EXPOSE</span> ${EXPOSED_PORT}
<span class="pl-k">ENTRYPOINT</span> [<span class="pl-s">"java"</span>, <span class="pl-s">"-Djava.security.egd=file:/dev/./urandom"</span>,<span class="pl-s">"-jar"</span>,<span class="pl-s">"/app.jar"</span>]</pre></div>
<ul dir="auto">
<li>Prepare a Dockerfile for the <code>customer-service</code> microservice with the following content and save it under <code>spring-petclinic-customer-service</code>.</li>
</ul>
<div class="highlight highlight-source-dockerfile position-relative overflow-auto" data-snippet-clipboard-copy-content="FROM openjdk:11-jre
ARG DOCKERIZE_VERSION=v0.6.1
ARG EXPOSED_PORT=8081
ENV SPRING_PROFILES_ACTIVE docker,mysql
ADD https://github.com/jwilder/dockerize/releases/download/${DOCKERIZE_VERSION}/dockerize-alpine-linux-amd64-${DOCKERIZE_VERSION}.tar.gz dockerize.tar.gz
RUN tar -xzf dockerize.tar.gz
RUN chmod +x dockerize
ADD ./target/*.jar /app.jar
EXPOSE ${EXPOSED_PORT}
ENTRYPOINT [&quot;java&quot;, &quot;-Djava.security.egd=file:/dev/./urandom&quot;,&quot;-jar&quot;,&quot;/app.jar&quot;]"><pre><span class="pl-k">FROM</span> openjdk:11-jre
<span class="pl-k">ARG</span> DOCKERIZE_VERSION=v0.6.1
<span class="pl-k">ARG</span> EXPOSED_PORT=8081
<span class="pl-k">ENV</span> SPRING_PROFILES_ACTIVE docker,mysql
<span class="pl-k">ADD</span> https://github.com/jwilder/dockerize/releases/download/${DOCKERIZE_VERSION}/dockerize-alpine-linux-amd64-${DOCKERIZE_VERSION}.tar.gz dockerize.tar.gz
<span class="pl-k">RUN</span> tar -xzf dockerize.tar.gz
<span class="pl-k">RUN</span> chmod +x dockerize
<span class="pl-k">ADD</span> ./target/*.jar /app.jar
<span class="pl-k">EXPOSE</span> ${EXPOSED_PORT}
<span class="pl-k">ENTRYPOINT</span> [<span class="pl-s">"java"</span>, <span class="pl-s">"-Djava.security.egd=file:/dev/./urandom"</span>,<span class="pl-s">"-jar"</span>,<span class="pl-s">"/app.jar"</span>]</pre></div>
<ul dir="auto">
<li>Prepare a Dockerfile for the <code>discovery-server</code> microservice with the following content and save it under <code>spring-petclinic-discovery-server</code>.</li>
</ul>
<div class="highlight highlight-source-dockerfile position-relative overflow-auto" data-snippet-clipboard-copy-content="FROM openjdk:11-jre
ARG DOCKERIZE_VERSION=v0.6.1
ARG EXPOSED_PORT=8761
ENV SPRING_PROFILES_ACTIVE docker,mysql
ADD https://github.com/jwilder/dockerize/releases/download/${DOCKERIZE_VERSION}/dockerize-alpine-linux-amd64-${DOCKERIZE_VERSION}.tar.gz dockerize.tar.gz
RUN tar -xzf dockerize.tar.gz
RUN chmod +x dockerize
ADD ./target/*.jar /app.jar
EXPOSE ${EXPOSED_PORT}
ENTRYPOINT [&quot;java&quot;, &quot;-Djava.security.egd=file:/dev/./urandom&quot;,&quot;-jar&quot;,&quot;/app.jar&quot;]"><pre><span class="pl-k">FROM</span> openjdk:11-jre
<span class="pl-k">ARG</span> DOCKERIZE_VERSION=v0.6.1
<span class="pl-k">ARG</span> EXPOSED_PORT=8761
<span class="pl-k">ENV</span> SPRING_PROFILES_ACTIVE docker,mysql
<span class="pl-k">ADD</span> https://github.com/jwilder/dockerize/releases/download/${DOCKERIZE_VERSION}/dockerize-alpine-linux-amd64-${DOCKERIZE_VERSION}.tar.gz dockerize.tar.gz
<span class="pl-k">RUN</span> tar -xzf dockerize.tar.gz
<span class="pl-k">RUN</span> chmod +x dockerize
<span class="pl-k">ADD</span> ./target/*.jar /app.jar
<span class="pl-k">EXPOSE</span> ${EXPOSED_PORT}
<span class="pl-k">ENTRYPOINT</span> [<span class="pl-s">"java"</span>, <span class="pl-s">"-Djava.security.egd=file:/dev/./urandom"</span>,<span class="pl-s">"-jar"</span>,<span class="pl-s">"/app.jar"</span>]</pre></div>
<ul dir="auto">
<li>Prepare a Dockerfile for the <code>hystrix-dashboard</code> microservice with the following content and save it under <code>spring-petclinic-hystrix-dashboard</code>.</li>
</ul>
<div class="highlight highlight-source-dockerfile position-relative overflow-auto" data-snippet-clipboard-copy-content="FROM openjdk:11-jre
ARG DOCKERIZE_VERSION=v0.6.1
ARG EXPOSED_PORT=7979
ENV SPRING_PROFILES_ACTIVE docker,mysql
ADD https://github.com/jwilder/dockerize/releases/download/${DOCKERIZE_VERSION}/dockerize-alpine-linux-amd64-${DOCKERIZE_VERSION}.tar.gz dockerize.tar.gz
RUN tar -xzf dockerize.tar.gz
RUN chmod +x dockerize
ADD ./target/*.jar /app.jar
EXPOSE ${EXPOSED_PORT}
ENTRYPOINT [&quot;java&quot;, &quot;-Djava.security.egd=file:/dev/./urandom&quot;,&quot;-jar&quot;,&quot;/app.jar&quot;]"><pre><span class="pl-k">FROM</span> openjdk:11-jre
<span class="pl-k">ARG</span> DOCKERIZE_VERSION=v0.6.1
<span class="pl-k">ARG</span> EXPOSED_PORT=7979
<span class="pl-k">ENV</span> SPRING_PROFILES_ACTIVE docker,mysql
<span class="pl-k">ADD</span> https://github.com/jwilder/dockerize/releases/download/${DOCKERIZE_VERSION}/dockerize-alpine-linux-amd64-${DOCKERIZE_VERSION}.tar.gz dockerize.tar.gz
<span class="pl-k">RUN</span> tar -xzf dockerize.tar.gz
<span class="pl-k">RUN</span> chmod +x dockerize
<span class="pl-k">ADD</span> ./target/*.jar /app.jar
<span class="pl-k">EXPOSE</span> ${EXPOSED_PORT}
<span class="pl-k">ENTRYPOINT</span> [<span class="pl-s">"java"</span>, <span class="pl-s">"-Djava.security.egd=file:/dev/./urandom"</span>,<span class="pl-s">"-jar"</span>,<span class="pl-s">"/app.jar"</span>]</pre></div>
<ul dir="auto">
<li>Prepare a Dockerfile for the <code>vets-service</code> microservice with the following content and save it under <code>spring-petclinic-vets-service</code>.</li>
</ul>
<div class="highlight highlight-source-dockerfile position-relative overflow-auto" data-snippet-clipboard-copy-content="FROM openjdk:11-jre
ARG DOCKERIZE_VERSION=v0.6.1
ARG EXPOSED_PORT=8083
ENV SPRING_PROFILES_ACTIVE docker,mysql
ADD https://github.com/jwilder/dockerize/releases/download/${DOCKERIZE_VERSION}/dockerize-alpine-linux-amd64-${DOCKERIZE_VERSION}.tar.gz dockerize.tar.gz
RUN tar -xzf dockerize.tar.gz
RUN chmod +x dockerize
ADD ./target/*.jar /app.jar
EXPOSE ${EXPOSED_PORT}
ENTRYPOINT [&quot;java&quot;, &quot;-Djava.security.egd=file:/dev/./urandom&quot;,&quot;-jar&quot;,&quot;/app.jar&quot;]"><pre><span class="pl-k">FROM</span> openjdk:11-jre
<span class="pl-k">ARG</span> DOCKERIZE_VERSION=v0.6.1
<span class="pl-k">ARG</span> EXPOSED_PORT=8083
<span class="pl-k">ENV</span> SPRING_PROFILES_ACTIVE docker,mysql
<span class="pl-k">ADD</span> https://github.com/jwilder/dockerize/releases/download/${DOCKERIZE_VERSION}/dockerize-alpine-linux-amd64-${DOCKERIZE_VERSION}.tar.gz dockerize.tar.gz
<span class="pl-k">RUN</span> tar -xzf dockerize.tar.gz
<span class="pl-k">RUN</span> chmod +x dockerize
<span class="pl-k">ADD</span> ./target/*.jar /app.jar
<span class="pl-k">EXPOSE</span> ${EXPOSED_PORT}
<span class="pl-k">ENTRYPOINT</span> [<span class="pl-s">"java"</span>, <span class="pl-s">"-Djava.security.egd=file:/dev/./urandom"</span>,<span class="pl-s">"-jar"</span>,<span class="pl-s">"/app.jar"</span>]</pre></div>
<ul dir="auto">
<li>Prepare a Dockerfile for the <code>visits-service</code> microservice with the following content and save it under <code>spring-petclinic-visits-service</code>.</li>
</ul>
<div class="highlight highlight-source-dockerfile position-relative overflow-auto" data-snippet-clipboard-copy-content="FROM openjdk:11-jre
ARG DOCKERIZE_VERSION=v0.6.1
ARG EXPOSED_PORT=8082
ENV SPRING_PROFILES_ACTIVE docker,mysql
ADD https://github.com/jwilder/dockerize/releases/download/${DOCKERIZE_VERSION}/dockerize-alpine-linux-amd64-${DOCKERIZE_VERSION}.tar.gz dockerize.tar.gz
RUN tar -xzf dockerize.tar.gz
RUN chmod +x dockerize
ADD ./target/*.jar /app.jar
EXPOSE ${EXPOSED_PORT}
ENTRYPOINT [&quot;java&quot;, &quot;-Djava.security.egd=file:/dev/./urandom&quot;,&quot;-jar&quot;,&quot;/app.jar&quot;]"><pre><span class="pl-k">FROM</span> openjdk:11-jre
<span class="pl-k">ARG</span> DOCKERIZE_VERSION=v0.6.1
<span class="pl-k">ARG</span> EXPOSED_PORT=8082
<span class="pl-k">ENV</span> SPRING_PROFILES_ACTIVE docker,mysql
<span class="pl-k">ADD</span> https://github.com/jwilder/dockerize/releases/download/${DOCKERIZE_VERSION}/dockerize-alpine-linux-amd64-${DOCKERIZE_VERSION}.tar.gz dockerize.tar.gz
<span class="pl-k">RUN</span> tar -xzf dockerize.tar.gz
<span class="pl-k">RUN</span> chmod +x dockerize
<span class="pl-k">ADD</span> ./target/*.jar /app.jar
<span class="pl-k">EXPOSE</span> ${EXPOSED_PORT}
<span class="pl-k">ENTRYPOINT</span> [<span class="pl-s">"java"</span>, <span class="pl-s">"-Djava.security.egd=file:/dev/./urandom"</span>,<span class="pl-s">"-jar"</span>,<span class="pl-s">"/app.jar"</span>]</pre></div>
<ul dir="auto">
<li>Commit the changes, then push the Dockerfiles to the remote repo.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="git add .
git commit -m 'added Dockerfiles for microservices'
git push --set-upstream origin feature/msp-6
git checkout dev
git merge feature/msp-6
git push origin dev"><pre>git add <span class="pl-c1">.</span>
git commit -m <span class="pl-s"><span class="pl-pds">'</span>added Dockerfiles for microservices<span class="pl-pds">'</span></span>
git push --set-upstream origin feature/msp-6
git checkout dev
git merge feature/msp-6
git push origin dev</pre></div>
<h2 dir="auto"><a id="user-content-msp-7---prepare-script-for-building-docker-images" class="anchor" aria-hidden="true" href="#msp-7---prepare-script-for-building-docker-images"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>MSP 7 - Prepare Script for Building Docker Images</h2>
<ul dir="auto">
<li>Create <code>feature/msp-7</code> branch from <code>dev</code>.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="git checkout dev
git branch feature/msp-7
git checkout feature/msp-7"><pre>git checkout dev
git branch feature/msp-7
git checkout feature/msp-7</pre></div>
<ul dir="auto">
<li>Prepare a script to build the docker images and save it as <code>build-dev-docker-images.sh</code> under <code>petclinic-microservices-with-db</code> folder.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="./mvnw clean package
docker build --force-rm -t &quot;petclinic-admin-server:dev&quot; ./spring-petclinic-admin-server
docker build --force-rm -t &quot;petclinic-api-gateway:dev&quot; ./spring-petclinic-api-gateway
docker build --force-rm -t &quot;petclinic-config-server:dev&quot; ./spring-petclinic-config-server
docker build --force-rm -t &quot;petclinic-customers-service:dev&quot; ./spring-petclinic-customers-service
docker build --force-rm -t &quot;petclinic-discovery-server:dev&quot; ./spring-petclinic-discovery-server
docker build --force-rm -t &quot;petclinic-hystrix-dashboard:dev&quot; ./spring-petclinic-hystrix-dashboard
docker build --force-rm -t &quot;petclinic-vets-service:dev&quot; ./spring-petclinic-vets-service
docker build --force-rm -t &quot;petclinic-visits-service:dev&quot; ./spring-petclinic-visits-service
docker build --force-rm -t &quot;petclinic-grafana-server:dev&quot; ./docker/grafana
docker build --force-rm -t &quot;petclinic-prometheus-server:dev&quot; ./docker/prometheus"><pre>./mvnw clean package
docker build --force-rm -t <span class="pl-s"><span class="pl-pds">"</span>petclinic-admin-server:dev<span class="pl-pds">"</span></span> ./spring-petclinic-admin-server
docker build --force-rm -t <span class="pl-s"><span class="pl-pds">"</span>petclinic-api-gateway:dev<span class="pl-pds">"</span></span> ./spring-petclinic-api-gateway
docker build --force-rm -t <span class="pl-s"><span class="pl-pds">"</span>petclinic-config-server:dev<span class="pl-pds">"</span></span> ./spring-petclinic-config-server
docker build --force-rm -t <span class="pl-s"><span class="pl-pds">"</span>petclinic-customers-service:dev<span class="pl-pds">"</span></span> ./spring-petclinic-customers-service
docker build --force-rm -t <span class="pl-s"><span class="pl-pds">"</span>petclinic-discovery-server:dev<span class="pl-pds">"</span></span> ./spring-petclinic-discovery-server
docker build --force-rm -t <span class="pl-s"><span class="pl-pds">"</span>petclinic-hystrix-dashboard:dev<span class="pl-pds">"</span></span> ./spring-petclinic-hystrix-dashboard
docker build --force-rm -t <span class="pl-s"><span class="pl-pds">"</span>petclinic-vets-service:dev<span class="pl-pds">"</span></span> ./spring-petclinic-vets-service
docker build --force-rm -t <span class="pl-s"><span class="pl-pds">"</span>petclinic-visits-service:dev<span class="pl-pds">"</span></span> ./spring-petclinic-visits-service
docker build --force-rm -t <span class="pl-s"><span class="pl-pds">"</span>petclinic-grafana-server:dev<span class="pl-pds">"</span></span> ./docker/grafana
docker build --force-rm -t <span class="pl-s"><span class="pl-pds">"</span>petclinic-prometheus-server:dev<span class="pl-pds">"</span></span> ./docker/prometheus</pre></div>
<ul dir="auto">
<li>Give execution permission to build-dev-docker-images.sh.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="chmod +x build-dev-docker-images.sh"><pre>chmod +x build-dev-docker-images.sh</pre></div>
<ul dir="auto">
<li>Build the images.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="./build-dev-docker-images.sh"><pre>./build-dev-docker-images.sh</pre></div>
<ul dir="auto">
<li>Commit the changes, then push the new script to the remote repo.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="git add .
git commit -m 'added script for building docker images'
git push --set-upstream origin feature/msp-7
git checkout dev
git merge feature/msp-7
git push origin dev"><pre>git add <span class="pl-c1">.</span>
git commit -m <span class="pl-s"><span class="pl-pds">'</span>added script for building docker images<span class="pl-pds">'</span></span>
git push --set-upstream origin feature/msp-7
git checkout dev
git merge feature/msp-7
git push origin dev</pre></div>
<h2 dir="auto"><a id="user-content-msp-8---create-docker-compose-file-for-local-development" class="anchor" aria-hidden="true" href="#msp-8---create-docker-compose-file-for-local-development"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>MSP 8 - Create Docker Compose File for Local Development</h2>
<ul dir="auto">
<li>Create <code>feature/msp-8</code> branch from <code>dev</code>.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="git checkout dev
git branch feature/msp-8
git checkout feature/msp-8"><pre>git checkout dev
git branch feature/msp-8
git checkout feature/msp-8</pre></div>
<ul dir="auto">
<li>Prepare docker compose file to deploy the application locally and save it as <code>docker-compose-local.yml</code> under <code>petclinic-microservices-with-db</code> folder.</li>
</ul>
<div class="highlight highlight-source-yaml position-relative overflow-auto" data-snippet-clipboard-copy-content="version: '2'

services: 
  config-server:
    image: petclinic-config-server:dev
    container_name: config-server
    mem_limit: 512M
    ports: 
      - 8888:8888

  discovery-server:
    image: petclinic-discovery-server:dev
    container_name: discovery-server
    mem_limit: 512M
    ports: 
      - 8761:8761
    depends_on: 
      - config-server
    entrypoint: [&quot;./dockerize&quot;, &quot;-wait=tcp://config-server:8888&quot;, &quot;-timeout=160s&quot;, &quot;--&quot;, &quot;java&quot;, &quot;-Djava.security.egd=file:/dev/./urandom&quot;,&quot;-jar&quot;,&quot;/app.jar&quot;]

  customers-service:
    image: petclinic-customers-service:dev
    container_name: customers-service
    mem_limit: 512M
    ports:
     - 8081:8081
    depends_on: 
     - config-server
     - discovery-server
    entrypoint: [&quot;./dockerize&quot;, &quot;-wait=tcp://discovery-server:8761&quot;, &quot;-timeout=160s&quot;, &quot;--&quot;, &quot;java&quot;, &quot;-Djava.security.egd=file:/dev/./urandom&quot;,&quot;-jar&quot;,&quot;/app.jar&quot; ]
  
  visits-service:
    image: petclinic-visits-service:dev
    container_name: visits-service
    mem_limit: 512M
    ports:
     - 8082:8082
    depends_on: 
     - config-server
     - discovery-server
    entrypoint: [&quot;./dockerize&quot;, &quot;-wait=tcp://discovery-server:8761&quot;, &quot;-timeout=160s&quot;, &quot;--&quot;, &quot;java&quot;, &quot;-Djava.security.egd=file:/dev/./urandom&quot;,&quot;-jar&quot;,&quot;/app.jar&quot; ]
  
  vets-service:
    image: petclinic-vets-service:dev
    container_name: vets-service
    mem_limit: 512M
    ports:
     - 8083:8083
    depends_on: 
     - config-server
     - discovery-server
    entrypoint: [&quot;./dockerize&quot;, &quot;-wait=tcp://discovery-server:8761&quot;, &quot;-timeout=160s&quot;, &quot;--&quot;, &quot;java&quot;, &quot;-Djava.security.egd=file:/dev/./urandom&quot;,&quot;-jar&quot;,&quot;/app.jar&quot; ]
  
  api-gateway:
    image: petclinic-api-gateway:dev
    container_name: api-gateway
    mem_limit: 512M
    ports:
     - 8080:8080
    depends_on: 
     - config-server
     - discovery-server
    entrypoint: [&quot;./dockerize&quot;, &quot;-wait=tcp://discovery-server:8761&quot;, &quot;-timeout=160s&quot;, &quot;--&quot;, &quot;java&quot;, &quot;-Djava.security.egd=file:/dev/./urandom&quot;,&quot;-jar&quot;,&quot;/app.jar&quot; ]
  
  admin-server:
    image: petclinic-admin-server:dev
    container_name: admin-server
    mem_limit: 512M
    ports:
     - 9090:9090
    depends_on: 
     - config-server
     - discovery-server
    entrypoint: [&quot;./dockerize&quot;, &quot;-wait=tcp://discovery-server:8761&quot;, &quot;-timeout=160s&quot;, &quot;--&quot;, &quot;java&quot;, &quot;-Djava.security.egd=file:/dev/./urandom&quot;,&quot;-jar&quot;,&quot;/app.jar&quot; ]

  hystrix-dashboard:
    image: petclinic-hystrix-dashboard:dev
    container_name: hystrix-dashboard
    mem_limit: 512M
    ports:
     - 7979:7979
    depends_on: 
     - config-server
     - discovery-server
    entrypoint: [&quot;./dockerize&quot;, &quot;-wait=tcp://discovery-server:8761&quot;, &quot;-timeout=160s&quot;, &quot;--&quot;, &quot;java&quot;, &quot;-Djava.security.egd=file:/dev/./urandom&quot;,&quot;-jar&quot;,&quot;/app.jar&quot; ]

  tracing-server:
    image: openzipkin/zipkin
    container_name: tracing-server
    mem_limit: 512M
    environment:
    - JAVA_OPTS=-XX:+UnlockExperimentalVMOptions -Djava.security.egd=file:/dev/./urandom
    ports:
     - 9411:9411 
  
  grafana-server:
    image: petclinic-grafana-server:dev
    container_name: grafana-server
    mem_limit: 256M
    ports:
    - 3000:3000

  prometheus-server:
    image: petclinic-prometheus-server:dev
    container_name: prometheus-server
    mem_limit: 256M
    ports:
    - 9091:9090

  mysql-server:
    image: mysql:5.7.8
    container_name: mysql-server
    environment: 
      MYSQL_ROOT_PASSWORD: petclinic
      MYSQL_DATABASE: petclinic
    mem_limit: 256M
    ports:
    - 3306:3306"><pre><span class="pl-ent">version</span>: <span class="pl-s"><span class="pl-pds">'</span>2<span class="pl-pds">'</span></span>

<span class="pl-ent">services</span>: 
  <span class="pl-ent">config-server</span>:
    <span class="pl-ent">image</span>: <span class="pl-s">petclinic-config-server:dev</span>
    <span class="pl-ent">container_name</span>: <span class="pl-s">config-server</span>
    <span class="pl-ent">mem_limit</span>: <span class="pl-c1">512M</span>
    <span class="pl-ent">ports</span>: 
      - <span class="pl-c1">8888:8888</span>

  <span class="pl-ent">discovery-server</span>:
    <span class="pl-ent">image</span>: <span class="pl-s">petclinic-discovery-server:dev</span>
    <span class="pl-ent">container_name</span>: <span class="pl-s">discovery-server</span>
    <span class="pl-ent">mem_limit</span>: <span class="pl-c1">512M</span>
    <span class="pl-ent">ports</span>: 
      - <span class="pl-c1">8761:8761</span>
    <span class="pl-ent">depends_on</span>: 
      - <span class="pl-s">config-server</span>
    <span class="pl-ent">entrypoint</span>: <span class="pl-s">["./dockerize", "-wait=tcp://config-server:8888", "-timeout=160s", "--", "java", "-Djava.security.egd=file:/dev/./urandom","-jar","/app.jar"]</span>

  <span class="pl-ent">customers-service</span>:
    <span class="pl-ent">image</span>: <span class="pl-s">petclinic-customers-service:dev</span>
    <span class="pl-ent">container_name</span>: <span class="pl-s">customers-service</span>
    <span class="pl-ent">mem_limit</span>: <span class="pl-c1">512M</span>
    <span class="pl-ent">ports</span>:
     - <span class="pl-c1">8081:8081</span>
    <span class="pl-ent">depends_on</span>: 
     - <span class="pl-s">config-server</span>
     - <span class="pl-s">discovery-server</span>
    <span class="pl-ent">entrypoint</span>: <span class="pl-s">["./dockerize", "-wait=tcp://discovery-server:8761", "-timeout=160s", "--", "java", "-Djava.security.egd=file:/dev/./urandom","-jar","/app.jar" ]</span>
  
  <span class="pl-ent">visits-service</span>:
    <span class="pl-ent">image</span>: <span class="pl-s">petclinic-visits-service:dev</span>
    <span class="pl-ent">container_name</span>: <span class="pl-s">visits-service</span>
    <span class="pl-ent">mem_limit</span>: <span class="pl-c1">512M</span>
    <span class="pl-ent">ports</span>:
     - <span class="pl-c1">8082:8082</span>
    <span class="pl-ent">depends_on</span>: 
     - <span class="pl-s">config-server</span>
     - <span class="pl-s">discovery-server</span>
    <span class="pl-ent">entrypoint</span>: <span class="pl-s">["./dockerize", "-wait=tcp://discovery-server:8761", "-timeout=160s", "--", "java", "-Djava.security.egd=file:/dev/./urandom","-jar","/app.jar" ]</span>
  
  <span class="pl-ent">vets-service</span>:
    <span class="pl-ent">image</span>: <span class="pl-s">petclinic-vets-service:dev</span>
    <span class="pl-ent">container_name</span>: <span class="pl-s">vets-service</span>
    <span class="pl-ent">mem_limit</span>: <span class="pl-c1">512M</span>
    <span class="pl-ent">ports</span>:
     - <span class="pl-c1">8083:8083</span>
    <span class="pl-ent">depends_on</span>: 
     - <span class="pl-s">config-server</span>
     - <span class="pl-s">discovery-server</span>
    <span class="pl-ent">entrypoint</span>: <span class="pl-s">["./dockerize", "-wait=tcp://discovery-server:8761", "-timeout=160s", "--", "java", "-Djava.security.egd=file:/dev/./urandom","-jar","/app.jar" ]</span>
  
  <span class="pl-ent">api-gateway</span>:
    <span class="pl-ent">image</span>: <span class="pl-s">petclinic-api-gateway:dev</span>
    <span class="pl-ent">container_name</span>: <span class="pl-s">api-gateway</span>
    <span class="pl-ent">mem_limit</span>: <span class="pl-c1">512M</span>
    <span class="pl-ent">ports</span>:
     - <span class="pl-c1">8080:8080</span>
    <span class="pl-ent">depends_on</span>: 
     - <span class="pl-s">config-server</span>
     - <span class="pl-s">discovery-server</span>
    <span class="pl-ent">entrypoint</span>: <span class="pl-s">["./dockerize", "-wait=tcp://discovery-server:8761", "-timeout=160s", "--", "java", "-Djava.security.egd=file:/dev/./urandom","-jar","/app.jar" ]</span>
  
  <span class="pl-ent">admin-server</span>:
    <span class="pl-ent">image</span>: <span class="pl-s">petclinic-admin-server:dev</span>
    <span class="pl-ent">container_name</span>: <span class="pl-s">admin-server</span>
    <span class="pl-ent">mem_limit</span>: <span class="pl-c1">512M</span>
    <span class="pl-ent">ports</span>:
     - <span class="pl-c1">9090:9090</span>
    <span class="pl-ent">depends_on</span>: 
     - <span class="pl-s">config-server</span>
     - <span class="pl-s">discovery-server</span>
    <span class="pl-ent">entrypoint</span>: <span class="pl-s">["./dockerize", "-wait=tcp://discovery-server:8761", "-timeout=160s", "--", "java", "-Djava.security.egd=file:/dev/./urandom","-jar","/app.jar" ]</span>

  <span class="pl-ent">hystrix-dashboard</span>:
    <span class="pl-ent">image</span>: <span class="pl-s">petclinic-hystrix-dashboard:dev</span>
    <span class="pl-ent">container_name</span>: <span class="pl-s">hystrix-dashboard</span>
    <span class="pl-ent">mem_limit</span>: <span class="pl-c1">512M</span>
    <span class="pl-ent">ports</span>:
     - <span class="pl-c1">7979:7979</span>
    <span class="pl-ent">depends_on</span>: 
     - <span class="pl-s">config-server</span>
     - <span class="pl-s">discovery-server</span>
    <span class="pl-ent">entrypoint</span>: <span class="pl-s">["./dockerize", "-wait=tcp://discovery-server:8761", "-timeout=160s", "--", "java", "-Djava.security.egd=file:/dev/./urandom","-jar","/app.jar" ]</span>

  <span class="pl-ent">tracing-server</span>:
    <span class="pl-ent">image</span>: <span class="pl-s">openzipkin/zipkin</span>
    <span class="pl-ent">container_name</span>: <span class="pl-s">tracing-server</span>
    <span class="pl-ent">mem_limit</span>: <span class="pl-c1">512M</span>
    <span class="pl-ent">environment</span>:
    - <span class="pl-s">JAVA_OPTS=-XX:+UnlockExperimentalVMOptions -Djava.security.egd=file:/dev/./urandom</span>
    <span class="pl-ent">ports</span>:
     - <span class="pl-c1">9411:9411</span> 
  
  <span class="pl-ent">grafana-server</span>:
    <span class="pl-ent">image</span>: <span class="pl-s">petclinic-grafana-server:dev</span>
    <span class="pl-ent">container_name</span>: <span class="pl-s">grafana-server</span>
    <span class="pl-ent">mem_limit</span>: <span class="pl-c1">256M</span>
    <span class="pl-ent">ports</span>:
    - <span class="pl-c1">3000:3000</span>

  <span class="pl-ent">prometheus-server</span>:
    <span class="pl-ent">image</span>: <span class="pl-s">petclinic-prometheus-server:dev</span>
    <span class="pl-ent">container_name</span>: <span class="pl-s">prometheus-server</span>
    <span class="pl-ent">mem_limit</span>: <span class="pl-c1">256M</span>
    <span class="pl-ent">ports</span>:
    - <span class="pl-c1">9091:9090</span>

  <span class="pl-ent">mysql-server</span>:
    <span class="pl-ent">image</span>: <span class="pl-s">mysql:5.7.8</span>
    <span class="pl-ent">container_name</span>: <span class="pl-s">mysql-server</span>
    <span class="pl-ent">environment</span>: 
      <span class="pl-ent">MYSQL_ROOT_PASSWORD</span>: <span class="pl-s">petclinic</span>
      <span class="pl-ent">MYSQL_DATABASE</span>: <span class="pl-s">petclinic</span>
    <span class="pl-ent">mem_limit</span>: <span class="pl-c1">256M</span>
    <span class="pl-ent">ports</span>:
    - <span class="pl-c1">3306:3306</span></pre></div>
<ul dir="auto">
<li>Prepare a script to test the deployment of the app locally with <code>docker-compose-local.yml</code> and save it as <code>test-local-deployment.sh</code> under <code>petclinic-microservices-with-db</code> folder.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="docker-compose -f docker-compose-local.yml up"><pre>docker-compose -f docker-compose-local.yml up</pre></div>
<ul dir="auto">
<li>Give execution permission to test-local-deployment.sh.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="chmod +x test-local-deployment.sh"><pre>chmod +x test-local-deployment.sh</pre></div>
<ul dir="auto">
<li>Execute the docker compose.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="./test-local-deployment.sh"><pre>./test-local-deployment.sh</pre></div>
<ul dir="auto">
<li>Commit the change, then push the docker compose file to the remote repo.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="git add .
git commit -m 'added docker-compose file and script for local deployment'
git push --set-upstream origin feature/msp-8
git checkout dev
git merge feature/msp-8
git push origin dev"><pre>git add <span class="pl-c1">.</span>
git commit -m <span class="pl-s"><span class="pl-pds">'</span>added docker-compose file and script for local deployment<span class="pl-pds">'</span></span>
git push --set-upstream origin feature/msp-8
git checkout dev
git merge feature/msp-8
git push origin dev</pre></div>
<h2 dir="auto"><a id="user-content-msp-9---setup-unit-tests-and-configure-code-coverage-report" class="anchor" aria-hidden="true" href="#msp-9---setup-unit-tests-and-configure-code-coverage-report"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>MSP 9 - Setup Unit Tests and Configure Code Coverage Report</h2>
<ul dir="auto">
<li>Create <code>feature/msp-9</code> branch from <code>dev</code>.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="git checkout dev
git branch feature/msp-9
git checkout feature/msp-9"><pre>git checkout dev
git branch feature/msp-9
git checkout feature/msp-9</pre></div>
<ul dir="auto">
<li>Create following unit tests for <code>Pet.java</code> under <code>customer-service</code> microservice using the following <code>PetTest</code> class and save it as <code>PetTest.java</code> under <code>./spring-petclinic-customers-service/src/test/java/org/springframework/samples/petclinic/customers/model/</code> folder.</li>
</ul>
<div class="highlight highlight-source-java position-relative overflow-auto" data-snippet-clipboard-copy-content="package org.springframework.samples.petclinic.customers.model;

import static org.junit.jupiter.api.Assertions.assertEquals;

import java.util.Date;

import org.junit.jupiter.api.Test;
public class PetTest {
    @Test
    public void testGetName(){
        //Arrange
        Pet pet = new Pet();
        //Act
        pet.setName(&quot;Fluffy&quot;);
        //Assert
        assertEquals(&quot;Fluffy&quot;, pet.getName());
    }
    @Test
    public void testGetOwner(){
        //Arrange
        Pet pet = new Pet();
        Owner owner = new Owner();
        owner.setFirstName(&quot;Call&quot;);
        //Act
        pet.setOwner(owner);
        //Assert
        assertEquals(&quot;Call&quot;, pet.getOwner().getFirstName());
    }
    @Test
    public void testBirthDate(){
        //Arrange
        Pet pet = new Pet();
        Date bd = new Date();
        //Act
        pet.setBirthDate(bd);
        //Assert
        assertEquals(bd,pet.getBirthDate());
    }
}"><pre><span class="pl-k">package</span> <span class="pl-smi">org.springframework.samples.petclinic.customers.model</span>;

<span class="pl-k">import static</span> <span class="pl-smi">org.junit.jupiter.api.Assertions.assertEquals</span>;

<span class="pl-k">import</span> <span class="pl-smi">java.util.Date</span>;

<span class="pl-k">import</span> <span class="pl-smi">org.junit.jupiter.api.Test</span>;
<span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">PetTest</span> {
    <span class="pl-k">@Test</span>
    <span class="pl-k">public</span> <span class="pl-k">void</span> <span class="pl-en">testGetName</span>(){
        <span class="pl-c"><span class="pl-c">//</span>Arrange</span>
        <span class="pl-smi">Pet</span> pet <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">Pet</span>();
        <span class="pl-c"><span class="pl-c">//</span>Act</span>
        pet<span class="pl-k">.</span>setName(<span class="pl-s"><span class="pl-pds">"</span>Fluffy<span class="pl-pds">"</span></span>);
        <span class="pl-c"><span class="pl-c">//</span>Assert</span>
        assertEquals(<span class="pl-s"><span class="pl-pds">"</span>Fluffy<span class="pl-pds">"</span></span>, pet<span class="pl-k">.</span>getName());
    }
    <span class="pl-k">@Test</span>
    <span class="pl-k">public</span> <span class="pl-k">void</span> <span class="pl-en">testGetOwner</span>(){
        <span class="pl-c"><span class="pl-c">//</span>Arrange</span>
        <span class="pl-smi">Pet</span> pet <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">Pet</span>();
        <span class="pl-smi">Owner</span> owner <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">Owner</span>();
        owner<span class="pl-k">.</span>setFirstName(<span class="pl-s"><span class="pl-pds">"</span>Call<span class="pl-pds">"</span></span>);
        <span class="pl-c"><span class="pl-c">//</span>Act</span>
        pet<span class="pl-k">.</span>setOwner(owner);
        <span class="pl-c"><span class="pl-c">//</span>Assert</span>
        assertEquals(<span class="pl-s"><span class="pl-pds">"</span>Call<span class="pl-pds">"</span></span>, pet<span class="pl-k">.</span>getOwner()<span class="pl-k">.</span>getFirstName());
    }
    <span class="pl-k">@Test</span>
    <span class="pl-k">public</span> <span class="pl-k">void</span> <span class="pl-en">testBirthDate</span>(){
        <span class="pl-c"><span class="pl-c">//</span>Arrange</span>
        <span class="pl-smi">Pet</span> pet <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">Pet</span>();
        <span class="pl-smi">Date</span> bd <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">Date</span>();
        <span class="pl-c"><span class="pl-c">//</span>Act</span>
        pet<span class="pl-k">.</span>setBirthDate(bd);
        <span class="pl-c"><span class="pl-c">//</span>Assert</span>
        assertEquals(bd,pet<span class="pl-k">.</span>getBirthDate());
    }
}</pre></div>
<ul dir="auto">
<li>Implement unit tests with maven wrapper for only <code>customer-service</code> microservice locally on <code>Dev Server</code>. Execute the following command under the <code>spring-petclinic-customers-service folder</code>.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="../mvnw clean test"><pre>../mvnw clean <span class="pl-c1">test</span></pre></div>
<ul dir="auto">
<li>Commit the change, then push the changes to the remote repo.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="git add .
git commit -m 'added 3 UTs for customer-service'
git push --set-upstream origin feature/msp-9"><pre>git add <span class="pl-c1">.</span>
git commit -m <span class="pl-s"><span class="pl-pds">'</span>added 3 UTs for customer-service<span class="pl-pds">'</span></span>
git push --set-upstream origin feature/msp-9</pre></div>
<ul dir="auto">
<li>Update POM file at root folder for Code Coverage Report using <code>Jacoco</code> tool plugin.</li>
</ul>
<div class="highlight highlight-text-xml position-relative overflow-auto" data-snippet-clipboard-copy-content="&lt;plugin&gt;
    &lt;groupId&gt;org.jacoco&lt;/groupId&gt;
    &lt;artifactId&gt;jacoco-maven-plugin&lt;/artifactId&gt;
    &lt;version&gt;0.8.2&lt;/version&gt;
    &lt;executions&gt;
        &lt;execution&gt;
            &lt;goals&gt;
                &lt;goal&gt;prepare-agent&lt;/goal&gt;
            &lt;/goals&gt;
        &lt;/execution&gt;
        &lt;!-- attached to Maven test phase --&gt;
        &lt;execution&gt;
            &lt;id&gt;report&lt;/id&gt;
            &lt;phase&gt;test&lt;/phase&gt;
            &lt;goals&gt;
                &lt;goal&gt;report&lt;/goal&gt;
            &lt;/goals&gt;
        &lt;/execution&gt;
    &lt;/executions&gt;
&lt;/plugin&gt;"><pre>&lt;<span class="pl-ent">plugin</span>&gt;
    &lt;<span class="pl-ent">groupId</span>&gt;org.jacoco&lt;/<span class="pl-ent">groupId</span>&gt;
    &lt;<span class="pl-ent">artifactId</span>&gt;jacoco-maven-plugin&lt;/<span class="pl-ent">artifactId</span>&gt;
    &lt;<span class="pl-ent">version</span>&gt;0.8.2&lt;/<span class="pl-ent">version</span>&gt;
    &lt;<span class="pl-ent">executions</span>&gt;
        &lt;<span class="pl-ent">execution</span>&gt;
            &lt;<span class="pl-ent">goals</span>&gt;
                &lt;<span class="pl-ent">goal</span>&gt;prepare-agent&lt;/<span class="pl-ent">goal</span>&gt;
            &lt;/<span class="pl-ent">goals</span>&gt;
        &lt;/<span class="pl-ent">execution</span>&gt;
        <span class="pl-c"><span class="pl-c">&lt;!--</span> attached to Maven test phase <span class="pl-c">--&gt;</span></span>
        &lt;<span class="pl-ent">execution</span>&gt;
            &lt;<span class="pl-ent">id</span>&gt;report&lt;/<span class="pl-ent">id</span>&gt;
            &lt;<span class="pl-ent">phase</span>&gt;test&lt;/<span class="pl-ent">phase</span>&gt;
            &lt;<span class="pl-ent">goals</span>&gt;
                &lt;<span class="pl-ent">goal</span>&gt;report&lt;/<span class="pl-ent">goal</span>&gt;
            &lt;/<span class="pl-ent">goals</span>&gt;
        &lt;/<span class="pl-ent">execution</span>&gt;
    &lt;/<span class="pl-ent">executions</span>&gt;
&lt;/<span class="pl-ent">plugin</span>&gt;</pre></div>
<ul dir="auto">
<li>Create code coverage report for only <code>customer-service</code> microservice locally on <code>Dev Server</code>. Execute the following command under the <code>spring-petclinic-customers-service folder</code>.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="../mvnw test"><pre>../mvnw <span class="pl-c1">test</span></pre></div>
<ul dir="auto">
<li>Commit the change, then push the changes to the remote repo.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="git add .
git commit -m 'updated POM with Jacoco plugin'
git push
git checkout dev
git merge feature/msp-9
git push origin dev"><pre>git add <span class="pl-c1">.</span>
git commit -m <span class="pl-s"><span class="pl-pds">'</span>updated POM with Jacoco plugin<span class="pl-pds">'</span></span>
git push
git checkout dev
git merge feature/msp-9
git push origin dev</pre></div>
<ul dir="auto">
<li>Deploy code coverage report (located under relative path <code>target/site/jacoco</code> of the microservice) on Simple HTTP Server for only <code>customer-service</code> microservice on <code>Dev Server</code>.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="python -m SimpleHTTPServer # for python 2.7
python3 -m http.server # for python 3+"><pre>python -m SimpleHTTPServer <span class="pl-c"><span class="pl-c">#</span> for python 2.7</span>
python3 -m http.server <span class="pl-c"><span class="pl-c">#</span> for python 3+</span></pre></div>
<h2 dir="auto"><a id="user-content-msp-10---prepare-and-implement-selenium-tests" class="anchor" aria-hidden="true" href="#msp-10---prepare-and-implement-selenium-tests"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>MSP 10 - Prepare and Implement Selenium Tests</h2>
<ul dir="auto">
<li>Create <code>feature/msp-10</code> branch from <code>dev</code>.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="git checkout dev
git branch feature/msp-10
git checkout feature/msp-10"><pre>git checkout dev
git branch feature/msp-10
git checkout feature/msp-10</pre></div>
<ul dir="auto">
<li>Create a folder for Selenium jobs with the name of <code>selenium-jobs</code>.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="mkdir selenium-jobs"><pre>mkdir selenium-jobs</pre></div>
<ul dir="auto">
<li>Create Selenium job (<code>QA Automation</code> test) for testing <code>Owners &gt;&gt; All</code> page and save it as <code>test_owners_all_headless.py</code> under <code>selenium-jobs</code> folder.</li>
</ul>
<div class="highlight highlight-source-python position-relative overflow-auto" data-snippet-clipboard-copy-content="from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC
from time import sleep
import os

# Set chrome options for working with headless mode (no screen)
chrome_options = webdriver.ChromeOptions()
chrome_options.add_argument(&quot;headless&quot;)
chrome_options.add_argument(&quot;no-sandbox&quot;)
chrome_options.add_argument(&quot;disable-dev-shm-usage&quot;)

# Update webdriver instance of chrome-driver with adding chrome options
driver = webdriver.Chrome(options=chrome_options)
# driver = webdriver.Chrome(&quot;/Users/home/Desktop/chromedriver&quot;)
# Connect to the application
APP_IP = os.environ['MASTER_PUBLIC_IP']
url = &quot;http://&quot;+APP_IP.strip()+&quot;:8080/&quot;
# url = &quot;http://localhost:8080&quot;
print(url)
driver.get(url)
sleep(3)
owners_link = driver.find_element_by_link_text(&quot;OWNERS&quot;)
owners_link.click()
sleep(2)
all_link = driver.find_element_by_link_text(&quot;ALL&quot;)
all_link.click()
sleep(2)

# Verify that table loaded
sleep(1)
verify_table = WebDriverWait(driver, 10).until(EC.presence_of_element_located((By.TAG_NAME, &quot;table&quot;)))

print(&quot;Table loaded&quot;)

driver.quit()"><pre><span class="pl-k">from</span> <span class="pl-s1">selenium</span> <span class="pl-k">import</span> <span class="pl-s1">webdriver</span>
<span class="pl-k">from</span> <span class="pl-s1">selenium</span>.<span class="pl-s1">webdriver</span>.<span class="pl-s1">common</span>.<span class="pl-s1">by</span> <span class="pl-k">import</span> <span class="pl-v">By</span>
<span class="pl-k">from</span> <span class="pl-s1">selenium</span>.<span class="pl-s1">webdriver</span>.<span class="pl-s1">support</span>.<span class="pl-s1">ui</span> <span class="pl-k">import</span> <span class="pl-v">WebDriverWait</span>
<span class="pl-k">from</span> <span class="pl-s1">selenium</span>.<span class="pl-s1">webdriver</span>.<span class="pl-s1">support</span> <span class="pl-k">import</span> <span class="pl-s1">expected_conditions</span> <span class="pl-k">as</span> <span class="pl-v">EC</span>
<span class="pl-k">from</span> <span class="pl-s1">time</span> <span class="pl-k">import</span> <span class="pl-s1">sleep</span>
<span class="pl-k">import</span> <span class="pl-s1">os</span>

<span class="pl-c"># Set chrome options for working with headless mode (no screen)</span>
<span class="pl-s1">chrome_options</span> <span class="pl-c1">=</span> <span class="pl-s1">webdriver</span>.<span class="pl-v">ChromeOptions</span>()
<span class="pl-s1">chrome_options</span>.<span class="pl-en">add_argument</span>(<span class="pl-s">"headless"</span>)
<span class="pl-s1">chrome_options</span>.<span class="pl-en">add_argument</span>(<span class="pl-s">"no-sandbox"</span>)
<span class="pl-s1">chrome_options</span>.<span class="pl-en">add_argument</span>(<span class="pl-s">"disable-dev-shm-usage"</span>)

<span class="pl-c"># Update webdriver instance of chrome-driver with adding chrome options</span>
<span class="pl-s1">driver</span> <span class="pl-c1">=</span> <span class="pl-s1">webdriver</span>.<span class="pl-v">Chrome</span>(<span class="pl-s1">options</span><span class="pl-c1">=</span><span class="pl-s1">chrome_options</span>)
<span class="pl-c"># driver = webdriver.Chrome("/Users/home/Desktop/chromedriver")</span>
<span class="pl-c"># Connect to the application</span>
<span class="pl-v">APP_IP</span> <span class="pl-c1">=</span> <span class="pl-s1">os</span>.<span class="pl-s1">environ</span>[<span class="pl-s">'MASTER_PUBLIC_IP'</span>]
<span class="pl-s1">url</span> <span class="pl-c1">=</span> <span class="pl-s">"http://"</span><span class="pl-c1">+</span><span class="pl-v">APP_IP</span>.<span class="pl-en">strip</span>()<span class="pl-c1">+</span><span class="pl-s">":8080/"</span>
<span class="pl-c"># url = "http://localhost:8080"</span>
<span class="pl-en">print</span>(<span class="pl-s1">url</span>)
<span class="pl-s1">driver</span>.<span class="pl-en">get</span>(<span class="pl-s1">url</span>)
<span class="pl-en">sleep</span>(<span class="pl-c1">3</span>)
<span class="pl-s1">owners_link</span> <span class="pl-c1">=</span> <span class="pl-s1">driver</span>.<span class="pl-en">find_element_by_link_text</span>(<span class="pl-s">"OWNERS"</span>)
<span class="pl-s1">owners_link</span>.<span class="pl-en">click</span>()
<span class="pl-en">sleep</span>(<span class="pl-c1">2</span>)
<span class="pl-s1">all_link</span> <span class="pl-c1">=</span> <span class="pl-s1">driver</span>.<span class="pl-en">find_element_by_link_text</span>(<span class="pl-s">"ALL"</span>)
<span class="pl-s1">all_link</span>.<span class="pl-en">click</span>()
<span class="pl-en">sleep</span>(<span class="pl-c1">2</span>)

<span class="pl-c"># Verify that table loaded</span>
<span class="pl-en">sleep</span>(<span class="pl-c1">1</span>)
<span class="pl-s1">verify_table</span> <span class="pl-c1">=</span> <span class="pl-v">WebDriverWait</span>(<span class="pl-s1">driver</span>, <span class="pl-c1">10</span>).<span class="pl-en">until</span>(<span class="pl-v">EC</span>.<span class="pl-en">presence_of_element_located</span>((<span class="pl-v">By</span>.<span class="pl-v">TAG_NAME</span>, <span class="pl-s">"table"</span>)))

<span class="pl-en">print</span>(<span class="pl-s">"Table loaded"</span>)

<span class="pl-s1">driver</span>.<span class="pl-en">quit</span>()</pre></div>
<ul dir="auto">
<li>Create Selenium job (<code>QA Automation</code> test) for testing <code>Owners &gt;&gt; Register</code> page and save it as <code>test_owners_register_headless.py</code> under <code>selenium-jobs</code> folder.</li>
</ul>
<div class="highlight highlight-source-python position-relative overflow-auto" data-snippet-clipboard-copy-content="from selenium import webdriver
from selenium.webdriver.common.keys import Keys
from time import sleep
import random
import os
# Set chrome options for working with headless mode (no screen)
chrome_options = webdriver.ChromeOptions()
chrome_options.add_argument(&quot;headless&quot;)
chrome_options.add_argument(&quot;no-sandbox&quot;)
chrome_options.add_argument(&quot;disable-dev-shm-usage&quot;)

# Update webdriver instance of chrome-driver with adding chrome options
driver = webdriver.Chrome(options=chrome_options)

# Connect to the application
APP_IP = os.environ['MASTER_PUBLIC_IP']
url = &quot;http://&quot;+APP_IP.strip()+&quot;:8080/&quot;
print(url)
driver.get(url)
owners_link = driver.find_element_by_link_text(&quot;OWNERS&quot;)
owners_link.click()
sleep(2)
all_link = driver.find_element_by_link_text(&quot;REGISTER&quot;)
all_link.click()
sleep(2)
# Register new Owner to Petclinic App
fn_field = driver.find_element_by_name('firstName')
fn = 'Callahan' + str(random.randint(0, 100))
fn_field.send_keys(fn)
sleep(1)
fn_field = driver.find_element_by_name('lastName')
fn_field.send_keys('Clarusway')
sleep(1)
fn_field = driver.find_element_by_name('address')
fn_field.send_keys('Ridge Corp. Street')
sleep(1)
fn_field = driver.find_element_by_name('city')
fn_field.send_keys('McLean')
sleep(1)
fn_field = driver.find_element_by_name('telephone')
fn_field.send_keys('+1230576803')
sleep(1)
fn_field.send_keys(Keys.ENTER)

# Wait 10 seconds to get updated Owner List
sleep(10)
# Verify that new user is added to Owner List
if fn in driver.page_source:
    print(fn, 'is added and found in the Owners Table')
    print(&quot;Test Passed&quot;)
else:
    print(fn, 'is not found in the Owners Table')
    print(&quot;Test Failed&quot;)
driver.quit()"><pre><span class="pl-k">from</span> <span class="pl-s1">selenium</span> <span class="pl-k">import</span> <span class="pl-s1">webdriver</span>
<span class="pl-k">from</span> <span class="pl-s1">selenium</span>.<span class="pl-s1">webdriver</span>.<span class="pl-s1">common</span>.<span class="pl-s1">keys</span> <span class="pl-k">import</span> <span class="pl-v">Keys</span>
<span class="pl-k">from</span> <span class="pl-s1">time</span> <span class="pl-k">import</span> <span class="pl-s1">sleep</span>
<span class="pl-k">import</span> <span class="pl-s1">random</span>
<span class="pl-k">import</span> <span class="pl-s1">os</span>
<span class="pl-c"># Set chrome options for working with headless mode (no screen)</span>
<span class="pl-s1">chrome_options</span> <span class="pl-c1">=</span> <span class="pl-s1">webdriver</span>.<span class="pl-v">ChromeOptions</span>()
<span class="pl-s1">chrome_options</span>.<span class="pl-en">add_argument</span>(<span class="pl-s">"headless"</span>)
<span class="pl-s1">chrome_options</span>.<span class="pl-en">add_argument</span>(<span class="pl-s">"no-sandbox"</span>)
<span class="pl-s1">chrome_options</span>.<span class="pl-en">add_argument</span>(<span class="pl-s">"disable-dev-shm-usage"</span>)

<span class="pl-c"># Update webdriver instance of chrome-driver with adding chrome options</span>
<span class="pl-s1">driver</span> <span class="pl-c1">=</span> <span class="pl-s1">webdriver</span>.<span class="pl-v">Chrome</span>(<span class="pl-s1">options</span><span class="pl-c1">=</span><span class="pl-s1">chrome_options</span>)

<span class="pl-c"># Connect to the application</span>
<span class="pl-v">APP_IP</span> <span class="pl-c1">=</span> <span class="pl-s1">os</span>.<span class="pl-s1">environ</span>[<span class="pl-s">'MASTER_PUBLIC_IP'</span>]
<span class="pl-s1">url</span> <span class="pl-c1">=</span> <span class="pl-s">"http://"</span><span class="pl-c1">+</span><span class="pl-v">APP_IP</span>.<span class="pl-en">strip</span>()<span class="pl-c1">+</span><span class="pl-s">":8080/"</span>
<span class="pl-en">print</span>(<span class="pl-s1">url</span>)
<span class="pl-s1">driver</span>.<span class="pl-en">get</span>(<span class="pl-s1">url</span>)
<span class="pl-s1">owners_link</span> <span class="pl-c1">=</span> <span class="pl-s1">driver</span>.<span class="pl-en">find_element_by_link_text</span>(<span class="pl-s">"OWNERS"</span>)
<span class="pl-s1">owners_link</span>.<span class="pl-en">click</span>()
<span class="pl-en">sleep</span>(<span class="pl-c1">2</span>)
<span class="pl-s1">all_link</span> <span class="pl-c1">=</span> <span class="pl-s1">driver</span>.<span class="pl-en">find_element_by_link_text</span>(<span class="pl-s">"REGISTER"</span>)
<span class="pl-s1">all_link</span>.<span class="pl-en">click</span>()
<span class="pl-en">sleep</span>(<span class="pl-c1">2</span>)
<span class="pl-c"># Register new Owner to Petclinic App</span>
<span class="pl-s1">fn_field</span> <span class="pl-c1">=</span> <span class="pl-s1">driver</span>.<span class="pl-en">find_element_by_name</span>(<span class="pl-s">'firstName'</span>)
<span class="pl-s1">fn</span> <span class="pl-c1">=</span> <span class="pl-s">'Callahan'</span> <span class="pl-c1">+</span> <span class="pl-en">str</span>(<span class="pl-s1">random</span>.<span class="pl-en">randint</span>(<span class="pl-c1">0</span>, <span class="pl-c1">100</span>))
<span class="pl-s1">fn_field</span>.<span class="pl-en">send_keys</span>(<span class="pl-s1">fn</span>)
<span class="pl-en">sleep</span>(<span class="pl-c1">1</span>)
<span class="pl-s1">fn_field</span> <span class="pl-c1">=</span> <span class="pl-s1">driver</span>.<span class="pl-en">find_element_by_name</span>(<span class="pl-s">'lastName'</span>)
<span class="pl-s1">fn_field</span>.<span class="pl-en">send_keys</span>(<span class="pl-s">'Clarusway'</span>)
<span class="pl-en">sleep</span>(<span class="pl-c1">1</span>)
<span class="pl-s1">fn_field</span> <span class="pl-c1">=</span> <span class="pl-s1">driver</span>.<span class="pl-en">find_element_by_name</span>(<span class="pl-s">'address'</span>)
<span class="pl-s1">fn_field</span>.<span class="pl-en">send_keys</span>(<span class="pl-s">'Ridge Corp. Street'</span>)
<span class="pl-en">sleep</span>(<span class="pl-c1">1</span>)
<span class="pl-s1">fn_field</span> <span class="pl-c1">=</span> <span class="pl-s1">driver</span>.<span class="pl-en">find_element_by_name</span>(<span class="pl-s">'city'</span>)
<span class="pl-s1">fn_field</span>.<span class="pl-en">send_keys</span>(<span class="pl-s">'McLean'</span>)
<span class="pl-en">sleep</span>(<span class="pl-c1">1</span>)
<span class="pl-s1">fn_field</span> <span class="pl-c1">=</span> <span class="pl-s1">driver</span>.<span class="pl-en">find_element_by_name</span>(<span class="pl-s">'telephone'</span>)
<span class="pl-s1">fn_field</span>.<span class="pl-en">send_keys</span>(<span class="pl-s">'+1230576803'</span>)
<span class="pl-en">sleep</span>(<span class="pl-c1">1</span>)
<span class="pl-s1">fn_field</span>.<span class="pl-en">send_keys</span>(<span class="pl-v">Keys</span>.<span class="pl-v">ENTER</span>)

<span class="pl-c"># Wait 10 seconds to get updated Owner List</span>
<span class="pl-en">sleep</span>(<span class="pl-c1">10</span>)
<span class="pl-c"># Verify that new user is added to Owner List</span>
<span class="pl-k">if</span> <span class="pl-s1">fn</span> <span class="pl-c1">in</span> <span class="pl-s1">driver</span>.<span class="pl-s1">page_source</span>:
    <span class="pl-en">print</span>(<span class="pl-s1">fn</span>, <span class="pl-s">'is added and found in the Owners Table'</span>)
    <span class="pl-en">print</span>(<span class="pl-s">"Test Passed"</span>)
<span class="pl-k">else</span>:
    <span class="pl-en">print</span>(<span class="pl-s1">fn</span>, <span class="pl-s">'is not found in the Owners Table'</span>)
    <span class="pl-en">print</span>(<span class="pl-s">"Test Failed"</span>)
<span class="pl-s1">driver</span>.<span class="pl-en">quit</span>()</pre></div>
<ul dir="auto">
<li>Create Selenium job (<code>QA Automation</code> test) for testing <code>Veterinarians</code> page and save it as <code>test_veterinarians_headless.py</code> under <code>selenium-jobs</code> folder.</li>
</ul>
<div class="highlight highlight-source-python position-relative overflow-auto" data-snippet-clipboard-copy-content="from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC
from time import sleep
import os

# Set chrome options for working with headless mode (no screen)
chrome_options = webdriver.ChromeOptions()
chrome_options.add_argument(&quot;headless&quot;)
chrome_options.add_argument(&quot;no-sandbox&quot;)
chrome_options.add_argument(&quot;disable-dev-shm-usage&quot;)

# Update webdriver instance of chrome-driver with adding chrome options
driver = webdriver.Chrome(options=chrome_options)

# Connect to the application
APP_IP = os.environ['MASTER_PUBLIC_IP']
url = &quot;http://&quot;+APP_IP.strip()+&quot;:8080/&quot;
print(url)
driver.get(url)
sleep(3)
vet_link = driver.find_element_by_link_text(&quot;VETERINARIANS&quot;)
vet_link.click()

# Verify that table loaded
sleep(5)
verify_table = WebDriverWait(driver, 10).until(EC.presence_of_element_located((By.TAG_NAME, &quot;table&quot;)))

print(&quot;Table loaded&quot;)

driver.quit()"><pre><span class="pl-k">from</span> <span class="pl-s1">selenium</span> <span class="pl-k">import</span> <span class="pl-s1">webdriver</span>
<span class="pl-k">from</span> <span class="pl-s1">selenium</span>.<span class="pl-s1">webdriver</span>.<span class="pl-s1">common</span>.<span class="pl-s1">by</span> <span class="pl-k">import</span> <span class="pl-v">By</span>
<span class="pl-k">from</span> <span class="pl-s1">selenium</span>.<span class="pl-s1">webdriver</span>.<span class="pl-s1">support</span>.<span class="pl-s1">ui</span> <span class="pl-k">import</span> <span class="pl-v">WebDriverWait</span>
<span class="pl-k">from</span> <span class="pl-s1">selenium</span>.<span class="pl-s1">webdriver</span>.<span class="pl-s1">support</span> <span class="pl-k">import</span> <span class="pl-s1">expected_conditions</span> <span class="pl-k">as</span> <span class="pl-v">EC</span>
<span class="pl-k">from</span> <span class="pl-s1">time</span> <span class="pl-k">import</span> <span class="pl-s1">sleep</span>
<span class="pl-k">import</span> <span class="pl-s1">os</span>

<span class="pl-c"># Set chrome options for working with headless mode (no screen)</span>
<span class="pl-s1">chrome_options</span> <span class="pl-c1">=</span> <span class="pl-s1">webdriver</span>.<span class="pl-v">ChromeOptions</span>()
<span class="pl-s1">chrome_options</span>.<span class="pl-en">add_argument</span>(<span class="pl-s">"headless"</span>)
<span class="pl-s1">chrome_options</span>.<span class="pl-en">add_argument</span>(<span class="pl-s">"no-sandbox"</span>)
<span class="pl-s1">chrome_options</span>.<span class="pl-en">add_argument</span>(<span class="pl-s">"disable-dev-shm-usage"</span>)

<span class="pl-c"># Update webdriver instance of chrome-driver with adding chrome options</span>
<span class="pl-s1">driver</span> <span class="pl-c1">=</span> <span class="pl-s1">webdriver</span>.<span class="pl-v">Chrome</span>(<span class="pl-s1">options</span><span class="pl-c1">=</span><span class="pl-s1">chrome_options</span>)

<span class="pl-c"># Connect to the application</span>
<span class="pl-v">APP_IP</span> <span class="pl-c1">=</span> <span class="pl-s1">os</span>.<span class="pl-s1">environ</span>[<span class="pl-s">'MASTER_PUBLIC_IP'</span>]
<span class="pl-s1">url</span> <span class="pl-c1">=</span> <span class="pl-s">"http://"</span><span class="pl-c1">+</span><span class="pl-v">APP_IP</span>.<span class="pl-en">strip</span>()<span class="pl-c1">+</span><span class="pl-s">":8080/"</span>
<span class="pl-en">print</span>(<span class="pl-s1">url</span>)
<span class="pl-s1">driver</span>.<span class="pl-en">get</span>(<span class="pl-s1">url</span>)
<span class="pl-en">sleep</span>(<span class="pl-c1">3</span>)
<span class="pl-s1">vet_link</span> <span class="pl-c1">=</span> <span class="pl-s1">driver</span>.<span class="pl-en">find_element_by_link_text</span>(<span class="pl-s">"VETERINARIANS"</span>)
<span class="pl-s1">vet_link</span>.<span class="pl-en">click</span>()

<span class="pl-c"># Verify that table loaded</span>
<span class="pl-en">sleep</span>(<span class="pl-c1">5</span>)
<span class="pl-s1">verify_table</span> <span class="pl-c1">=</span> <span class="pl-v">WebDriverWait</span>(<span class="pl-s1">driver</span>, <span class="pl-c1">10</span>).<span class="pl-en">until</span>(<span class="pl-v">EC</span>.<span class="pl-en">presence_of_element_located</span>((<span class="pl-v">By</span>.<span class="pl-v">TAG_NAME</span>, <span class="pl-s">"table"</span>)))

<span class="pl-en">print</span>(<span class="pl-s">"Table loaded"</span>)

<span class="pl-s1">driver</span>.<span class="pl-en">quit</span>()</pre></div>
<ul dir="auto">
<li>Commit the change, then push the selenium jobs to the remote repo.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="git add .
git commit -m 'added selenium jobs written in python'
git push --set-upstream origin feature/msp-10
git checkout dev
git merge feature/msp-10
git push origin dev"><pre>git add <span class="pl-c1">.</span>
git commit -m <span class="pl-s"><span class="pl-pds">'</span>added selenium jobs written in python<span class="pl-pds">'</span></span>
git push --set-upstream origin feature/msp-10
git checkout dev
git merge feature/msp-10
git push origin dev</pre></div>
<h2 dir="auto"><a id="user-content-msp-11---prepare-jenkins-server-for-cicd-pipeline" class="anchor" aria-hidden="true" href="#msp-11---prepare-jenkins-server-for-cicd-pipeline"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>MSP 11 - Prepare Jenkins Server for CI/CD Pipeline</h2>
<ul dir="auto">
<li>Create <code>feature/msp-11</code> branch from <code>dev</code>.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="git checkout dev
git branch feature/msp-11
git checkout feature/msp-11"><pre>git checkout dev
git branch feature/msp-11
git checkout feature/msp-11</pre></div>
<ul dir="auto">
<li>Set up a Jenkins Server and enable it with <code>Git</code>,  <code>Docker</code>,  <code>Docker Compose</code>,  <code>AWS CLI v2</code>, <code>Python</code>,  <code>Ansible</code> and <code>Boto3</code>.  To do so, prepare a <a href="/adursunoglu16/petclinic-microservice-private/blob/main/503-microservices-ci-cd-pipeline-with-helm/msp-11-jenkins-server-cfn-template.yml">Cloudformation template for Jenkins Server</a> with following script and save it as <code>jenkins-server-cfn-template.yml</code> under <code>infrastructure</code> folder.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="#! /bin/bash
# update os
yum update -y
# set server hostname as jenkins-server
hostnamectl set-hostname jenkins-server
# install git
yum install git -y
# install java 11
yum install java-11-amazon-corretto -y
# install jenkins
wget -O /etc/yum.repos.d/jenkins.repo https://pkg.jenkins.io/redhat/jenkins.repo
rpm --import https://pkg.jenkins.io/redhat/jenkins.io.key
yum install jenkins -y
systemctl start jenkins
systemctl enable jenkins
# install docker
amazon-linux-extras install docker -y
systemctl start docker
systemctl enable docker
usermod -a -G docker ec2-user
usermod -a -G docker jenkins
# configure docker as cloud agent for jenkins
cp /lib/systemd/system/docker.service /lib/systemd/system/docker.service.bak
sed -i 's/^ExecStart=.*/ExecStart=\/usr\/bin\/dockerd -H tcp:\/\/127.0.0.1:2375 -H unix:\/\/\/var\/run\/docker.sock/g' /lib/systemd/system/docker.service
systemctl daemon-reload
systemctl restart docker
systemctl restart jenkins
# install docker compose
curl -L &quot;https://github.com/docker/compose/releases/download/1.26.2/docker-compose-$(uname -s)-$(uname -m)&quot; \
-o /usr/local/bin/docker-compose
chmod +x /usr/local/bin/docker-compose
# uninstall aws cli version 1
rm -rf /bin/aws
# install aws cli version 2
curl &quot;https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip&quot; -o &quot;awscliv2.zip&quot;
unzip awscliv2.zip
./aws/install
# install python 3
yum install python3 -y
# install ansible
pip3 install ansible
# install boto3
pip3 install boto3"><pre><span class="pl-c"><span class="pl-c">#!</span> /bin/bash</span>
<span class="pl-c"><span class="pl-c">#</span> update os</span>
yum update -y
<span class="pl-c"><span class="pl-c">#</span> set server hostname as jenkins-server</span>
hostnamectl set-hostname jenkins-server
<span class="pl-c"><span class="pl-c">#</span> install git</span>
yum install git -y
<span class="pl-c"><span class="pl-c">#</span> install java 11</span>
yum install java-11-amazon-corretto -y
<span class="pl-c"><span class="pl-c">#</span> install jenkins</span>
wget -O /etc/yum.repos.d/jenkins.repo https://pkg.jenkins.io/redhat/jenkins.repo
rpm --import https://pkg.jenkins.io/redhat/jenkins.io.key
yum install jenkins -y
systemctl start jenkins
systemctl <span class="pl-c1">enable</span> jenkins
<span class="pl-c"><span class="pl-c">#</span> install docker</span>
amazon-linux-extras install docker -y
systemctl start docker
systemctl <span class="pl-c1">enable</span> docker
usermod -a -G docker ec2-user
usermod -a -G docker jenkins
<span class="pl-c"><span class="pl-c">#</span> configure docker as cloud agent for jenkins</span>
cp /lib/systemd/system/docker.service /lib/systemd/system/docker.service.bak
sed -i <span class="pl-s"><span class="pl-pds">'</span>s/^ExecStart=.*/ExecStart=\/usr\/bin\/dockerd -H tcp:\/\/127.0.0.1:2375 -H unix:\/\/\/var\/run\/docker.sock/g<span class="pl-pds">'</span></span> /lib/systemd/system/docker.service
systemctl daemon-reload
systemctl restart docker
systemctl restart jenkins
<span class="pl-c"><span class="pl-c">#</span> install docker compose</span>
curl -L <span class="pl-s"><span class="pl-pds">"</span>https://github.com/docker/compose/releases/download/1.26.2/docker-compose-<span class="pl-s"><span class="pl-pds">$(</span>uname -s<span class="pl-pds">)</span></span>-<span class="pl-s"><span class="pl-pds">$(</span>uname -m<span class="pl-pds">)</span></span><span class="pl-pds">"</span></span> \
-o /usr/local/bin/docker-compose
chmod +x /usr/local/bin/docker-compose
<span class="pl-c"><span class="pl-c">#</span> uninstall aws cli version 1</span>
rm -rf /bin/aws
<span class="pl-c"><span class="pl-c">#</span> install aws cli version 2</span>
curl <span class="pl-s"><span class="pl-pds">"</span>https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip<span class="pl-pds">"</span></span> -o <span class="pl-s"><span class="pl-pds">"</span>awscliv2.zip<span class="pl-pds">"</span></span>
unzip awscliv2.zip
./aws/install
<span class="pl-c"><span class="pl-c">#</span> install python 3</span>
yum install python3 -y
<span class="pl-c"><span class="pl-c">#</span> install ansible</span>
pip3 install ansible
<span class="pl-c"><span class="pl-c">#</span> install boto3</span>
pip3 install boto3</pre></div>
<ul dir="auto">
<li>
<p dir="auto">Grant permissions to Jenkins Server within Cloudformation template to create Cloudformation Stack and create ECR Registry, push or pull Docker images to ECR Repo.</p>
</li>
<li>
<p dir="auto">Commit the change, then push the cloudformation file to the remote repo.</p>
</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="git add .
git commit -m 'added jenkins server cfn template'
git push --set-upstream origin feature/msp-11
git checkout dev
git merge feature/msp-11
git push origin dev"><pre>git add <span class="pl-c1">.</span>
git commit -m <span class="pl-s"><span class="pl-pds">'</span>added jenkins server cfn template<span class="pl-pds">'</span></span>
git push --set-upstream origin feature/msp-11
git checkout dev
git merge feature/msp-11
git push origin dev</pre></div>
<h2 dir="auto"><a id="user-content-msp-12---configure-jenkins-server-for-project" class="anchor" aria-hidden="true" href="#msp-12---configure-jenkins-server-for-project"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>MSP 12 - Configure Jenkins Server for Project</h2>
<ul dir="auto">
<li>Get the initial administrative password.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="sudo cat /var/lib/jenkins/secrets/initialAdminPassword"><pre>sudo cat /var/lib/jenkins/secrets/initialAdminPassword</pre></div>
<ul dir="auto">
<li>
<p dir="auto">Enter the temporary password to unlock the Jenkins.</p>
</li>
<li>
<p dir="auto">Install suggested plugins.</p>
</li>
<li>
<p dir="auto">Create first admin user.</p>
</li>
<li>
<p dir="auto">Open your Jenkins dashboard and navigate to <code>Manage Jenkins</code> &gt;&gt; <code>Manage Plugins</code> &gt;&gt; <code>Available</code> tab</p>
</li>
<li>
<p dir="auto">Search and select <code>GitHub Integration</code>,  <code>Docker Plugin</code>,  <code>Docker Pipeline</code>, and <code>Jacoco</code> plugins, then click <code>Install without restart</code>. Note: No need to install the other <code>Git plugin</code> which is already installed can be seen under <code>Installed</code> tab.</p>
</li>
<li>
<p dir="auto">Configure Docker as <code>cloud agent</code> by navigating to <code>Manage Jenkins</code> &gt;&gt; <code>Manage Nodes and Clouds</code> &gt;&gt; <code>Configure Clouds</code> and using <code>tcp://localhost:2375</code> as Docker Host URI.</p>
</li>
</ul>
<h2 dir="auto"><a id="user-content-msp-13---prepare-continuous-integration-ci-pipeline" class="anchor" aria-hidden="true" href="#msp-13---prepare-continuous-integration-ci-pipeline"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>MSP 13 - Prepare Continuous Integration (CI) Pipeline</h2>
<ul dir="auto">
<li>Create <code>feature/msp-13</code> branch from <code>dev</code>.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="git checkout dev
git branch feature/msp-13
git checkout feature/msp-13"><pre>git checkout dev
git branch feature/msp-13
git checkout feature/msp-13</pre></div>
<ul dir="auto">
<li>Create a folder, named <code>jenkins</code>, to keep <code>Jenkinsfiles</code> and <code>Jenkins jobs</code> of the project.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="mkdir jenkins"><pre>mkdir jenkins</pre></div>
<ul dir="auto">
<li>
<p dir="auto">Create a Jenkins job with the name of <code>petclinic-ci-job</code>:</p>
<ul dir="auto">
<li>Select <code>Freestyle project</code> and click <code>OK</code></li>
<li>Select github project and write the url to your repository's page into <code>Project url</code> (<a href="https://github.com/%5Byour-github-account%5D/petclinic-microservices">https://github.com/[your-github-account]/petclinic-microservices</a>)</li>
<li>Under the <code>Source Code Management</code> select <code>Git</code></li>
<li>Write the url of your repository into the <code>Repository URL</code> (<a href="https://github.com/%5Byour-github-account%5D/petclinic-microservices.git">https://github.com/[your-github-account]/petclinic-microservices.git</a>)</li>
<li>Add <code>*/dev</code>, <code>*/feature**</code> and <code>*/bugfix**</code> branches to <code>Branches to build</code></li>
<li>Select <code>GitHub hook trigger for GITScm polling</code> under  <code>Build triggers</code></li>
<li>Select <code>Add timestamps to the Console Output</code> under <code>Build Environment</code></li>
<li>Click <code>Add build step</code> under <code>Build</code> and select <code>Execute Shell</code></li>
<li>Write below script into the <code>Command</code>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="echo 'Running Unit Tests on Petclinic Application'
docker run --rm -v $HOME/.m2:/root/.m2 -v `pwd`:/app -w /app maven:3.8-openjdk-11 mvn clean test"><pre><span class="pl-c1">echo</span> <span class="pl-s"><span class="pl-pds">'</span>Running Unit Tests on Petclinic Application<span class="pl-pds">'</span></span>
docker run --rm -v <span class="pl-smi">$HOME</span>/.m2:/root/.m2 -v <span class="pl-s"><span class="pl-pds">`</span>pwd<span class="pl-pds">`</span></span>:/app -w /app maven:3.8-openjdk-11 mvn clean <span class="pl-c1">test</span></pre></div>
</li>
<li>Click <code>Add post-build action</code> under <code>Post-build Actions</code> and select <code>Record jacoco coverage report</code></li>
<li>Click <code>Save</code></li>
</ul>
</li>
<li>
<p dir="auto">Jenkins <code>CI Job</code> should be triggered to run on each commit of <code>feature**</code> and <code>bugfix**</code> branches and on each <code>PR</code> merge to <code>dev</code> branch.</p>
</li>
<li>
<p dir="auto">Prepare a script for Jenkins CI job (covering Unit Test only) and save it as <code>jenkins-petclinic-ci-job.sh</code> under <code>jenkins</code> folder.</p>
</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="echo 'Running Unit Tests on Petclinic Application'
docker run --rm -v $HOME/.m2:/root/.m2 -v `pwd`:/app -w /app maven:3.8-openjdk-11 mvn clean test"><pre><span class="pl-c1">echo</span> <span class="pl-s"><span class="pl-pds">'</span>Running Unit Tests on Petclinic Application<span class="pl-pds">'</span></span>
docker run --rm -v <span class="pl-smi">$HOME</span>/.m2:/root/.m2 -v <span class="pl-s"><span class="pl-pds">`</span>pwd<span class="pl-pds">`</span></span>:/app -w /app maven:3.8-openjdk-11 mvn clean <span class="pl-c1">test</span></pre></div>
<ul dir="auto">
<li>
<p dir="auto">Create a webhook for Jenkins CI Job;</p>
<ul dir="auto">
<li>
<p dir="auto">Go to the project repository page and click on <code>Settings</code>.</p>
</li>
<li>
<p dir="auto">Click on the <code>Webhooks</code> on the left hand menu, and then click on <code>Add webhook</code>.</p>
</li>
<li>
<p dir="auto">Copy the Jenkins URL, paste it into <code>Payload URL</code> field, add <code>/github-webhook/</code> at the end of URL, and click on <code>Add webhook</code>.</p>
</li>
</ul>
<div class="snippet-clipboard-content position-relative overflow-auto" data-snippet-clipboard-copy-content="http://[jenkins-server-hostname]:8080/github-webhook/"><pre lang="text"><code>http://[jenkins-server-hostname]:8080/github-webhook/
</code></pre></div>
</li>
<li>
<p dir="auto">Commit the change, then push the Jenkinsfile to the remote repo.</p>
</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="git add .
git commit -m 'added Jenkins Job for CI pipeline'
git push --set-upstream origin feature/msp-13
git checkout dev
git merge feature/msp-13
git push origin dev"><pre>git add <span class="pl-c1">.</span>
git commit -m <span class="pl-s"><span class="pl-pds">'</span>added Jenkins Job for CI pipeline<span class="pl-pds">'</span></span>
git push --set-upstream origin feature/msp-13
git checkout dev
git merge feature/msp-13
git push origin dev</pre></div>
<h2 dir="auto"><a id="user-content-msp-14---create-docker-registry-for-dev-manually" class="anchor" aria-hidden="true" href="#msp-14---create-docker-registry-for-dev-manually"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>MSP 14 - Create Docker Registry for Dev Manually</h2>
<ul dir="auto">
<li>Create a Jenkins Job and name it as <code>create-ecr-docker-registry-for-dev</code> to create Docker Registry for <code>dev</code> on AWS ECR manually.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="PATH=&quot;$PATH:/usr/local/bin&quot;
APP_REPO_NAME=&quot;clarusway-repo/petclinic-app-dev&quot;
AWS_REGION=&quot;us-east-1&quot;

aws ecr create-repository \
  --repository-name ${APP_REPO_NAME} \
  --image-scanning-configuration scanOnPush=false \
  --image-tag-mutability MUTABLE \
  --region ${AWS_REGION}"><pre>PATH=<span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">$PATH</span>:/usr/local/bin<span class="pl-pds">"</span></span>
APP_REPO_NAME=<span class="pl-s"><span class="pl-pds">"</span>clarusway-repo/petclinic-app-dev<span class="pl-pds">"</span></span>
AWS_REGION=<span class="pl-s"><span class="pl-pds">"</span>us-east-1<span class="pl-pds">"</span></span>

aws ecr create-repository \
  --repository-name <span class="pl-smi">${APP_REPO_NAME}</span> \
  --image-scanning-configuration scanOnPush=false \
  --image-tag-mutability MUTABLE \
  --region <span class="pl-smi">${AWS_REGION}</span></pre></div>
<h2 dir="auto"><a id="user-content-msp-15---prepare-script-for-development-docker-registry" class="anchor" aria-hidden="true" href="#msp-15---prepare-script-for-development-docker-registry"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>MSP 15 - Prepare Script for Development Docker Registry</h2>
<ul dir="auto">
<li>Create <code>feature/msp-15</code> branch from <code>dev</code>.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="git checkout dev
git branch feature/msp-15
git checkout feature/msp-15"><pre>git checkout dev
git branch feature/msp-15
git checkout feature/msp-15</pre></div>
<ul dir="auto">
<li>Prepare a script to create Docker Registry for <code>dev</code> on AWS ECR and save it as <code>create-ecr-docker-registry-for-dev.sh</code> under <code>infrastructure</code> folder.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="PATH=&quot;$PATH:/usr/local/bin&quot;
APP_REPO_NAME=&quot;clarusway-repo/petclinic-app-dev&quot;
AWS_REGION=&quot;us-east-1&quot;

aws ecr create-repository \
  --repository-name ${APP_REPO_NAME} \
  --image-scanning-configuration scanOnPush=false \
  --image-tag-mutability MUTABLE \
  --region ${AWS_REGION}"><pre>PATH=<span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">$PATH</span>:/usr/local/bin<span class="pl-pds">"</span></span>
APP_REPO_NAME=<span class="pl-s"><span class="pl-pds">"</span>clarusway-repo/petclinic-app-dev<span class="pl-pds">"</span></span>
AWS_REGION=<span class="pl-s"><span class="pl-pds">"</span>us-east-1<span class="pl-pds">"</span></span>

aws ecr create-repository \
  --repository-name <span class="pl-smi">${APP_REPO_NAME}</span> \
  --image-scanning-configuration scanOnPush=false \
  --image-tag-mutability MUTABLE \
  --region <span class="pl-smi">${AWS_REGION}</span></pre></div>
<ul dir="auto">
<li>Commit the change, then push the script to the remote repo.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="git add .
git commit -m 'added script for creating ECR registry for dev'
git push --set-upstream origin feature/msp-15
git checkout dev
git merge feature/msp-15
git push origin dev"><pre>git add <span class="pl-c1">.</span>
git commit -m <span class="pl-s"><span class="pl-pds">'</span>added script for creating ECR registry for dev<span class="pl-pds">'</span></span>
git push --set-upstream origin feature/msp-15
git checkout dev
git merge feature/msp-15
git push origin dev</pre></div>
<h2 dir="auto"><a id="user-content-msp-16---create-a-qa-automation-environment-with-docker-swarm" class="anchor" aria-hidden="true" href="#msp-16---create-a-qa-automation-environment-with-docker-swarm"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>MSP 16 - Create a QA Automation Environment with Docker Swarm</h2>
<ul dir="auto">
<li>Create <code>feature/msp-16</code> branch from <code>dev</code>.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="git checkout dev
git branch feature/msp-16
git checkout feature/msp-16"><pre>git checkout dev
git branch feature/msp-16
git checkout feature/msp-16</pre></div>
<ul dir="auto">
<li>
<p dir="auto">Prepare a Cloudformation template for Docker Swarm Infrastructure consisting of 3 Managers, 2 Worker Instances and save it as <code>dev-docker-swarm-infrastructure-cfn-template.yml</code> under <code>infrastructure</code> folder.</p>
</li>
<li>
<p dir="auto">Grant permissions to Docker Machines within Cloudformation template to create ECR Registry, push or pull Docker images to/from ECR Repo.</p>
</li>
<li>
<p dir="auto">Commit the change, then push the cloudformation template to the remote repo.</p>
</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="git add .
git commit -m 'added cloudformation template for Docker Swarm infrastructure'
git push --set-upstream origin feature/msp-16"><pre>git add <span class="pl-c1">.</span>
git commit -m <span class="pl-s"><span class="pl-pds">'</span>added cloudformation template for Docker Swarm infrastructure<span class="pl-pds">'</span></span>
git push --set-upstream origin feature/msp-16</pre></div>
<ul dir="auto">
<li>Create a Jenkins Job and name it as <code>test-creating-qa-automation-infrastructure</code> to test <code>bash</code> scripts creating QA Automation Infrastructure for <code>dev</code> manually.
<ul dir="auto">
<li>Select <code>Freestyle project</code> and click <code>OK</code></li>
<li>Select github project and write the url to your repository's page into <code>Project url</code> (<a href="https://github.com/%5Byour-github-account%5D/petclinic-microservices">https://github.com/[your-github-account]/petclinic-microservices</a>)</li>
<li>Under the <code>Source Code Management</code> select <code>Git</code></li>
<li>Write the url of your repository into the <code>Repository URL</code> (<a href="https://github.com/%5Byour-github-account%5D/petclinic-microservices.git">https://github.com/[your-github-account]/petclinic-microservices.git</a>)</li>
<li>Add <code>*/feature/msp-16</code>branch to <code>Branches to build</code></li>
<li>Select <code>Add timestamps to the Console Output</code> under <code>Build Environment</code></li>
<li>Click <code>Add build step</code> under <code>Build</code> and select <code>Execute Shell</code></li>
<li>Write below script into the <code>Command</code> for checking the environment tools and versions with following script.</li>
</ul>
</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="echo $PATH
whoami
PATH=&quot;$PATH:/usr/local/bin&quot;
python3 --version
pip3 --version
ansible --version
aws --version"><pre><span class="pl-c1">echo</span> <span class="pl-smi">$PATH</span>
whoami
PATH=<span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">$PATH</span>:/usr/local/bin<span class="pl-pds">"</span></span>
python3 --version
pip3 --version
ansible --version
aws --version</pre></div>
<ul dir="auto">
<li>Click <code>Save</code></li>
</ul>
<ul dir="auto">
<li>After running the job above, replace the script with the one below in order to test creating key pair for <code>ansible</code>.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="PATH=&quot;$PATH:/usr/local/bin&quot;
CFN_KEYPAIR=&quot;call-ansible-test-dev.key&quot;
AWS_REGION=&quot;us-east-1&quot;
aws ec2 create-key-pair --region ${AWS_REGION} --key-name ${CFN_KEYPAIR} --query &quot;KeyMaterial&quot; --output text &gt; ${CFN_KEYPAIR}
chmod 400 ${CFN_KEYPAIR}"><pre>PATH=<span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">$PATH</span>:/usr/local/bin<span class="pl-pds">"</span></span>
CFN_KEYPAIR=<span class="pl-s"><span class="pl-pds">"</span>call-ansible-test-dev.key<span class="pl-pds">"</span></span>
AWS_REGION=<span class="pl-s"><span class="pl-pds">"</span>us-east-1<span class="pl-pds">"</span></span>
aws ec2 create-key-pair --region <span class="pl-smi">${AWS_REGION}</span> --key-name <span class="pl-smi">${CFN_KEYPAIR}</span> --query <span class="pl-s"><span class="pl-pds">"</span>KeyMaterial<span class="pl-pds">"</span></span> --output text <span class="pl-k">&gt;</span> <span class="pl-smi">${CFN_KEYPAIR}</span>
chmod 400 <span class="pl-smi">${CFN_KEYPAIR}</span></pre></div>
<ul dir="auto">
<li>After running the job above, replace the script with the one below in order to test creating Docker Swarm infrastructure with AWS Cloudformation.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="PATH=&quot;$PATH:/usr/local/bin&quot;
APP_NAME=&quot;Petclinic&quot;
APP_STACK_NAME=&quot;Call-$APP_NAME-App-${BUILD_NUMBER}&quot;
CFN_KEYPAIR=&quot;call-ansible-test-dev.key&quot;
CFN_TEMPLATE=&quot;./infrastructure/dev-docker-swarm-infrastructure-cfn-template.yml&quot;
AWS_REGION=&quot;us-east-1&quot;
aws cloudformation create-stack --region ${AWS_REGION} --stack-name ${APP_STACK_NAME} --capabilities CAPABILITY_IAM --template-body file://${CFN_TEMPLATE} --parameters ParameterKey=KeyPairName,ParameterValue=${CFN_KEYPAIR}"><pre>PATH=<span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">$PATH</span>:/usr/local/bin<span class="pl-pds">"</span></span>
APP_NAME=<span class="pl-s"><span class="pl-pds">"</span>Petclinic<span class="pl-pds">"</span></span>
APP_STACK_NAME=<span class="pl-s"><span class="pl-pds">"</span>Call-<span class="pl-smi">$APP_NAME</span>-App-<span class="pl-smi">${BUILD_NUMBER}</span><span class="pl-pds">"</span></span>
CFN_KEYPAIR=<span class="pl-s"><span class="pl-pds">"</span>call-ansible-test-dev.key<span class="pl-pds">"</span></span>
CFN_TEMPLATE=<span class="pl-s"><span class="pl-pds">"</span>./infrastructure/dev-docker-swarm-infrastructure-cfn-template.yml<span class="pl-pds">"</span></span>
AWS_REGION=<span class="pl-s"><span class="pl-pds">"</span>us-east-1<span class="pl-pds">"</span></span>
aws cloudformation create-stack --region <span class="pl-smi">${AWS_REGION}</span> --stack-name <span class="pl-smi">${APP_STACK_NAME}</span> --capabilities CAPABILITY_IAM --template-body file://<span class="pl-smi">${CFN_TEMPLATE}</span> --parameters ParameterKey=KeyPairName,ParameterValue=<span class="pl-smi">${CFN_KEYPAIR}</span></pre></div>
<ul dir="auto">
<li>After running the job above, replace the script with the one below in order to test SSH connection with one of the docker instance.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="CFN_KEYPAIR=&quot;call-ansible-test-dev.key&quot;
ssh -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no -i ${WORKSPACE}/${CFN_KEYPAIR} ec2-user@172.31.91.243 hostname"><pre>CFN_KEYPAIR=<span class="pl-s"><span class="pl-pds">"</span>call-ansible-test-dev.key<span class="pl-pds">"</span></span>
ssh -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no -i <span class="pl-smi">${WORKSPACE}</span>/<span class="pl-smi">${CFN_KEYPAIR}</span> ec2-user@172.31.91.243 hostname</pre></div>
<ul dir="auto">
<li>Prepare static inventory file with name of <code>hosts.ini</code> for Ansible under <code>ansible/inventory</code> folder using Docker machines private IP addresses.</li>
</ul>
<div class="highlight highlight-source-ini position-relative overflow-auto" data-snippet-clipboard-copy-content="172.31.91.243   ansible_user=ec2-user  
172.31.87.143   ansible_user=ec2-user
172.31.90.30    ansible_user=ec2-user
172.31.92.190   ansible_user=ec2-user
172.31.88.8     ansible_user=ec2-user"><pre>172.31.91.243   <span class="pl-k">ansible_user</span>=ec2-user  
172.31.87.143   <span class="pl-k">ansible_user</span>=ec2-user
172.31.90.30    <span class="pl-k">ansible_user</span>=ec2-user
172.31.92.190   <span class="pl-k">ansible_user</span>=ec2-user
172.31.88.8     <span class="pl-k">ansible_user</span>=ec2-user</pre></div>
<ul dir="auto">
<li>Commit the change, then push the cloudformation template to the remote repo.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="git add .
git commit -m 'added ansible static inventory host.ini for testing'
git push"><pre>git add <span class="pl-c1">.</span>
git commit -m <span class="pl-s"><span class="pl-pds">'</span>added ansible static inventory host.ini for testing<span class="pl-pds">'</span></span>
git push</pre></div>
<ul dir="auto">
<li>Configure <code>test-creating-qa-automation-infrastructure</code> job and replace the existing script with the one below in order to test ansible by pinging static hosts.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="PATH=&quot;$PATH:/usr/local/bin&quot;
CFN_KEYPAIR=&quot;call-ansible-test-dev.key&quot;
export ANSIBLE_INVENTORY=&quot;${WORKSPACE}/ansible/inventory/hosts.ini&quot;
export ANSIBLE_PRIVATE_KEY_FILE=&quot;${WORKSPACE}/${CFN_KEYPAIR}&quot;
export ANSIBLE_HOST_KEY_CHECKING=False
ansible all -m ping"><pre>PATH=<span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">$PATH</span>:/usr/local/bin<span class="pl-pds">"</span></span>
CFN_KEYPAIR=<span class="pl-s"><span class="pl-pds">"</span>call-ansible-test-dev.key<span class="pl-pds">"</span></span>
<span class="pl-k">export</span> ANSIBLE_INVENTORY=<span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${WORKSPACE}</span>/ansible/inventory/hosts.ini<span class="pl-pds">"</span></span>
<span class="pl-k">export</span> ANSIBLE_PRIVATE_KEY_FILE=<span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${WORKSPACE}</span>/<span class="pl-smi">${CFN_KEYPAIR}</span><span class="pl-pds">"</span></span>
<span class="pl-k">export</span> ANSIBLE_HOST_KEY_CHECKING=False
ansible all -m ping</pre></div>
<ul dir="auto">
<li>Prepare dynamic inventory file with name of <code>dev_stack_dynamic_inventory_aws_ec2.yaml</code> for Ansible under <code>ansible/inventory</code> folder using Docker machines private IP addresses.</li>
</ul>
<div class="highlight highlight-source-yaml position-relative overflow-auto" data-snippet-clipboard-copy-content="plugin: aws_ec2
regions:
  - &quot;us-east-1&quot;
filters:
  tag:app-stack-name: APP_STACK_NAME
  tag:environment: dev
keyed_groups:
  - key: tags['app-stack-name']
    prefix: 'app_stack_'
    separator: ''
  - key: tags['swarm-role']
    prefix: 'role_'
    separator: ''
  - key: tags['environment']
    prefix: 'env_'
    separator: ''
  - key: tags['server']
    separator: ''
hostnames:
  - &quot;private-ip-address&quot;
compose:
  ansible_user: &quot;'ec2-user'&quot;"><pre><span class="pl-ent">plugin</span>: <span class="pl-s">aws_ec2</span>
<span class="pl-ent">regions</span>:
  - <span class="pl-s"><span class="pl-pds">"</span>us-east-1<span class="pl-pds">"</span></span>
<span class="pl-ent">filters</span>:
  <span class="pl-ent">tag:app-stack-name</span>: <span class="pl-s">APP_STACK_NAME</span>
  <span class="pl-ent">tag:environment</span>: <span class="pl-s">dev</span>
<span class="pl-ent">keyed_groups</span>:
  - <span class="pl-ent">key</span>: <span class="pl-s">tags['app-stack-name']</span>
    <span class="pl-ent">prefix</span>: <span class="pl-s"><span class="pl-pds">'</span>app_stack_<span class="pl-pds">'</span></span>
    <span class="pl-ent">separator</span>: <span class="pl-s"><span class="pl-pds">'</span><span class="pl-pds">'</span></span>
  - <span class="pl-ent">key</span>: <span class="pl-s">tags['swarm-role']</span>
    <span class="pl-ent">prefix</span>: <span class="pl-s"><span class="pl-pds">'</span>role_<span class="pl-pds">'</span></span>
    <span class="pl-ent">separator</span>: <span class="pl-s"><span class="pl-pds">'</span><span class="pl-pds">'</span></span>
  - <span class="pl-ent">key</span>: <span class="pl-s">tags['environment']</span>
    <span class="pl-ent">prefix</span>: <span class="pl-s"><span class="pl-pds">'</span>env_<span class="pl-pds">'</span></span>
    <span class="pl-ent">separator</span>: <span class="pl-s"><span class="pl-pds">'</span><span class="pl-pds">'</span></span>
  - <span class="pl-ent">key</span>: <span class="pl-s">tags['server']</span>
    <span class="pl-ent">separator</span>: <span class="pl-s"><span class="pl-pds">'</span><span class="pl-pds">'</span></span>
<span class="pl-ent">hostnames</span>:
  - <span class="pl-s"><span class="pl-pds">"</span>private-ip-address<span class="pl-pds">"</span></span>
<span class="pl-ent">compose</span>:
  <span class="pl-ent">ansible_user</span>: <span class="pl-s"><span class="pl-pds">"</span>'ec2-user'<span class="pl-pds">"</span></span></pre></div>
<ul dir="auto">
<li>Prepare dynamic inventory file with name of <code>dev_stack_swarm_grand_master_aws_ec2.yaml</code> for Ansible under <code>ansible/inventory</code> folder using Docker machines private IP addresses.</li>
</ul>
<div class="highlight highlight-source-yaml position-relative overflow-auto" data-snippet-clipboard-copy-content="plugin: aws_ec2
regions:
  - &quot;us-east-1&quot;
filters:
  tag:app-stack-name: APP_STACK_NAME
  tag:environment: dev
  tag:swarm-role: grand-master
hostnames:
  - &quot;private-ip-address&quot;
compose:
  ansible_user: &quot;'ec2-user'&quot;"><pre><span class="pl-ent">plugin</span>: <span class="pl-s">aws_ec2</span>
<span class="pl-ent">regions</span>:
  - <span class="pl-s"><span class="pl-pds">"</span>us-east-1<span class="pl-pds">"</span></span>
<span class="pl-ent">filters</span>:
  <span class="pl-ent">tag:app-stack-name</span>: <span class="pl-s">APP_STACK_NAME</span>
  <span class="pl-ent">tag:environment</span>: <span class="pl-s">dev</span>
  <span class="pl-ent">tag:swarm-role</span>: <span class="pl-s">grand-master</span>
<span class="pl-ent">hostnames</span>:
  - <span class="pl-s"><span class="pl-pds">"</span>private-ip-address<span class="pl-pds">"</span></span>
<span class="pl-ent">compose</span>:
  <span class="pl-ent">ansible_user</span>: <span class="pl-s"><span class="pl-pds">"</span>'ec2-user'<span class="pl-pds">"</span></span></pre></div>
<ul dir="auto">
<li>Prepare dynamic inventory file with name of <code>dev_stack_swarm_managers_aws_ec2.yaml</code> for Ansible under <code>ansible/inventory</code> folder using Docker machines private IP addresses.</li>
</ul>
<div class="highlight highlight-source-yaml position-relative overflow-auto" data-snippet-clipboard-copy-content="plugin: aws_ec2
regions:
  - &quot;us-east-1&quot;
filters:
  tag:app-stack-name: APP_STACK_NAME
  tag:environment: dev
  tag:swarm-role: manager
hostnames:
  - &quot;private-ip-address&quot;
compose:
  ansible_user: &quot;'ec2-user'&quot;"><pre><span class="pl-ent">plugin</span>: <span class="pl-s">aws_ec2</span>
<span class="pl-ent">regions</span>:
  - <span class="pl-s"><span class="pl-pds">"</span>us-east-1<span class="pl-pds">"</span></span>
<span class="pl-ent">filters</span>:
  <span class="pl-ent">tag:app-stack-name</span>: <span class="pl-s">APP_STACK_NAME</span>
  <span class="pl-ent">tag:environment</span>: <span class="pl-s">dev</span>
  <span class="pl-ent">tag:swarm-role</span>: <span class="pl-s">manager</span>
<span class="pl-ent">hostnames</span>:
  - <span class="pl-s"><span class="pl-pds">"</span>private-ip-address<span class="pl-pds">"</span></span>
<span class="pl-ent">compose</span>:
  <span class="pl-ent">ansible_user</span>: <span class="pl-s"><span class="pl-pds">"</span>'ec2-user'<span class="pl-pds">"</span></span></pre></div>
<ul dir="auto">
<li>Prepare dynamic inventory file with name of <code>dev_stack_swarm_workers_aws_ec2.yaml</code> for Ansible under <code>ansible/inventory</code> folder using Docker machines private IP addresses.</li>
</ul>
<div class="highlight highlight-source-yaml position-relative overflow-auto" data-snippet-clipboard-copy-content="plugin: aws_ec2
regions:
  - &quot;us-east-1&quot;
filters:
  tag:app-stack-name: APP_STACK_NAME
  tag:environment: dev
  tag:swarm-role: worker
hostnames:
  - &quot;private-ip-address&quot;
compose:
  ansible_user: &quot;'ec2-user'&quot;"><pre><span class="pl-ent">plugin</span>: <span class="pl-s">aws_ec2</span>
<span class="pl-ent">regions</span>:
  - <span class="pl-s"><span class="pl-pds">"</span>us-east-1<span class="pl-pds">"</span></span>
<span class="pl-ent">filters</span>:
  <span class="pl-ent">tag:app-stack-name</span>: <span class="pl-s">APP_STACK_NAME</span>
  <span class="pl-ent">tag:environment</span>: <span class="pl-s">dev</span>
  <span class="pl-ent">tag:swarm-role</span>: <span class="pl-s">worker</span>
<span class="pl-ent">hostnames</span>:
  - <span class="pl-s"><span class="pl-pds">"</span>private-ip-address<span class="pl-pds">"</span></span>
<span class="pl-ent">compose</span>:
  <span class="pl-ent">ansible_user</span>: <span class="pl-s"><span class="pl-pds">"</span>'ec2-user'<span class="pl-pds">"</span></span></pre></div>
<ul dir="auto">
<li>Commit the change, then push the cloudformation template to the remote repo.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="git add .
git commit -m 'added ansible dynamic inventory files for dev environment'
git push"><pre>git add <span class="pl-c1">.</span>
git commit -m <span class="pl-s"><span class="pl-pds">'</span>added ansible dynamic inventory files for dev environment<span class="pl-pds">'</span></span>
git push</pre></div>
<ul dir="auto">
<li>Configure <code>test-creating-qa-automation-infrastructure</code> job and replace the existing script with the one below in order to check the Ansible dynamic inventory for <code>dev</code> environment.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="APP_NAME=&quot;Petclinic&quot;
CFN_KEYPAIR=&quot;call-ansible-test-dev.key&quot;
PATH=&quot;$PATH:/usr/local/bin&quot;
export ANSIBLE_PRIVATE_KEY_FILE=&quot;${WORKSPACE}/${CFN_KEYPAIR}&quot;
export ANSIBLE_HOST_KEY_CHECKING=False
export APP_STACK_NAME=&quot;Call-$APP_NAME-App-${BUILD_NUMBER}&quot;
# Dev Stack
sed -i &quot;s/APP_STACK_NAME/$APP_STACK_NAME/&quot; ./ansible/inventory/dev_stack_dynamic_inventory_aws_ec2.yaml
cat ./ansible/inventory/dev_stack_dynamic_inventory_aws_ec2.yaml
ansible-inventory -v -i ./ansible/inventory/dev_stack_dynamic_inventory_aws_ec2.yaml --graph
# Dev Stack Grand Master
sed -i &quot;s/APP_STACK_NAME/$APP_STACK_NAME/&quot; ./ansible/inventory/dev_stack_swarm_grand_master_aws_ec2.yaml
cat ./ansible/inventory/dev_stack_swarm_grand_master_aws_ec2.yaml
ansible-inventory -v -i ./ansible/inventory/dev_stack_swarm_grand_master_aws_ec2.yaml --graph
# Dev Stack Managers
sed -i &quot;s/APP_STACK_NAME/$APP_STACK_NAME/&quot; ./ansible/inventory/dev_stack_swarm_managers_aws_ec2.yaml
cat ./ansible/inventory/dev_stack_swarm_managers_aws_ec2.yaml
ansible-inventory -v -i ./ansible/inventory/dev_stack_swarm_managers_aws_ec2.yaml --graph
# Dev Stack Workers
sed -i &quot;s/APP_STACK_NAME/$APP_STACK_NAME/&quot; ./ansible/inventory/dev_stack_swarm_workers_aws_ec2.yaml
cat ./ansible/inventory/dev_stack_swarm_workers_aws_ec2.yaml
ansible-inventory -v -i ./ansible/inventory/dev_stack_swarm_workers_aws_ec2.yaml --graph"><pre>APP_NAME=<span class="pl-s"><span class="pl-pds">"</span>Petclinic<span class="pl-pds">"</span></span>
CFN_KEYPAIR=<span class="pl-s"><span class="pl-pds">"</span>call-ansible-test-dev.key<span class="pl-pds">"</span></span>
PATH=<span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">$PATH</span>:/usr/local/bin<span class="pl-pds">"</span></span>
<span class="pl-k">export</span> ANSIBLE_PRIVATE_KEY_FILE=<span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${WORKSPACE}</span>/<span class="pl-smi">${CFN_KEYPAIR}</span><span class="pl-pds">"</span></span>
<span class="pl-k">export</span> ANSIBLE_HOST_KEY_CHECKING=False
<span class="pl-k">export</span> APP_STACK_NAME=<span class="pl-s"><span class="pl-pds">"</span>Call-<span class="pl-smi">$APP_NAME</span>-App-<span class="pl-smi">${BUILD_NUMBER}</span><span class="pl-pds">"</span></span>
<span class="pl-c"><span class="pl-c">#</span> Dev Stack</span>
sed -i <span class="pl-s"><span class="pl-pds">"</span>s/APP_STACK_NAME/<span class="pl-smi">$APP_STACK_NAME</span>/<span class="pl-pds">"</span></span> ./ansible/inventory/dev_stack_dynamic_inventory_aws_ec2.yaml
cat ./ansible/inventory/dev_stack_dynamic_inventory_aws_ec2.yaml
ansible-inventory -v -i ./ansible/inventory/dev_stack_dynamic_inventory_aws_ec2.yaml --graph
<span class="pl-c"><span class="pl-c">#</span> Dev Stack Grand Master</span>
sed -i <span class="pl-s"><span class="pl-pds">"</span>s/APP_STACK_NAME/<span class="pl-smi">$APP_STACK_NAME</span>/<span class="pl-pds">"</span></span> ./ansible/inventory/dev_stack_swarm_grand_master_aws_ec2.yaml
cat ./ansible/inventory/dev_stack_swarm_grand_master_aws_ec2.yaml
ansible-inventory -v -i ./ansible/inventory/dev_stack_swarm_grand_master_aws_ec2.yaml --graph
<span class="pl-c"><span class="pl-c">#</span> Dev Stack Managers</span>
sed -i <span class="pl-s"><span class="pl-pds">"</span>s/APP_STACK_NAME/<span class="pl-smi">$APP_STACK_NAME</span>/<span class="pl-pds">"</span></span> ./ansible/inventory/dev_stack_swarm_managers_aws_ec2.yaml
cat ./ansible/inventory/dev_stack_swarm_managers_aws_ec2.yaml
ansible-inventory -v -i ./ansible/inventory/dev_stack_swarm_managers_aws_ec2.yaml --graph
<span class="pl-c"><span class="pl-c">#</span> Dev Stack Workers</span>
sed -i <span class="pl-s"><span class="pl-pds">"</span>s/APP_STACK_NAME/<span class="pl-smi">$APP_STACK_NAME</span>/<span class="pl-pds">"</span></span> ./ansible/inventory/dev_stack_swarm_workers_aws_ec2.yaml
cat ./ansible/inventory/dev_stack_swarm_workers_aws_ec2.yaml
ansible-inventory -v -i ./ansible/inventory/dev_stack_swarm_workers_aws_ec2.yaml --graph</pre></div>
<ul dir="auto">
<li>After running the job above, replace the script with the one below in order to test all instances within dev dynamic inventory by pinging static hosts.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="# Test dev dynamic inventory by pinging
APP_NAME=&quot;Petclinic&quot;
CFN_KEYPAIR=&quot;call-ansible-test-dev.key&quot;
PATH=&quot;$PATH:/usr/local/bin&quot;
export ANSIBLE_PRIVATE_KEY_FILE=&quot;${WORKSPACE}/${CFN_KEYPAIR}&quot;
export ANSIBLE_HOST_KEY_CHECKING=False
export APP_STACK_NAME=&quot;Call-$APP_NAME-App-${BUILD_NUMBER}&quot;
sed -i &quot;s/APP_STACK_NAME/$APP_STACK_NAME/&quot; ./ansible/inventory/dev_stack_dynamic_inventory_aws_ec2.yaml
ansible -i ./ansible/inventory/dev_stack_dynamic_inventory_aws_ec2.yaml all -m ping"><pre><span class="pl-c"><span class="pl-c">#</span> Test dev dynamic inventory by pinging</span>
APP_NAME=<span class="pl-s"><span class="pl-pds">"</span>Petclinic<span class="pl-pds">"</span></span>
CFN_KEYPAIR=<span class="pl-s"><span class="pl-pds">"</span>call-ansible-test-dev.key<span class="pl-pds">"</span></span>
PATH=<span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">$PATH</span>:/usr/local/bin<span class="pl-pds">"</span></span>
<span class="pl-k">export</span> ANSIBLE_PRIVATE_KEY_FILE=<span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${WORKSPACE}</span>/<span class="pl-smi">${CFN_KEYPAIR}</span><span class="pl-pds">"</span></span>
<span class="pl-k">export</span> ANSIBLE_HOST_KEY_CHECKING=False
<span class="pl-k">export</span> APP_STACK_NAME=<span class="pl-s"><span class="pl-pds">"</span>Call-<span class="pl-smi">$APP_NAME</span>-App-<span class="pl-smi">${BUILD_NUMBER}</span><span class="pl-pds">"</span></span>
sed -i <span class="pl-s"><span class="pl-pds">"</span>s/APP_STACK_NAME/<span class="pl-smi">$APP_STACK_NAME</span>/<span class="pl-pds">"</span></span> ./ansible/inventory/dev_stack_dynamic_inventory_aws_ec2.yaml
ansible -i ./ansible/inventory/dev_stack_dynamic_inventory_aws_ec2.yaml all -m ping</pre></div>
<ul dir="auto">
<li>Create an ansible playbook to install and configure tools (<code>Docker</code>, <code>Docker-Compose</code>, <code>AWS CLI V2</code>) needed for all Docker Swarm nodes (instances) and save it as <code>pb_setup_for_all_docker_swarm_instances.yaml</code> under <code>ansible/playbooks</code> folder.</li>
</ul>
<div class="highlight highlight-source-yaml position-relative overflow-auto" data-snippet-clipboard-copy-content="- hosts: all
  tasks:
  - name: update os
    yum:
      name: '*'
      state: present
  - name: install docker
    command: amazon-linux-extras install docker=latest -y
  - name: start docker
    service:
      name: docker
      state: started
      enabled: yes
  - name: add ec2-user to docker group
    shell: &quot;usermod -a -G docker ec2-user&quot;
  - name: install docker compose.
    get_url:
      url: https://github.com/docker/compose/releases/download/1.26.2/docker-compose-Linux-x86_64
      dest: /usr/local/bin/docker-compose
      mode: 0755
  - name: uninstall aws cli v1
    file:
      path: /bin/aws
      state: absent
  - name: download awscliv2 installer
    unarchive:
      src: https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip
      dest: /tmp
      remote_src: yes
      creates: /tmp/aws
      mode: 0755
  - name: run the installer
    command:
    args:
      cmd: &quot;/tmp/aws/install&quot;
      creates: /usr/local/bin/aws"><pre>- <span class="pl-ent">hosts</span>: <span class="pl-s">all</span>
  <span class="pl-ent">tasks</span>:
  - <span class="pl-ent">name</span>: <span class="pl-s">update os</span>
    <span class="pl-ent">yum</span>:
      <span class="pl-ent">name</span>: <span class="pl-s"><span class="pl-pds">'</span>*<span class="pl-pds">'</span></span>
      <span class="pl-ent">state</span>: <span class="pl-s">present</span>
  - <span class="pl-ent">name</span>: <span class="pl-s">install docker</span>
    <span class="pl-ent">command</span>: <span class="pl-s">amazon-linux-extras install docker=latest -y</span>
  - <span class="pl-ent">name</span>: <span class="pl-s">start docker</span>
    <span class="pl-ent">service</span>:
      <span class="pl-ent">name</span>: <span class="pl-s">docker</span>
      <span class="pl-ent">state</span>: <span class="pl-s">started</span>
      <span class="pl-ent">enabled</span>: <span class="pl-s">yes</span>
  - <span class="pl-ent">name</span>: <span class="pl-s">add ec2-user to docker group</span>
    <span class="pl-ent">shell</span>: <span class="pl-s"><span class="pl-pds">"</span>usermod -a -G docker ec2-user<span class="pl-pds">"</span></span>
  - <span class="pl-ent">name</span>: <span class="pl-s">install docker compose.</span>
    <span class="pl-ent">get_url</span>:
      <span class="pl-ent">url</span>: <span class="pl-s">https://github.com/docker/compose/releases/download/1.26.2/docker-compose-Linux-x86_64</span>
      <span class="pl-ent">dest</span>: <span class="pl-s">/usr/local/bin/docker-compose</span>
      <span class="pl-ent">mode</span>: <span class="pl-c1">0755</span>
  - <span class="pl-ent">name</span>: <span class="pl-s">uninstall aws cli v1</span>
    <span class="pl-ent">file</span>:
      <span class="pl-ent">path</span>: <span class="pl-s">/bin/aws</span>
      <span class="pl-ent">state</span>: <span class="pl-s">absent</span>
  - <span class="pl-ent">name</span>: <span class="pl-s">download awscliv2 installer</span>
    <span class="pl-ent">unarchive</span>:
      <span class="pl-ent">src</span>: <span class="pl-s">https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip</span>
      <span class="pl-ent">dest</span>: <span class="pl-s">/tmp</span>
      <span class="pl-ent">remote_src</span>: <span class="pl-s">yes</span>
      <span class="pl-ent">creates</span>: <span class="pl-s">/tmp/aws</span>
      <span class="pl-ent">mode</span>: <span class="pl-c1">0755</span>
  - <span class="pl-ent">name</span>: <span class="pl-s">run the installer</span>
    <span class="pl-ent">command</span>:
    <span class="pl-ent">args</span>:
      <span class="pl-ent">cmd</span>: <span class="pl-s"><span class="pl-pds">"</span>/tmp/aws/install<span class="pl-pds">"</span></span>
      <span class="pl-ent">creates</span>: <span class="pl-s">/usr/local/bin/aws</span></pre></div>
<ul dir="auto">
<li>Create an ansible playbook to initialize the Docker Swarm and configure tools on <code>Grand Master</code> instance of Docker Swarm and save it as <code>pb_initialize_docker_swarm.yaml</code> under <code>ansible/playbooks</code> folder.</li>
</ul>
<div class="highlight highlight-source-yaml position-relative overflow-auto" data-snippet-clipboard-copy-content="- hosts: role_grand_master
  tasks:
  - name: initialize docker swarm
    shell: docker swarm init
  - name: install git
    yum:
      name: git
      state: present
  - name: run the visualizer app for docker swarm
    shell: |
      docker service create \
        --name=viz \
        --publish=8088:8080/tcp \
        --constraint=node.role==manager \
        --mount=type=bind,src=/var/run/docker.sock,dst=/var/run/docker.sock \
        dockersamples/visualizer"><pre>- <span class="pl-ent">hosts</span>: <span class="pl-s">role_grand_master</span>
  <span class="pl-ent">tasks</span>:
  - <span class="pl-ent">name</span>: <span class="pl-s">initialize docker swarm</span>
    <span class="pl-ent">shell</span>: <span class="pl-s">docker swarm init</span>
  - <span class="pl-ent">name</span>: <span class="pl-s">install git</span>
    <span class="pl-ent">yum</span>:
      <span class="pl-ent">name</span>: <span class="pl-s">git</span>
      <span class="pl-ent">state</span>: <span class="pl-s">present</span>
  - <span class="pl-ent">name</span>: <span class="pl-s">run the visualizer app for docker swarm</span>
    <span class="pl-ent">shell</span>: <span class="pl-s">|</span>
<span class="pl-s">      docker service create \</span>
<span class="pl-s">        --name=viz \</span>
<span class="pl-s">        --publish=8088:8080/tcp \</span>
<span class="pl-s">        --constraint=node.role==manager \</span>
<span class="pl-s">        --mount=type=bind,src=/var/run/docker.sock,dst=/var/run/docker.sock \</span>
<span class="pl-s">        dockersamples/visualizer</span></pre></div>
<ul dir="auto">
<li>Create an ansible playbook to join the Docker manager nodes to the Swarm and save it as <code>pb_join_docker_swarm_managers.yaml</code> under <code>ansible/playbooks</code> folder.</li>
</ul>
<div class="highlight highlight-source-yaml position-relative overflow-auto" data-snippet-clipboard-copy-content="- hosts: role_grand_master
  tasks:
  - name: Get swarm join-token for managers
    shell: docker swarm join-token manager | grep -i 'docker'
    register: join_command_for_managers

  - debug: msg='{{ join_command_for_managers.stdout.strip() }}'
  
  - name: register grand_master with variable
    add_host:
      name: &quot;grand_master&quot;
      manager_join: &quot;{{ join_command_for_managers.stdout.strip() }}&quot;

- hosts: role_manager
  tasks:
  - name: Join managers to swarm
    shell: &quot;{{ hostvars['grand_master']['manager_join'] }}&quot;
    register: result_of_joining

  - debug: msg='{{ result_of_joining.stdout }}'"><pre>- <span class="pl-ent">hosts</span>: <span class="pl-s">role_grand_master</span>
  <span class="pl-ent">tasks</span>:
  - <span class="pl-ent">name</span>: <span class="pl-s">Get swarm join-token for managers</span>
    <span class="pl-ent">shell</span>: <span class="pl-s">docker swarm join-token manager | grep -i 'docker'</span>
    <span class="pl-ent">register</span>: <span class="pl-s">join_command_for_managers</span>

  - <span class="pl-ent">debug</span>: <span class="pl-s">msg='{{ join_command_for_managers.stdout.strip() }}'</span>
  
  - <span class="pl-ent">name</span>: <span class="pl-s">register grand_master with variable</span>
    <span class="pl-ent">add_host</span>:
      <span class="pl-ent">name</span>: <span class="pl-s"><span class="pl-pds">"</span>grand_master<span class="pl-pds">"</span></span>
      <span class="pl-ent">manager_join</span>: <span class="pl-s"><span class="pl-pds">"</span>{{ join_command_for_managers.stdout.strip() }}<span class="pl-pds">"</span></span>

- <span class="pl-ent">hosts</span>: <span class="pl-s">role_manager</span>
  <span class="pl-ent">tasks</span>:
  - <span class="pl-ent">name</span>: <span class="pl-s">Join managers to swarm</span>
    <span class="pl-ent">shell</span>: <span class="pl-s"><span class="pl-pds">"</span>{{ hostvars['grand_master']['manager_join'] }}<span class="pl-pds">"</span></span>
    <span class="pl-ent">register</span>: <span class="pl-s">result_of_joining</span>

  - <span class="pl-ent">debug</span>: <span class="pl-s">msg='{{ result_of_joining.stdout }}'</span></pre></div>
<ul dir="auto">
<li>Create an ansible playbook to join the Docker worker nodes to the Swarm and save it as <code>pb_join_docker_swarm_workers.yaml</code> under <code>ansible/playbooks</code> folder.</li>
</ul>
<div class="highlight highlight-source-yaml position-relative overflow-auto" data-snippet-clipboard-copy-content="- hosts: role_grand_master
  tasks:
  - name: Get swarm join-token for workers
    shell: docker swarm join-token worker | grep -i 'docker'
    register: join_command_for_workers

  - debug: msg='{{ join_command_for_workers.stdout.strip() }}'
  
  - name: register grand_master with variable
    add_host:
      name: &quot;grand_master&quot;
      worker_join: &quot;{{ join_command_for_workers.stdout.strip() }}&quot;

- hosts: role_worker
  tasks:
  - name: Join workers to swarm
    shell: &quot;{{ hostvars['grand_master']['worker_join'] }}&quot;
    register: result_of_joining

  - debug: msg='{{ result_of_joining.stdout }}'"><pre>- <span class="pl-ent">hosts</span>: <span class="pl-s">role_grand_master</span>
  <span class="pl-ent">tasks</span>:
  - <span class="pl-ent">name</span>: <span class="pl-s">Get swarm join-token for workers</span>
    <span class="pl-ent">shell</span>: <span class="pl-s">docker swarm join-token worker | grep -i 'docker'</span>
    <span class="pl-ent">register</span>: <span class="pl-s">join_command_for_workers</span>

  - <span class="pl-ent">debug</span>: <span class="pl-s">msg='{{ join_command_for_workers.stdout.strip() }}'</span>
  
  - <span class="pl-ent">name</span>: <span class="pl-s">register grand_master with variable</span>
    <span class="pl-ent">add_host</span>:
      <span class="pl-ent">name</span>: <span class="pl-s"><span class="pl-pds">"</span>grand_master<span class="pl-pds">"</span></span>
      <span class="pl-ent">worker_join</span>: <span class="pl-s"><span class="pl-pds">"</span>{{ join_command_for_workers.stdout.strip() }}<span class="pl-pds">"</span></span>

- <span class="pl-ent">hosts</span>: <span class="pl-s">role_worker</span>
  <span class="pl-ent">tasks</span>:
  - <span class="pl-ent">name</span>: <span class="pl-s">Join workers to swarm</span>
    <span class="pl-ent">shell</span>: <span class="pl-s"><span class="pl-pds">"</span>{{ hostvars['grand_master']['worker_join'] }}<span class="pl-pds">"</span></span>
    <span class="pl-ent">register</span>: <span class="pl-s">result_of_joining</span>

  - <span class="pl-ent">debug</span>: <span class="pl-s">msg='{{ result_of_joining.stdout }}'</span></pre></div>
<ul dir="auto">
<li>Commit the change, then push the ansible playbooks to the remote repo.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="git add .
git commit -m 'added ansible playbooks for dev environment'
git push"><pre>git add <span class="pl-c1">.</span>
git commit -m <span class="pl-s"><span class="pl-pds">'</span>added ansible playbooks for dev environment<span class="pl-pds">'</span></span>
git push</pre></div>
<ul dir="auto">
<li>Configure <code>test-creating-qa-automation-infrastructure</code> job and replace the existing script with the one below in order to test the playbooks to create a Docker Swarm on Cloudformation Stack.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="APP_NAME=&quot;Petclinic&quot;
CFN_KEYPAIR=&quot;call-ansible-test-dev.key&quot;
PATH=&quot;$PATH:/usr/local/bin&quot;
export ANSIBLE_PRIVATE_KEY_FILE=&quot;${WORKSPACE}/${CFN_KEYPAIR}&quot;
export ANSIBLE_HOST_KEY_CHECKING=False
export APP_STACK_NAME=&quot;Call-$APP_NAME-App-${BUILD_NUMBER}&quot;
sed -i &quot;s/APP_STACK_NAME/$APP_STACK_NAME/&quot; ./ansible/inventory/dev_stack_dynamic_inventory_aws_ec2.yaml
# Swarm Setup for all nodes (instances)
ansible-playbook -i ./ansible/inventory/dev_stack_dynamic_inventory_aws_ec2.yaml -b ./ansible/playbooks/pb_setup_for_all_docker_swarm_instances.yaml
# Swarm Setup for Grand Master node
ansible-playbook -i ./ansible/inventory/dev_stack_dynamic_inventory_aws_ec2.yaml -b ./ansible/playbooks/pb_initialize_docker_swarm.yaml
# Swarm Setup for Other Managers nodes
ansible-playbook -i ./ansible/inventory/dev_stack_dynamic_inventory_aws_ec2.yaml -b ./ansible/playbooks/pb_join_docker_swarm_managers.yaml
# Swarm Setup for Workers nodes
ansible-playbook -i ./ansible/inventory/dev_stack_dynamic_inventory_aws_ec2.yaml -b ./ansible/playbooks/pb_join_docker_swarm_workers.yaml"><pre>APP_NAME=<span class="pl-s"><span class="pl-pds">"</span>Petclinic<span class="pl-pds">"</span></span>
CFN_KEYPAIR=<span class="pl-s"><span class="pl-pds">"</span>call-ansible-test-dev.key<span class="pl-pds">"</span></span>
PATH=<span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">$PATH</span>:/usr/local/bin<span class="pl-pds">"</span></span>
<span class="pl-k">export</span> ANSIBLE_PRIVATE_KEY_FILE=<span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${WORKSPACE}</span>/<span class="pl-smi">${CFN_KEYPAIR}</span><span class="pl-pds">"</span></span>
<span class="pl-k">export</span> ANSIBLE_HOST_KEY_CHECKING=False
<span class="pl-k">export</span> APP_STACK_NAME=<span class="pl-s"><span class="pl-pds">"</span>Call-<span class="pl-smi">$APP_NAME</span>-App-<span class="pl-smi">${BUILD_NUMBER}</span><span class="pl-pds">"</span></span>
sed -i <span class="pl-s"><span class="pl-pds">"</span>s/APP_STACK_NAME/<span class="pl-smi">$APP_STACK_NAME</span>/<span class="pl-pds">"</span></span> ./ansible/inventory/dev_stack_dynamic_inventory_aws_ec2.yaml
<span class="pl-c"><span class="pl-c">#</span> Swarm Setup for all nodes (instances)</span>
ansible-playbook -i ./ansible/inventory/dev_stack_dynamic_inventory_aws_ec2.yaml -b ./ansible/playbooks/pb_setup_for_all_docker_swarm_instances.yaml
<span class="pl-c"><span class="pl-c">#</span> Swarm Setup for Grand Master node</span>
ansible-playbook -i ./ansible/inventory/dev_stack_dynamic_inventory_aws_ec2.yaml -b ./ansible/playbooks/pb_initialize_docker_swarm.yaml
<span class="pl-c"><span class="pl-c">#</span> Swarm Setup for Other Managers nodes</span>
ansible-playbook -i ./ansible/inventory/dev_stack_dynamic_inventory_aws_ec2.yaml -b ./ansible/playbooks/pb_join_docker_swarm_managers.yaml
<span class="pl-c"><span class="pl-c">#</span> Swarm Setup for Workers nodes</span>
ansible-playbook -i ./ansible/inventory/dev_stack_dynamic_inventory_aws_ec2.yaml -b ./ansible/playbooks/pb_join_docker_swarm_workers.yaml</pre></div>
<ul dir="auto">
<li>After running the job above, replace the script with the one below in order to test tearing down the Docker Swarm infrastructure using AWS CLI with following script.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="PATH=&quot;$PATH:/usr/local/bin&quot;
APP_NAME=&quot;Petclinic&quot;
AWS_STACK_NAME=&quot;Call-$APP_NAME-App-${BUILD_NUMBER}&quot;
AWS_REGION=&quot;us-east-1&quot;
aws cloudformation delete-stack --region ${AWS_REGION} --stack-name ${AWS_STACK_NAME}"><pre>PATH=<span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">$PATH</span>:/usr/local/bin<span class="pl-pds">"</span></span>
APP_NAME=<span class="pl-s"><span class="pl-pds">"</span>Petclinic<span class="pl-pds">"</span></span>
AWS_STACK_NAME=<span class="pl-s"><span class="pl-pds">"</span>Call-<span class="pl-smi">$APP_NAME</span>-App-<span class="pl-smi">${BUILD_NUMBER}</span><span class="pl-pds">"</span></span>
AWS_REGION=<span class="pl-s"><span class="pl-pds">"</span>us-east-1<span class="pl-pds">"</span></span>
aws cloudformation delete-stack --region <span class="pl-smi">${AWS_REGION}</span> --stack-name <span class="pl-smi">${AWS_STACK_NAME}</span></pre></div>
<ul dir="auto">
<li>After running the job above, replace the script with the one below in order to test deleting existing key pair using AWS CLI with following script.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="PATH=&quot;$PATH:/usr/local/bin&quot;
CFN_KEYPAIR=&quot;call-ansible-test-dev.key&quot;
AWS_REGION=&quot;us-east-1&quot;
aws ec2 delete-key-pair --region ${AWS_REGION} --key-name ${CFN_KEYPAIR}
rm -rf ${CFN_KEYPAIR}"><pre>PATH=<span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">$PATH</span>:/usr/local/bin<span class="pl-pds">"</span></span>
CFN_KEYPAIR=<span class="pl-s"><span class="pl-pds">"</span>call-ansible-test-dev.key<span class="pl-pds">"</span></span>
AWS_REGION=<span class="pl-s"><span class="pl-pds">"</span>us-east-1<span class="pl-pds">"</span></span>
aws ec2 delete-key-pair --region <span class="pl-smi">${AWS_REGION}</span> --key-name <span class="pl-smi">${CFN_KEYPAIR}</span>
rm -rf <span class="pl-smi">${CFN_KEYPAIR}</span></pre></div>
<ul dir="auto">
<li>Create a script to create QA Automation infrastructure and save it as <code>create-qa-automation-environment.sh</code> under <code>infrastructure</code> folder. (This script shouldn't be used in one time. It should be applied step by step like above)</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="# Environment variables
PATH=&quot;$PATH:/usr/local/bin&quot;
APP_NAME=&quot;Petclinic&quot;
CFN_KEYPAIR=&quot;Call-$APP_NAME-dev-${BUILD_NUMBER}.key&quot;
CFN_TEMPLATE=&quot;./infrastructure/dev-docker-swarm-infrastructure-cfn-template.yml&quot;
AWS_REGION=&quot;us-east-1&quot;
export ANSIBLE_PRIVATE_KEY_FILE=&quot;${WORKSPACE}/${CFN_KEYPAIR}&quot;
export ANSIBLE_HOST_KEY_CHECKING=False
export APP_STACK_NAME=&quot;Call-$APP_NAME-App-${BUILD_NUMBER}&quot;
# Create key pair for Ansible
aws ec2 create-key-pair --region ${AWS_REGION} --key-name ${CFN_KEYPAIR} --query &quot;KeyMaterial&quot; --output text &gt; ${CFN_KEYPAIR}
chmod 400 ${CFN_KEYPAIR}
# Create infrastructure for Docker Swarm
aws cloudformation create-stack --region ${AWS_REGION} --stack-name ${APP_STACK_NAME} --capabilities CAPABILITY_IAM --template-body file://${CFN_TEMPLATE} --parameters ParameterKey=KeyPairName,ParameterValue=${CFN_KEYPAIR}

# Install Docker Swarm environment on the infrastructure
# Update dynamic inventory (hosts/docker nodes)
sed -i &quot;s/APP_STACK_NAME/$APP_STACK_NAME/&quot; ./ansible/inventory/dev_stack_dynamic_inventory_aws_ec2.yaml
# Install common tools on all instances/nodes
ansible-playbook -i ./ansible/inventory/dev_stack_dynamic_inventory_aws_ec2.yaml -b ./ansible/playbooks/pb_setup_for_all_docker_swarm_instances.yaml
# Initialize Docker Swarm on Grand Master
ansible-playbook -i ./ansible/inventory/dev_stack_dynamic_inventory_aws_ec2.yaml -b ./ansible/playbooks/pb_initialize_docker_swarm.yaml
# Join the manager instances to the Swarm
ansible-playbook -i ./ansible/inventory/dev_stack_dynamic_inventory_aws_ec2.yaml -b ./ansible/playbooks/pb_join_docker_swarm_managers.yaml
# Join the worker instances to the Swarm
ansible-playbook -i ./ansible/inventory/dev_stack_dynamic_inventory_aws_ec2.yaml -b ./ansible/playbooks/pb_join_docker_swarm_workers.yaml

# Build, Deploy, Test the application

# Tear down the Docker Swarm infrastructure
aws cloudformation delete-stack --region ${AWS_REGION} --stack-name ${AWS_STACK_NAME}
# Delete key pair
aws ec2 delete-key-pair --region ${AWS_REGION} --key-name ${CFN_KEYPAIR}
rm -rf ${CFN_KEYPAIR}"><pre><span class="pl-c"><span class="pl-c">#</span> Environment variables</span>
PATH=<span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">$PATH</span>:/usr/local/bin<span class="pl-pds">"</span></span>
APP_NAME=<span class="pl-s"><span class="pl-pds">"</span>Petclinic<span class="pl-pds">"</span></span>
CFN_KEYPAIR=<span class="pl-s"><span class="pl-pds">"</span>Call-<span class="pl-smi">$APP_NAME</span>-dev-<span class="pl-smi">${BUILD_NUMBER}</span>.key<span class="pl-pds">"</span></span>
CFN_TEMPLATE=<span class="pl-s"><span class="pl-pds">"</span>./infrastructure/dev-docker-swarm-infrastructure-cfn-template.yml<span class="pl-pds">"</span></span>
AWS_REGION=<span class="pl-s"><span class="pl-pds">"</span>us-east-1<span class="pl-pds">"</span></span>
<span class="pl-k">export</span> ANSIBLE_PRIVATE_KEY_FILE=<span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${WORKSPACE}</span>/<span class="pl-smi">${CFN_KEYPAIR}</span><span class="pl-pds">"</span></span>
<span class="pl-k">export</span> ANSIBLE_HOST_KEY_CHECKING=False
<span class="pl-k">export</span> APP_STACK_NAME=<span class="pl-s"><span class="pl-pds">"</span>Call-<span class="pl-smi">$APP_NAME</span>-App-<span class="pl-smi">${BUILD_NUMBER}</span><span class="pl-pds">"</span></span>
<span class="pl-c"><span class="pl-c">#</span> Create key pair for Ansible</span>
aws ec2 create-key-pair --region <span class="pl-smi">${AWS_REGION}</span> --key-name <span class="pl-smi">${CFN_KEYPAIR}</span> --query <span class="pl-s"><span class="pl-pds">"</span>KeyMaterial<span class="pl-pds">"</span></span> --output text <span class="pl-k">&gt;</span> <span class="pl-smi">${CFN_KEYPAIR}</span>
chmod 400 <span class="pl-smi">${CFN_KEYPAIR}</span>
<span class="pl-c"><span class="pl-c">#</span> Create infrastructure for Docker Swarm</span>
aws cloudformation create-stack --region <span class="pl-smi">${AWS_REGION}</span> --stack-name <span class="pl-smi">${APP_STACK_NAME}</span> --capabilities CAPABILITY_IAM --template-body file://<span class="pl-smi">${CFN_TEMPLATE}</span> --parameters ParameterKey=KeyPairName,ParameterValue=<span class="pl-smi">${CFN_KEYPAIR}</span>

<span class="pl-c"><span class="pl-c">#</span> Install Docker Swarm environment on the infrastructure</span>
<span class="pl-c"><span class="pl-c">#</span> Update dynamic inventory (hosts/docker nodes)</span>
sed -i <span class="pl-s"><span class="pl-pds">"</span>s/APP_STACK_NAME/<span class="pl-smi">$APP_STACK_NAME</span>/<span class="pl-pds">"</span></span> ./ansible/inventory/dev_stack_dynamic_inventory_aws_ec2.yaml
<span class="pl-c"><span class="pl-c">#</span> Install common tools on all instances/nodes</span>
ansible-playbook -i ./ansible/inventory/dev_stack_dynamic_inventory_aws_ec2.yaml -b ./ansible/playbooks/pb_setup_for_all_docker_swarm_instances.yaml
<span class="pl-c"><span class="pl-c">#</span> Initialize Docker Swarm on Grand Master</span>
ansible-playbook -i ./ansible/inventory/dev_stack_dynamic_inventory_aws_ec2.yaml -b ./ansible/playbooks/pb_initialize_docker_swarm.yaml
<span class="pl-c"><span class="pl-c">#</span> Join the manager instances to the Swarm</span>
ansible-playbook -i ./ansible/inventory/dev_stack_dynamic_inventory_aws_ec2.yaml -b ./ansible/playbooks/pb_join_docker_swarm_managers.yaml
<span class="pl-c"><span class="pl-c">#</span> Join the worker instances to the Swarm</span>
ansible-playbook -i ./ansible/inventory/dev_stack_dynamic_inventory_aws_ec2.yaml -b ./ansible/playbooks/pb_join_docker_swarm_workers.yaml

<span class="pl-c"><span class="pl-c">#</span> Build, Deploy, Test the application</span>

<span class="pl-c"><span class="pl-c">#</span> Tear down the Docker Swarm infrastructure</span>
aws cloudformation delete-stack --region <span class="pl-smi">${AWS_REGION}</span> --stack-name <span class="pl-smi">${AWS_STACK_NAME}</span>
<span class="pl-c"><span class="pl-c">#</span> Delete key pair</span>
aws ec2 delete-key-pair --region <span class="pl-smi">${AWS_REGION}</span> --key-name <span class="pl-smi">${CFN_KEYPAIR}</span>
rm -rf <span class="pl-smi">${CFN_KEYPAIR}</span></pre></div>
<ul dir="auto">
<li>Commit the change, then push the script to the remote repo.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="git add .
git commit -m 'added scripts for qa automation environment'
git push
git checkout dev
git merge feature/msp-16
git push origin dev"><pre>git add <span class="pl-c1">.</span>
git commit -m <span class="pl-s"><span class="pl-pds">'</span>added scripts for qa automation environment<span class="pl-pds">'</span></span>
git push
git checkout dev
git merge feature/msp-16
git push origin dev</pre></div>
<h2 dir="auto"><a id="user-content-msp-17---prepare-a-qa-automation-pipeline-for-nightly-builds" class="anchor" aria-hidden="true" href="#msp-17---prepare-a-qa-automation-pipeline-for-nightly-builds"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>MSP 17 - Prepare a QA Automation Pipeline for Nightly Builds</h2>
<ul dir="auto">
<li>Create <code>feature/msp-17</code> branch from <code>dev</code>.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="git checkout dev
git branch feature/msp-17
git checkout feature/msp-17"><pre>git checkout dev
git branch feature/msp-17
git checkout feature/msp-17</pre></div>
<ul dir="auto">
<li>Prepare a script to package the app with maven Docker container and save it as <code>package-with-maven-container.sh</code> and save it under <code>jenkins</code> folder.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="docker run --rm -v $HOME/.m2:/root/.m2 -v $WORKSPACE:/app -w /app maven:3.8-openjdk-11 mvn clean package"><pre>docker run --rm -v <span class="pl-smi">$HOME</span>/.m2:/root/.m2 -v <span class="pl-smi">$WORKSPACE</span>:/app -w /app maven:3.8-openjdk-11 mvn clean package</pre></div>
<ul dir="auto">
<li>Prepare a script to create ECR tags for the dev docker images and save it as <code>prepare-tags-ecr-for-dev-docker-images.sh</code> and save it under <code>jenkins</code> folder.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="MVN_VERSION=$(. ${WORKSPACE}/spring-petclinic-admin-server/target/maven-archiver/pom.properties &amp;&amp; echo $version)
export IMAGE_TAG_ADMIN_SERVER=&quot;${ECR_REGISTRY}/${APP_REPO_NAME}:admin-server-v${MVN_VERSION}-b${BUILD_NUMBER}&quot;
MVN_VERSION=$(. ${WORKSPACE}/spring-petclinic-api-gateway/target/maven-archiver/pom.properties &amp;&amp; echo $version)
export IMAGE_TAG_API_GATEWAY=&quot;${ECR_REGISTRY}/${APP_REPO_NAME}:api-gateway-v${MVN_VERSION}-b${BUILD_NUMBER}&quot;
MVN_VERSION=$(. ${WORKSPACE}/spring-petclinic-config-server/target/maven-archiver/pom.properties &amp;&amp; echo $version)
export IMAGE_TAG_CONFIG_SERVER=&quot;${ECR_REGISTRY}/${APP_REPO_NAME}:config-server-v${MVN_VERSION}-b${BUILD_NUMBER}&quot;
MVN_VERSION=$(. ${WORKSPACE}/spring-petclinic-customers-service/target/maven-archiver/pom.properties &amp;&amp; echo $version)
export IMAGE_TAG_CUSTOMERS_SERVICE=&quot;${ECR_REGISTRY}/${APP_REPO_NAME}:customers-service-v${MVN_VERSION}-b${BUILD_NUMBER}&quot;
MVN_VERSION=$(. ${WORKSPACE}/spring-petclinic-discovery-server/target/maven-archiver/pom.properties &amp;&amp; echo $version)
export IMAGE_TAG_DISCOVERY_SERVER=&quot;${ECR_REGISTRY}/${APP_REPO_NAME}:discovery-server-v${MVN_VERSION}-b${BUILD_NUMBER}&quot;
MVN_VERSION=$(. ${WORKSPACE}/spring-petclinic-hystrix-dashboard/target/maven-archiver/pom.properties &amp;&amp; echo $version)
export IMAGE_TAG_HYSTRIX_DASHBOARD=&quot;${ECR_REGISTRY}/${APP_REPO_NAME}:hystrix-dashboard-v${MVN_VERSION}-b${BUILD_NUMBER}&quot;
MVN_VERSION=$(. ${WORKSPACE}/spring-petclinic-vets-service/target/maven-archiver/pom.properties &amp;&amp; echo $version)
export IMAGE_TAG_VETS_SERVICE=&quot;${ECR_REGISTRY}/${APP_REPO_NAME}:vets-service-v${MVN_VERSION}-b${BUILD_NUMBER}&quot;
MVN_VERSION=$(. ${WORKSPACE}/spring-petclinic-visits-service/target/maven-archiver/pom.properties &amp;&amp; echo $version)
export IMAGE_TAG_VISITS_SERVICE=&quot;${ECR_REGISTRY}/${APP_REPO_NAME}:visits-service-v${MVN_VERSION}-b${BUILD_NUMBER}&quot;
export IMAGE_TAG_GRAFANA_SERVICE=&quot;${ECR_REGISTRY}/${APP_REPO_NAME}:grafana-service&quot;
export IMAGE_TAG_PROMETHEUS_SERVICE=&quot;${ECR_REGISTRY}/${APP_REPO_NAME}:prometheus-service&quot;"><pre>MVN_VERSION=<span class="pl-s"><span class="pl-pds">$(</span>. <span class="pl-smi">${WORKSPACE}</span>/spring-petclinic-admin-server/target/maven-archiver/pom.properties <span class="pl-k">&amp;&amp;</span> <span class="pl-c1">echo</span> <span class="pl-smi">$version</span><span class="pl-pds">)</span></span>
<span class="pl-k">export</span> IMAGE_TAG_ADMIN_SERVER=<span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${ECR_REGISTRY}</span>/<span class="pl-smi">${APP_REPO_NAME}</span>:admin-server-v<span class="pl-smi">${MVN_VERSION}</span>-b<span class="pl-smi">${BUILD_NUMBER}</span><span class="pl-pds">"</span></span>
MVN_VERSION=<span class="pl-s"><span class="pl-pds">$(</span>. <span class="pl-smi">${WORKSPACE}</span>/spring-petclinic-api-gateway/target/maven-archiver/pom.properties <span class="pl-k">&amp;&amp;</span> <span class="pl-c1">echo</span> <span class="pl-smi">$version</span><span class="pl-pds">)</span></span>
<span class="pl-k">export</span> IMAGE_TAG_API_GATEWAY=<span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${ECR_REGISTRY}</span>/<span class="pl-smi">${APP_REPO_NAME}</span>:api-gateway-v<span class="pl-smi">${MVN_VERSION}</span>-b<span class="pl-smi">${BUILD_NUMBER}</span><span class="pl-pds">"</span></span>
MVN_VERSION=<span class="pl-s"><span class="pl-pds">$(</span>. <span class="pl-smi">${WORKSPACE}</span>/spring-petclinic-config-server/target/maven-archiver/pom.properties <span class="pl-k">&amp;&amp;</span> <span class="pl-c1">echo</span> <span class="pl-smi">$version</span><span class="pl-pds">)</span></span>
<span class="pl-k">export</span> IMAGE_TAG_CONFIG_SERVER=<span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${ECR_REGISTRY}</span>/<span class="pl-smi">${APP_REPO_NAME}</span>:config-server-v<span class="pl-smi">${MVN_VERSION}</span>-b<span class="pl-smi">${BUILD_NUMBER}</span><span class="pl-pds">"</span></span>
MVN_VERSION=<span class="pl-s"><span class="pl-pds">$(</span>. <span class="pl-smi">${WORKSPACE}</span>/spring-petclinic-customers-service/target/maven-archiver/pom.properties <span class="pl-k">&amp;&amp;</span> <span class="pl-c1">echo</span> <span class="pl-smi">$version</span><span class="pl-pds">)</span></span>
<span class="pl-k">export</span> IMAGE_TAG_CUSTOMERS_SERVICE=<span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${ECR_REGISTRY}</span>/<span class="pl-smi">${APP_REPO_NAME}</span>:customers-service-v<span class="pl-smi">${MVN_VERSION}</span>-b<span class="pl-smi">${BUILD_NUMBER}</span><span class="pl-pds">"</span></span>
MVN_VERSION=<span class="pl-s"><span class="pl-pds">$(</span>. <span class="pl-smi">${WORKSPACE}</span>/spring-petclinic-discovery-server/target/maven-archiver/pom.properties <span class="pl-k">&amp;&amp;</span> <span class="pl-c1">echo</span> <span class="pl-smi">$version</span><span class="pl-pds">)</span></span>
<span class="pl-k">export</span> IMAGE_TAG_DISCOVERY_SERVER=<span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${ECR_REGISTRY}</span>/<span class="pl-smi">${APP_REPO_NAME}</span>:discovery-server-v<span class="pl-smi">${MVN_VERSION}</span>-b<span class="pl-smi">${BUILD_NUMBER}</span><span class="pl-pds">"</span></span>
MVN_VERSION=<span class="pl-s"><span class="pl-pds">$(</span>. <span class="pl-smi">${WORKSPACE}</span>/spring-petclinic-hystrix-dashboard/target/maven-archiver/pom.properties <span class="pl-k">&amp;&amp;</span> <span class="pl-c1">echo</span> <span class="pl-smi">$version</span><span class="pl-pds">)</span></span>
<span class="pl-k">export</span> IMAGE_TAG_HYSTRIX_DASHBOARD=<span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${ECR_REGISTRY}</span>/<span class="pl-smi">${APP_REPO_NAME}</span>:hystrix-dashboard-v<span class="pl-smi">${MVN_VERSION}</span>-b<span class="pl-smi">${BUILD_NUMBER}</span><span class="pl-pds">"</span></span>
MVN_VERSION=<span class="pl-s"><span class="pl-pds">$(</span>. <span class="pl-smi">${WORKSPACE}</span>/spring-petclinic-vets-service/target/maven-archiver/pom.properties <span class="pl-k">&amp;&amp;</span> <span class="pl-c1">echo</span> <span class="pl-smi">$version</span><span class="pl-pds">)</span></span>
<span class="pl-k">export</span> IMAGE_TAG_VETS_SERVICE=<span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${ECR_REGISTRY}</span>/<span class="pl-smi">${APP_REPO_NAME}</span>:vets-service-v<span class="pl-smi">${MVN_VERSION}</span>-b<span class="pl-smi">${BUILD_NUMBER}</span><span class="pl-pds">"</span></span>
MVN_VERSION=<span class="pl-s"><span class="pl-pds">$(</span>. <span class="pl-smi">${WORKSPACE}</span>/spring-petclinic-visits-service/target/maven-archiver/pom.properties <span class="pl-k">&amp;&amp;</span> <span class="pl-c1">echo</span> <span class="pl-smi">$version</span><span class="pl-pds">)</span></span>
<span class="pl-k">export</span> IMAGE_TAG_VISITS_SERVICE=<span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${ECR_REGISTRY}</span>/<span class="pl-smi">${APP_REPO_NAME}</span>:visits-service-v<span class="pl-smi">${MVN_VERSION}</span>-b<span class="pl-smi">${BUILD_NUMBER}</span><span class="pl-pds">"</span></span>
<span class="pl-k">export</span> IMAGE_TAG_GRAFANA_SERVICE=<span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${ECR_REGISTRY}</span>/<span class="pl-smi">${APP_REPO_NAME}</span>:grafana-service<span class="pl-pds">"</span></span>
<span class="pl-k">export</span> IMAGE_TAG_PROMETHEUS_SERVICE=<span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${ECR_REGISTRY}</span>/<span class="pl-smi">${APP_REPO_NAME}</span>:prometheus-service<span class="pl-pds">"</span></span></pre></div>
<ul dir="auto">
<li>Prepare a script to build the dev docker images tagged for ECR registry and save it as <code>build-dev-docker-images-for-ecr.sh</code> and save it under <code>jenkins</code> folder.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="docker build --force-rm -t &quot;${IMAGE_TAG_ADMIN_SERVER}&quot; &quot;${WORKSPACE}/spring-petclinic-admin-server&quot;
docker build --force-rm -t &quot;${IMAGE_TAG_API_GATEWAY}&quot; &quot;${WORKSPACE}/spring-petclinic-api-gateway&quot;
docker build --force-rm -t &quot;${IMAGE_TAG_CONFIG_SERVER}&quot; &quot;${WORKSPACE}/spring-petclinic-config-server&quot;
docker build --force-rm -t &quot;${IMAGE_TAG_CUSTOMERS_SERVICE}&quot; &quot;${WORKSPACE}/spring-petclinic-customers-service&quot;
docker build --force-rm -t &quot;${IMAGE_TAG_DISCOVERY_SERVER}&quot; &quot;${WORKSPACE}/spring-petclinic-discovery-server&quot;
docker build --force-rm -t &quot;${IMAGE_TAG_HYSTRIX_DASHBOARD}&quot; &quot;${WORKSPACE}/spring-petclinic-hystrix-dashboard&quot;
docker build --force-rm -t &quot;${IMAGE_TAG_VETS_SERVICE}&quot; &quot;${WORKSPACE}/spring-petclinic-vets-service&quot;
docker build --force-rm -t &quot;${IMAGE_TAG_VISITS_SERVICE}&quot; &quot;${WORKSPACE}/spring-petclinic-visits-service&quot;
docker build --force-rm -t &quot;${IMAGE_TAG_GRAFANA_SERVICE}&quot; &quot;${WORKSPACE}/docker/grafana&quot;
docker build --force-rm -t &quot;${IMAGE_TAG_PROMETHEUS_SERVICE}&quot; &quot;${WORKSPACE}/docker/prometheus&quot;"><pre>docker build --force-rm -t <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${IMAGE_TAG_ADMIN_SERVER}</span><span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${WORKSPACE}</span>/spring-petclinic-admin-server<span class="pl-pds">"</span></span>
docker build --force-rm -t <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${IMAGE_TAG_API_GATEWAY}</span><span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${WORKSPACE}</span>/spring-petclinic-api-gateway<span class="pl-pds">"</span></span>
docker build --force-rm -t <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${IMAGE_TAG_CONFIG_SERVER}</span><span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${WORKSPACE}</span>/spring-petclinic-config-server<span class="pl-pds">"</span></span>
docker build --force-rm -t <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${IMAGE_TAG_CUSTOMERS_SERVICE}</span><span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${WORKSPACE}</span>/spring-petclinic-customers-service<span class="pl-pds">"</span></span>
docker build --force-rm -t <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${IMAGE_TAG_DISCOVERY_SERVER}</span><span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${WORKSPACE}</span>/spring-petclinic-discovery-server<span class="pl-pds">"</span></span>
docker build --force-rm -t <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${IMAGE_TAG_HYSTRIX_DASHBOARD}</span><span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${WORKSPACE}</span>/spring-petclinic-hystrix-dashboard<span class="pl-pds">"</span></span>
docker build --force-rm -t <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${IMAGE_TAG_VETS_SERVICE}</span><span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${WORKSPACE}</span>/spring-petclinic-vets-service<span class="pl-pds">"</span></span>
docker build --force-rm -t <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${IMAGE_TAG_VISITS_SERVICE}</span><span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${WORKSPACE}</span>/spring-petclinic-visits-service<span class="pl-pds">"</span></span>
docker build --force-rm -t <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${IMAGE_TAG_GRAFANA_SERVICE}</span><span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${WORKSPACE}</span>/docker/grafana<span class="pl-pds">"</span></span>
docker build --force-rm -t <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${IMAGE_TAG_PROMETHEUS_SERVICE}</span><span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${WORKSPACE}</span>/docker/prometheus<span class="pl-pds">"</span></span></pre></div>
<ul dir="auto">
<li>Prepare a script to push the dev docker images to the ECR repo and save it as <code>push-dev-docker-images-to-ecr.sh</code> and save it under <code>jenkins</code> folder.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="# Provide credentials for Docker to login the AWS ECR and push the images
aws ecr get-login-password --region ${AWS_REGION} | docker login --username AWS --password-stdin ${ECR_REGISTRY} 
docker push &quot;${IMAGE_TAG_ADMIN_SERVER}&quot;
docker push &quot;${IMAGE_TAG_API_GATEWAY}&quot;
docker push &quot;${IMAGE_TAG_CONFIG_SERVER}&quot;
docker push &quot;${IMAGE_TAG_CUSTOMERS_SERVICE}&quot;
docker push &quot;${IMAGE_TAG_DISCOVERY_SERVER}&quot;
docker push &quot;${IMAGE_TAG_HYSTRIX_DASHBOARD}&quot;
docker push &quot;${IMAGE_TAG_VETS_SERVICE}&quot;
docker push &quot;${IMAGE_TAG_VISITS_SERVICE}&quot;
docker push &quot;${IMAGE_TAG_GRAFANA_SERVICE}&quot;
docker push &quot;${IMAGE_TAG_PROMETHEUS_SERVICE}&quot;"><pre><span class="pl-c"><span class="pl-c">#</span> Provide credentials for Docker to login the AWS ECR and push the images</span>
aws ecr get-login-password --region <span class="pl-smi">${AWS_REGION}</span> <span class="pl-k">|</span> docker login --username AWS --password-stdin <span class="pl-smi">${ECR_REGISTRY}</span> 
docker push <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${IMAGE_TAG_ADMIN_SERVER}</span><span class="pl-pds">"</span></span>
docker push <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${IMAGE_TAG_API_GATEWAY}</span><span class="pl-pds">"</span></span>
docker push <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${IMAGE_TAG_CONFIG_SERVER}</span><span class="pl-pds">"</span></span>
docker push <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${IMAGE_TAG_CUSTOMERS_SERVICE}</span><span class="pl-pds">"</span></span>
docker push <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${IMAGE_TAG_DISCOVERY_SERVER}</span><span class="pl-pds">"</span></span>
docker push <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${IMAGE_TAG_HYSTRIX_DASHBOARD}</span><span class="pl-pds">"</span></span>
docker push <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${IMAGE_TAG_VETS_SERVICE}</span><span class="pl-pds">"</span></span>
docker push <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${IMAGE_TAG_VISITS_SERVICE}</span><span class="pl-pds">"</span></span>
docker push <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${IMAGE_TAG_GRAFANA_SERVICE}</span><span class="pl-pds">"</span></span>
docker push <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${IMAGE_TAG_PROMETHEUS_SERVICE}</span><span class="pl-pds">"</span></span></pre></div>
<ul dir="auto">
<li>Commit the change, then push the scripts to the remote repo.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="git add .
git commit -m 'added scripts for qa automation environment'
git push --set-upstream origin feature/msp-17"><pre>git add <span class="pl-c1">.</span>
git commit -m <span class="pl-s"><span class="pl-pds">'</span>added scripts for qa automation environment<span class="pl-pds">'</span></span>
git push --set-upstream origin feature/msp-17</pre></div>
<ul dir="auto">
<li>
<p dir="auto">OPTIONAL: Create a Jenkins job with the name of <code>test-msp-17-scripts</code> to test the scripts:</p>
<ul dir="auto">
<li>Select <code>Freestyle project</code> and click <code>OK</code></li>
<li>Select github project and write the url to your repository's page into <code>Project url</code> (<a href="https://github.com/%5Byour-github-account%5D/petclinic-microservices">https://github.com/[your-github-account]/petclinic-microservices</a>)</li>
<li>Under the <code>Source Code Management</code> select <code>Git</code></li>
<li>Write the url of your repository into the <code>Repository URL</code> (<a href="https://github.com/%5Byour-github-account%5D/petclinic-microservices.git">https://github.com/[your-github-account]/petclinic-microservices.git</a>)</li>
<li>Add <code>*/feature/msp-17</code> branch to <code>Branches to build</code></li>
<li>Click <code>Add build step</code> under <code>Build</code> and select <code>Execute Shell</code></li>
<li>Write below script into the <code>Command</code>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="PATH=&quot;$PATH:/usr/local/bin&quot;
APP_REPO_NAME=&quot;clarusway-repo/petclinic-app-dev&quot; # Write your own repo name
AWS_REGION=&quot;us-east-1&quot; #Update this line if you work on another region
ECR_REGISTRY=&quot;046402772087.dkr.ecr.us-east-1.amazonaws.com&quot; # Replace this line with your ECR name
aws ecr create-repository \
    --repository-name ${APP_REPO_NAME} \
    --image-scanning-configuration scanOnPush=false \
    --image-tag-mutability MUTABLE \
    --region ${AWS_REGION}
. ./jenkins/package-with-maven-container.sh
. ./jenkins/prepare-tags-ecr-for-dev-docker-images.sh
. ./jenkins/build-dev-docker-images-for-ecr.sh
. ./jenkins/push-dev-docker-images-to-ecr.sh"><pre>PATH=<span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">$PATH</span>:/usr/local/bin<span class="pl-pds">"</span></span>
APP_REPO_NAME=<span class="pl-s"><span class="pl-pds">"</span>clarusway-repo/petclinic-app-dev<span class="pl-pds">"</span></span> <span class="pl-c"><span class="pl-c">#</span> Write your own repo name</span>
AWS_REGION=<span class="pl-s"><span class="pl-pds">"</span>us-east-1<span class="pl-pds">"</span></span> <span class="pl-c"><span class="pl-c">#</span>Update this line if you work on another region</span>
ECR_REGISTRY=<span class="pl-s"><span class="pl-pds">"</span>046402772087.dkr.ecr.us-east-1.amazonaws.com<span class="pl-pds">"</span></span> <span class="pl-c"><span class="pl-c">#</span> Replace this line with your ECR name</span>
aws ecr create-repository \
    --repository-name <span class="pl-smi">${APP_REPO_NAME}</span> \
    --image-scanning-configuration scanOnPush=false \
    --image-tag-mutability MUTABLE \
    --region <span class="pl-smi">${AWS_REGION}</span>
<span class="pl-c1">.</span> ./jenkins/package-with-maven-container.sh
<span class="pl-c1">.</span> ./jenkins/prepare-tags-ecr-for-dev-docker-images.sh
<span class="pl-c1">.</span> ./jenkins/build-dev-docker-images-for-ecr.sh
<span class="pl-c1">.</span> ./jenkins/push-dev-docker-images-to-ecr.sh</pre></div>
</li>
<li>Click <code>Save</code></li>
<li>Click <code>Build now</code> to manually start the job.</li>
</ul>
</li>
<li>
<p dir="auto">Prepare a docker compose file for swarm deployment and save it as <code>docker-compose-swarm-dev.yml</code> under the project root.</p>
</li>
</ul>
<div class="highlight highlight-source-yaml position-relative overflow-auto" data-snippet-clipboard-copy-content="version: '3.8'

services:
  config-server:
    image: &quot;${IMAGE_TAG_CONFIG_SERVER}&quot;
    networks:
      - clarusnet
    ports:
      - 8888:8888

  discovery-server:
    image: &quot;${IMAGE_TAG_DISCOVERY_SERVER}&quot;
    depends_on:
      - config-server
    entrypoint: [&quot;./dockerize&quot;,&quot;-wait=tcp://config-server:8888&quot;,&quot;-timeout=60s&quot;,&quot;--&quot;,&quot;java&quot;, &quot;-Djava.security.egd=file:/dev/./urandom&quot;,&quot;-jar&quot;,&quot;/app.jar&quot;]
    networks:
      - clarusnet
    ports:
      - 8761:8761

  customers-service:
    image: &quot;${IMAGE_TAG_CUSTOMERS_SERVICE}&quot;
    deploy:
      replicas: 3
      update_config:
          parallelism: 2
          delay: 5s
          order: start-first
    depends_on:
      - config-server
      - discovery-server
    entrypoint: [&quot;./dockerize&quot;,&quot;-wait=tcp://discovery-server:8761&quot;,&quot;-timeout=60s&quot;,&quot;--&quot;,&quot;java&quot;, &quot;-Djava.security.egd=file:/dev/./urandom&quot;,&quot;-jar&quot;,&quot;/app.jar&quot;]
    networks:
      - clarusnet
    ports:
      - 8081:8081

  visits-service:
    image: &quot;${IMAGE_TAG_VISITS_SERVICE}&quot;
    deploy:
      replicas: 3
      update_config:
          parallelism: 2
          delay: 5s
          order: start-first
    depends_on:
      - config-server
      - discovery-server
    entrypoint: [&quot;./dockerize&quot;,&quot;-wait=tcp://discovery-server:8761&quot;,&quot;-timeout=60s&quot;,&quot;--&quot;,&quot;java&quot;, &quot;-Djava.security.egd=file:/dev/./urandom&quot;,&quot;-jar&quot;,&quot;/app.jar&quot;]
    networks:
      - clarusnet
    ports:
      - 8082:8082

  vets-service:
    image: &quot;${IMAGE_TAG_VETS_SERVICE}&quot;
    deploy:
      replicas: 3
      update_config:
          parallelism: 2
          delay: 5s
          order: start-first
    depends_on:
      - config-server
      - discovery-server
    entrypoint: [&quot;./dockerize&quot;,&quot;-wait=tcp://discovery-server:8761&quot;,&quot;-timeout=60s&quot;,&quot;--&quot;,&quot;java&quot;, &quot;-Djava.security.egd=file:/dev/./urandom&quot;,&quot;-jar&quot;,&quot;/app.jar&quot;]
    networks:
      - clarusnet
    ports:
      - 8083:8083

  api-gateway:
    image: &quot;${IMAGE_TAG_API_GATEWAY}&quot;
    deploy:
      replicas: 3
      update_config:
          parallelism: 2
          delay: 5s
          order: start-first
    depends_on:
      - config-server
      - discovery-server
    entrypoint: [&quot;./dockerize&quot;,&quot;-wait=tcp://discovery-server:8761&quot;,&quot;-timeout=60s&quot;,&quot;--&quot;,&quot;java&quot;, &quot;-Djava.security.egd=file:/dev/./urandom&quot;,&quot;-jar&quot;,&quot;/app.jar&quot;]
    networks:
      - clarusnet
    ports:
      - 8080:8080

  tracing-server:
    image: openzipkin/zipkin
    environment:
      - JAVA_OPTS=-XX:+UnlockExperimentalVMOptions -Djava.security.egd=file:/dev/./urandom
    networks:
      - clarusnet
    ports:
      - 9411:9411

  admin-server:
    image: &quot;${IMAGE_TAG_ADMIN_SERVER}&quot;
    depends_on:
      - config-server
      - discovery-server
    entrypoint: [&quot;./dockerize&quot;,&quot;-wait=tcp://discovery-server:8761&quot;,&quot;-timeout=60s&quot;,&quot;--&quot;,&quot;java&quot;, &quot;-Djava.security.egd=file:/dev/./urandom&quot;,&quot;-jar&quot;,&quot;/app.jar&quot;]
    networks:
      - clarusnet
    ports:
      - 9090:9090

  hystrix-dashboard:
    image: &quot;${IMAGE_TAG_HYSTRIX_DASHBOARD}&quot;
    depends_on:
      - config-server
      - discovery-server
    entrypoint: [&quot;./dockerize&quot;,&quot;-wait=tcp://discovery-server:8761&quot;,&quot;-timeout=60s&quot;,&quot;--&quot;,&quot;java&quot;, &quot;-Djava.security.egd=file:/dev/./urandom&quot;,&quot;-jar&quot;,&quot;/app.jar&quot;]
    networks:
      - clarusnet
    ports:
      - 7979:7979

  ## Grafana / Prometheus

  grafana-server:
    image: &quot;${IMAGE_TAG_GRAFANA_SERVICE}&quot;
    networks:
      - clarusnet
    ports:
      - 3000:3000

  prometheus-server:
    image: &quot;${IMAGE_TAG_PROMETHEUS_SERVICE}&quot;
    networks:
      - clarusnet
    ports:
      - 9091:9090
    
  mysql-server:
    image: mysql:5.7.8
    environment: 
      MYSQL_ROOT_PASSWORD: petclinic
      MYSQL_DATABASE: petclinic
    networks:
      - clarusnet
    ports:
      - 3306:3306

networks:
  clarusnet:
    driver: overlay"><pre><span class="pl-ent">version</span>: <span class="pl-s"><span class="pl-pds">'</span>3.8<span class="pl-pds">'</span></span>

<span class="pl-ent">services</span>:
  <span class="pl-ent">config-server</span>:
    <span class="pl-ent">image</span>: <span class="pl-s"><span class="pl-pds">"</span>${IMAGE_TAG_CONFIG_SERVER}<span class="pl-pds">"</span></span>
    <span class="pl-ent">networks</span>:
      - <span class="pl-s">clarusnet</span>
    <span class="pl-ent">ports</span>:
      - <span class="pl-c1">8888:8888</span>

  <span class="pl-ent">discovery-server</span>:
    <span class="pl-ent">image</span>: <span class="pl-s"><span class="pl-pds">"</span>${IMAGE_TAG_DISCOVERY_SERVER}<span class="pl-pds">"</span></span>
    <span class="pl-ent">depends_on</span>:
      - <span class="pl-s">config-server</span>
    <span class="pl-ent">entrypoint</span>: <span class="pl-s">["./dockerize","-wait=tcp://config-server:8888","-timeout=60s","--","java", "-Djava.security.egd=file:/dev/./urandom","-jar","/app.jar"]</span>
    <span class="pl-ent">networks</span>:
      - <span class="pl-s">clarusnet</span>
    <span class="pl-ent">ports</span>:
      - <span class="pl-c1">8761:8761</span>

  <span class="pl-ent">customers-service</span>:
    <span class="pl-ent">image</span>: <span class="pl-s"><span class="pl-pds">"</span>${IMAGE_TAG_CUSTOMERS_SERVICE}<span class="pl-pds">"</span></span>
    <span class="pl-ent">deploy</span>:
      <span class="pl-ent">replicas</span>: <span class="pl-c1">3</span>
      <span class="pl-ent">update_config</span>:
          <span class="pl-ent">parallelism</span>: <span class="pl-c1">2</span>
          <span class="pl-ent">delay</span>: <span class="pl-c1">5s</span>
          <span class="pl-ent">order</span>: <span class="pl-s">start-first</span>
    <span class="pl-ent">depends_on</span>:
      - <span class="pl-s">config-server</span>
      - <span class="pl-s">discovery-server</span>
    <span class="pl-ent">entrypoint</span>: <span class="pl-s">["./dockerize","-wait=tcp://discovery-server:8761","-timeout=60s","--","java", "-Djava.security.egd=file:/dev/./urandom","-jar","/app.jar"]</span>
    <span class="pl-ent">networks</span>:
      - <span class="pl-s">clarusnet</span>
    <span class="pl-ent">ports</span>:
      - <span class="pl-c1">8081:8081</span>

  <span class="pl-ent">visits-service</span>:
    <span class="pl-ent">image</span>: <span class="pl-s"><span class="pl-pds">"</span>${IMAGE_TAG_VISITS_SERVICE}<span class="pl-pds">"</span></span>
    <span class="pl-ent">deploy</span>:
      <span class="pl-ent">replicas</span>: <span class="pl-c1">3</span>
      <span class="pl-ent">update_config</span>:
          <span class="pl-ent">parallelism</span>: <span class="pl-c1">2</span>
          <span class="pl-ent">delay</span>: <span class="pl-c1">5s</span>
          <span class="pl-ent">order</span>: <span class="pl-s">start-first</span>
    <span class="pl-ent">depends_on</span>:
      - <span class="pl-s">config-server</span>
      - <span class="pl-s">discovery-server</span>
    <span class="pl-ent">entrypoint</span>: <span class="pl-s">["./dockerize","-wait=tcp://discovery-server:8761","-timeout=60s","--","java", "-Djava.security.egd=file:/dev/./urandom","-jar","/app.jar"]</span>
    <span class="pl-ent">networks</span>:
      - <span class="pl-s">clarusnet</span>
    <span class="pl-ent">ports</span>:
      - <span class="pl-c1">8082:8082</span>

  <span class="pl-ent">vets-service</span>:
    <span class="pl-ent">image</span>: <span class="pl-s"><span class="pl-pds">"</span>${IMAGE_TAG_VETS_SERVICE}<span class="pl-pds">"</span></span>
    <span class="pl-ent">deploy</span>:
      <span class="pl-ent">replicas</span>: <span class="pl-c1">3</span>
      <span class="pl-ent">update_config</span>:
          <span class="pl-ent">parallelism</span>: <span class="pl-c1">2</span>
          <span class="pl-ent">delay</span>: <span class="pl-c1">5s</span>
          <span class="pl-ent">order</span>: <span class="pl-s">start-first</span>
    <span class="pl-ent">depends_on</span>:
      - <span class="pl-s">config-server</span>
      - <span class="pl-s">discovery-server</span>
    <span class="pl-ent">entrypoint</span>: <span class="pl-s">["./dockerize","-wait=tcp://discovery-server:8761","-timeout=60s","--","java", "-Djava.security.egd=file:/dev/./urandom","-jar","/app.jar"]</span>
    <span class="pl-ent">networks</span>:
      - <span class="pl-s">clarusnet</span>
    <span class="pl-ent">ports</span>:
      - <span class="pl-c1">8083:8083</span>

  <span class="pl-ent">api-gateway</span>:
    <span class="pl-ent">image</span>: <span class="pl-s"><span class="pl-pds">"</span>${IMAGE_TAG_API_GATEWAY}<span class="pl-pds">"</span></span>
    <span class="pl-ent">deploy</span>:
      <span class="pl-ent">replicas</span>: <span class="pl-c1">3</span>
      <span class="pl-ent">update_config</span>:
          <span class="pl-ent">parallelism</span>: <span class="pl-c1">2</span>
          <span class="pl-ent">delay</span>: <span class="pl-c1">5s</span>
          <span class="pl-ent">order</span>: <span class="pl-s">start-first</span>
    <span class="pl-ent">depends_on</span>:
      - <span class="pl-s">config-server</span>
      - <span class="pl-s">discovery-server</span>
    <span class="pl-ent">entrypoint</span>: <span class="pl-s">["./dockerize","-wait=tcp://discovery-server:8761","-timeout=60s","--","java", "-Djava.security.egd=file:/dev/./urandom","-jar","/app.jar"]</span>
    <span class="pl-ent">networks</span>:
      - <span class="pl-s">clarusnet</span>
    <span class="pl-ent">ports</span>:
      - <span class="pl-c1">8080:8080</span>

  <span class="pl-ent">tracing-server</span>:
    <span class="pl-ent">image</span>: <span class="pl-s">openzipkin/zipkin</span>
    <span class="pl-ent">environment</span>:
      - <span class="pl-s">JAVA_OPTS=-XX:+UnlockExperimentalVMOptions -Djava.security.egd=file:/dev/./urandom</span>
    <span class="pl-ent">networks</span>:
      - <span class="pl-s">clarusnet</span>
    <span class="pl-ent">ports</span>:
      - <span class="pl-c1">9411:9411</span>

  <span class="pl-ent">admin-server</span>:
    <span class="pl-ent">image</span>: <span class="pl-s"><span class="pl-pds">"</span>${IMAGE_TAG_ADMIN_SERVER}<span class="pl-pds">"</span></span>
    <span class="pl-ent">depends_on</span>:
      - <span class="pl-s">config-server</span>
      - <span class="pl-s">discovery-server</span>
    <span class="pl-ent">entrypoint</span>: <span class="pl-s">["./dockerize","-wait=tcp://discovery-server:8761","-timeout=60s","--","java", "-Djava.security.egd=file:/dev/./urandom","-jar","/app.jar"]</span>
    <span class="pl-ent">networks</span>:
      - <span class="pl-s">clarusnet</span>
    <span class="pl-ent">ports</span>:
      - <span class="pl-c1">9090:9090</span>

  <span class="pl-ent">hystrix-dashboard</span>:
    <span class="pl-ent">image</span>: <span class="pl-s"><span class="pl-pds">"</span>${IMAGE_TAG_HYSTRIX_DASHBOARD}<span class="pl-pds">"</span></span>
    <span class="pl-ent">depends_on</span>:
      - <span class="pl-s">config-server</span>
      - <span class="pl-s">discovery-server</span>
    <span class="pl-ent">entrypoint</span>: <span class="pl-s">["./dockerize","-wait=tcp://discovery-server:8761","-timeout=60s","--","java", "-Djava.security.egd=file:/dev/./urandom","-jar","/app.jar"]</span>
    <span class="pl-ent">networks</span>:
      - <span class="pl-s">clarusnet</span>
    <span class="pl-ent">ports</span>:
      - <span class="pl-c1">7979:7979</span>

  <span class="pl-c"><span class="pl-c">#</span># Grafana / Prometheus</span>

  <span class="pl-ent">grafana-server</span>:
    <span class="pl-ent">image</span>: <span class="pl-s"><span class="pl-pds">"</span>${IMAGE_TAG_GRAFANA_SERVICE}<span class="pl-pds">"</span></span>
    <span class="pl-ent">networks</span>:
      - <span class="pl-s">clarusnet</span>
    <span class="pl-ent">ports</span>:
      - <span class="pl-c1">3000:3000</span>

  <span class="pl-ent">prometheus-server</span>:
    <span class="pl-ent">image</span>: <span class="pl-s"><span class="pl-pds">"</span>${IMAGE_TAG_PROMETHEUS_SERVICE}<span class="pl-pds">"</span></span>
    <span class="pl-ent">networks</span>:
      - <span class="pl-s">clarusnet</span>
    <span class="pl-ent">ports</span>:
      - <span class="pl-c1">9091:9090</span>
    
  <span class="pl-ent">mysql-server</span>:
    <span class="pl-ent">image</span>: <span class="pl-s">mysql:5.7.8</span>
    <span class="pl-ent">environment</span>: 
      <span class="pl-ent">MYSQL_ROOT_PASSWORD</span>: <span class="pl-s">petclinic</span>
      <span class="pl-ent">MYSQL_DATABASE</span>: <span class="pl-s">petclinic</span>
    <span class="pl-ent">networks</span>:
      - <span class="pl-s">clarusnet</span>
    <span class="pl-ent">ports</span>:
      - <span class="pl-c1">3306:3306</span>

<span class="pl-ent">networks</span>:
  <span class="pl-ent">clarusnet</span>:
    <span class="pl-ent">driver</span>: <span class="pl-s">overlay</span></pre></div>
<ul dir="auto">
<li>Create Ansible playbook for deploying app on Docker swarm using docker compose file and save it as <code>pb_deploy_app_on_docker_swarm.yaml</code> under <code>ansible/playbooks</code> folder.</li>
</ul>
<div class="highlight highlight-source-yaml position-relative overflow-auto" data-snippet-clipboard-copy-content="- hosts: role_grand_master
  tasks:
  - name: Copy docker compose file to grand master
    copy:
      src: &quot;{{ workspace }}/docker-compose-swarm-dev-tagged.yml&quot;
      dest: /home/ec2-user/docker-compose-swarm-dev-tagged.yml

  - name: get login credentials for ecr
    shell: &quot;export PATH=$PATH:/usr/local/bin/ &amp;&amp; aws ecr get-login-password --region {{ aws_region }} | docker login --username AWS --password-stdin {{ ecr_registry }}&quot;

  - name: deploy the app stack on swarm
    shell: &quot;docker stack deploy --with-registry-auth -c /home/ec2-user/docker-compose-swarm-dev-tagged.yml {{ app_name }}&quot;
    register: output

  - debug: msg=&quot;{{ output.stdout }}&quot;"><pre>- <span class="pl-ent">hosts</span>: <span class="pl-s">role_grand_master</span>
  <span class="pl-ent">tasks</span>:
  - <span class="pl-ent">name</span>: <span class="pl-s">Copy docker compose file to grand master</span>
    <span class="pl-ent">copy</span>:
      <span class="pl-ent">src</span>: <span class="pl-s"><span class="pl-pds">"</span>{{ workspace }}/docker-compose-swarm-dev-tagged.yml<span class="pl-pds">"</span></span>
      <span class="pl-ent">dest</span>: <span class="pl-s">/home/ec2-user/docker-compose-swarm-dev-tagged.yml</span>

  - <span class="pl-ent">name</span>: <span class="pl-s">get login credentials for ecr</span>
    <span class="pl-ent">shell</span>: <span class="pl-s"><span class="pl-pds">"</span>export PATH=$PATH:/usr/local/bin/ &amp;&amp; aws ecr get-login-password --region {{ aws_region }} | docker login --username AWS --password-stdin {{ ecr_registry }}<span class="pl-pds">"</span></span>

  - <span class="pl-ent">name</span>: <span class="pl-s">deploy the app stack on swarm</span>
    <span class="pl-ent">shell</span>: <span class="pl-s"><span class="pl-pds">"</span>docker stack deploy --with-registry-auth -c /home/ec2-user/docker-compose-swarm-dev-tagged.yml {{ app_name }}<span class="pl-pds">"</span></span>
    <span class="pl-ent">register</span>: <span class="pl-s">output</span>

  - <span class="pl-ent">debug</span>: <span class="pl-s">msg="{{ output.stdout }}"</span></pre></div>
<ul dir="auto">
<li>Prepare a script to deploy the application on docker swarm and save it as <code>deploy_app_on_docker_swarm.sh</code> under <code>ansible/scripts</code> folder.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="PATH=&quot;$PATH:/usr/local/bin&quot;
APP_NAME=&quot;petclinic&quot;
envsubst &lt; docker-compose-swarm-dev.yml &gt; docker-compose-swarm-dev-tagged.yml
ansible-playbook -i ./ansible/inventory/dev_stack_dynamic_inventory_aws_ec2.yaml -b --extra-vars &quot;workspace=${WORKSPACE} app_name=${APP_NAME} aws_region=${AWS_REGION} ecr_registry=${ECR_REGISTRY}&quot; ./ansible/playbooks/pb_deploy_app_on_docker_swarm.yaml"><pre>PATH=<span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">$PATH</span>:/usr/local/bin<span class="pl-pds">"</span></span>
APP_NAME=<span class="pl-s"><span class="pl-pds">"</span>petclinic<span class="pl-pds">"</span></span>
envsubst <span class="pl-k">&lt;</span> docker-compose-swarm-dev.yml <span class="pl-k">&gt;</span> docker-compose-swarm-dev-tagged.yml
ansible-playbook -i ./ansible/inventory/dev_stack_dynamic_inventory_aws_ec2.yaml -b --extra-vars <span class="pl-s"><span class="pl-pds">"</span>workspace=<span class="pl-smi">${WORKSPACE}</span> app_name=<span class="pl-smi">${APP_NAME}</span> aws_region=<span class="pl-smi">${AWS_REGION}</span> ecr_registry=<span class="pl-smi">${ECR_REGISTRY}</span><span class="pl-pds">"</span></span> ./ansible/playbooks/pb_deploy_app_on_docker_swarm.yaml</pre></div>
<ul dir="auto">
<li>Create Selenium dummy test with name of <code>dummy_selenium_test_headless.py</code> with following content to check the setup for the Selenium jobs and save it under <code>selenium-jobs</code> folder.</li>
</ul>
<div class="highlight highlight-source-python position-relative overflow-auto" data-snippet-clipboard-copy-content="from selenium import webdriver

chrome_options = webdriver.ChromeOptions()
chrome_options.add_argument(&quot;headless&quot;)
chrome_options.add_argument(&quot;no-sandbox&quot;)
chrome_options.add_argument(&quot;disable-dev-shm-usage&quot;)
driver = webdriver.Chrome(options=chrome_options)

base_url = &quot;https://www.google.com/&quot;
driver.get(base_url)
source = driver.page_source

if &quot;I'm Feeling Lucky&quot; in source:
  print(&quot;Test passed&quot;)
else:
  print(&quot;Test failed&quot;)
driver.close()"><pre><span class="pl-k">from</span> <span class="pl-s1">selenium</span> <span class="pl-k">import</span> <span class="pl-s1">webdriver</span>

<span class="pl-s1">chrome_options</span> <span class="pl-c1">=</span> <span class="pl-s1">webdriver</span>.<span class="pl-v">ChromeOptions</span>()
<span class="pl-s1">chrome_options</span>.<span class="pl-en">add_argument</span>(<span class="pl-s">"headless"</span>)
<span class="pl-s1">chrome_options</span>.<span class="pl-en">add_argument</span>(<span class="pl-s">"no-sandbox"</span>)
<span class="pl-s1">chrome_options</span>.<span class="pl-en">add_argument</span>(<span class="pl-s">"disable-dev-shm-usage"</span>)
<span class="pl-s1">driver</span> <span class="pl-c1">=</span> <span class="pl-s1">webdriver</span>.<span class="pl-v">Chrome</span>(<span class="pl-s1">options</span><span class="pl-c1">=</span><span class="pl-s1">chrome_options</span>)

<span class="pl-s1">base_url</span> <span class="pl-c1">=</span> <span class="pl-s">"https://www.google.com/"</span>
<span class="pl-s1">driver</span>.<span class="pl-en">get</span>(<span class="pl-s1">base_url</span>)
<span class="pl-s1">source</span> <span class="pl-c1">=</span> <span class="pl-s1">driver</span>.<span class="pl-s1">page_source</span>

<span class="pl-k">if</span> <span class="pl-s">"I'm Feeling Lucky"</span> <span class="pl-c1">in</span> <span class="pl-s1">source</span>:
  <span class="pl-en">print</span>(<span class="pl-s">"Test passed"</span>)
<span class="pl-k">else</span>:
  <span class="pl-en">print</span>(<span class="pl-s">"Test failed"</span>)
<span class="pl-s1">driver</span>.<span class="pl-en">close</span>()</pre></div>
<ul dir="auto">
<li>Create Ansible playbook for running dummy selenium job and save it as <code>pb_run_dummy_selenium_job.yaml</code> under <code>ansible/playbooks</code> folder.</li>
</ul>
<div class="highlight highlight-source-yaml position-relative overflow-auto" data-snippet-clipboard-copy-content="- hosts: all
  tasks:
  - name: run dummy selenium job
    shell: &quot;docker run --rm -v {{ workspace }}:{{ workspace }} -w {{ workspace }} callahanclarus/selenium-py-chrome:latest python {{ item }}&quot;
    with_fileglob: &quot;{{ workspace }}/selenium-jobs/dummy*.py&quot;
    register: output
  
  - name: show results
    debug: msg=&quot;{{ item.stdout }}&quot;
    with_items: &quot;{{ output.results }}&quot;"><pre>- <span class="pl-ent">hosts</span>: <span class="pl-s">all</span>
  <span class="pl-ent">tasks</span>:
  - <span class="pl-ent">name</span>: <span class="pl-s">run dummy selenium job</span>
    <span class="pl-ent">shell</span>: <span class="pl-s"><span class="pl-pds">"</span>docker run --rm -v {{ workspace }}:{{ workspace }} -w {{ workspace }} callahanclarus/selenium-py-chrome:latest python {{ item }}<span class="pl-pds">"</span></span>
    <span class="pl-ent">with_fileglob</span>: <span class="pl-s"><span class="pl-pds">"</span>{{ workspace }}/selenium-jobs/dummy*.py<span class="pl-pds">"</span></span>
    <span class="pl-ent">register</span>: <span class="pl-s">output</span>
  
  - <span class="pl-ent">name</span>: <span class="pl-s">show results</span>
    <span class="pl-ent">debug</span>: <span class="pl-s">msg="{{ item.stdout }}"</span>
    <span class="pl-ent">with_items</span>: <span class="pl-s"><span class="pl-pds">"</span>{{ output.results }}<span class="pl-pds">"</span></span></pre></div>
<ul dir="auto">
<li>Prepare a script to run the playbook for dummy selenium job on Jenkins Server (localhost) and save it as <code>run_dummy_selenium_job.sh</code> under <code>ansible/scripts</code> folder.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="PATH=&quot;$PATH:/usr/local/bin&quot;
ansible-playbook --connection=local --inventory 127.0.0.1, --extra-vars &quot;workspace=${WORKSPACE}&quot; ./ansible/playbooks/pb_run_dummy_selenium_job.yaml"><pre>PATH=<span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">$PATH</span>:/usr/local/bin<span class="pl-pds">"</span></span>
ansible-playbook --connection=local --inventory 127.0.0.1, --extra-vars <span class="pl-s"><span class="pl-pds">"</span>workspace=<span class="pl-smi">${WORKSPACE}</span><span class="pl-pds">"</span></span> ./ansible/playbooks/pb_run_dummy_selenium_job.yaml</pre></div>
<ul dir="auto">
<li>Commit the change, then push the scripts for dummy selenium job to the remote repo.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="git add .
git commit -m 'added scripts for running dummy selenium job'
git push --set-upstream origin feature/msp-17"><pre>git add <span class="pl-c1">.</span>
git commit -m <span class="pl-s"><span class="pl-pds">'</span>added scripts for running dummy selenium job<span class="pl-pds">'</span></span>
git push --set-upstream origin feature/msp-17</pre></div>
<ul dir="auto">
<li>
<p dir="auto">Create a Jenkins job with name of <code>test-running-dummy-selenium-job</code> to check the setup for selenium tests by running dummy selenium job on <code>feature/msp-17</code> branch.</p>
</li>
<li>
<p dir="auto">Create Ansible playbook for running all selenium jobs under <code>selenium-jobs</code> folder and save it as <code>pb_run_selenium_jobs.yaml</code> under <code>ansible/playbooks</code> folder.</p>
</li>
</ul>
<div class="highlight highlight-source-yaml position-relative overflow-auto" data-snippet-clipboard-copy-content="- hosts: all
  tasks:
  - name: run all selenium jobs
    shell: &quot;docker run --rm --env MASTER_PUBLIC_IP={{ master_public_ip }} -v {{ workspace }}:{{ workspace }} -w {{ workspace }} callahanclarus/selenium-py-chrome:latest python {{ item }}&quot;
    register: output
    with_fileglob: &quot;{{ workspace }}/selenium-jobs/test*.py&quot;
  
  - name: show results
    debug: msg=&quot;{{ item.stdout }}&quot;
    with_items: &quot;{{ output.results }}&quot;"><pre>- <span class="pl-ent">hosts</span>: <span class="pl-s">all</span>
  <span class="pl-ent">tasks</span>:
  - <span class="pl-ent">name</span>: <span class="pl-s">run all selenium jobs</span>
    <span class="pl-ent">shell</span>: <span class="pl-s"><span class="pl-pds">"</span>docker run --rm --env MASTER_PUBLIC_IP={{ master_public_ip }} -v {{ workspace }}:{{ workspace }} -w {{ workspace }} callahanclarus/selenium-py-chrome:latest python {{ item }}<span class="pl-pds">"</span></span>
    <span class="pl-ent">register</span>: <span class="pl-s">output</span>
    <span class="pl-ent">with_fileglob</span>: <span class="pl-s"><span class="pl-pds">"</span>{{ workspace }}/selenium-jobs/test*.py<span class="pl-pds">"</span></span>
  
  - <span class="pl-ent">name</span>: <span class="pl-s">show results</span>
    <span class="pl-ent">debug</span>: <span class="pl-s">msg="{{ item.stdout }}"</span>
    <span class="pl-ent">with_items</span>: <span class="pl-s"><span class="pl-pds">"</span>{{ output.results }}<span class="pl-pds">"</span></span></pre></div>
<ul dir="auto">
<li>Prepare a script to run the playbook for all selenium jobs on Jenkins Server (localhost) and save it as <code>run_selenium_jobs.sh</code> under <code>ansible/scripts</code> folder.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="PATH=&quot;$PATH:/usr/local/bin&quot;
ansible-playbook -vvv --connection=local --inventory 127.0.0.1, --extra-vars &quot;workspace=${WORKSPACE} master_public_ip=${GRAND_MASTER_PUBLIC_IP}&quot; ./ansible/playbooks/pb_run_selenium_jobs.yaml"><pre>PATH=<span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">$PATH</span>:/usr/local/bin<span class="pl-pds">"</span></span>
ansible-playbook -vvv --connection=local --inventory 127.0.0.1, --extra-vars <span class="pl-s"><span class="pl-pds">"</span>workspace=<span class="pl-smi">${WORKSPACE}</span> master_public_ip=<span class="pl-smi">${GRAND_MASTER_PUBLIC_IP}</span><span class="pl-pds">"</span></span> ./ansible/playbooks/pb_run_selenium_jobs.yaml</pre></div>
<ul dir="auto">
<li>Prepare a Jenkinsfile for <code>petclinic-nightly</code> builds and save it as <code>jenkinsfile-petclinic-nightly</code> under <code>jenkins</code> folder.</li>
</ul>
<div class="highlight highlight-source-groovy position-relative overflow-auto" data-snippet-clipboard-copy-content="pipeline {
    agent any
    environment {
        PATH=sh(script:&quot;echo $PATH:/usr/local/bin&quot;, returnStdout:true).trim()
        APP_NAME=&quot;petclinic&quot;
        APP_STACK_NAME=&quot;Callet-${APP_NAME}-app-${BUILD_NUMBER}&quot;
        APP_REPO_NAME=&quot;claruswayset-repo/${APP_NAME}-app-dev&quot;
        AWS_ACCOUNT_ID=sh(script:'export PATH=&quot;$PATH:/usr/local/bin&quot; &amp;&amp; aws sts get-caller-identity --query Account --output text', returnStdout:true).trim()
        AWS_REGION=&quot;us-east-1&quot;
        ECR_REGISTRY=&quot;${AWS_ACCOUNT_ID}.dkr.ecr.${AWS_REGION}.amazonaws.com&quot;
        CFN_KEYPAIR=&quot;call-${APP_NAME}-dev-${BUILD_NUMBER}.key&quot;
        CFN_TEMPLATE=&quot;./infrastructure/dev-docker-swarm-infrastructure-cfn-template.yml&quot;
        ANSIBLE_PRIVATE_KEY_FILE=&quot;${WORKSPACE}/${CFN_KEYPAIR}&quot;
        ANSIBLE_HOST_KEY_CHECKING=&quot;False&quot;
    }
    stages {
        stage('Create ECR Repo') {
            steps {
                echo &quot;Creating ECR Repo for ${APP_NAME} app&quot;
                sh &quot;&quot;&quot;
                aws ecr create-repository \
                    --repository-name ${APP_REPO_NAME} \
                    --image-scanning-configuration scanOnPush=false \
                    --image-tag-mutability MUTABLE \
                    --region ${AWS_REGION}
                &quot;&quot;&quot;
            }
        }
        stage('Package Application') {
            steps {
                echo 'Packaging the app into jars with maven'
                sh &quot;. ./jenkins/package-with-maven-container.sh&quot;
            }
        }
        stage('Prepare Tags for Docker Images') {
            steps {
                echo 'Preparing Tags for Docker Images'
                script {
                    MVN_VERSION=sh(script:'. ${WORKSPACE}/spring-petclinic-admin-server/target/maven-archiver/pom.properties &amp;&amp; echo $version', returnStdout:true).trim()
                    env.IMAGE_TAG_ADMIN_SERVER=&quot;${ECR_REGISTRY}/${APP_REPO_NAME}:admin-server-v${MVN_VERSION}-b${BUILD_NUMBER}&quot;
                    MVN_VERSION=sh(script:'. ${WORKSPACE}/spring-petclinic-api-gateway/target/maven-archiver/pom.properties &amp;&amp; echo $version', returnStdout:true).trim()
                    env.IMAGE_TAG_API_GATEWAY=&quot;${ECR_REGISTRY}/${APP_REPO_NAME}:api-gateway-v${MVN_VERSION}-b${BUILD_NUMBER}&quot;
                    MVN_VERSION=sh(script:'. ${WORKSPACE}/spring-petclinic-config-server/target/maven-archiver/pom.properties &amp;&amp; echo $version', returnStdout:true).trim()
                    env.IMAGE_TAG_CONFIG_SERVER=&quot;${ECR_REGISTRY}/${APP_REPO_NAME}:config-server-v${MVN_VERSION}-b${BUILD_NUMBER}&quot;
                    MVN_VERSION=sh(script:'. ${WORKSPACE}/spring-petclinic-customers-service/target/maven-archiver/pom.properties &amp;&amp; echo $version', returnStdout:true).trim()
                    env.IMAGE_TAG_CUSTOMERS_SERVICE=&quot;${ECR_REGISTRY}/${APP_REPO_NAME}:customers-service-v${MVN_VERSION}-b${BUILD_NUMBER}&quot;
                    MVN_VERSION=sh(script:'. ${WORKSPACE}/spring-petclinic-discovery-server/target/maven-archiver/pom.properties &amp;&amp; echo $version', returnStdout:true).trim()
                    env.IMAGE_TAG_DISCOVERY_SERVER=&quot;${ECR_REGISTRY}/${APP_REPO_NAME}:discovery-server-v${MVN_VERSION}-b${BUILD_NUMBER}&quot;
                    MVN_VERSION=sh(script:'. ${WORKSPACE}/spring-petclinic-hystrix-dashboard/target/maven-archiver/pom.properties &amp;&amp; echo $version', returnStdout:true).trim()
                    env.IMAGE_TAG_HYSTRIX_DASHBOARD=&quot;${ECR_REGISTRY}/${APP_REPO_NAME}:hystrix-dashboard-v${MVN_VERSION}-b${BUILD_NUMBER}&quot;
                    MVN_VERSION=sh(script:'. ${WORKSPACE}/spring-petclinic-vets-service/target/maven-archiver/pom.properties &amp;&amp; echo $version', returnStdout:true).trim()
                    env.IMAGE_TAG_VETS_SERVICE=&quot;${ECR_REGISTRY}/${APP_REPO_NAME}:vets-service-v${MVN_VERSION}-b${BUILD_NUMBER}&quot;
                    MVN_VERSION=sh(script:'. ${WORKSPACE}/spring-petclinic-visits-service/target/maven-archiver/pom.properties &amp;&amp; echo $version', returnStdout:true).trim()
                    env.IMAGE_TAG_VISITS_SERVICE=&quot;${ECR_REGISTRY}/${APP_REPO_NAME}:visits-service-v${MVN_VERSION}-b${BUILD_NUMBER}&quot;
                    env.IMAGE_TAG_GRAFANA_SERVICE=&quot;${ECR_REGISTRY}/${APP_REPO_NAME}:grafana-service&quot;
                    env.IMAGE_TAG_PROMETHEUS_SERVICE=&quot;${ECR_REGISTRY}/${APP_REPO_NAME}:prometheus-service&quot;
                }
            }
        }
        stage('Build App Docker Images') {
            steps {
                echo 'Building App Dev Images'
                sh &quot;. ./jenkins/build-dev-docker-images-for-ecr.sh&quot;
                sh 'docker image ls'
            }
        }
        stage('Push Images to ECR Repo') {
            steps {
                echo &quot;Pushing ${APP_NAME} App Images to ECR Repo&quot;
                sh &quot;. ./jenkins/push-dev-docker-images-to-ecr.sh&quot;
            }
        }
        stage('Create Key Pair for Ansible') {
            steps {
                echo &quot;Creating Key Pair for ${APP_NAME} App&quot;
                sh &quot;aws ec2 create-key-pair --region ${AWS_REGION} --key-name ${CFN_KEYPAIR} --query KeyMaterial --output text &gt; ${CFN_KEYPAIR}&quot;
                sh &quot;chmod 400 ${CFN_KEYPAIR}&quot;
            }
        }
        stage('Create QA Automation Infrastructure') {
            steps {
                echo 'Creating QA Automation Infrastructure for Dev Environment with Cloudfomation'
                sh &quot;aws cloudformation create-stack --region ${AWS_REGION} --stack-name ${APP_STACK_NAME} --capabilities CAPABILITY_IAM --template-body file://${CFN_TEMPLATE} --parameters ParameterKey=KeyPairName,ParameterValue=${CFN_KEYPAIR}&quot;
                sh &quot;aws cloudformation wait stack-create-complete --stack-name ${APP_STACK_NAME}&quot; 
                script {
                    echo &quot;Docker Grand Master is not UP and running yet.&quot;
                    env.id = sh(script: 'aws ec2 describe-instances --filters Name=tag-value,Values=grand-master Name=tag-value,Values=${APP_STACK_NAME} Name=instance-state-name,Values=running --query Reservations[*].Instances[*].[InstanceId] --output text',  returnStdout:true).trim()
                    sh 'aws ec2 wait instance-status-ok --instance-ids $id'
                }
            }
        }

        stage('Create Docker Swarm for QA Automation Build') {
            steps {
                echo &quot;Setup Docker Swarm for QA Automation Build for ${APP_NAME} App&quot;
                echo &quot;Update dynamic environment&quot;
                sh &quot;sed -i 's/APP_STACK_NAME/${APP_STACK_NAME}/' ./ansible/inventory/dev_stack_dynamic_inventory_aws_ec2.yaml&quot;
                echo &quot;Swarm Setup for all nodes (instances)&quot;
                sh &quot;ansible-playbook -i ./ansible/inventory/dev_stack_dynamic_inventory_aws_ec2.yaml -b ./ansible/playbooks/pb_setup_for_all_docker_swarm_instances.yaml&quot;
                echo &quot;Swarm Setup for Grand Master node&quot;
                sh &quot;ansible-playbook -i ./ansible/inventory/dev_stack_dynamic_inventory_aws_ec2.yaml -b ./ansible/playbooks/pb_initialize_docker_swarm.yaml&quot;
                echo &quot;Swarm Setup for Other Managers nodes&quot;
                sh &quot;ansible-playbook -i ./ansible/inventory/dev_stack_dynamic_inventory_aws_ec2.yaml -b ./ansible/playbooks/pb_join_docker_swarm_managers.yaml&quot;
                echo &quot;Swarm Setup for Workers nodes&quot;
                sh &quot;ansible-playbook -i ./ansible/inventory/dev_stack_dynamic_inventory_aws_ec2.yaml -b ./ansible/playbooks/pb_join_docker_swarm_workers.yaml&quot;
            }
        }

        stage('Deploy App on Docker Swarm'){
            steps {
                echo 'Deploying App on Swarm'
                sh 'envsubst &lt; docker-compose-swarm-dev.yml &gt; docker-compose-swarm-dev-tagged.yml'
                sh 'ansible-playbook -i ./ansible/inventory/dev_stack_dynamic_inventory_aws_ec2.yaml -b --extra-vars &quot;workspace=${WORKSPACE} app_name=${APP_NAME} aws_region=${AWS_REGION} ecr_registry=${ECR_REGISTRY}&quot; ./ansible/playbooks/pb_deploy_app_on_docker_swarm.yaml'
            }
        }

        stage('Test the Application Deployment'){
            steps {
                echo &quot;Check if the ${APP_NAME} app is ready or not&quot;
                script {
                    env.GRAND_MASTER_PUBLIC_IP = sh(script:&quot;aws ec2 describe-instances --region ${AWS_REGION} --filters Name=tag-value,Values=grand-master Name=tag-value,Values=${APP_STACK_NAME} --query Reservations[*].Instances[*].[PublicIpAddress] --output text&quot;, returnStdout:true).trim()
                    while(true) {
                        try{
                            sh &quot;curl -s ${GRAND_MASTER_PUBLIC_IP}:8080&quot;
                            echo &quot;${APP_NAME} app is successfully deployed.&quot;
                            break
                        }
                        catch(Exception){
                            echo &quot;Could not connect to ${APP_NAME} app&quot;
                            sleep(5)
                        }
                    }
                }
            }
        }

        stage('Run QA Automation Tests'){
            steps {
                echo &quot;Run the Selenium Functional Test on QA Environment&quot;
                sh 'ansible-playbook -vvv --connection=local --inventory 127.0.0.1, --extra-vars &quot;workspace=${WORKSPACE} master_public_ip=${GRAND_MASTER_PUBLIC_IP}&quot; ./ansible/playbooks/pb_run_selenium_jobs.yaml'
            }
        }
    }

    post {
        always {
            echo 'Deleting all local images'
            sh 'docker image prune -af'
            echo 'Delete the Image Repository on ECR'
            sh &quot;&quot;&quot;
                aws ecr delete-repository \
                  --repository-name ${APP_REPO_NAME} \
                  --region ${AWS_REGION}\
                  --force
                &quot;&quot;&quot;
            echo 'Tear down the Docker Swarm infrastructure using AWS CLI'
            sh &quot;aws cloudformation delete-stack --region ${AWS_REGION} --stack-name ${APP_STACK_NAME}&quot;
            echo &quot;Delete existing key pair using AWS CLI&quot;
            sh &quot;aws ec2 delete-key-pair --region ${AWS_REGION} --key-name ${CFN_KEYPAIR}&quot;
            sh &quot;rm -rf ${CFN_KEYPAIR}&quot;
        }
    }
}"><pre>pipeline {
    agent any
    environment {
        <span class="pl-c1">PATH</span><span class="pl-k">=</span>sh(<span class="pl-c1">script</span>:<span class="pl-s"><span class="pl-pds">"</span>echo <span class="pl-smi">$P<span class="pl-smi">ATH</span></span>:/usr/local/bin<span class="pl-pds">"</span></span>, <span class="pl-c1">returnStdout</span>:<span class="pl-c1">true</span>)<span class="pl-k">.</span>trim()
        <span class="pl-c1">APP_NAME</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>petclinic<span class="pl-pds">"</span></span>
        <span class="pl-c1">APP_STACK_NAME</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>Callet-<span class="pl-s1"><span class="pl-pse">${</span>APP_NAME<span class="pl-pse">}</span></span>-app-<span class="pl-s1"><span class="pl-pse">${</span>BUILD_NUMBER<span class="pl-pse">}</span></span><span class="pl-pds">"</span></span>
        <span class="pl-c1">APP_REPO_NAME</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>claruswayset-repo/<span class="pl-s1"><span class="pl-pse">${</span>APP_NAME<span class="pl-pse">}</span></span>-app-dev<span class="pl-pds">"</span></span>
        <span class="pl-c1">AWS_ACCOUNT_ID</span><span class="pl-k">=</span>sh(<span class="pl-c1">script</span>:<span class="pl-s"><span class="pl-pds">'</span>export PATH="$PATH:/usr/local/bin" &amp;&amp; aws sts get-caller-identity --query Account --output text<span class="pl-pds">'</span></span>, <span class="pl-c1">returnStdout</span>:<span class="pl-c1">true</span>)<span class="pl-k">.</span>trim()
        <span class="pl-c1">AWS_REGION</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>us-east-1<span class="pl-pds">"</span></span>
        <span class="pl-c1">ECR_REGISTRY</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span><span class="pl-s1"><span class="pl-pse">${</span>AWS_ACCOUNT_ID<span class="pl-pse">}</span></span>.dkr.ecr.<span class="pl-s1"><span class="pl-pse">${</span>AWS_REGION<span class="pl-pse">}</span></span>.amazonaws.com<span class="pl-pds">"</span></span>
        <span class="pl-c1">CFN_KEYPAIR</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>call-<span class="pl-s1"><span class="pl-pse">${</span>APP_NAME<span class="pl-pse">}</span></span>-dev-<span class="pl-s1"><span class="pl-pse">${</span>BUILD_NUMBER<span class="pl-pse">}</span></span>.key<span class="pl-pds">"</span></span>
        <span class="pl-c1">CFN_TEMPLATE</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>./infrastructure/dev-docker-swarm-infrastructure-cfn-template.yml<span class="pl-pds">"</span></span>
        <span class="pl-c1">ANSIBLE_PRIVATE_KEY_FILE</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span><span class="pl-s1"><span class="pl-pse">${</span>WORKSPACE<span class="pl-pse">}</span></span>/<span class="pl-s1"><span class="pl-pse">${</span>CFN_KEYPAIR<span class="pl-pse">}</span></span><span class="pl-pds">"</span></span>
        <span class="pl-c1">ANSIBLE_HOST_KEY_CHECKING</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>False<span class="pl-pds">"</span></span>
    }
    stages {
        stage(<span class="pl-s"><span class="pl-pds">'</span>Create ECR Repo<span class="pl-pds">'</span></span>) {
            steps {
                echo <span class="pl-s"><span class="pl-pds">"</span>Creating ECR Repo for <span class="pl-s1"><span class="pl-pse">${</span>APP_NAME<span class="pl-pse">}</span></span> app<span class="pl-pds">"</span></span>
                sh <span class="pl-s"><span class="pl-pds">"""</span></span>
<span class="pl-s">                aws ecr create-repository \</span>
<span class="pl-s">                    --repository-name <span class="pl-s1"><span class="pl-pse">${</span>APP_REPO_NAME<span class="pl-pse">}</span></span> \</span>
<span class="pl-s">                    --image-scanning-configuration scanOnPush=false \</span>
<span class="pl-s">                    --image-tag-mutability MUTABLE \</span>
<span class="pl-s">                    --region <span class="pl-s1"><span class="pl-pse">${</span>AWS_REGION<span class="pl-pse">}</span></span></span>
<span class="pl-s">                <span class="pl-pds">"""</span></span>
            }
        }
        stage(<span class="pl-s"><span class="pl-pds">'</span>Package Application<span class="pl-pds">'</span></span>) {
            steps {
                echo <span class="pl-s"><span class="pl-pds">'</span>Packaging the app into jars with maven<span class="pl-pds">'</span></span>
                sh <span class="pl-s"><span class="pl-pds">"</span>. ./jenkins/package-with-maven-container.sh<span class="pl-pds">"</span></span>
            }
        }
        stage(<span class="pl-s"><span class="pl-pds">'</span>Prepare Tags for Docker Images<span class="pl-pds">'</span></span>) {
            steps {
                echo <span class="pl-s"><span class="pl-pds">'</span>Preparing Tags for Docker Images<span class="pl-pds">'</span></span>
                script {
                    <span class="pl-c1">MVN_VERSION</span><span class="pl-k">=</span>sh(<span class="pl-c1">script</span>:<span class="pl-s"><span class="pl-pds">'</span>. ${WORKSPACE}/spring-petclinic-admin-server/target/maven-archiver/pom.properties &amp;&amp; echo $version<span class="pl-pds">'</span></span>, <span class="pl-c1">returnStdout</span>:<span class="pl-c1">true</span>)<span class="pl-k">.</span>trim()
                    env<span class="pl-k">.</span><span class="pl-c1">IMAGE_TAG_ADMIN_SERVER</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span><span class="pl-s1"><span class="pl-pse">${</span>ECR_REGISTRY<span class="pl-pse">}</span></span>/<span class="pl-s1"><span class="pl-pse">${</span>APP_REPO_NAME<span class="pl-pse">}</span></span>:admin-server-v<span class="pl-s1"><span class="pl-pse">${</span>MVN_VERSION<span class="pl-pse">}</span></span>-b<span class="pl-s1"><span class="pl-pse">${</span>BUILD_NUMBER<span class="pl-pse">}</span></span><span class="pl-pds">"</span></span>
                    <span class="pl-c1">MVN_VERSION</span><span class="pl-k">=</span>sh(<span class="pl-c1">script</span>:<span class="pl-s"><span class="pl-pds">'</span>. ${WORKSPACE}/spring-petclinic-api-gateway/target/maven-archiver/pom.properties &amp;&amp; echo $version<span class="pl-pds">'</span></span>, <span class="pl-c1">returnStdout</span>:<span class="pl-c1">true</span>)<span class="pl-k">.</span>trim()
                    env<span class="pl-k">.</span><span class="pl-c1">IMAGE_TAG_API_GATEWAY</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span><span class="pl-s1"><span class="pl-pse">${</span>ECR_REGISTRY<span class="pl-pse">}</span></span>/<span class="pl-s1"><span class="pl-pse">${</span>APP_REPO_NAME<span class="pl-pse">}</span></span>:api-gateway-v<span class="pl-s1"><span class="pl-pse">${</span>MVN_VERSION<span class="pl-pse">}</span></span>-b<span class="pl-s1"><span class="pl-pse">${</span>BUILD_NUMBER<span class="pl-pse">}</span></span><span class="pl-pds">"</span></span>
                    <span class="pl-c1">MVN_VERSION</span><span class="pl-k">=</span>sh(<span class="pl-c1">script</span>:<span class="pl-s"><span class="pl-pds">'</span>. ${WORKSPACE}/spring-petclinic-config-server/target/maven-archiver/pom.properties &amp;&amp; echo $version<span class="pl-pds">'</span></span>, <span class="pl-c1">returnStdout</span>:<span class="pl-c1">true</span>)<span class="pl-k">.</span>trim()
                    env<span class="pl-k">.</span><span class="pl-c1">IMAGE_TAG_CONFIG_SERVER</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span><span class="pl-s1"><span class="pl-pse">${</span>ECR_REGISTRY<span class="pl-pse">}</span></span>/<span class="pl-s1"><span class="pl-pse">${</span>APP_REPO_NAME<span class="pl-pse">}</span></span>:config-server-v<span class="pl-s1"><span class="pl-pse">${</span>MVN_VERSION<span class="pl-pse">}</span></span>-b<span class="pl-s1"><span class="pl-pse">${</span>BUILD_NUMBER<span class="pl-pse">}</span></span><span class="pl-pds">"</span></span>
                    <span class="pl-c1">MVN_VERSION</span><span class="pl-k">=</span>sh(<span class="pl-c1">script</span>:<span class="pl-s"><span class="pl-pds">'</span>. ${WORKSPACE}/spring-petclinic-customers-service/target/maven-archiver/pom.properties &amp;&amp; echo $version<span class="pl-pds">'</span></span>, <span class="pl-c1">returnStdout</span>:<span class="pl-c1">true</span>)<span class="pl-k">.</span>trim()
                    env<span class="pl-k">.</span><span class="pl-c1">IMAGE_TAG_CUSTOMERS_SERVICE</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span><span class="pl-s1"><span class="pl-pse">${</span>ECR_REGISTRY<span class="pl-pse">}</span></span>/<span class="pl-s1"><span class="pl-pse">${</span>APP_REPO_NAME<span class="pl-pse">}</span></span>:customers-service-v<span class="pl-s1"><span class="pl-pse">${</span>MVN_VERSION<span class="pl-pse">}</span></span>-b<span class="pl-s1"><span class="pl-pse">${</span>BUILD_NUMBER<span class="pl-pse">}</span></span><span class="pl-pds">"</span></span>
                    <span class="pl-c1">MVN_VERSION</span><span class="pl-k">=</span>sh(<span class="pl-c1">script</span>:<span class="pl-s"><span class="pl-pds">'</span>. ${WORKSPACE}/spring-petclinic-discovery-server/target/maven-archiver/pom.properties &amp;&amp; echo $version<span class="pl-pds">'</span></span>, <span class="pl-c1">returnStdout</span>:<span class="pl-c1">true</span>)<span class="pl-k">.</span>trim()
                    env<span class="pl-k">.</span><span class="pl-c1">IMAGE_TAG_DISCOVERY_SERVER</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span><span class="pl-s1"><span class="pl-pse">${</span>ECR_REGISTRY<span class="pl-pse">}</span></span>/<span class="pl-s1"><span class="pl-pse">${</span>APP_REPO_NAME<span class="pl-pse">}</span></span>:discovery-server-v<span class="pl-s1"><span class="pl-pse">${</span>MVN_VERSION<span class="pl-pse">}</span></span>-b<span class="pl-s1"><span class="pl-pse">${</span>BUILD_NUMBER<span class="pl-pse">}</span></span><span class="pl-pds">"</span></span>
                    <span class="pl-c1">MVN_VERSION</span><span class="pl-k">=</span>sh(<span class="pl-c1">script</span>:<span class="pl-s"><span class="pl-pds">'</span>. ${WORKSPACE}/spring-petclinic-hystrix-dashboard/target/maven-archiver/pom.properties &amp;&amp; echo $version<span class="pl-pds">'</span></span>, <span class="pl-c1">returnStdout</span>:<span class="pl-c1">true</span>)<span class="pl-k">.</span>trim()
                    env<span class="pl-k">.</span><span class="pl-c1">IMAGE_TAG_HYSTRIX_DASHBOARD</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span><span class="pl-s1"><span class="pl-pse">${</span>ECR_REGISTRY<span class="pl-pse">}</span></span>/<span class="pl-s1"><span class="pl-pse">${</span>APP_REPO_NAME<span class="pl-pse">}</span></span>:hystrix-dashboard-v<span class="pl-s1"><span class="pl-pse">${</span>MVN_VERSION<span class="pl-pse">}</span></span>-b<span class="pl-s1"><span class="pl-pse">${</span>BUILD_NUMBER<span class="pl-pse">}</span></span><span class="pl-pds">"</span></span>
                    <span class="pl-c1">MVN_VERSION</span><span class="pl-k">=</span>sh(<span class="pl-c1">script</span>:<span class="pl-s"><span class="pl-pds">'</span>. ${WORKSPACE}/spring-petclinic-vets-service/target/maven-archiver/pom.properties &amp;&amp; echo $version<span class="pl-pds">'</span></span>, <span class="pl-c1">returnStdout</span>:<span class="pl-c1">true</span>)<span class="pl-k">.</span>trim()
                    env<span class="pl-k">.</span><span class="pl-c1">IMAGE_TAG_VETS_SERVICE</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span><span class="pl-s1"><span class="pl-pse">${</span>ECR_REGISTRY<span class="pl-pse">}</span></span>/<span class="pl-s1"><span class="pl-pse">${</span>APP_REPO_NAME<span class="pl-pse">}</span></span>:vets-service-v<span class="pl-s1"><span class="pl-pse">${</span>MVN_VERSION<span class="pl-pse">}</span></span>-b<span class="pl-s1"><span class="pl-pse">${</span>BUILD_NUMBER<span class="pl-pse">}</span></span><span class="pl-pds">"</span></span>
                    <span class="pl-c1">MVN_VERSION</span><span class="pl-k">=</span>sh(<span class="pl-c1">script</span>:<span class="pl-s"><span class="pl-pds">'</span>. ${WORKSPACE}/spring-petclinic-visits-service/target/maven-archiver/pom.properties &amp;&amp; echo $version<span class="pl-pds">'</span></span>, <span class="pl-c1">returnStdout</span>:<span class="pl-c1">true</span>)<span class="pl-k">.</span>trim()
                    env<span class="pl-k">.</span><span class="pl-c1">IMAGE_TAG_VISITS_SERVICE</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span><span class="pl-s1"><span class="pl-pse">${</span>ECR_REGISTRY<span class="pl-pse">}</span></span>/<span class="pl-s1"><span class="pl-pse">${</span>APP_REPO_NAME<span class="pl-pse">}</span></span>:visits-service-v<span class="pl-s1"><span class="pl-pse">${</span>MVN_VERSION<span class="pl-pse">}</span></span>-b<span class="pl-s1"><span class="pl-pse">${</span>BUILD_NUMBER<span class="pl-pse">}</span></span><span class="pl-pds">"</span></span>
                    env<span class="pl-k">.</span><span class="pl-c1">IMAGE_TAG_GRAFANA_SERVICE</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span><span class="pl-s1"><span class="pl-pse">${</span>ECR_REGISTRY<span class="pl-pse">}</span></span>/<span class="pl-s1"><span class="pl-pse">${</span>APP_REPO_NAME<span class="pl-pse">}</span></span>:grafana-service<span class="pl-pds">"</span></span>
                    env<span class="pl-k">.</span><span class="pl-c1">IMAGE_TAG_PROMETHEUS_SERVICE</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span><span class="pl-s1"><span class="pl-pse">${</span>ECR_REGISTRY<span class="pl-pse">}</span></span>/<span class="pl-s1"><span class="pl-pse">${</span>APP_REPO_NAME<span class="pl-pse">}</span></span>:prometheus-service<span class="pl-pds">"</span></span>
                }
            }
        }
        stage(<span class="pl-s"><span class="pl-pds">'</span>Build App Docker Images<span class="pl-pds">'</span></span>) {
            steps {
                echo <span class="pl-s"><span class="pl-pds">'</span>Building App Dev Images<span class="pl-pds">'</span></span>
                sh <span class="pl-s"><span class="pl-pds">"</span>. ./jenkins/build-dev-docker-images-for-ecr.sh<span class="pl-pds">"</span></span>
                sh <span class="pl-s"><span class="pl-pds">'</span>docker image ls<span class="pl-pds">'</span></span>
            }
        }
        stage(<span class="pl-s"><span class="pl-pds">'</span>Push Images to ECR Repo<span class="pl-pds">'</span></span>) {
            steps {
                echo <span class="pl-s"><span class="pl-pds">"</span>Pushing <span class="pl-s1"><span class="pl-pse">${</span>APP_NAME<span class="pl-pse">}</span></span> App Images to ECR Repo<span class="pl-pds">"</span></span>
                sh <span class="pl-s"><span class="pl-pds">"</span>. ./jenkins/push-dev-docker-images-to-ecr.sh<span class="pl-pds">"</span></span>
            }
        }
        stage(<span class="pl-s"><span class="pl-pds">'</span>Create Key Pair for Ansible<span class="pl-pds">'</span></span>) {
            steps {
                echo <span class="pl-s"><span class="pl-pds">"</span>Creating Key Pair for <span class="pl-s1"><span class="pl-pse">${</span>APP_NAME<span class="pl-pse">}</span></span> App<span class="pl-pds">"</span></span>
                sh <span class="pl-s"><span class="pl-pds">"</span>aws ec2 create-key-pair --region <span class="pl-s1"><span class="pl-pse">${</span>AWS_REGION<span class="pl-pse">}</span></span> --key-name <span class="pl-s1"><span class="pl-pse">${</span>CFN_KEYPAIR<span class="pl-pse">}</span></span> --query KeyMaterial --output text &gt; <span class="pl-s1"><span class="pl-pse">${</span>CFN_KEYPAIR<span class="pl-pse">}</span></span><span class="pl-pds">"</span></span>
                sh <span class="pl-s"><span class="pl-pds">"</span>chmod 400 <span class="pl-s1"><span class="pl-pse">${</span>CFN_KEYPAIR<span class="pl-pse">}</span></span><span class="pl-pds">"</span></span>
            }
        }
        stage(<span class="pl-s"><span class="pl-pds">'</span>Create QA Automation Infrastructure<span class="pl-pds">'</span></span>) {
            steps {
                echo <span class="pl-s"><span class="pl-pds">'</span>Creating QA Automation Infrastructure for Dev Environment with Cloudfomation<span class="pl-pds">'</span></span>
                sh <span class="pl-s"><span class="pl-pds">"</span>aws cloudformation create-stack --region <span class="pl-s1"><span class="pl-pse">${</span>AWS_REGION<span class="pl-pse">}</span></span> --stack-name <span class="pl-s1"><span class="pl-pse">${</span>APP_STACK_NAME<span class="pl-pse">}</span></span> --capabilities CAPABILITY_IAM --template-body file://<span class="pl-s1"><span class="pl-pse">${</span>CFN_TEMPLATE<span class="pl-pse">}</span></span> --parameters ParameterKey=KeyPairName,ParameterValue=<span class="pl-s1"><span class="pl-pse">${</span>CFN_KEYPAIR<span class="pl-pse">}</span></span><span class="pl-pds">"</span></span>
                sh <span class="pl-s"><span class="pl-pds">"</span>aws cloudformation wait stack-create-complete --stack-name <span class="pl-s1"><span class="pl-pse">${</span>APP_STACK_NAME<span class="pl-pse">}</span></span><span class="pl-pds">"</span></span> 
                script {
                    echo <span class="pl-s"><span class="pl-pds">"</span>Docker Grand Master is not UP and running yet.<span class="pl-pds">"</span></span>
                    env<span class="pl-k">.</span>id <span class="pl-k">=</span> sh(<span class="pl-c1">script</span>: <span class="pl-s"><span class="pl-pds">'</span>aws ec2 describe-instances --filters Name=tag-value,Values=grand-master Name=tag-value,Values=${APP_STACK_NAME} Name=instance-state-name,Values=running --query Reservations[*].Instances[*].[InstanceId] --output text<span class="pl-pds">'</span></span>,  <span class="pl-c1">returnStdout</span>:<span class="pl-c1">true</span>)<span class="pl-k">.</span>trim()
                    sh <span class="pl-s"><span class="pl-pds">'</span>aws ec2 wait instance-status-ok --instance-ids $id<span class="pl-pds">'</span></span>
                }
            }
        }

        stage(<span class="pl-s"><span class="pl-pds">'</span>Create Docker Swarm for QA Automation Build<span class="pl-pds">'</span></span>) {
            steps {
                echo <span class="pl-s"><span class="pl-pds">"</span>Setup Docker Swarm for QA Automation Build for <span class="pl-s1"><span class="pl-pse">${</span>APP_NAME<span class="pl-pse">}</span></span> App<span class="pl-pds">"</span></span>
                echo <span class="pl-s"><span class="pl-pds">"</span>Update dynamic environment<span class="pl-pds">"</span></span>
                sh <span class="pl-s"><span class="pl-pds">"</span>sed -i 's/APP_STACK_NAME/<span class="pl-s1"><span class="pl-pse">${</span>APP_STACK_NAME<span class="pl-pse">}</span></span>/' ./ansible/inventory/dev_stack_dynamic_inventory_aws_ec2.yaml<span class="pl-pds">"</span></span>
                echo <span class="pl-s"><span class="pl-pds">"</span>Swarm Setup for all nodes (instances)<span class="pl-pds">"</span></span>
                sh <span class="pl-s"><span class="pl-pds">"</span>ansible-playbook -i ./ansible/inventory/dev_stack_dynamic_inventory_aws_ec2.yaml -b ./ansible/playbooks/pb_setup_for_all_docker_swarm_instances.yaml<span class="pl-pds">"</span></span>
                echo <span class="pl-s"><span class="pl-pds">"</span>Swarm Setup for Grand Master node<span class="pl-pds">"</span></span>
                sh <span class="pl-s"><span class="pl-pds">"</span>ansible-playbook -i ./ansible/inventory/dev_stack_dynamic_inventory_aws_ec2.yaml -b ./ansible/playbooks/pb_initialize_docker_swarm.yaml<span class="pl-pds">"</span></span>
                echo <span class="pl-s"><span class="pl-pds">"</span>Swarm Setup for Other Managers nodes<span class="pl-pds">"</span></span>
                sh <span class="pl-s"><span class="pl-pds">"</span>ansible-playbook -i ./ansible/inventory/dev_stack_dynamic_inventory_aws_ec2.yaml -b ./ansible/playbooks/pb_join_docker_swarm_managers.yaml<span class="pl-pds">"</span></span>
                echo <span class="pl-s"><span class="pl-pds">"</span>Swarm Setup for Workers nodes<span class="pl-pds">"</span></span>
                sh <span class="pl-s"><span class="pl-pds">"</span>ansible-playbook -i ./ansible/inventory/dev_stack_dynamic_inventory_aws_ec2.yaml -b ./ansible/playbooks/pb_join_docker_swarm_workers.yaml<span class="pl-pds">"</span></span>
            }
        }

        stage(<span class="pl-s"><span class="pl-pds">'</span>Deploy App on Docker Swarm<span class="pl-pds">'</span></span>){
            steps {
                echo <span class="pl-s"><span class="pl-pds">'</span>Deploying App on Swarm<span class="pl-pds">'</span></span>
                sh <span class="pl-s"><span class="pl-pds">'</span>envsubst &lt; docker-compose-swarm-dev.yml &gt; docker-compose-swarm-dev-tagged.yml<span class="pl-pds">'</span></span>
                sh <span class="pl-s"><span class="pl-pds">'</span>ansible-playbook -i ./ansible/inventory/dev_stack_dynamic_inventory_aws_ec2.yaml -b --extra-vars "workspace=${WORKSPACE} app_name=${APP_NAME} aws_region=${AWS_REGION} ecr_registry=${ECR_REGISTRY}" ./ansible/playbooks/pb_deploy_app_on_docker_swarm.yaml<span class="pl-pds">'</span></span>
            }
        }

        stage(<span class="pl-s"><span class="pl-pds">'</span>Test the Application Deployment<span class="pl-pds">'</span></span>){
            steps {
                echo <span class="pl-s"><span class="pl-pds">"</span>Check if the <span class="pl-s1"><span class="pl-pse">${</span>APP_NAME<span class="pl-pse">}</span></span> app is ready or not<span class="pl-pds">"</span></span>
                script {
                    env<span class="pl-k">.</span><span class="pl-c1">GRAND_MASTER_PUBLIC_IP</span> <span class="pl-k">=</span> sh(<span class="pl-c1">script</span>:<span class="pl-s"><span class="pl-pds">"</span>aws ec2 describe-instances --region <span class="pl-s1"><span class="pl-pse">${</span>AWS_REGION<span class="pl-pse">}</span></span> --filters Name=tag-value,Values=grand-master Name=tag-value,Values=<span class="pl-s1"><span class="pl-pse">${</span>APP_STACK_NAME<span class="pl-pse">}</span></span> --query Reservations[*].Instances[*].[PublicIpAddress] --output text<span class="pl-pds">"</span></span>, <span class="pl-c1">returnStdout</span>:<span class="pl-c1">true</span>)<span class="pl-k">.</span>trim()
                    <span class="pl-k">while</span>(<span class="pl-c1">true</span>) {
                        <span class="pl-k">try</span>{
                            sh <span class="pl-s"><span class="pl-pds">"</span>curl -s <span class="pl-s1"><span class="pl-pse">${</span>GRAND_MASTER_PUBLIC_IP<span class="pl-pse">}</span></span>:8080<span class="pl-pds">"</span></span>
                            echo <span class="pl-s"><span class="pl-pds">"</span><span class="pl-s1"><span class="pl-pse">${</span>APP_NAME<span class="pl-pse">}</span></span> app is successfully deployed.<span class="pl-pds">"</span></span>
                            <span class="pl-k">break</span>
                        }
                        <span class="pl-k">catch</span>(<span class="pl-k">Exception</span>){
                            echo <span class="pl-s"><span class="pl-pds">"</span>Could not connect to <span class="pl-s1"><span class="pl-pse">${</span>APP_NAME<span class="pl-pse">}</span></span> app<span class="pl-pds">"</span></span>
                            sleep(<span class="pl-c1">5</span>)
                        }
                    }
                }
            }
        }

        stage(<span class="pl-s"><span class="pl-pds">'</span>Run QA Automation Tests<span class="pl-pds">'</span></span>){
            steps {
                echo <span class="pl-s"><span class="pl-pds">"</span>Run the Selenium Functional Test on QA Environment<span class="pl-pds">"</span></span>
                sh <span class="pl-s"><span class="pl-pds">'</span>ansible-playbook -vvv --connection=local --inventory 127.0.0.1, --extra-vars "workspace=${WORKSPACE} master_public_ip=${GRAND_MASTER_PUBLIC_IP}" ./ansible/playbooks/pb_run_selenium_jobs.yaml<span class="pl-pds">'</span></span>
            }
        }
    }

    post {
        always {
            echo <span class="pl-s"><span class="pl-pds">'</span>Deleting all local images<span class="pl-pds">'</span></span>
            sh <span class="pl-s"><span class="pl-pds">'</span>docker image prune -af<span class="pl-pds">'</span></span>
            echo <span class="pl-s"><span class="pl-pds">'</span>Delete the Image Repository on ECR<span class="pl-pds">'</span></span>
            sh <span class="pl-s"><span class="pl-pds">"""</span></span>
<span class="pl-s">                aws ecr delete-repository \</span>
<span class="pl-s">                  --repository-name <span class="pl-s1"><span class="pl-pse">${</span>APP_REPO_NAME<span class="pl-pse">}</span></span> \</span>
<span class="pl-s">                  --region <span class="pl-s1"><span class="pl-pse">${</span>AWS_REGION<span class="pl-pse">}</span></span>\</span>
<span class="pl-s">                  --force</span>
<span class="pl-s">                <span class="pl-pds">"""</span></span>
            echo <span class="pl-s"><span class="pl-pds">'</span>Tear down the Docker Swarm infrastructure using AWS CLI<span class="pl-pds">'</span></span>
            sh <span class="pl-s"><span class="pl-pds">"</span>aws cloudformation delete-stack --region <span class="pl-s1"><span class="pl-pse">${</span>AWS_REGION<span class="pl-pse">}</span></span> --stack-name <span class="pl-s1"><span class="pl-pse">${</span>APP_STACK_NAME<span class="pl-pse">}</span></span><span class="pl-pds">"</span></span>
            echo <span class="pl-s"><span class="pl-pds">"</span>Delete existing key pair using AWS CLI<span class="pl-pds">"</span></span>
            sh <span class="pl-s"><span class="pl-pds">"</span>aws ec2 delete-key-pair --region <span class="pl-s1"><span class="pl-pse">${</span>AWS_REGION<span class="pl-pse">}</span></span> --key-name <span class="pl-s1"><span class="pl-pse">${</span>CFN_KEYPAIR<span class="pl-pse">}</span></span><span class="pl-pds">"</span></span>
            sh <span class="pl-s"><span class="pl-pds">"</span>rm -rf <span class="pl-s1"><span class="pl-pse">${</span>CFN_KEYPAIR<span class="pl-pse">}</span></span><span class="pl-pds">"</span></span>
        }
    }
}</pre></div>
<ul dir="auto">
<li>
<p dir="auto">Create a Jenkins pipeline with name of <code>petclinic-nightly</code> with following script to run QA automation tests and configure a <code>cron job</code> to trigger the pipeline every night at midnight (<code>0 0 * * *</code>) on <code>dev</code> branch. Petclinic nightly build pipeline should be built on temporary QA automation environment.</p>
</li>
<li>
<p dir="auto">Commit the change, then push the script to the remote repo.</p>
</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="git add .
git commit -m 'added qa automation pipeline for dev'
git push
git checkout dev
git merge feature/msp-17
git push origin dev"><pre>git add <span class="pl-c1">.</span>
git commit -m <span class="pl-s"><span class="pl-pds">'</span>added qa automation pipeline for dev<span class="pl-pds">'</span></span>
git push
git checkout dev
git merge feature/msp-17
git push origin dev</pre></div>
<h2 dir="auto"><a id="user-content-msp-18---create-a-qa-environment-on-docker-swarm-with-cloudformation-and-ansible" class="anchor" aria-hidden="true" href="#msp-18---create-a-qa-environment-on-docker-swarm-with-cloudformation-and-ansible"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>MSP 18 - Create a QA Environment on Docker Swarm with Cloudformation and Ansible</h2>
<ul dir="auto">
<li>Create <code>feature/msp-18</code> branch from <code>dev</code>.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="git checkout dev
git branch feature/msp-18
git checkout feature/msp-18"><pre>git checkout dev
git branch feature/msp-18
git checkout feature/msp-18</pre></div>
<ul dir="auto">
<li>
<p dir="auto">Prepare a Cloudformation template for <code>QA</code> Docker Swarm Infrastructure consisting of 3 Managers, 2 Worker Instances and save it as <code>qa-docker-swarm-infrastructure-cfn-template.yml</code> under <code>infrastructure</code> folder.</p>
</li>
<li>
<p dir="auto">Grant permissions to Docker Machines within Cloudformation template to create ECR Registry, push or pull Docker images to/from ECR Repo.</p>
</li>
<li>
<p dir="auto">Create a Jenkins Job with the name of <code>create-permanent-key-pair-for-petclinic-qa-env</code> for Ansible key pair to be used in QA environment using following script, and save the script as <code>create-permanent-key-pair-for-qa-environment.sh</code> under <code>jenkins</code> folder.</p>
</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="PATH=&quot;$PATH:/usr/local/bin&quot;
APP_NAME=&quot;petclinic&quot;
CFN_KEYPAIR=&quot;matt-${APP_NAME}-qa.key&quot;
AWS_REGION=&quot;us-east-1&quot;
aws ec2 create-key-pair --region ${AWS_REGION} --key-name ${CFN_KEYPAIR} --query &quot;KeyMaterial&quot; --output text &gt; ${CFN_KEYPAIR}
chmod 400 ${CFN_KEYPAIR}
mkdir -p ${JENKINS_HOME}/.ssh
mv ${CFN_KEYPAIR} ${JENKINS_HOME}/.ssh/${CFN_KEYPAIR}
ls -al ${JENKINS_HOME}/.ssh"><pre>PATH=<span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">$PATH</span>:/usr/local/bin<span class="pl-pds">"</span></span>
APP_NAME=<span class="pl-s"><span class="pl-pds">"</span>petclinic<span class="pl-pds">"</span></span>
CFN_KEYPAIR=<span class="pl-s"><span class="pl-pds">"</span>matt-<span class="pl-smi">${APP_NAME}</span>-qa.key<span class="pl-pds">"</span></span>
AWS_REGION=<span class="pl-s"><span class="pl-pds">"</span>us-east-1<span class="pl-pds">"</span></span>
aws ec2 create-key-pair --region <span class="pl-smi">${AWS_REGION}</span> --key-name <span class="pl-smi">${CFN_KEYPAIR}</span> --query <span class="pl-s"><span class="pl-pds">"</span>KeyMaterial<span class="pl-pds">"</span></span> --output text <span class="pl-k">&gt;</span> <span class="pl-smi">${CFN_KEYPAIR}</span>
chmod 400 <span class="pl-smi">${CFN_KEYPAIR}</span>
mkdir -p <span class="pl-smi">${JENKINS_HOME}</span>/.ssh
mv <span class="pl-smi">${CFN_KEYPAIR}</span> <span class="pl-smi">${JENKINS_HOME}</span>/.ssh/<span class="pl-smi">${CFN_KEYPAIR}</span>
ls -al <span class="pl-smi">${JENKINS_HOME}</span>/.ssh</pre></div>
<ul dir="auto">
<li>Prepare a script with the name of <code>create-qa-infrastructure-cfn.sh</code> for a Permanent QA Infrastructure with AWS Cloudformation using AWS CLI under <code>infrastructure</code> folder.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="PATH=&quot;$PATH:/usr/local/bin&quot;
APP_NAME=&quot;petclinic&quot;
APP_STACK_NAME=&quot;Matt-$APP_NAME-App-QA-${BUILD_NUMBER}&quot;
CFN_KEYPAIR=&quot;matt-${APP_NAME}-qa.key&quot;
CFN_TEMPLATE=&quot;./infrastructure/qa-docker-swarm-infrastructure-cfn-template.yml&quot;
AWS_REGION=&quot;us-east-1&quot;
aws cloudformation create-stack --region ${AWS_REGION} --stack-name ${APP_STACK_NAME} --capabilities CAPABILITY_IAM --template-body file://${CFN_TEMPLATE} --parameters ParameterKey=KeyPairName,ParameterValue=${CFN_KEYPAIR}"><pre>PATH=<span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">$PATH</span>:/usr/local/bin<span class="pl-pds">"</span></span>
APP_NAME=<span class="pl-s"><span class="pl-pds">"</span>petclinic<span class="pl-pds">"</span></span>
APP_STACK_NAME=<span class="pl-s"><span class="pl-pds">"</span>Matt-<span class="pl-smi">$APP_NAME</span>-App-QA-<span class="pl-smi">${BUILD_NUMBER}</span><span class="pl-pds">"</span></span>
CFN_KEYPAIR=<span class="pl-s"><span class="pl-pds">"</span>matt-<span class="pl-smi">${APP_NAME}</span>-qa.key<span class="pl-pds">"</span></span>
CFN_TEMPLATE=<span class="pl-s"><span class="pl-pds">"</span>./infrastructure/qa-docker-swarm-infrastructure-cfn-template.yml<span class="pl-pds">"</span></span>
AWS_REGION=<span class="pl-s"><span class="pl-pds">"</span>us-east-1<span class="pl-pds">"</span></span>
aws cloudformation create-stack --region <span class="pl-smi">${AWS_REGION}</span> --stack-name <span class="pl-smi">${APP_STACK_NAME}</span> --capabilities CAPABILITY_IAM --template-body file://<span class="pl-smi">${CFN_TEMPLATE}</span> --parameters ParameterKey=KeyPairName,ParameterValue=<span class="pl-smi">${CFN_KEYPAIR}</span></pre></div>
<ul dir="auto">
<li>Prepare dynamic inventory file with name of <code>qa_stack_dynamic_inventory_aws_ec2.yaml</code> for Ansible under <code>ansible/inventory</code> folder using Docker machines private IP addresses.</li>
</ul>
<div class="highlight highlight-source-yaml position-relative overflow-auto" data-snippet-clipboard-copy-content="plugin: aws_ec2
regions:
  - &quot;us-east-1&quot;
filters:
  tag:app-stack-name: APP_STACK_NAME
  tag:environment: qa
keyed_groups:
  - key: tags['app-stack-name']
    prefix: 'app_stack_'
    separator: ''
  - key: tags['swarm-role']
    prefix: 'role_'
    separator: ''
  - key: tags['environment']
    prefix: 'env_'
    separator: ''
  - key: tags['server']
    separator: ''
hostnames:
  - &quot;private-ip-address&quot;
compose:
  ansible_user: &quot;'ec2-user'&quot;"><pre><span class="pl-ent">plugin</span>: <span class="pl-s">aws_ec2</span>
<span class="pl-ent">regions</span>:
  - <span class="pl-s"><span class="pl-pds">"</span>us-east-1<span class="pl-pds">"</span></span>
<span class="pl-ent">filters</span>:
  <span class="pl-ent">tag:app-stack-name</span>: <span class="pl-s">APP_STACK_NAME</span>
  <span class="pl-ent">tag:environment</span>: <span class="pl-s">qa</span>
<span class="pl-ent">keyed_groups</span>:
  - <span class="pl-ent">key</span>: <span class="pl-s">tags['app-stack-name']</span>
    <span class="pl-ent">prefix</span>: <span class="pl-s"><span class="pl-pds">'</span>app_stack_<span class="pl-pds">'</span></span>
    <span class="pl-ent">separator</span>: <span class="pl-s"><span class="pl-pds">'</span><span class="pl-pds">'</span></span>
  - <span class="pl-ent">key</span>: <span class="pl-s">tags['swarm-role']</span>
    <span class="pl-ent">prefix</span>: <span class="pl-s"><span class="pl-pds">'</span>role_<span class="pl-pds">'</span></span>
    <span class="pl-ent">separator</span>: <span class="pl-s"><span class="pl-pds">'</span><span class="pl-pds">'</span></span>
  - <span class="pl-ent">key</span>: <span class="pl-s">tags['environment']</span>
    <span class="pl-ent">prefix</span>: <span class="pl-s"><span class="pl-pds">'</span>env_<span class="pl-pds">'</span></span>
    <span class="pl-ent">separator</span>: <span class="pl-s"><span class="pl-pds">'</span><span class="pl-pds">'</span></span>
  - <span class="pl-ent">key</span>: <span class="pl-s">tags['server']</span>
    <span class="pl-ent">separator</span>: <span class="pl-s"><span class="pl-pds">'</span><span class="pl-pds">'</span></span>
<span class="pl-ent">hostnames</span>:
  - <span class="pl-s"><span class="pl-pds">"</span>private-ip-address<span class="pl-pds">"</span></span>
<span class="pl-ent">compose</span>:
  <span class="pl-ent">ansible_user</span>: <span class="pl-s"><span class="pl-pds">"</span>'ec2-user'<span class="pl-pds">"</span></span></pre></div>
<ul dir="auto">
<li>Prepare script with the name of <code>qa_build_deploy_environment.sh</code> to create a <code>QA</code> Environment for Release on Docker Swarm using the same playbooks created for <code>Dev</code> environment under <code>ansible/scripts</code> folder.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="PATH=&quot;$PATH:/usr/local/bin&quot;
APP_NAME=&quot;petclinic&quot;
CFN_KEYPAIR=&quot;matt-${APP_NAME}-qa.key&quot;
APP_STACK_NAME=&quot;Matt-$APP_NAME-App-QA-${BUILD_NUMBER}&quot;
export ANSIBLE_PRIVATE_KEY_FILE=&quot;${JENKINS_HOME}/.ssh/${CFN_KEYPAIR}&quot;
export ANSIBLE_HOST_KEY_CHECKING=False
sed -i &quot;s/APP_STACK_NAME/$APP_STACK_NAME/&quot; ./ansible/inventory/qa_stack_dynamic_inventory_aws_ec2.yaml
# Swarm Setup for all nodes (instances)
ansible-playbook -i ./ansible/inventory/qa_stack_dynamic_inventory_aws_ec2.yaml -b ./ansible/playbooks/pb_setup_for_all_docker_swarm_instances.yaml
# Swarm Setup for Grand Master node
ansible-playbook -i ./ansible/inventory/qa_stack_dynamic_inventory_aws_ec2.yaml -b ./ansible/playbooks/pb_initialize_docker_swarm.yaml
# Swarm Setup for Other Managers nodes
ansible-playbook -i ./ansible/inventory/qa_stack_dynamic_inventory_aws_ec2.yaml -b ./ansible/playbooks/pb_join_docker_swarm_managers.yaml
# Swarm Setup for Workers nodes
ansible-playbook -i ./ansible/inventory/qa_stack_dynamic_inventory_aws_ec2.yaml -b ./ansible/playbooks/pb_join_docker_swarm_workers.yaml"><pre>PATH=<span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">$PATH</span>:/usr/local/bin<span class="pl-pds">"</span></span>
APP_NAME=<span class="pl-s"><span class="pl-pds">"</span>petclinic<span class="pl-pds">"</span></span>
CFN_KEYPAIR=<span class="pl-s"><span class="pl-pds">"</span>matt-<span class="pl-smi">${APP_NAME}</span>-qa.key<span class="pl-pds">"</span></span>
APP_STACK_NAME=<span class="pl-s"><span class="pl-pds">"</span>Matt-<span class="pl-smi">$APP_NAME</span>-App-QA-<span class="pl-smi">${BUILD_NUMBER}</span><span class="pl-pds">"</span></span>
<span class="pl-k">export</span> ANSIBLE_PRIVATE_KEY_FILE=<span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${JENKINS_HOME}</span>/.ssh/<span class="pl-smi">${CFN_KEYPAIR}</span><span class="pl-pds">"</span></span>
<span class="pl-k">export</span> ANSIBLE_HOST_KEY_CHECKING=False
sed -i <span class="pl-s"><span class="pl-pds">"</span>s/APP_STACK_NAME/<span class="pl-smi">$APP_STACK_NAME</span>/<span class="pl-pds">"</span></span> ./ansible/inventory/qa_stack_dynamic_inventory_aws_ec2.yaml
<span class="pl-c"><span class="pl-c">#</span> Swarm Setup for all nodes (instances)</span>
ansible-playbook -i ./ansible/inventory/qa_stack_dynamic_inventory_aws_ec2.yaml -b ./ansible/playbooks/pb_setup_for_all_docker_swarm_instances.yaml
<span class="pl-c"><span class="pl-c">#</span> Swarm Setup for Grand Master node</span>
ansible-playbook -i ./ansible/inventory/qa_stack_dynamic_inventory_aws_ec2.yaml -b ./ansible/playbooks/pb_initialize_docker_swarm.yaml
<span class="pl-c"><span class="pl-c">#</span> Swarm Setup for Other Managers nodes</span>
ansible-playbook -i ./ansible/inventory/qa_stack_dynamic_inventory_aws_ec2.yaml -b ./ansible/playbooks/pb_join_docker_swarm_managers.yaml
<span class="pl-c"><span class="pl-c">#</span> Swarm Setup for Workers nodes</span>
ansible-playbook -i ./ansible/inventory/qa_stack_dynamic_inventory_aws_ec2.yaml -b ./ansible/playbooks/pb_join_docker_swarm_workers.yaml</pre></div>
<ul dir="auto">
<li>Prepare a Jenkinsfile to create a QA Environment on Docker Swarm manually and save it as <code>jenkinsfile-create-qa-environment-on-docker-swarm</code> under <code>jenkins</code> folder.</li>
</ul>
<div class="highlight highlight-source-groovy position-relative overflow-auto" data-snippet-clipboard-copy-content="pipeline {
    agent any
    environment {
        PATH=sh(script:&quot;echo $PATH:/usr/local/bin&quot;, returnStdout:true).trim()
        APP_NAME=&quot;petclinic&quot;
        APP_STACK_NAME=&quot;Matt-$APP_NAME-App-QA-${BUILD_NUMBER}&quot;
        AWS_REGION=&quot;us-east-1&quot;
        CFN_KEYPAIR=&quot;matt-${APP_NAME}-qa.key&quot;
        CFN_TEMPLATE=&quot;./infrastructure/qa-docker-swarm-infrastructure-cfn-template.yml&quot;
        ANSIBLE_PRIVATE_KEY_FILE=&quot;${JENKINS_HOME}/.ssh/${CFN_KEYPAIR}&quot;
        ANSIBLE_HOST_KEY_CHECKING=&quot;False&quot;
    }
    stages {
        stage('Create QA Environment Infrastructure') {
            steps {
                echo 'Creating Infrastructure for QA Environment with Cloudfomation'
                sh &quot;aws cloudformation create-stack --region ${AWS_REGION} --stack-name ${APP_STACK_NAME} --capabilities CAPABILITY_IAM --template-body file://${CFN_TEMPLATE} --parameters ParameterKey=KeyPairName,ParameterValue=${CFN_KEYPAIR}&quot;
                sh &quot;aws cloudformation wait stack-create-complete --stack-name ${APP_STACK_NAME}&quot; 
                script {
                    echo &quot;Docker Grand Master is not UP and running yet.&quot;
                    env.id = sh(script: 'aws ec2 describe-instances --filters Name=tag-value,Values=grand-master Name=tag-value,Values=${APP_STACK_NAME} Name=instance-state-name,Values=running --query Reservations[*].Instances[*].[InstanceId] --output text',  returnStdout:true).trim()
                    sh 'aws ec2 wait instance-status-ok --instance-ids $id'
                }
                
            }
        }
        stage('Create Docker Swarm for QA Environment') {
            steps {
                echo &quot;Setup Docker Swarm for QA Environment for ${APP_NAME} App&quot;
                echo &quot;Update dynamic environment&quot;
                sh &quot;sed -i 's/APP_STACK_NAME/${APP_STACK_NAME}/' ./ansible/inventory/qa_stack_dynamic_inventory_aws_ec2.yaml&quot;
                echo &quot;Swarm Setup for all nodes (instances)&quot;
                sh &quot;ansible-playbook -i ./ansible/inventory/qa_stack_dynamic_inventory_aws_ec2.yaml -b ./ansible/playbooks/pb_setup_for_all_docker_swarm_instances.yaml&quot;
                echo &quot;Swarm Setup for Grand Master node&quot;
                sh &quot;ansible-playbook -i ./ansible/inventory/qa_stack_dynamic_inventory_aws_ec2.yaml -b ./ansible/playbooks/pb_initialize_docker_swarm.yaml&quot;
                echo &quot;Swarm Setup for Other Managers nodes&quot;
                sh &quot;ansible-playbook -i ./ansible/inventory/qa_stack_dynamic_inventory_aws_ec2.yaml -b ./ansible/playbooks/pb_join_docker_swarm_managers.yaml&quot;
                echo &quot;Swarm Setup for Workers nodes&quot;
                sh &quot;ansible-playbook -i ./ansible/inventory/qa_stack_dynamic_inventory_aws_ec2.yaml -b ./ansible/playbooks/pb_join_docker_swarm_workers.yaml&quot;
            }
        }
    }
    post {
        failure {
            echo 'Tear down the Docker Swarm infrastructure using AWS CLI'
            sh &quot;aws cloudformation delete-stack --region ${AWS_REGION} --stack-name ${APP_STACK_NAME}&quot;
        }
    }
}"><pre>pipeline {
    agent any
    environment {
        <span class="pl-c1">PATH</span><span class="pl-k">=</span>sh(<span class="pl-c1">script</span>:<span class="pl-s"><span class="pl-pds">"</span>echo <span class="pl-smi">$P<span class="pl-smi">ATH</span></span>:/usr/local/bin<span class="pl-pds">"</span></span>, <span class="pl-c1">returnStdout</span>:<span class="pl-c1">true</span>)<span class="pl-k">.</span>trim()
        <span class="pl-c1">APP_NAME</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>petclinic<span class="pl-pds">"</span></span>
        <span class="pl-c1">APP_STACK_NAME</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>Matt-<span class="pl-smi">$A<span class="pl-smi">PP_NAME</span></span>-App-QA-<span class="pl-s1"><span class="pl-pse">${</span>BUILD_NUMBER<span class="pl-pse">}</span></span><span class="pl-pds">"</span></span>
        <span class="pl-c1">AWS_REGION</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>us-east-1<span class="pl-pds">"</span></span>
        <span class="pl-c1">CFN_KEYPAIR</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>matt-<span class="pl-s1"><span class="pl-pse">${</span>APP_NAME<span class="pl-pse">}</span></span>-qa.key<span class="pl-pds">"</span></span>
        <span class="pl-c1">CFN_TEMPLATE</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>./infrastructure/qa-docker-swarm-infrastructure-cfn-template.yml<span class="pl-pds">"</span></span>
        <span class="pl-c1">ANSIBLE_PRIVATE_KEY_FILE</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span><span class="pl-s1"><span class="pl-pse">${</span>JENKINS_HOME<span class="pl-pse">}</span></span>/.ssh/<span class="pl-s1"><span class="pl-pse">${</span>CFN_KEYPAIR<span class="pl-pse">}</span></span><span class="pl-pds">"</span></span>
        <span class="pl-c1">ANSIBLE_HOST_KEY_CHECKING</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>False<span class="pl-pds">"</span></span>
    }
    stages {
        stage(<span class="pl-s"><span class="pl-pds">'</span>Create QA Environment Infrastructure<span class="pl-pds">'</span></span>) {
            steps {
                echo <span class="pl-s"><span class="pl-pds">'</span>Creating Infrastructure for QA Environment with Cloudfomation<span class="pl-pds">'</span></span>
                sh <span class="pl-s"><span class="pl-pds">"</span>aws cloudformation create-stack --region <span class="pl-s1"><span class="pl-pse">${</span>AWS_REGION<span class="pl-pse">}</span></span> --stack-name <span class="pl-s1"><span class="pl-pse">${</span>APP_STACK_NAME<span class="pl-pse">}</span></span> --capabilities CAPABILITY_IAM --template-body file://<span class="pl-s1"><span class="pl-pse">${</span>CFN_TEMPLATE<span class="pl-pse">}</span></span> --parameters ParameterKey=KeyPairName,ParameterValue=<span class="pl-s1"><span class="pl-pse">${</span>CFN_KEYPAIR<span class="pl-pse">}</span></span><span class="pl-pds">"</span></span>
                sh <span class="pl-s"><span class="pl-pds">"</span>aws cloudformation wait stack-create-complete --stack-name <span class="pl-s1"><span class="pl-pse">${</span>APP_STACK_NAME<span class="pl-pse">}</span></span><span class="pl-pds">"</span></span> 
                script {
                    echo <span class="pl-s"><span class="pl-pds">"</span>Docker Grand Master is not UP and running yet.<span class="pl-pds">"</span></span>
                    env<span class="pl-k">.</span>id <span class="pl-k">=</span> sh(<span class="pl-c1">script</span>: <span class="pl-s"><span class="pl-pds">'</span>aws ec2 describe-instances --filters Name=tag-value,Values=grand-master Name=tag-value,Values=${APP_STACK_NAME} Name=instance-state-name,Values=running --query Reservations[*].Instances[*].[InstanceId] --output text<span class="pl-pds">'</span></span>,  <span class="pl-c1">returnStdout</span>:<span class="pl-c1">true</span>)<span class="pl-k">.</span>trim()
                    sh <span class="pl-s"><span class="pl-pds">'</span>aws ec2 wait instance-status-ok --instance-ids $id<span class="pl-pds">'</span></span>
                }
                
            }
        }
        stage(<span class="pl-s"><span class="pl-pds">'</span>Create Docker Swarm for QA Environment<span class="pl-pds">'</span></span>) {
            steps {
                echo <span class="pl-s"><span class="pl-pds">"</span>Setup Docker Swarm for QA Environment for <span class="pl-s1"><span class="pl-pse">${</span>APP_NAME<span class="pl-pse">}</span></span> App<span class="pl-pds">"</span></span>
                echo <span class="pl-s"><span class="pl-pds">"</span>Update dynamic environment<span class="pl-pds">"</span></span>
                sh <span class="pl-s"><span class="pl-pds">"</span>sed -i 's/APP_STACK_NAME/<span class="pl-s1"><span class="pl-pse">${</span>APP_STACK_NAME<span class="pl-pse">}</span></span>/' ./ansible/inventory/qa_stack_dynamic_inventory_aws_ec2.yaml<span class="pl-pds">"</span></span>
                echo <span class="pl-s"><span class="pl-pds">"</span>Swarm Setup for all nodes (instances)<span class="pl-pds">"</span></span>
                sh <span class="pl-s"><span class="pl-pds">"</span>ansible-playbook -i ./ansible/inventory/qa_stack_dynamic_inventory_aws_ec2.yaml -b ./ansible/playbooks/pb_setup_for_all_docker_swarm_instances.yaml<span class="pl-pds">"</span></span>
                echo <span class="pl-s"><span class="pl-pds">"</span>Swarm Setup for Grand Master node<span class="pl-pds">"</span></span>
                sh <span class="pl-s"><span class="pl-pds">"</span>ansible-playbook -i ./ansible/inventory/qa_stack_dynamic_inventory_aws_ec2.yaml -b ./ansible/playbooks/pb_initialize_docker_swarm.yaml<span class="pl-pds">"</span></span>
                echo <span class="pl-s"><span class="pl-pds">"</span>Swarm Setup for Other Managers nodes<span class="pl-pds">"</span></span>
                sh <span class="pl-s"><span class="pl-pds">"</span>ansible-playbook -i ./ansible/inventory/qa_stack_dynamic_inventory_aws_ec2.yaml -b ./ansible/playbooks/pb_join_docker_swarm_managers.yaml<span class="pl-pds">"</span></span>
                echo <span class="pl-s"><span class="pl-pds">"</span>Swarm Setup for Workers nodes<span class="pl-pds">"</span></span>
                sh <span class="pl-s"><span class="pl-pds">"</span>ansible-playbook -i ./ansible/inventory/qa_stack_dynamic_inventory_aws_ec2.yaml -b ./ansible/playbooks/pb_join_docker_swarm_workers.yaml<span class="pl-pds">"</span></span>
            }
        }
    }
    post {
        failure {
            echo <span class="pl-s"><span class="pl-pds">'</span>Tear down the Docker Swarm infrastructure using AWS CLI<span class="pl-pds">'</span></span>
            sh <span class="pl-s"><span class="pl-pds">"</span>aws cloudformation delete-stack --region <span class="pl-s1"><span class="pl-pse">${</span>AWS_REGION<span class="pl-pse">}</span></span> --stack-name <span class="pl-s1"><span class="pl-pse">${</span>APP_STACK_NAME<span class="pl-pse">}</span></span><span class="pl-pds">"</span></span>
        }
    }
}</pre></div>
<ul dir="auto">
<li>Commit the change, then push the scripts to the remote repo.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="git add .
git commit -m &quot;added jenkinsfile for creating manual qa environment&quot;
git push --set-upstream origin feature/msp-18
git checkout dev
git merge feature/msp-18
git push origin dev"><pre>git add <span class="pl-c1">.</span>
git commit -m <span class="pl-s"><span class="pl-pds">"</span>added jenkinsfile for creating manual qa environment<span class="pl-pds">"</span></span>
git push --set-upstream origin feature/msp-18
git checkout dev
git merge feature/msp-18
git push origin dev</pre></div>
<ul dir="auto">
<li>Create a pipeline on Jenkins Server with name of <code>create-qa-environment-on-docker-swarm</code> and create QA environment manually on <code>dev</code> branch.</li>
</ul>
<h2 dir="auto"><a id="user-content-msp-19---prepare-build-scripts-for-qa-environment" class="anchor" aria-hidden="true" href="#msp-19---prepare-build-scripts-for-qa-environment"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>MSP 19 - Prepare Build Scripts for QA Environment</h2>
<ul dir="auto">
<li>Create <code>feature/msp-19</code> branch from <code>dev</code>.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="git checkout dev
git branch feature/msp-19
git checkout feature/msp-19"><pre>git checkout dev
git branch feature/msp-19
git checkout feature/msp-19</pre></div>
<ul dir="auto">
<li>Create a Jenkins Job and name it as <code>create-ecr-docker-registry-for-petclinic-qa</code> to create Docker Registry for <code>QA</code> manually on AWS ECR.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="PATH=&quot;$PATH:/usr/local/bin&quot;
APP_REPO_NAME=&quot;clarusway-repo/petclinic-app-qa&quot;
AWS_REGION=&quot;us-east-1&quot;

aws ecr create-repository \
  --repository-name ${APP_REPO_NAME} \
  --image-scanning-configuration scanOnPush=false \
  --image-tag-mutability MUTABLE \
  --region ${AWS_REGION}"><pre>PATH=<span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">$PATH</span>:/usr/local/bin<span class="pl-pds">"</span></span>
APP_REPO_NAME=<span class="pl-s"><span class="pl-pds">"</span>clarusway-repo/petclinic-app-qa<span class="pl-pds">"</span></span>
AWS_REGION=<span class="pl-s"><span class="pl-pds">"</span>us-east-1<span class="pl-pds">"</span></span>

aws ecr create-repository \
  --repository-name <span class="pl-smi">${APP_REPO_NAME}</span> \
  --image-scanning-configuration scanOnPush=false \
  --image-tag-mutability MUTABLE \
  --region <span class="pl-smi">${AWS_REGION}</span></pre></div>
<ul dir="auto">
<li>Prepare a script to create ECR tags for the docker images and save it as <code>prepare-tags-ecr-for-qa-docker-images.sh</code> and save it under <code>jenkins</code> folder.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="MVN_VERSION=$(. ${WORKSPACE}/spring-petclinic-admin-server/target/maven-archiver/pom.properties &amp;&amp; echo $version)
export IMAGE_TAG_ADMIN_SERVER=&quot;${ECR_REGISTRY}/${APP_REPO_NAME}:admin-server-qa-v${MVN_VERSION}-b${BUILD_NUMBER}&quot;
MVN_VERSION=$(. ${WORKSPACE}/spring-petclinic-api-gateway/target/maven-archiver/pom.properties &amp;&amp; echo $version)
export IMAGE_TAG_API_GATEWAY=&quot;${ECR_REGISTRY}/${APP_REPO_NAME}:api-gateway-qa-v${MVN_VERSION}-b${BUILD_NUMBER}&quot;
MVN_VERSION=$(. ${WORKSPACE}/spring-petclinic-config-server/target/maven-archiver/pom.properties &amp;&amp; echo $version)
export IMAGE_TAG_CONFIG_SERVER=&quot;${ECR_REGISTRY}/${APP_REPO_NAME}:config-server-qa-v${MVN_VERSION}-b${BUILD_NUMBER}&quot;
MVN_VERSION=$(. ${WORKSPACE}/spring-petclinic-customers-service/target/maven-archiver/pom.properties &amp;&amp; echo $version)
export IMAGE_TAG_CUSTOMERS_SERVICE=&quot;${ECR_REGISTRY}/${APP_REPO_NAME}:customers-service-qa-v${MVN_VERSION}-b${BUILD_NUMBER}&quot;
MVN_VERSION=$(. ${WORKSPACE}/spring-petclinic-discovery-server/target/maven-archiver/pom.properties &amp;&amp; echo $version)
export IMAGE_TAG_DISCOVERY_SERVER=&quot;${ECR_REGISTRY}/${APP_REPO_NAME}:discovery-server-qa-v${MVN_VERSION}-b${BUILD_NUMBER}&quot;
MVN_VERSION=$(. ${WORKSPACE}/spring-petclinic-hystrix-dashboard/target/maven-archiver/pom.properties &amp;&amp; echo $version)
export IMAGE_TAG_HYSTRIX_DASHBOARD=&quot;${ECR_REGISTRY}/${APP_REPO_NAME}:hystrix-dashboard-qa-v${MVN_VERSION}-b${BUILD_NUMBER}&quot;
MVN_VERSION=$(. ${WORKSPACE}/spring-petclinic-vets-service/target/maven-archiver/pom.properties &amp;&amp; echo $version)
export IMAGE_TAG_VETS_SERVICE=&quot;${ECR_REGISTRY}/${APP_REPO_NAME}:vets-service-qa-v${MVN_VERSION}-b${BUILD_NUMBER}&quot;
MVN_VERSION=$(. ${WORKSPACE}/spring-petclinic-visits-service/target/maven-archiver/pom.properties &amp;&amp; echo $version)
export IMAGE_TAG_VISITS_SERVICE=&quot;${ECR_REGISTRY}/${APP_REPO_NAME}:visits-service-qa-v${MVN_VERSION}-b${BUILD_NUMBER}&quot;
export IMAGE_TAG_GRAFANA_SERVICE=&quot;${ECR_REGISTRY}/${APP_REPO_NAME}:grafana-service&quot;
export IMAGE_TAG_PROMETHEUS_SERVICE=&quot;${ECR_REGISTRY}/${APP_REPO_NAME}:prometheus-service&quot;"><pre>MVN_VERSION=<span class="pl-s"><span class="pl-pds">$(</span>. <span class="pl-smi">${WORKSPACE}</span>/spring-petclinic-admin-server/target/maven-archiver/pom.properties <span class="pl-k">&amp;&amp;</span> <span class="pl-c1">echo</span> <span class="pl-smi">$version</span><span class="pl-pds">)</span></span>
<span class="pl-k">export</span> IMAGE_TAG_ADMIN_SERVER=<span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${ECR_REGISTRY}</span>/<span class="pl-smi">${APP_REPO_NAME}</span>:admin-server-qa-v<span class="pl-smi">${MVN_VERSION}</span>-b<span class="pl-smi">${BUILD_NUMBER}</span><span class="pl-pds">"</span></span>
MVN_VERSION=<span class="pl-s"><span class="pl-pds">$(</span>. <span class="pl-smi">${WORKSPACE}</span>/spring-petclinic-api-gateway/target/maven-archiver/pom.properties <span class="pl-k">&amp;&amp;</span> <span class="pl-c1">echo</span> <span class="pl-smi">$version</span><span class="pl-pds">)</span></span>
<span class="pl-k">export</span> IMAGE_TAG_API_GATEWAY=<span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${ECR_REGISTRY}</span>/<span class="pl-smi">${APP_REPO_NAME}</span>:api-gateway-qa-v<span class="pl-smi">${MVN_VERSION}</span>-b<span class="pl-smi">${BUILD_NUMBER}</span><span class="pl-pds">"</span></span>
MVN_VERSION=<span class="pl-s"><span class="pl-pds">$(</span>. <span class="pl-smi">${WORKSPACE}</span>/spring-petclinic-config-server/target/maven-archiver/pom.properties <span class="pl-k">&amp;&amp;</span> <span class="pl-c1">echo</span> <span class="pl-smi">$version</span><span class="pl-pds">)</span></span>
<span class="pl-k">export</span> IMAGE_TAG_CONFIG_SERVER=<span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${ECR_REGISTRY}</span>/<span class="pl-smi">${APP_REPO_NAME}</span>:config-server-qa-v<span class="pl-smi">${MVN_VERSION}</span>-b<span class="pl-smi">${BUILD_NUMBER}</span><span class="pl-pds">"</span></span>
MVN_VERSION=<span class="pl-s"><span class="pl-pds">$(</span>. <span class="pl-smi">${WORKSPACE}</span>/spring-petclinic-customers-service/target/maven-archiver/pom.properties <span class="pl-k">&amp;&amp;</span> <span class="pl-c1">echo</span> <span class="pl-smi">$version</span><span class="pl-pds">)</span></span>
<span class="pl-k">export</span> IMAGE_TAG_CUSTOMERS_SERVICE=<span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${ECR_REGISTRY}</span>/<span class="pl-smi">${APP_REPO_NAME}</span>:customers-service-qa-v<span class="pl-smi">${MVN_VERSION}</span>-b<span class="pl-smi">${BUILD_NUMBER}</span><span class="pl-pds">"</span></span>
MVN_VERSION=<span class="pl-s"><span class="pl-pds">$(</span>. <span class="pl-smi">${WORKSPACE}</span>/spring-petclinic-discovery-server/target/maven-archiver/pom.properties <span class="pl-k">&amp;&amp;</span> <span class="pl-c1">echo</span> <span class="pl-smi">$version</span><span class="pl-pds">)</span></span>
<span class="pl-k">export</span> IMAGE_TAG_DISCOVERY_SERVER=<span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${ECR_REGISTRY}</span>/<span class="pl-smi">${APP_REPO_NAME}</span>:discovery-server-qa-v<span class="pl-smi">${MVN_VERSION}</span>-b<span class="pl-smi">${BUILD_NUMBER}</span><span class="pl-pds">"</span></span>
MVN_VERSION=<span class="pl-s"><span class="pl-pds">$(</span>. <span class="pl-smi">${WORKSPACE}</span>/spring-petclinic-hystrix-dashboard/target/maven-archiver/pom.properties <span class="pl-k">&amp;&amp;</span> <span class="pl-c1">echo</span> <span class="pl-smi">$version</span><span class="pl-pds">)</span></span>
<span class="pl-k">export</span> IMAGE_TAG_HYSTRIX_DASHBOARD=<span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${ECR_REGISTRY}</span>/<span class="pl-smi">${APP_REPO_NAME}</span>:hystrix-dashboard-qa-v<span class="pl-smi">${MVN_VERSION}</span>-b<span class="pl-smi">${BUILD_NUMBER}</span><span class="pl-pds">"</span></span>
MVN_VERSION=<span class="pl-s"><span class="pl-pds">$(</span>. <span class="pl-smi">${WORKSPACE}</span>/spring-petclinic-vets-service/target/maven-archiver/pom.properties <span class="pl-k">&amp;&amp;</span> <span class="pl-c1">echo</span> <span class="pl-smi">$version</span><span class="pl-pds">)</span></span>
<span class="pl-k">export</span> IMAGE_TAG_VETS_SERVICE=<span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${ECR_REGISTRY}</span>/<span class="pl-smi">${APP_REPO_NAME}</span>:vets-service-qa-v<span class="pl-smi">${MVN_VERSION}</span>-b<span class="pl-smi">${BUILD_NUMBER}</span><span class="pl-pds">"</span></span>
MVN_VERSION=<span class="pl-s"><span class="pl-pds">$(</span>. <span class="pl-smi">${WORKSPACE}</span>/spring-petclinic-visits-service/target/maven-archiver/pom.properties <span class="pl-k">&amp;&amp;</span> <span class="pl-c1">echo</span> <span class="pl-smi">$version</span><span class="pl-pds">)</span></span>
<span class="pl-k">export</span> IMAGE_TAG_VISITS_SERVICE=<span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${ECR_REGISTRY}</span>/<span class="pl-smi">${APP_REPO_NAME}</span>:visits-service-qa-v<span class="pl-smi">${MVN_VERSION}</span>-b<span class="pl-smi">${BUILD_NUMBER}</span><span class="pl-pds">"</span></span>
<span class="pl-k">export</span> IMAGE_TAG_GRAFANA_SERVICE=<span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${ECR_REGISTRY}</span>/<span class="pl-smi">${APP_REPO_NAME}</span>:grafana-service<span class="pl-pds">"</span></span>
<span class="pl-k">export</span> IMAGE_TAG_PROMETHEUS_SERVICE=<span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${ECR_REGISTRY}</span>/<span class="pl-smi">${APP_REPO_NAME}</span>:prometheus-service<span class="pl-pds">"</span></span></pre></div>
<ul dir="auto">
<li>Prepare a script to build the dev docker images tagged for ECR registry and save it as <code>build-qa-docker-images-for-ecr.sh</code> and save it under <code>jenkins</code> folder.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="docker build --force-rm -t &quot;${IMAGE_TAG_ADMIN_SERVER}&quot; &quot;${WORKSPACE}/spring-petclinic-admin-server&quot;
docker build --force-rm -t &quot;${IMAGE_TAG_API_GATEWAY}&quot; &quot;${WORKSPACE}/spring-petclinic-api-gateway&quot;
docker build --force-rm -t &quot;${IMAGE_TAG_CONFIG_SERVER}&quot; &quot;${WORKSPACE}/spring-petclinic-config-server&quot;
docker build --force-rm -t &quot;${IMAGE_TAG_CUSTOMERS_SERVICE}&quot; &quot;${WORKSPACE}/spring-petclinic-customers-service&quot;
docker build --force-rm -t &quot;${IMAGE_TAG_DISCOVERY_SERVER}&quot; &quot;${WORKSPACE}/spring-petclinic-discovery-server&quot;
docker build --force-rm -t &quot;${IMAGE_TAG_HYSTRIX_DASHBOARD}&quot; &quot;${WORKSPACE}/spring-petclinic-hystrix-dashboard&quot;
docker build --force-rm -t &quot;${IMAGE_TAG_VETS_SERVICE}&quot; &quot;${WORKSPACE}/spring-petclinic-vets-service&quot;
docker build --force-rm -t &quot;${IMAGE_TAG_VISITS_SERVICE}&quot; &quot;${WORKSPACE}/spring-petclinic-visits-service&quot;
docker build --force-rm -t &quot;${IMAGE_TAG_GRAFANA_SERVICE}&quot; &quot;${WORKSPACE}/docker/grafana&quot;
docker build --force-rm -t &quot;${IMAGE_TAG_PROMETHEUS_SERVICE}&quot; &quot;${WORKSPACE}/docker/prometheus&quot;"><pre>docker build --force-rm -t <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${IMAGE_TAG_ADMIN_SERVER}</span><span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${WORKSPACE}</span>/spring-petclinic-admin-server<span class="pl-pds">"</span></span>
docker build --force-rm -t <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${IMAGE_TAG_API_GATEWAY}</span><span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${WORKSPACE}</span>/spring-petclinic-api-gateway<span class="pl-pds">"</span></span>
docker build --force-rm -t <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${IMAGE_TAG_CONFIG_SERVER}</span><span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${WORKSPACE}</span>/spring-petclinic-config-server<span class="pl-pds">"</span></span>
docker build --force-rm -t <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${IMAGE_TAG_CUSTOMERS_SERVICE}</span><span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${WORKSPACE}</span>/spring-petclinic-customers-service<span class="pl-pds">"</span></span>
docker build --force-rm -t <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${IMAGE_TAG_DISCOVERY_SERVER}</span><span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${WORKSPACE}</span>/spring-petclinic-discovery-server<span class="pl-pds">"</span></span>
docker build --force-rm -t <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${IMAGE_TAG_HYSTRIX_DASHBOARD}</span><span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${WORKSPACE}</span>/spring-petclinic-hystrix-dashboard<span class="pl-pds">"</span></span>
docker build --force-rm -t <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${IMAGE_TAG_VETS_SERVICE}</span><span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${WORKSPACE}</span>/spring-petclinic-vets-service<span class="pl-pds">"</span></span>
docker build --force-rm -t <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${IMAGE_TAG_VISITS_SERVICE}</span><span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${WORKSPACE}</span>/spring-petclinic-visits-service<span class="pl-pds">"</span></span>
docker build --force-rm -t <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${IMAGE_TAG_GRAFANA_SERVICE}</span><span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${WORKSPACE}</span>/docker/grafana<span class="pl-pds">"</span></span>
docker build --force-rm -t <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${IMAGE_TAG_PROMETHEUS_SERVICE}</span><span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${WORKSPACE}</span>/docker/prometheus<span class="pl-pds">"</span></span></pre></div>
<ul dir="auto">
<li>Prepare a script to push the dev docker images to the ECR repo and save it as <code>push-qa-docker-images-to-ecr.sh</code> and save it under <code>jenkins</code> folder.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="aws ecr get-login-password --region ${AWS_REGION} | docker login --username AWS --password-stdin ${ECR_REGISTRY}
docker push &quot;${IMAGE_TAG_ADMIN_SERVER}&quot;
docker push &quot;${IMAGE_TAG_API_GATEWAY}&quot;
docker push &quot;${IMAGE_TAG_CONFIG_SERVER}&quot;
docker push &quot;${IMAGE_TAG_CUSTOMERS_SERVICE}&quot;
docker push &quot;${IMAGE_TAG_DISCOVERY_SERVER}&quot;
docker push &quot;${IMAGE_TAG_HYSTRIX_DASHBOARD}&quot;
docker push &quot;${IMAGE_TAG_VETS_SERVICE}&quot;
docker push &quot;${IMAGE_TAG_VISITS_SERVICE}&quot;
docker push &quot;${IMAGE_TAG_GRAFANA_SERVICE}&quot;
docker push &quot;${IMAGE_TAG_PROMETHEUS_SERVICE}&quot;"><pre>aws ecr get-login-password --region <span class="pl-smi">${AWS_REGION}</span> <span class="pl-k">|</span> docker login --username AWS --password-stdin <span class="pl-smi">${ECR_REGISTRY}</span>
docker push <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${IMAGE_TAG_ADMIN_SERVER}</span><span class="pl-pds">"</span></span>
docker push <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${IMAGE_TAG_API_GATEWAY}</span><span class="pl-pds">"</span></span>
docker push <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${IMAGE_TAG_CONFIG_SERVER}</span><span class="pl-pds">"</span></span>
docker push <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${IMAGE_TAG_CUSTOMERS_SERVICE}</span><span class="pl-pds">"</span></span>
docker push <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${IMAGE_TAG_DISCOVERY_SERVER}</span><span class="pl-pds">"</span></span>
docker push <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${IMAGE_TAG_HYSTRIX_DASHBOARD}</span><span class="pl-pds">"</span></span>
docker push <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${IMAGE_TAG_VETS_SERVICE}</span><span class="pl-pds">"</span></span>
docker push <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${IMAGE_TAG_VISITS_SERVICE}</span><span class="pl-pds">"</span></span>
docker push <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${IMAGE_TAG_GRAFANA_SERVICE}</span><span class="pl-pds">"</span></span>
docker push <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${IMAGE_TAG_PROMETHEUS_SERVICE}</span><span class="pl-pds">"</span></span></pre></div>
<ul dir="auto">
<li>Prepare a docker compose file for swarm deployment on QA environment and save it as <code>docker-compose-swarm-qa.yml</code> under the project root folder.</li>
</ul>
<div class="highlight highlight-source-yaml position-relative overflow-auto" data-snippet-clipboard-copy-content="version: '3.8'

services:
  config-server:
    image: &quot;${IMAGE_TAG_CONFIG_SERVER}&quot;
    deploy:
      resources:
        limits:
          memory: 512M
    networks:
      - clarusnet
    ports:
     - 8888:8888

  discovery-server:
    image: &quot;${IMAGE_TAG_DISCOVERY_SERVER}&quot;
    deploy:
      resources:
        limits:
          memory: 512M
    depends_on:
      - config-server
    entrypoint: [&quot;./dockerize&quot;,&quot;-wait=tcp://config-server:8888&quot;,&quot;-timeout=60s&quot;,&quot;--&quot;,&quot;java&quot;, &quot;-Djava.security.egd=file:/dev/./urandom&quot;,&quot;-jar&quot;,&quot;/app.jar&quot;]
    networks:
      - clarusnet
    ports:
     - 8761:8761

  customers-service:
    image: &quot;${IMAGE_TAG_CUSTOMERS_SERVICE}&quot;
    deploy:
      resources:
        limits:
          memory: 512M
      replicas: 3
      update_config:
          parallelism: 2
          delay: 5s
          order: start-first
    depends_on:
     - config-server
     - discovery-server
    entrypoint: [&quot;./dockerize&quot;,&quot;-wait=tcp://discovery-server:8761&quot;,&quot;-timeout=60s&quot;,&quot;--&quot;,&quot;java&quot;, &quot;-Djava.security.egd=file:/dev/./urandom&quot;,&quot;-jar&quot;,&quot;/app.jar&quot;]
    networks:
      - clarusnet
    ports:
    - 8081:8081

  visits-service:
    image: &quot;${IMAGE_TAG_VISITS_SERVICE}&quot;
    deploy:
      resources:
        limits:
          memory: 512M
      replicas: 3
      update_config:
          parallelism: 2
          delay: 5s
          order: start-first
    depends_on:
     - config-server
     - discovery-server
    entrypoint: [&quot;./dockerize&quot;,&quot;-wait=tcp://discovery-server:8761&quot;,&quot;-timeout=60s&quot;,&quot;--&quot;,&quot;java&quot;, &quot;-Djava.security.egd=file:/dev/./urandom&quot;,&quot;-jar&quot;,&quot;/app.jar&quot;]
    networks:
      - clarusnet
    ports:
     - 8082:8082

  vets-service:
    image: &quot;${IMAGE_TAG_VETS_SERVICE}&quot;
    deploy:
      resources:
        limits:
          memory: 512M
      replicas: 3
      update_config:
          parallelism: 2
          delay: 5s
          order: start-first
    depends_on:
     - config-server
     - discovery-server
    entrypoint: [&quot;./dockerize&quot;,&quot;-wait=tcp://discovery-server:8761&quot;,&quot;-timeout=60s&quot;,&quot;--&quot;,&quot;java&quot;, &quot;-Djava.security.egd=file:/dev/./urandom&quot;,&quot;-jar&quot;,&quot;/app.jar&quot;]
    networks:
      - clarusnet
    ports:
     - 8083:8083

  api-gateway:
    image: &quot;${IMAGE_TAG_API_GATEWAY}&quot;
    deploy:
      resources:
        limits:
          memory: 512M
      replicas: 5
      update_config:
          parallelism: 2
          delay: 5s
          order: start-first
    depends_on:
     - config-server
     - discovery-server
    entrypoint: [&quot;./dockerize&quot;,&quot;-wait=tcp://discovery-server:8761&quot;,&quot;-timeout=60s&quot;,&quot;--&quot;,&quot;java&quot;, &quot;-Djava.security.egd=file:/dev/./urandom&quot;,&quot;-jar&quot;,&quot;/app.jar&quot;]
    networks:
      - clarusnet
    ports:
     - 8080:8080

  tracing-server:
    image: openzipkin/zipkin
    deploy:
      resources:
        limits:
          memory: 512M
    environment:
    - JAVA_OPTS=-XX:+UnlockExperimentalVMOptions -Djava.security.egd=file:/dev/./urandom
    networks:
      - clarusnet
    ports:
     - 9411:9411

  admin-server:
    image: &quot;${IMAGE_TAG_ADMIN_SERVER}&quot;
    deploy:
      resources:
        limits:
          memory: 512M
    depends_on:
     - config-server
     - discovery-server
    entrypoint: [&quot;./dockerize&quot;,&quot;-wait=tcp://discovery-server:8761&quot;,&quot;-timeout=60s&quot;,&quot;--&quot;,&quot;java&quot;, &quot;-Djava.security.egd=file:/dev/./urandom&quot;,&quot;-jar&quot;,&quot;/app.jar&quot;]
    networks:
      - clarusnet
    ports:
     - 9090:9090

  hystrix-dashboard:
    image: &quot;${IMAGE_TAG_HYSTRIX_DASHBOARD}&quot;
    deploy:
      resources:
        limits:
          memory: 512M
    depends_on:
     - config-server
     - discovery-server
    entrypoint: [&quot;./dockerize&quot;,&quot;-wait=tcp://discovery-server:8761&quot;,&quot;-timeout=60s&quot;,&quot;--&quot;,&quot;java&quot;, &quot;-Djava.security.egd=file:/dev/./urandom&quot;,&quot;-jar&quot;,&quot;/app.jar&quot;]
    networks:
      - clarusnet
    ports:
     - 7979:7979

  ## Grafana / Prometheus

  grafana-server:
    image: &quot;${IMAGE_TAG_GRAFANA_SERVICE}&quot;
    deploy:
      resources:
        limits:
          memory: 256M
    networks:
      - clarusnet
    ports:
    - 3000:3000

  prometheus-server:
    image: &quot;${IMAGE_TAG_PROMETHEUS_SERVICE}&quot;
    deploy:
      resources:
        limits:
          memory: 256M
    networks:
      - clarusnet
    ports:
    - 9091:9090
  
  mysql-server:
    image: mysql:5.7.8
    environment: 
      MYSQL_ROOT_PASSWORD: petclinic
      MYSQL_DATABASE: petclinic
    networks:
      - clarusnet
    ports:
      - 3306:3306

networks:
  clarusnet:
    driver: overlay"><pre><span class="pl-ent">version</span>: <span class="pl-s"><span class="pl-pds">'</span>3.8<span class="pl-pds">'</span></span>

<span class="pl-ent">services</span>:
  <span class="pl-ent">config-server</span>:
    <span class="pl-ent">image</span>: <span class="pl-s"><span class="pl-pds">"</span>${IMAGE_TAG_CONFIG_SERVER}<span class="pl-pds">"</span></span>
    <span class="pl-ent">deploy</span>:
      <span class="pl-ent">resources</span>:
        <span class="pl-ent">limits</span>:
          <span class="pl-ent">memory</span>: <span class="pl-c1">512M</span>
    <span class="pl-ent">networks</span>:
      - <span class="pl-s">clarusnet</span>
    <span class="pl-ent">ports</span>:
     - <span class="pl-c1">8888:8888</span>

  <span class="pl-ent">discovery-server</span>:
    <span class="pl-ent">image</span>: <span class="pl-s"><span class="pl-pds">"</span>${IMAGE_TAG_DISCOVERY_SERVER}<span class="pl-pds">"</span></span>
    <span class="pl-ent">deploy</span>:
      <span class="pl-ent">resources</span>:
        <span class="pl-ent">limits</span>:
          <span class="pl-ent">memory</span>: <span class="pl-c1">512M</span>
    <span class="pl-ent">depends_on</span>:
      - <span class="pl-s">config-server</span>
    <span class="pl-ent">entrypoint</span>: <span class="pl-s">["./dockerize","-wait=tcp://config-server:8888","-timeout=60s","--","java", "-Djava.security.egd=file:/dev/./urandom","-jar","/app.jar"]</span>
    <span class="pl-ent">networks</span>:
      - <span class="pl-s">clarusnet</span>
    <span class="pl-ent">ports</span>:
     - <span class="pl-c1">8761:8761</span>

  <span class="pl-ent">customers-service</span>:
    <span class="pl-ent">image</span>: <span class="pl-s"><span class="pl-pds">"</span>${IMAGE_TAG_CUSTOMERS_SERVICE}<span class="pl-pds">"</span></span>
    <span class="pl-ent">deploy</span>:
      <span class="pl-ent">resources</span>:
        <span class="pl-ent">limits</span>:
          <span class="pl-ent">memory</span>: <span class="pl-c1">512M</span>
      <span class="pl-ent">replicas</span>: <span class="pl-c1">3</span>
      <span class="pl-ent">update_config</span>:
          <span class="pl-ent">parallelism</span>: <span class="pl-c1">2</span>
          <span class="pl-ent">delay</span>: <span class="pl-c1">5s</span>
          <span class="pl-ent">order</span>: <span class="pl-s">start-first</span>
    <span class="pl-ent">depends_on</span>:
     - <span class="pl-s">config-server</span>
     - <span class="pl-s">discovery-server</span>
    <span class="pl-ent">entrypoint</span>: <span class="pl-s">["./dockerize","-wait=tcp://discovery-server:8761","-timeout=60s","--","java", "-Djava.security.egd=file:/dev/./urandom","-jar","/app.jar"]</span>
    <span class="pl-ent">networks</span>:
      - <span class="pl-s">clarusnet</span>
    <span class="pl-ent">ports</span>:
    - <span class="pl-c1">8081:8081</span>

  <span class="pl-ent">visits-service</span>:
    <span class="pl-ent">image</span>: <span class="pl-s"><span class="pl-pds">"</span>${IMAGE_TAG_VISITS_SERVICE}<span class="pl-pds">"</span></span>
    <span class="pl-ent">deploy</span>:
      <span class="pl-ent">resources</span>:
        <span class="pl-ent">limits</span>:
          <span class="pl-ent">memory</span>: <span class="pl-c1">512M</span>
      <span class="pl-ent">replicas</span>: <span class="pl-c1">3</span>
      <span class="pl-ent">update_config</span>:
          <span class="pl-ent">parallelism</span>: <span class="pl-c1">2</span>
          <span class="pl-ent">delay</span>: <span class="pl-c1">5s</span>
          <span class="pl-ent">order</span>: <span class="pl-s">start-first</span>
    <span class="pl-ent">depends_on</span>:
     - <span class="pl-s">config-server</span>
     - <span class="pl-s">discovery-server</span>
    <span class="pl-ent">entrypoint</span>: <span class="pl-s">["./dockerize","-wait=tcp://discovery-server:8761","-timeout=60s","--","java", "-Djava.security.egd=file:/dev/./urandom","-jar","/app.jar"]</span>
    <span class="pl-ent">networks</span>:
      - <span class="pl-s">clarusnet</span>
    <span class="pl-ent">ports</span>:
     - <span class="pl-c1">8082:8082</span>

  <span class="pl-ent">vets-service</span>:
    <span class="pl-ent">image</span>: <span class="pl-s"><span class="pl-pds">"</span>${IMAGE_TAG_VETS_SERVICE}<span class="pl-pds">"</span></span>
    <span class="pl-ent">deploy</span>:
      <span class="pl-ent">resources</span>:
        <span class="pl-ent">limits</span>:
          <span class="pl-ent">memory</span>: <span class="pl-c1">512M</span>
      <span class="pl-ent">replicas</span>: <span class="pl-c1">3</span>
      <span class="pl-ent">update_config</span>:
          <span class="pl-ent">parallelism</span>: <span class="pl-c1">2</span>
          <span class="pl-ent">delay</span>: <span class="pl-c1">5s</span>
          <span class="pl-ent">order</span>: <span class="pl-s">start-first</span>
    <span class="pl-ent">depends_on</span>:
     - <span class="pl-s">config-server</span>
     - <span class="pl-s">discovery-server</span>
    <span class="pl-ent">entrypoint</span>: <span class="pl-s">["./dockerize","-wait=tcp://discovery-server:8761","-timeout=60s","--","java", "-Djava.security.egd=file:/dev/./urandom","-jar","/app.jar"]</span>
    <span class="pl-ent">networks</span>:
      - <span class="pl-s">clarusnet</span>
    <span class="pl-ent">ports</span>:
     - <span class="pl-c1">8083:8083</span>

  <span class="pl-ent">api-gateway</span>:
    <span class="pl-ent">image</span>: <span class="pl-s"><span class="pl-pds">"</span>${IMAGE_TAG_API_GATEWAY}<span class="pl-pds">"</span></span>
    <span class="pl-ent">deploy</span>:
      <span class="pl-ent">resources</span>:
        <span class="pl-ent">limits</span>:
          <span class="pl-ent">memory</span>: <span class="pl-c1">512M</span>
      <span class="pl-ent">replicas</span>: <span class="pl-c1">5</span>
      <span class="pl-ent">update_config</span>:
          <span class="pl-ent">parallelism</span>: <span class="pl-c1">2</span>
          <span class="pl-ent">delay</span>: <span class="pl-c1">5s</span>
          <span class="pl-ent">order</span>: <span class="pl-s">start-first</span>
    <span class="pl-ent">depends_on</span>:
     - <span class="pl-s">config-server</span>
     - <span class="pl-s">discovery-server</span>
    <span class="pl-ent">entrypoint</span>: <span class="pl-s">["./dockerize","-wait=tcp://discovery-server:8761","-timeout=60s","--","java", "-Djava.security.egd=file:/dev/./urandom","-jar","/app.jar"]</span>
    <span class="pl-ent">networks</span>:
      - <span class="pl-s">clarusnet</span>
    <span class="pl-ent">ports</span>:
     - <span class="pl-c1">8080:8080</span>

  <span class="pl-ent">tracing-server</span>:
    <span class="pl-ent">image</span>: <span class="pl-s">openzipkin/zipkin</span>
    <span class="pl-ent">deploy</span>:
      <span class="pl-ent">resources</span>:
        <span class="pl-ent">limits</span>:
          <span class="pl-ent">memory</span>: <span class="pl-c1">512M</span>
    <span class="pl-ent">environment</span>:
    - <span class="pl-s">JAVA_OPTS=-XX:+UnlockExperimentalVMOptions -Djava.security.egd=file:/dev/./urandom</span>
    <span class="pl-ent">networks</span>:
      - <span class="pl-s">clarusnet</span>
    <span class="pl-ent">ports</span>:
     - <span class="pl-c1">9411:9411</span>

  <span class="pl-ent">admin-server</span>:
    <span class="pl-ent">image</span>: <span class="pl-s"><span class="pl-pds">"</span>${IMAGE_TAG_ADMIN_SERVER}<span class="pl-pds">"</span></span>
    <span class="pl-ent">deploy</span>:
      <span class="pl-ent">resources</span>:
        <span class="pl-ent">limits</span>:
          <span class="pl-ent">memory</span>: <span class="pl-c1">512M</span>
    <span class="pl-ent">depends_on</span>:
     - <span class="pl-s">config-server</span>
     - <span class="pl-s">discovery-server</span>
    <span class="pl-ent">entrypoint</span>: <span class="pl-s">["./dockerize","-wait=tcp://discovery-server:8761","-timeout=60s","--","java", "-Djava.security.egd=file:/dev/./urandom","-jar","/app.jar"]</span>
    <span class="pl-ent">networks</span>:
      - <span class="pl-s">clarusnet</span>
    <span class="pl-ent">ports</span>:
     - <span class="pl-c1">9090:9090</span>

  <span class="pl-ent">hystrix-dashboard</span>:
    <span class="pl-ent">image</span>: <span class="pl-s"><span class="pl-pds">"</span>${IMAGE_TAG_HYSTRIX_DASHBOARD}<span class="pl-pds">"</span></span>
    <span class="pl-ent">deploy</span>:
      <span class="pl-ent">resources</span>:
        <span class="pl-ent">limits</span>:
          <span class="pl-ent">memory</span>: <span class="pl-c1">512M</span>
    <span class="pl-ent">depends_on</span>:
     - <span class="pl-s">config-server</span>
     - <span class="pl-s">discovery-server</span>
    <span class="pl-ent">entrypoint</span>: <span class="pl-s">["./dockerize","-wait=tcp://discovery-server:8761","-timeout=60s","--","java", "-Djava.security.egd=file:/dev/./urandom","-jar","/app.jar"]</span>
    <span class="pl-ent">networks</span>:
      - <span class="pl-s">clarusnet</span>
    <span class="pl-ent">ports</span>:
     - <span class="pl-c1">7979:7979</span>

  <span class="pl-c"><span class="pl-c">#</span># Grafana / Prometheus</span>

  <span class="pl-ent">grafana-server</span>:
    <span class="pl-ent">image</span>: <span class="pl-s"><span class="pl-pds">"</span>${IMAGE_TAG_GRAFANA_SERVICE}<span class="pl-pds">"</span></span>
    <span class="pl-ent">deploy</span>:
      <span class="pl-ent">resources</span>:
        <span class="pl-ent">limits</span>:
          <span class="pl-ent">memory</span>: <span class="pl-c1">256M</span>
    <span class="pl-ent">networks</span>:
      - <span class="pl-s">clarusnet</span>
    <span class="pl-ent">ports</span>:
    - <span class="pl-c1">3000:3000</span>

  <span class="pl-ent">prometheus-server</span>:
    <span class="pl-ent">image</span>: <span class="pl-s"><span class="pl-pds">"</span>${IMAGE_TAG_PROMETHEUS_SERVICE}<span class="pl-pds">"</span></span>
    <span class="pl-ent">deploy</span>:
      <span class="pl-ent">resources</span>:
        <span class="pl-ent">limits</span>:
          <span class="pl-ent">memory</span>: <span class="pl-c1">256M</span>
    <span class="pl-ent">networks</span>:
      - <span class="pl-s">clarusnet</span>
    <span class="pl-ent">ports</span>:
    - <span class="pl-c1">9091:9090</span>
  
  <span class="pl-ent">mysql-server</span>:
    <span class="pl-ent">image</span>: <span class="pl-s">mysql:5.7.8</span>
    <span class="pl-ent">environment</span>: 
      <span class="pl-ent">MYSQL_ROOT_PASSWORD</span>: <span class="pl-s">petclinic</span>
      <span class="pl-ent">MYSQL_DATABASE</span>: <span class="pl-s">petclinic</span>
    <span class="pl-ent">networks</span>:
      - <span class="pl-s">clarusnet</span>
    <span class="pl-ent">ports</span>:
      - <span class="pl-c1">3306:3306</span>

<span class="pl-ent">networks</span>:
  <span class="pl-ent">clarusnet</span>:
    <span class="pl-ent">driver</span>: <span class="pl-s">overlay</span></pre></div>
<ul dir="auto">
<li>Create Ansible playbook for deploying app on QA environment using docker compose file and save it as <code>pb_deploy_app_on_qa_environment.yaml</code> under <code>ansible/playbooks</code> folder.</li>
</ul>
<div class="highlight highlight-source-yaml position-relative overflow-auto" data-snippet-clipboard-copy-content="---
- hosts: role_grand_master
  tasks:
  - name: Copy docker compose file to grand master
    copy:
      src: &quot;{{ workspace }}/docker-compose-swarm-qa-tagged.yml&quot;
      dest: /home/ec2-user/docker-compose-swarm-qa-tagged.yml

  - name: get login credentials for ecr
    shell: &quot;export PATH=$PATH:/usr/local/bin/ &amp;&amp; aws ecr get-login-password --region {{ aws_region }} | docker login --username AWS --password-stdin {{ ecr_registry }}&quot;
    register: output

  - name: deploy the app stack on swarm
    shell: &quot;docker stack deploy --with-registry-auth -c /home/ec2-user/docker-compose-swarm-qa-tagged.yml {{ app_name }}&quot;
    register: output

  - debug: msg=&quot;{{ output.stdout }}&quot;"><pre>---
- <span class="pl-ent">hosts</span>: <span class="pl-s">role_grand_master</span>
  <span class="pl-ent">tasks</span>:
  - <span class="pl-ent">name</span>: <span class="pl-s">Copy docker compose file to grand master</span>
    <span class="pl-ent">copy</span>:
      <span class="pl-ent">src</span>: <span class="pl-s"><span class="pl-pds">"</span>{{ workspace }}/docker-compose-swarm-qa-tagged.yml<span class="pl-pds">"</span></span>
      <span class="pl-ent">dest</span>: <span class="pl-s">/home/ec2-user/docker-compose-swarm-qa-tagged.yml</span>

  - <span class="pl-ent">name</span>: <span class="pl-s">get login credentials for ecr</span>
    <span class="pl-ent">shell</span>: <span class="pl-s"><span class="pl-pds">"</span>export PATH=$PATH:/usr/local/bin/ &amp;&amp; aws ecr get-login-password --region {{ aws_region }} | docker login --username AWS --password-stdin {{ ecr_registry }}<span class="pl-pds">"</span></span>
    <span class="pl-ent">register</span>: <span class="pl-s">output</span>

  - <span class="pl-ent">name</span>: <span class="pl-s">deploy the app stack on swarm</span>
    <span class="pl-ent">shell</span>: <span class="pl-s"><span class="pl-pds">"</span>docker stack deploy --with-registry-auth -c /home/ec2-user/docker-compose-swarm-qa-tagged.yml {{ app_name }}<span class="pl-pds">"</span></span>
    <span class="pl-ent">register</span>: <span class="pl-s">output</span>

  - <span class="pl-ent">debug</span>: <span class="pl-s">msg="{{ output.stdout }}"</span></pre></div>
<ul dir="auto">
<li>Prepare a script to deploy the application on QA environment and save it as <code>deploy_app_on_qa_environment.sh</code> under <code>ansible/scripts</code> folder.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="PATH=&quot;$PATH:/usr/local/bin&quot;
APP_NAME=&quot;petclinic&quot;
sed -i &quot;s/APP_STACK_NAME/${APP_STACK_NAME}/&quot; ./ansible/inventory/qa_stack_dynamic_inventory_aws_ec2.yaml
envsubst &lt; docker-compose-swarm-qa.yml &gt; docker-compose-swarm-qa-tagged.yml
ansible-playbook -i ./ansible/inventory/qa_stack_dynamic_inventory_aws_ec2.yaml -b --extra-vars &quot;workspace=${WORKSPACE} app_name=${APP_NAME} aws_region=${AWS_REGION} ecr_registry=${ECR_REGISTRY}&quot; ./ansible/playbooks/pb_deploy_app_on_qa_environment.yaml"><pre>PATH=<span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">$PATH</span>:/usr/local/bin<span class="pl-pds">"</span></span>
APP_NAME=<span class="pl-s"><span class="pl-pds">"</span>petclinic<span class="pl-pds">"</span></span>
sed -i <span class="pl-s"><span class="pl-pds">"</span>s/APP_STACK_NAME/<span class="pl-smi">${APP_STACK_NAME}</span>/<span class="pl-pds">"</span></span> ./ansible/inventory/qa_stack_dynamic_inventory_aws_ec2.yaml
envsubst <span class="pl-k">&lt;</span> docker-compose-swarm-qa.yml <span class="pl-k">&gt;</span> docker-compose-swarm-qa-tagged.yml
ansible-playbook -i ./ansible/inventory/qa_stack_dynamic_inventory_aws_ec2.yaml -b --extra-vars <span class="pl-s"><span class="pl-pds">"</span>workspace=<span class="pl-smi">${WORKSPACE}</span> app_name=<span class="pl-smi">${APP_NAME}</span> aws_region=<span class="pl-smi">${AWS_REGION}</span> ecr_registry=<span class="pl-smi">${ECR_REGISTRY}</span><span class="pl-pds">"</span></span> ./ansible/playbooks/pb_deploy_app_on_qa_environment.yaml</pre></div>
<ul dir="auto">
<li>Commit the change, then push the script to the remote repo.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="git add .
git commit -m 'added build scripts for QA Environment'
git push --set-upstream origin feature/msp-19
git checkout dev
git merge feature/msp-19
git push origin dev"><pre>git add <span class="pl-c1">.</span>
git commit -m <span class="pl-s"><span class="pl-pds">'</span>added build scripts for QA Environment<span class="pl-pds">'</span></span>
git push --set-upstream origin feature/msp-19
git checkout dev
git merge feature/msp-19
git push origin dev</pre></div>
<h2 dir="auto"><a id="user-content-msp-20---build-and-deploy-app-on-qa-environment-manually" class="anchor" aria-hidden="true" href="#msp-20---build-and-deploy-app-on-qa-environment-manually"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>MSP 20 - Build and Deploy App on QA Environment Manually</h2>
<ul dir="auto">
<li>Create <code>feature/msp-20</code> branch from <code>dev</code>.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="git checkout dev
git branch feature/msp-20
git checkout feature/msp-20"><pre>git checkout dev
git branch feature/msp-20
git checkout feature/msp-20</pre></div>
<ul dir="auto">
<li>Create a Jenkins Job with name of <code>build-and-deploy-petclinic-on-qa-env</code> to build and deploy the app on <code>QA environment</code> manually on <code>release</code> branch using following script, and save the script as <code>build-and-deploy-petclinic-on-qa-env-manually.sh</code> under <code>jenkins</code> folder.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="PATH=&quot;$PATH:/usr/local/bin&quot;
APP_NAME=&quot;petclinic&quot;
APP_REPO_NAME=&quot;clarusway-repo/petclinic-app-qa&quot;
APP_STACK_NAME=&quot;Call-petclinic-App-QA-1&quot;
CFN_KEYPAIR=&quot;call-petclinic-qa.key&quot;
AWS_ACCOUNT_ID=$(aws sts get-caller-identity --query Account --output text)
AWS_REGION=&quot;us-east-1&quot;
ECR_REGISTRY=&quot;${AWS_ACCOUNT_ID}.dkr.ecr.${AWS_REGION}.amazonaws.com&quot;
export ANSIBLE_PRIVATE_KEY_FILE=&quot;${JENKINS_HOME}/.ssh/${CFN_KEYPAIR}&quot;
export ANSIBLE_HOST_KEY_CHECKING=&quot;False&quot;
echo 'Packaging the App into Jars with Maven'
. ./jenkins/package-with-maven-container.sh
echo 'Preparing QA Tags for Docker Images'
. ./jenkins/prepare-tags-ecr-for-qa-docker-images.sh
echo 'Building App QA Images'
. ./jenkins/build-qa-docker-images-for-ecr.sh
echo &quot;Pushing App QA Images to ECR Repo&quot;
. ./jenkins/push-qa-docker-images-to-ecr.sh
echo 'Deploying App on Swarm'
. ./ansible/scripts/deploy_app_on_qa_environment.sh
echo 'Deleting all local images'
docker image prune -af"><pre>PATH=<span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">$PATH</span>:/usr/local/bin<span class="pl-pds">"</span></span>
APP_NAME=<span class="pl-s"><span class="pl-pds">"</span>petclinic<span class="pl-pds">"</span></span>
APP_REPO_NAME=<span class="pl-s"><span class="pl-pds">"</span>clarusway-repo/petclinic-app-qa<span class="pl-pds">"</span></span>
APP_STACK_NAME=<span class="pl-s"><span class="pl-pds">"</span>Call-petclinic-App-QA-1<span class="pl-pds">"</span></span>
CFN_KEYPAIR=<span class="pl-s"><span class="pl-pds">"</span>call-petclinic-qa.key<span class="pl-pds">"</span></span>
AWS_ACCOUNT_ID=<span class="pl-s"><span class="pl-pds">$(</span>aws sts get-caller-identity --query Account --output text<span class="pl-pds">)</span></span>
AWS_REGION=<span class="pl-s"><span class="pl-pds">"</span>us-east-1<span class="pl-pds">"</span></span>
ECR_REGISTRY=<span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${AWS_ACCOUNT_ID}</span>.dkr.ecr.<span class="pl-smi">${AWS_REGION}</span>.amazonaws.com<span class="pl-pds">"</span></span>
<span class="pl-k">export</span> ANSIBLE_PRIVATE_KEY_FILE=<span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${JENKINS_HOME}</span>/.ssh/<span class="pl-smi">${CFN_KEYPAIR}</span><span class="pl-pds">"</span></span>
<span class="pl-k">export</span> ANSIBLE_HOST_KEY_CHECKING=<span class="pl-s"><span class="pl-pds">"</span>False<span class="pl-pds">"</span></span>
<span class="pl-c1">echo</span> <span class="pl-s"><span class="pl-pds">'</span>Packaging the App into Jars with Maven<span class="pl-pds">'</span></span>
<span class="pl-c1">.</span> ./jenkins/package-with-maven-container.sh
<span class="pl-c1">echo</span> <span class="pl-s"><span class="pl-pds">'</span>Preparing QA Tags for Docker Images<span class="pl-pds">'</span></span>
<span class="pl-c1">.</span> ./jenkins/prepare-tags-ecr-for-qa-docker-images.sh
<span class="pl-c1">echo</span> <span class="pl-s"><span class="pl-pds">'</span>Building App QA Images<span class="pl-pds">'</span></span>
<span class="pl-c1">.</span> ./jenkins/build-qa-docker-images-for-ecr.sh
<span class="pl-c1">echo</span> <span class="pl-s"><span class="pl-pds">"</span>Pushing App QA Images to ECR Repo<span class="pl-pds">"</span></span>
<span class="pl-c1">.</span> ./jenkins/push-qa-docker-images-to-ecr.sh
<span class="pl-c1">echo</span> <span class="pl-s"><span class="pl-pds">'</span>Deploying App on Swarm<span class="pl-pds">'</span></span>
<span class="pl-c1">.</span> ./ansible/scripts/deploy_app_on_qa_environment.sh
<span class="pl-c1">echo</span> <span class="pl-s"><span class="pl-pds">'</span>Deleting all local images<span class="pl-pds">'</span></span>
docker image prune -af</pre></div>
<ul dir="auto">
<li>Commit the change, then push the script to the remote repo.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="git add .
git commit -m 'added script for jenkins job to build and deploy app on QA environment'
git push --set-upstream origin feature/msp-20
git checkout dev
git merge feature/msp-20
git push origin dev"><pre>git add <span class="pl-c1">.</span>
git commit -m <span class="pl-s"><span class="pl-pds">'</span>added script for jenkins job to build and deploy app on QA environment<span class="pl-pds">'</span></span>
git push --set-upstream origin feature/msp-20
git checkout dev
git merge feature/msp-20
git push origin dev</pre></div>
<ul dir="auto">
<li>Merge <code>dev</code> into <code>release</code> branch, then run <code>build-and-deploy-petclinic-on-qa-env</code> job to build and deploy the app on <code>QA environment</code> manually.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="git checkout release
git merge dev
git push origin release"><pre>git checkout release
git merge dev
git push origin release</pre></div>
<h2 dir="auto"><a id="user-content-msp-21---prepare-a-qa-pipeline" class="anchor" aria-hidden="true" href="#msp-21---prepare-a-qa-pipeline"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>MSP 21 - Prepare a QA Pipeline</h2>
<ul dir="auto">
<li>Create <code>feature/msp-21</code> branch from <code>dev</code>.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="git checkout dev
git branch feature/msp-21
git checkout feature/msp-21"><pre>git checkout dev
git branch feature/msp-21
git checkout feature/msp-21</pre></div>
<ul dir="auto">
<li>
<p dir="auto">Create a QA Pipeline on Jenkins with name of <code>petclinic-weekly-qa</code> with following script and configure a <code>cron job</code> to trigger the pipeline every Sundays at midnight (<code>59 23 * * 0</code>) on <code>release</code> branch. Petclinic weekly build pipeline should be built on permanent QA environment.</p>
</li>
<li>
<p dir="auto">Prepare a Jenkinsfile for <code>petclinic-weekly-qa</code> builds and save it as <code>jenkinsfile-petclinic-weekly-qa</code> under <code>jenkins</code> folder.</p>
</li>
</ul>
<div class="highlight highlight-source-groovy position-relative overflow-auto" data-snippet-clipboard-copy-content="pipeline {
    agent any
    environment {
        PATH=sh(script:&quot;echo $PATH:/usr/local/bin&quot;, returnStdout:true).trim()
        APP_NAME=&quot;petclinic&quot;
        APP_REPO_NAME=&quot;clarusway-repo/petclinic-app-qa&quot;
        APP_STACK_NAME=&quot;Matt-petclinic-App-QA-1&quot;
        CFN_KEYPAIR=&quot;matt-petclinic-qa.key&quot;
        AWS_ACCOUNT_ID=sh(script:'export PATH=&quot;$PATH:/usr/local/bin&quot; &amp;&amp; aws sts get-caller-identity --query Account --output text', returnStdout:true).trim()
        AWS_REGION=&quot;us-east-1&quot;
        ECR_REGISTRY=&quot;${AWS_ACCOUNT_ID}.dkr.ecr.${AWS_REGION}.amazonaws.com&quot;
        ANSIBLE_PRIVATE_KEY_FILE=&quot;${JENKINS_HOME}/.ssh/${CFN_KEYPAIR}&quot;
        ANSIBLE_HOST_KEY_CHECKING=&quot;False&quot;
    }
    stages {
        stage('Package Application') {
            steps {
                echo 'Packaging the app into jars with maven'
                sh &quot;. ./jenkins/package-with-maven-container.sh&quot;
            }
        }
        stage('Prepare Tags for Docker Images') {
            steps {
                echo 'Preparing Tags for Docker Images'
                script {
                    MVN_VERSION=sh(script:'. ${WORKSPACE}/spring-petclinic-admin-server/target/maven-archiver/pom.properties &amp;&amp; echo $version', returnStdout:true).trim()
                    env.IMAGE_TAG_ADMIN_SERVER=&quot;${ECR_REGISTRY}/${APP_REPO_NAME}:admin-server-qa-v${MVN_VERSION}-b${BUILD_NUMBER}&quot;
                    MVN_VERSION=sh(script:'. ${WORKSPACE}/spring-petclinic-api-gateway/target/maven-archiver/pom.properties &amp;&amp; echo $version', returnStdout:true).trim()
                    env.IMAGE_TAG_API_GATEWAY=&quot;${ECR_REGISTRY}/${APP_REPO_NAME}:api-gateway-qa-v${MVN_VERSION}-b${BUILD_NUMBER}&quot;
                    MVN_VERSION=sh(script:'. ${WORKSPACE}/spring-petclinic-config-server/target/maven-archiver/pom.properties &amp;&amp; echo $version', returnStdout:true).trim()
                    env.IMAGE_TAG_CONFIG_SERVER=&quot;${ECR_REGISTRY}/${APP_REPO_NAME}:config-server-qa-v${MVN_VERSION}-b${BUILD_NUMBER}&quot;
                    MVN_VERSION=sh(script:'. ${WORKSPACE}/spring-petclinic-customers-service/target/maven-archiver/pom.properties &amp;&amp; echo $version', returnStdout:true).trim()
                    env.IMAGE_TAG_CUSTOMERS_SERVICE=&quot;${ECR_REGISTRY}/${APP_REPO_NAME}:customers-service-qa-v${MVN_VERSION}-b${BUILD_NUMBER}&quot;
                    MVN_VERSION=sh(script:'. ${WORKSPACE}/spring-petclinic-discovery-server/target/maven-archiver/pom.properties &amp;&amp; echo $version', returnStdout:true).trim()
                    env.IMAGE_TAG_DISCOVERY_SERVER=&quot;${ECR_REGISTRY}/${APP_REPO_NAME}:discovery-server-qa-v${MVN_VERSION}-b${BUILD_NUMBER}&quot;
                    MVN_VERSION=sh(script:'. ${WORKSPACE}/spring-petclinic-hystrix-dashboard/target/maven-archiver/pom.properties &amp;&amp; echo $version', returnStdout:true).trim()
                    env.IMAGE_TAG_HYSTRIX_DASHBOARD=&quot;${ECR_REGISTRY}/${APP_REPO_NAME}:hystrix-dashboard-qa-v${MVN_VERSION}-b${BUILD_NUMBER}&quot;
                    MVN_VERSION=sh(script:'. ${WORKSPACE}/spring-petclinic-vets-service/target/maven-archiver/pom.properties &amp;&amp; echo $version', returnStdout:true).trim()
                    env.IMAGE_TAG_VETS_SERVICE=&quot;${ECR_REGISTRY}/${APP_REPO_NAME}:vets-service-qa-v${MVN_VERSION}-b${BUILD_NUMBER}&quot;
                    MVN_VERSION=sh(script:'. ${WORKSPACE}/spring-petclinic-visits-service/target/maven-archiver/pom.properties &amp;&amp; echo $version', returnStdout:true).trim()
                    env.IMAGE_TAG_VISITS_SERVICE=&quot;${ECR_REGISTRY}/${APP_REPO_NAME}:visits-service-qa-v${MVN_VERSION}-b${BUILD_NUMBER}&quot;
                    env.IMAGE_TAG_GRAFANA_SERVICE=&quot;${ECR_REGISTRY}/${APP_REPO_NAME}:grafana-service&quot;
                    env.IMAGE_TAG_PROMETHEUS_SERVICE=&quot;${ECR_REGISTRY}/${APP_REPO_NAME}:prometheus-service&quot;
                }
            }
        }
        stage('Build App Docker Images') {
            steps {
                echo 'Building App Dev Images'
                sh &quot;. ./jenkins/build-qa-docker-images-for-ecr.sh&quot;
                sh 'docker image ls'
            }
        }
        stage('Push Images to ECR Repo') {
            steps {
                echo &quot;Pushing ${APP_NAME} App Images to ECR Repo&quot;
                sh &quot;. ./jenkins/push-qa-docker-images-to-ecr.sh&quot;
            }
        }
        stage('Deploy App on Docker Swarm'){
            steps {
                echo 'Deploying App on Swarm'
                sh '. ./ansible/scripts/deploy_app_on_qa_environment.sh'
            }
        }
    }
    post {
        always {
            echo 'Deleting all local images'
            sh 'docker image prune -af'
        }
    }
}"><pre>pipeline {
    agent any
    environment {
        <span class="pl-c1">PATH</span><span class="pl-k">=</span>sh(<span class="pl-c1">script</span>:<span class="pl-s"><span class="pl-pds">"</span>echo <span class="pl-smi">$P<span class="pl-smi">ATH</span></span>:/usr/local/bin<span class="pl-pds">"</span></span>, <span class="pl-c1">returnStdout</span>:<span class="pl-c1">true</span>)<span class="pl-k">.</span>trim()
        <span class="pl-c1">APP_NAME</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>petclinic<span class="pl-pds">"</span></span>
        <span class="pl-c1">APP_REPO_NAME</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>clarusway-repo/petclinic-app-qa<span class="pl-pds">"</span></span>
        <span class="pl-c1">APP_STACK_NAME</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>Matt-petclinic-App-QA-1<span class="pl-pds">"</span></span>
        <span class="pl-c1">CFN_KEYPAIR</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>matt-petclinic-qa.key<span class="pl-pds">"</span></span>
        <span class="pl-c1">AWS_ACCOUNT_ID</span><span class="pl-k">=</span>sh(<span class="pl-c1">script</span>:<span class="pl-s"><span class="pl-pds">'</span>export PATH="$PATH:/usr/local/bin" &amp;&amp; aws sts get-caller-identity --query Account --output text<span class="pl-pds">'</span></span>, <span class="pl-c1">returnStdout</span>:<span class="pl-c1">true</span>)<span class="pl-k">.</span>trim()
        <span class="pl-c1">AWS_REGION</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>us-east-1<span class="pl-pds">"</span></span>
        <span class="pl-c1">ECR_REGISTRY</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span><span class="pl-s1"><span class="pl-pse">${</span>AWS_ACCOUNT_ID<span class="pl-pse">}</span></span>.dkr.ecr.<span class="pl-s1"><span class="pl-pse">${</span>AWS_REGION<span class="pl-pse">}</span></span>.amazonaws.com<span class="pl-pds">"</span></span>
        <span class="pl-c1">ANSIBLE_PRIVATE_KEY_FILE</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span><span class="pl-s1"><span class="pl-pse">${</span>JENKINS_HOME<span class="pl-pse">}</span></span>/.ssh/<span class="pl-s1"><span class="pl-pse">${</span>CFN_KEYPAIR<span class="pl-pse">}</span></span><span class="pl-pds">"</span></span>
        <span class="pl-c1">ANSIBLE_HOST_KEY_CHECKING</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>False<span class="pl-pds">"</span></span>
    }
    stages {
        stage(<span class="pl-s"><span class="pl-pds">'</span>Package Application<span class="pl-pds">'</span></span>) {
            steps {
                echo <span class="pl-s"><span class="pl-pds">'</span>Packaging the app into jars with maven<span class="pl-pds">'</span></span>
                sh <span class="pl-s"><span class="pl-pds">"</span>. ./jenkins/package-with-maven-container.sh<span class="pl-pds">"</span></span>
            }
        }
        stage(<span class="pl-s"><span class="pl-pds">'</span>Prepare Tags for Docker Images<span class="pl-pds">'</span></span>) {
            steps {
                echo <span class="pl-s"><span class="pl-pds">'</span>Preparing Tags for Docker Images<span class="pl-pds">'</span></span>
                script {
                    <span class="pl-c1">MVN_VERSION</span><span class="pl-k">=</span>sh(<span class="pl-c1">script</span>:<span class="pl-s"><span class="pl-pds">'</span>. ${WORKSPACE}/spring-petclinic-admin-server/target/maven-archiver/pom.properties &amp;&amp; echo $version<span class="pl-pds">'</span></span>, <span class="pl-c1">returnStdout</span>:<span class="pl-c1">true</span>)<span class="pl-k">.</span>trim()
                    env<span class="pl-k">.</span><span class="pl-c1">IMAGE_TAG_ADMIN_SERVER</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span><span class="pl-s1"><span class="pl-pse">${</span>ECR_REGISTRY<span class="pl-pse">}</span></span>/<span class="pl-s1"><span class="pl-pse">${</span>APP_REPO_NAME<span class="pl-pse">}</span></span>:admin-server-qa-v<span class="pl-s1"><span class="pl-pse">${</span>MVN_VERSION<span class="pl-pse">}</span></span>-b<span class="pl-s1"><span class="pl-pse">${</span>BUILD_NUMBER<span class="pl-pse">}</span></span><span class="pl-pds">"</span></span>
                    <span class="pl-c1">MVN_VERSION</span><span class="pl-k">=</span>sh(<span class="pl-c1">script</span>:<span class="pl-s"><span class="pl-pds">'</span>. ${WORKSPACE}/spring-petclinic-api-gateway/target/maven-archiver/pom.properties &amp;&amp; echo $version<span class="pl-pds">'</span></span>, <span class="pl-c1">returnStdout</span>:<span class="pl-c1">true</span>)<span class="pl-k">.</span>trim()
                    env<span class="pl-k">.</span><span class="pl-c1">IMAGE_TAG_API_GATEWAY</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span><span class="pl-s1"><span class="pl-pse">${</span>ECR_REGISTRY<span class="pl-pse">}</span></span>/<span class="pl-s1"><span class="pl-pse">${</span>APP_REPO_NAME<span class="pl-pse">}</span></span>:api-gateway-qa-v<span class="pl-s1"><span class="pl-pse">${</span>MVN_VERSION<span class="pl-pse">}</span></span>-b<span class="pl-s1"><span class="pl-pse">${</span>BUILD_NUMBER<span class="pl-pse">}</span></span><span class="pl-pds">"</span></span>
                    <span class="pl-c1">MVN_VERSION</span><span class="pl-k">=</span>sh(<span class="pl-c1">script</span>:<span class="pl-s"><span class="pl-pds">'</span>. ${WORKSPACE}/spring-petclinic-config-server/target/maven-archiver/pom.properties &amp;&amp; echo $version<span class="pl-pds">'</span></span>, <span class="pl-c1">returnStdout</span>:<span class="pl-c1">true</span>)<span class="pl-k">.</span>trim()
                    env<span class="pl-k">.</span><span class="pl-c1">IMAGE_TAG_CONFIG_SERVER</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span><span class="pl-s1"><span class="pl-pse">${</span>ECR_REGISTRY<span class="pl-pse">}</span></span>/<span class="pl-s1"><span class="pl-pse">${</span>APP_REPO_NAME<span class="pl-pse">}</span></span>:config-server-qa-v<span class="pl-s1"><span class="pl-pse">${</span>MVN_VERSION<span class="pl-pse">}</span></span>-b<span class="pl-s1"><span class="pl-pse">${</span>BUILD_NUMBER<span class="pl-pse">}</span></span><span class="pl-pds">"</span></span>
                    <span class="pl-c1">MVN_VERSION</span><span class="pl-k">=</span>sh(<span class="pl-c1">script</span>:<span class="pl-s"><span class="pl-pds">'</span>. ${WORKSPACE}/spring-petclinic-customers-service/target/maven-archiver/pom.properties &amp;&amp; echo $version<span class="pl-pds">'</span></span>, <span class="pl-c1">returnStdout</span>:<span class="pl-c1">true</span>)<span class="pl-k">.</span>trim()
                    env<span class="pl-k">.</span><span class="pl-c1">IMAGE_TAG_CUSTOMERS_SERVICE</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span><span class="pl-s1"><span class="pl-pse">${</span>ECR_REGISTRY<span class="pl-pse">}</span></span>/<span class="pl-s1"><span class="pl-pse">${</span>APP_REPO_NAME<span class="pl-pse">}</span></span>:customers-service-qa-v<span class="pl-s1"><span class="pl-pse">${</span>MVN_VERSION<span class="pl-pse">}</span></span>-b<span class="pl-s1"><span class="pl-pse">${</span>BUILD_NUMBER<span class="pl-pse">}</span></span><span class="pl-pds">"</span></span>
                    <span class="pl-c1">MVN_VERSION</span><span class="pl-k">=</span>sh(<span class="pl-c1">script</span>:<span class="pl-s"><span class="pl-pds">'</span>. ${WORKSPACE}/spring-petclinic-discovery-server/target/maven-archiver/pom.properties &amp;&amp; echo $version<span class="pl-pds">'</span></span>, <span class="pl-c1">returnStdout</span>:<span class="pl-c1">true</span>)<span class="pl-k">.</span>trim()
                    env<span class="pl-k">.</span><span class="pl-c1">IMAGE_TAG_DISCOVERY_SERVER</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span><span class="pl-s1"><span class="pl-pse">${</span>ECR_REGISTRY<span class="pl-pse">}</span></span>/<span class="pl-s1"><span class="pl-pse">${</span>APP_REPO_NAME<span class="pl-pse">}</span></span>:discovery-server-qa-v<span class="pl-s1"><span class="pl-pse">${</span>MVN_VERSION<span class="pl-pse">}</span></span>-b<span class="pl-s1"><span class="pl-pse">${</span>BUILD_NUMBER<span class="pl-pse">}</span></span><span class="pl-pds">"</span></span>
                    <span class="pl-c1">MVN_VERSION</span><span class="pl-k">=</span>sh(<span class="pl-c1">script</span>:<span class="pl-s"><span class="pl-pds">'</span>. ${WORKSPACE}/spring-petclinic-hystrix-dashboard/target/maven-archiver/pom.properties &amp;&amp; echo $version<span class="pl-pds">'</span></span>, <span class="pl-c1">returnStdout</span>:<span class="pl-c1">true</span>)<span class="pl-k">.</span>trim()
                    env<span class="pl-k">.</span><span class="pl-c1">IMAGE_TAG_HYSTRIX_DASHBOARD</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span><span class="pl-s1"><span class="pl-pse">${</span>ECR_REGISTRY<span class="pl-pse">}</span></span>/<span class="pl-s1"><span class="pl-pse">${</span>APP_REPO_NAME<span class="pl-pse">}</span></span>:hystrix-dashboard-qa-v<span class="pl-s1"><span class="pl-pse">${</span>MVN_VERSION<span class="pl-pse">}</span></span>-b<span class="pl-s1"><span class="pl-pse">${</span>BUILD_NUMBER<span class="pl-pse">}</span></span><span class="pl-pds">"</span></span>
                    <span class="pl-c1">MVN_VERSION</span><span class="pl-k">=</span>sh(<span class="pl-c1">script</span>:<span class="pl-s"><span class="pl-pds">'</span>. ${WORKSPACE}/spring-petclinic-vets-service/target/maven-archiver/pom.properties &amp;&amp; echo $version<span class="pl-pds">'</span></span>, <span class="pl-c1">returnStdout</span>:<span class="pl-c1">true</span>)<span class="pl-k">.</span>trim()
                    env<span class="pl-k">.</span><span class="pl-c1">IMAGE_TAG_VETS_SERVICE</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span><span class="pl-s1"><span class="pl-pse">${</span>ECR_REGISTRY<span class="pl-pse">}</span></span>/<span class="pl-s1"><span class="pl-pse">${</span>APP_REPO_NAME<span class="pl-pse">}</span></span>:vets-service-qa-v<span class="pl-s1"><span class="pl-pse">${</span>MVN_VERSION<span class="pl-pse">}</span></span>-b<span class="pl-s1"><span class="pl-pse">${</span>BUILD_NUMBER<span class="pl-pse">}</span></span><span class="pl-pds">"</span></span>
                    <span class="pl-c1">MVN_VERSION</span><span class="pl-k">=</span>sh(<span class="pl-c1">script</span>:<span class="pl-s"><span class="pl-pds">'</span>. ${WORKSPACE}/spring-petclinic-visits-service/target/maven-archiver/pom.properties &amp;&amp; echo $version<span class="pl-pds">'</span></span>, <span class="pl-c1">returnStdout</span>:<span class="pl-c1">true</span>)<span class="pl-k">.</span>trim()
                    env<span class="pl-k">.</span><span class="pl-c1">IMAGE_TAG_VISITS_SERVICE</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span><span class="pl-s1"><span class="pl-pse">${</span>ECR_REGISTRY<span class="pl-pse">}</span></span>/<span class="pl-s1"><span class="pl-pse">${</span>APP_REPO_NAME<span class="pl-pse">}</span></span>:visits-service-qa-v<span class="pl-s1"><span class="pl-pse">${</span>MVN_VERSION<span class="pl-pse">}</span></span>-b<span class="pl-s1"><span class="pl-pse">${</span>BUILD_NUMBER<span class="pl-pse">}</span></span><span class="pl-pds">"</span></span>
                    env<span class="pl-k">.</span><span class="pl-c1">IMAGE_TAG_GRAFANA_SERVICE</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span><span class="pl-s1"><span class="pl-pse">${</span>ECR_REGISTRY<span class="pl-pse">}</span></span>/<span class="pl-s1"><span class="pl-pse">${</span>APP_REPO_NAME<span class="pl-pse">}</span></span>:grafana-service<span class="pl-pds">"</span></span>
                    env<span class="pl-k">.</span><span class="pl-c1">IMAGE_TAG_PROMETHEUS_SERVICE</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span><span class="pl-s1"><span class="pl-pse">${</span>ECR_REGISTRY<span class="pl-pse">}</span></span>/<span class="pl-s1"><span class="pl-pse">${</span>APP_REPO_NAME<span class="pl-pse">}</span></span>:prometheus-service<span class="pl-pds">"</span></span>
                }
            }
        }
        stage(<span class="pl-s"><span class="pl-pds">'</span>Build App Docker Images<span class="pl-pds">'</span></span>) {
            steps {
                echo <span class="pl-s"><span class="pl-pds">'</span>Building App Dev Images<span class="pl-pds">'</span></span>
                sh <span class="pl-s"><span class="pl-pds">"</span>. ./jenkins/build-qa-docker-images-for-ecr.sh<span class="pl-pds">"</span></span>
                sh <span class="pl-s"><span class="pl-pds">'</span>docker image ls<span class="pl-pds">'</span></span>
            }
        }
        stage(<span class="pl-s"><span class="pl-pds">'</span>Push Images to ECR Repo<span class="pl-pds">'</span></span>) {
            steps {
                echo <span class="pl-s"><span class="pl-pds">"</span>Pushing <span class="pl-s1"><span class="pl-pse">${</span>APP_NAME<span class="pl-pse">}</span></span> App Images to ECR Repo<span class="pl-pds">"</span></span>
                sh <span class="pl-s"><span class="pl-pds">"</span>. ./jenkins/push-qa-docker-images-to-ecr.sh<span class="pl-pds">"</span></span>
            }
        }
        stage(<span class="pl-s"><span class="pl-pds">'</span>Deploy App on Docker Swarm<span class="pl-pds">'</span></span>){
            steps {
                echo <span class="pl-s"><span class="pl-pds">'</span>Deploying App on Swarm<span class="pl-pds">'</span></span>
                sh <span class="pl-s"><span class="pl-pds">'</span>. ./ansible/scripts/deploy_app_on_qa_environment.sh<span class="pl-pds">'</span></span>
            }
        }
    }
    post {
        always {
            echo <span class="pl-s"><span class="pl-pds">'</span>Deleting all local images<span class="pl-pds">'</span></span>
            sh <span class="pl-s"><span class="pl-pds">'</span>docker image prune -af<span class="pl-pds">'</span></span>
        }
    }
}</pre></div>
<ul dir="auto">
<li>Commit the change, then push the script to the remote repo.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="git add .
git commit -m 'added jenkinsfile petclinic-weekly-qa for release branch'
git push --set-upstream origin feature/msp-21
git checkout dev
git merge feature/msp-21
git push origin dev"><pre>git add <span class="pl-c1">.</span>
git commit -m <span class="pl-s"><span class="pl-pds">'</span>added jenkinsfile petclinic-weekly-qa for release branch<span class="pl-pds">'</span></span>
git push --set-upstream origin feature/msp-21
git checkout dev
git merge feature/msp-21
git push origin dev</pre></div>
<ul dir="auto">
<li>Merge <code>dev</code> into <code>release</code> branch to build and deploy the app on <code>QA environment</code> with pipeline.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="git checkout release
git merge dev
git push origin release"><pre>git checkout release
git merge dev
git push origin release</pre></div>
<h2 dir="auto"><a id="user-content-msp-22---prepare-high-availability-rke-kubernetes-cluster-on-aws-ec2" class="anchor" aria-hidden="true" href="#msp-22---prepare-high-availability-rke-kubernetes-cluster-on-aws-ec2"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>MSP 22 - Prepare High-availability RKE Kubernetes Cluster on AWS EC2</h2>
<ul dir="auto">
<li>Create <code>feature/msp-22</code> branch from <code>release</code>.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="git checkout release
git branch feature/msp-22
git checkout feature/msp-22"><pre>git checkout release
git branch feature/msp-22
git checkout feature/msp-22</pre></div>
<ul dir="auto">
<li>
<p dir="auto">Explain <a href="https://rancher.com/docs/rancher/v2.x/en/overview/architecture/" rel="nofollow">Rancher Container Management Tool</a>.</p>
</li>
<li>
<p dir="auto">Create an IAM Policy with name of <code>call-rke-controlplane-policy.json</code> and also save it under <code>infrastructure</code> for <code>Control Plane</code> node to enable Rancher to create or remove EC2 resources.</p>
</li>
</ul>
<div class="highlight highlight-source-json position-relative overflow-auto" data-snippet-clipboard-copy-content="{
&quot;Version&quot;: &quot;2012-10-17&quot;,
&quot;Statement&quot;: [
  {
    &quot;Effect&quot;: &quot;Allow&quot;,
    &quot;Action&quot;: [
      &quot;autoscaling:DescribeAutoScalingGroups&quot;,
      &quot;autoscaling:DescribeLaunchConfigurations&quot;,
      &quot;autoscaling:DescribeTags&quot;,
      &quot;ec2:DescribeInstances&quot;,
      &quot;ec2:DescribeRegions&quot;,
      &quot;ec2:DescribeRouteTables&quot;,
      &quot;ec2:DescribeSecurityGroups&quot;,
      &quot;ec2:DescribeSubnets&quot;,
      &quot;ec2:DescribeVolumes&quot;,
      &quot;ec2:CreateSecurityGroup&quot;,
      &quot;ec2:CreateTags&quot;,
      &quot;ec2:CreateVolume&quot;,
      &quot;ec2:ModifyInstanceAttribute&quot;,
      &quot;ec2:ModifyVolume&quot;,
      &quot;ec2:AttachVolume&quot;,
      &quot;ec2:AuthorizeSecurityGroupIngress&quot;,
      &quot;ec2:CreateRoute&quot;,
      &quot;ec2:DeleteRoute&quot;,
      &quot;ec2:DeleteSecurityGroup&quot;,
      &quot;ec2:DeleteVolume&quot;,
      &quot;ec2:DetachVolume&quot;,
      &quot;ec2:RevokeSecurityGroupIngress&quot;,
      &quot;ec2:DescribeVpcs&quot;,
      &quot;elasticloadbalancing:AddTags&quot;,
      &quot;elasticloadbalancing:AttachLoadBalancerToSubnets&quot;,
      &quot;elasticloadbalancing:ApplySecurityGroupsToLoadBalancer&quot;,
      &quot;elasticloadbalancing:CreateLoadBalancer&quot;,
      &quot;elasticloadbalancing:CreateLoadBalancerPolicy&quot;,
      &quot;elasticloadbalancing:CreateLoadBalancerListeners&quot;,
      &quot;elasticloadbalancing:ConfigureHealthCheck&quot;,
      &quot;elasticloadbalancing:DeleteLoadBalancer&quot;,
      &quot;elasticloadbalancing:DeleteLoadBalancerListeners&quot;,
      &quot;elasticloadbalancing:DescribeLoadBalancers&quot;,
      &quot;elasticloadbalancing:DescribeLoadBalancerAttributes&quot;,
      &quot;elasticloadbalancing:DetachLoadBalancerFromSubnets&quot;,
      &quot;elasticloadbalancing:DeregisterInstancesFromLoadBalancer&quot;,
      &quot;elasticloadbalancing:ModifyLoadBalancerAttributes&quot;,
      &quot;elasticloadbalancing:RegisterInstancesWithLoadBalancer&quot;,
      &quot;elasticloadbalancing:SetLoadBalancerPoliciesForBackendServer&quot;,
      &quot;elasticloadbalancing:AddTags&quot;,
      &quot;elasticloadbalancing:CreateListener&quot;,
      &quot;elasticloadbalancing:CreateTargetGroup&quot;,
      &quot;elasticloadbalancing:DeleteListener&quot;,
      &quot;elasticloadbalancing:DeleteTargetGroup&quot;,
      &quot;elasticloadbalancing:DescribeListeners&quot;,
      &quot;elasticloadbalancing:DescribeLoadBalancerPolicies&quot;,
      &quot;elasticloadbalancing:DescribeTargetGroups&quot;,
      &quot;elasticloadbalancing:DescribeTargetHealth&quot;,
      &quot;elasticloadbalancing:ModifyListener&quot;,
      &quot;elasticloadbalancing:ModifyTargetGroup&quot;,
      &quot;elasticloadbalancing:RegisterTargets&quot;,
      &quot;elasticloadbalancing:SetLoadBalancerPoliciesOfListener&quot;,
      &quot;iam:CreateServiceLinkedRole&quot;,
      &quot;kms:DescribeKey&quot;
    ],
    &quot;Resource&quot;: [
      &quot;*&quot;
    ]
  }
]
}"><pre>{
<span class="pl-ent">"Version"</span>: <span class="pl-s"><span class="pl-pds">"</span>2012-10-17<span class="pl-pds">"</span></span>,
<span class="pl-ent">"Statement"</span>: [
  {
    <span class="pl-ent">"Effect"</span>: <span class="pl-s"><span class="pl-pds">"</span>Allow<span class="pl-pds">"</span></span>,
    <span class="pl-ent">"Action"</span>: [
      <span class="pl-s"><span class="pl-pds">"</span>autoscaling:DescribeAutoScalingGroups<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>autoscaling:DescribeLaunchConfigurations<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>autoscaling:DescribeTags<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>ec2:DescribeInstances<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>ec2:DescribeRegions<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>ec2:DescribeRouteTables<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>ec2:DescribeSecurityGroups<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>ec2:DescribeSubnets<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>ec2:DescribeVolumes<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>ec2:CreateSecurityGroup<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>ec2:CreateTags<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>ec2:CreateVolume<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>ec2:ModifyInstanceAttribute<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>ec2:ModifyVolume<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>ec2:AttachVolume<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>ec2:AuthorizeSecurityGroupIngress<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>ec2:CreateRoute<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>ec2:DeleteRoute<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>ec2:DeleteSecurityGroup<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>ec2:DeleteVolume<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>ec2:DetachVolume<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>ec2:RevokeSecurityGroupIngress<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>ec2:DescribeVpcs<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>elasticloadbalancing:AddTags<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>elasticloadbalancing:AttachLoadBalancerToSubnets<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>elasticloadbalancing:ApplySecurityGroupsToLoadBalancer<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>elasticloadbalancing:CreateLoadBalancer<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>elasticloadbalancing:CreateLoadBalancerPolicy<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>elasticloadbalancing:CreateLoadBalancerListeners<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>elasticloadbalancing:ConfigureHealthCheck<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>elasticloadbalancing:DeleteLoadBalancer<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>elasticloadbalancing:DeleteLoadBalancerListeners<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>elasticloadbalancing:DescribeLoadBalancers<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>elasticloadbalancing:DescribeLoadBalancerAttributes<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>elasticloadbalancing:DetachLoadBalancerFromSubnets<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>elasticloadbalancing:DeregisterInstancesFromLoadBalancer<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>elasticloadbalancing:ModifyLoadBalancerAttributes<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>elasticloadbalancing:RegisterInstancesWithLoadBalancer<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>elasticloadbalancing:SetLoadBalancerPoliciesForBackendServer<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>elasticloadbalancing:AddTags<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>elasticloadbalancing:CreateListener<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>elasticloadbalancing:CreateTargetGroup<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>elasticloadbalancing:DeleteListener<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>elasticloadbalancing:DeleteTargetGroup<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>elasticloadbalancing:DescribeListeners<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>elasticloadbalancing:DescribeLoadBalancerPolicies<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>elasticloadbalancing:DescribeTargetGroups<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>elasticloadbalancing:DescribeTargetHealth<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>elasticloadbalancing:ModifyListener<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>elasticloadbalancing:ModifyTargetGroup<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>elasticloadbalancing:RegisterTargets<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>elasticloadbalancing:SetLoadBalancerPoliciesOfListener<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>iam:CreateServiceLinkedRole<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>kms:DescribeKey<span class="pl-pds">"</span></span>
    ],
    <span class="pl-ent">"Resource"</span>: [
      <span class="pl-s"><span class="pl-pds">"</span>*<span class="pl-pds">"</span></span>
    ]
  }
]
}</pre></div>
<ul dir="auto">
<li>Create an IAM Policy with name of <code>call-rke-etcd-worker-policy.json</code> and also save it under <code>infrastructure</code> for <code>etcd</code> or <code>worker</code> nodes to enable Rancher to get information from EC2 resources.</li>
</ul>
<div class="highlight highlight-source-json position-relative overflow-auto" data-snippet-clipboard-copy-content="{
&quot;Version&quot;: &quot;2012-10-17&quot;,
&quot;Statement&quot;: [
    {
        &quot;Effect&quot;: &quot;Allow&quot;,
        &quot;Action&quot;: [
            &quot;ec2:DescribeInstances&quot;,
            &quot;ec2:DescribeRegions&quot;,
            &quot;ecr:GetAuthorizationToken&quot;,
            &quot;ecr:BatchCheckLayerAvailability&quot;,
            &quot;ecr:GetDownloadUrlForLayer&quot;,
            &quot;ecr:GetRepositoryPolicy&quot;,
            &quot;ecr:DescribeRepositories&quot;,
            &quot;ecr:ListImages&quot;,
            &quot;ecr:BatchGetImage&quot;
        ],
        &quot;Resource&quot;: &quot;*&quot;
    }
]
}"><pre>{
<span class="pl-ent">"Version"</span>: <span class="pl-s"><span class="pl-pds">"</span>2012-10-17<span class="pl-pds">"</span></span>,
<span class="pl-ent">"Statement"</span>: [
    {
        <span class="pl-ent">"Effect"</span>: <span class="pl-s"><span class="pl-pds">"</span>Allow<span class="pl-pds">"</span></span>,
        <span class="pl-ent">"Action"</span>: [
            <span class="pl-s"><span class="pl-pds">"</span>ec2:DescribeInstances<span class="pl-pds">"</span></span>,
            <span class="pl-s"><span class="pl-pds">"</span>ec2:DescribeRegions<span class="pl-pds">"</span></span>,
            <span class="pl-s"><span class="pl-pds">"</span>ecr:GetAuthorizationToken<span class="pl-pds">"</span></span>,
            <span class="pl-s"><span class="pl-pds">"</span>ecr:BatchCheckLayerAvailability<span class="pl-pds">"</span></span>,
            <span class="pl-s"><span class="pl-pds">"</span>ecr:GetDownloadUrlForLayer<span class="pl-pds">"</span></span>,
            <span class="pl-s"><span class="pl-pds">"</span>ecr:GetRepositoryPolicy<span class="pl-pds">"</span></span>,
            <span class="pl-s"><span class="pl-pds">"</span>ecr:DescribeRepositories<span class="pl-pds">"</span></span>,
            <span class="pl-s"><span class="pl-pds">"</span>ecr:ListImages<span class="pl-pds">"</span></span>,
            <span class="pl-s"><span class="pl-pds">"</span>ecr:BatchGetImage<span class="pl-pds">"</span></span>
        ],
        <span class="pl-ent">"Resource"</span>: <span class="pl-s"><span class="pl-pds">"</span>*<span class="pl-pds">"</span></span>
    }
]
}</pre></div>
<ul dir="auto">
<li>
<p dir="auto">Create an IAM Role with name of <code>call-rke-role</code> to attach RKE nodes (instances) using <code>call-rke-controlplane-policy</code> and <code>call-rke-etcd-worker-policy</code>.</p>
</li>
<li>
<p dir="auto">Create a security group for External Application Load Balancer of Rancher with name of <code>call-rke-alb-sg</code> and allow HTTP (Port 80) and HTTPS (Port 443) connections from anywhere.</p>
</li>
<li>
<p dir="auto">Create a security group for RKE Kubernetes Cluster with name of <code>call-rke-cluster-sg</code> and define following inbound and outbound rules.</p>
<ul dir="auto">
<li>
<p dir="auto">Inbound rules;</p>
<ul dir="auto">
<li>
<p dir="auto">Allow HTTP protocol (TCP on port 80) from Application Load Balancer.</p>
</li>
<li>
<p dir="auto">Allow HTTPS protocol (TCP on port 443) from any source that needs to use Rancher UI or API.</p>
</li>
<li>
<p dir="auto">Allow TCP on port 6443 from any source that needs to use Kubernetes API server(ex. Jenkins Server).</p>
</li>
<li>
<p dir="auto">Allow SSH on port 22 to any node IP that installs Docker (ex. Jenkins Server).</p>
</li>
</ul>
</li>
<li>
<p dir="auto">Outbound rules;</p>
<ul dir="auto">
<li>
<p dir="auto">Allow SSH protocol (TCP on port 22) to any node IP from a node created using Node Driver.</p>
</li>
<li>
<p dir="auto">Allow HTTP protocol (TCP on port 80) to all IP for getting updates.</p>
</li>
<li>
<p dir="auto">Allow HTTPS protocol (TCP on port 443) to <code>35.160.43.145/32</code>, <code>35.167.242.46/32</code>, <code>52.33.59.17/32</code> for catalogs of <code>git.rancher.io</code>.</p>
</li>
<li>
<p dir="auto">Allow TCP on port 2376 to any node IP from a node created using Node Driver for Docker machine TLS port.</p>
</li>
</ul>
</li>
<li>
<p dir="auto">Allow all protocol on all port from <code>call-rke-cluster-sg</code> for self communication between Rancher <code>controlplane</code>, <code>etcd</code>, <code>worker</code> nodes.</p>
</li>
</ul>
</li>
<li>
<p dir="auto">Log into Jenkins Server and create <code>call-rancher.pem</code> key-pair for Rancher Server using AWS CLI</p>
</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="aws ec2 create-key-pair --region us-east-1 --key-name call-rancher.pem --query KeyMaterial --output text &gt; ~/.ssh/call-rancher.pem
chmod 400 ~/.ssh/call-rancher.pem"><pre>aws ec2 create-key-pair --region us-east-1 --key-name call-rancher.pem --query KeyMaterial --output text <span class="pl-k">&gt;</span> <span class="pl-k">~</span>/.ssh/call-rancher.pem
chmod 400 <span class="pl-k">~</span>/.ssh/call-rancher.pem</pre></div>
<ul dir="auto">
<li>
<p dir="auto">Launch an EC2 instance using <code>Ubuntu Server 20.04 LTS (HVM) (64-bit x86)</code> with <code>t2.medium</code> type, 16 GB root volume,  <code>call-rke-cluster-sg</code> security group, <code>call-rke-role</code> IAM Role, <code>Name:Call-Rancher-Cluster-Instance</code> tag and <code>call-rancher.pem</code> key-pair. Take note of <code>subnet id</code> of EC2.</p>
</li>
<li>
<p dir="auto">Attach a tag to the <code>nodes (intances)</code>, <code>subnets</code> and <code>security group</code> for Rancher with <code>Key = kubernetes.io/cluster/Call-Rancher</code> and <code>Value = owned</code>.</p>
</li>
<li>
<p dir="auto">Install <code>kubectl</code> on Jenkins Server. <a href="https://kubernetes.io/docs/tasks/tools/install-kubectl/#install-kubectl" rel="nofollow">Install and Set up kubectl</a></p>
</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="curl -o kubectl https://amazon-eks.s3.us-west-2.amazonaws.com/1.18.9/2020-11-02/bin/linux/amd64/kubectl
sudo mv kubectl /usr/local/bin/kubectl
chmod +x /usr/local/bin/kubectl
kubectl version --short --client"><pre>curl -o kubectl https://amazon-eks.s3.us-west-2.amazonaws.com/1.18.9/2020-11-02/bin/linux/amd64/kubectl
sudo mv kubectl /usr/local/bin/kubectl
chmod +x /usr/local/bin/kubectl
kubectl version --short --client</pre></div>
<ul dir="auto">
<li>Log into <code>Call-Rancher-Cluster-Instance</code> from Jenkins Server (Bastion host) and install Docker using the following script.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="# Set hostname of instance
sudo hostnamectl set-hostname rancher-instance-1
# Update OS 
sudo apt-get update -y
sudo apt-get upgrade -y
# Install and start Docker on Ubuntu 19.03
# Update the apt package index and install packages to allow apt to use a repository over HTTPS
sudo apt-get install \
  apt-transport-https \
  ca-certificates \
  curl \
  gnupg \
  lsb-release
# Add Docker’s official GPG key
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg
# Use the following command to set up the stable repository
echo \
  &quot;deb [arch=amd64 signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu \
  $(lsb_release -cs) stable&quot; | sudo tee /etc/apt/sources.list.d/docker.list &gt; /dev/null
# Update packages
sudo apt-get update

# Install and start Docker
sudo apt-get install docker-ce docker-ce-cli containerd.io
sudo systemctl start docker
sudo systemctl enable docker

# Add ubuntu user to docker group
sudo usermod -aG docker ubuntu
newgrp docker"><pre><span class="pl-c"><span class="pl-c">#</span> Set hostname of instance</span>
sudo hostnamectl set-hostname rancher-instance-1
<span class="pl-c"><span class="pl-c">#</span> Update OS </span>
sudo apt-get update -y
sudo apt-get upgrade -y
<span class="pl-c"><span class="pl-c">#</span> Install and start Docker on Ubuntu 19.03</span>
<span class="pl-c"><span class="pl-c">#</span> Update the apt package index and install packages to allow apt to use a repository over HTTPS</span>
sudo apt-get install \
  apt-transport-https \
  ca-certificates \
  curl \
  gnupg \
  lsb-release
<span class="pl-c"><span class="pl-c">#</span> Add Docker’s official GPG key</span>
curl -fsSL https://download.docker.com/linux/ubuntu/gpg <span class="pl-k">|</span> sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg
<span class="pl-c"><span class="pl-c">#</span> Use the following command to set up the stable repository</span>
<span class="pl-c1">echo</span> \
  <span class="pl-s"><span class="pl-pds">"</span>deb [arch=amd64 signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu <span class="pl-cce">\</span></span>
<span class="pl-s">  <span class="pl-s"><span class="pl-pds">$(</span>lsb_release -cs<span class="pl-pds">)</span></span> stable<span class="pl-pds">"</span></span> <span class="pl-k">|</span> sudo tee /etc/apt/sources.list.d/docker.list <span class="pl-k">&gt;</span> /dev/null
<span class="pl-c"><span class="pl-c">#</span> Update packages</span>
sudo apt-get update

<span class="pl-c"><span class="pl-c">#</span> Install and start Docker</span>
sudo apt-get install docker-ce docker-ce-cli containerd.io
sudo systemctl start docker
sudo systemctl <span class="pl-c1">enable</span> docker

<span class="pl-c"><span class="pl-c">#</span> Add ubuntu user to docker group</span>
sudo usermod -aG docker ubuntu
newgrp docker</pre></div>
<ul dir="auto">
<li>Create a target groups with name of <code>call-rancher-http-80-tg</code> with following setup and add the <code>rancher instances</code> to it.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="Target type         : instance
Protocol            : HTTP
Port                : 80

&lt;!-- Health Checks Settings --&gt;
Protocol            : HTTP
Path                : /healthz
Port                : traffic port
Healthy threshold   : 3
Unhealthy threshold : 3
Timeout             : 5 seconds
Interval            : 10 seoconds
Success             : 200"><pre>Target <span class="pl-c1">type</span>         <span class="pl-c1">:</span> instance
Protocol            <span class="pl-c1">:</span> HTTP
Port                <span class="pl-c1">:</span> 80

<span class="pl-k">&lt;</span><span class="pl-k">!</span>-- Health Checks Settings --<span class="pl-k">&gt;</span>
Protocol            <span class="pl-c1">:</span> HTTP
Path                <span class="pl-c1">:</span> /healthz
Port                <span class="pl-c1">:</span> traffic port
Healthy threshold   <span class="pl-c1">:</span> 3
Unhealthy threshold <span class="pl-c1">:</span> 3
Timeout             <span class="pl-c1">:</span> 5 seconds
Interval            <span class="pl-c1">:</span> 10 seoconds
Success             <span class="pl-c1">:</span> 200</pre></div>
<ul dir="auto">
<li>Create Application Load Balancer with name of <code>call-rancher-alb</code> using <code>call-rke-alb-sg</code> security group with following settings and add <code>call-rancher-http-80-tg</code> target group to it.</li>
</ul>
<div class="snippet-clipboard-content position-relative overflow-auto" data-snippet-clipboard-copy-content="Scheme              : internet-facing
IP address type     : ipv4

&lt;!-- Listeners--&gt;
Protocol            : HTTPS/HTTP
Port                : 443/80
Availability Zones  : Select AZs of RKE instances
Target group        : `call-rancher-http-80-tg` target group "><pre lang="text"><code>Scheme              : internet-facing
IP address type     : ipv4

&lt;!-- Listeners--&gt;
Protocol            : HTTPS/HTTP
Port                : 443/80
Availability Zones  : Select AZs of RKE instances
Target group        : `call-rancher-http-80-tg` target group 
</code></pre></div>
<ul dir="auto">
<li>
<p dir="auto">Configure ALB Listener of HTTP on <code>Port 80</code> to redirect traffic to HTTPS on <code>Port 443</code>.</p>
</li>
<li>
<p dir="auto">Create DNS A record for <code>rancher.clarusway.us</code> and attach the <code>call-rancher-alb</code> application load balancer to it.</p>
</li>
<li>
<p dir="auto">Install RKE, the Rancher Kubernetes Engine, <a href="https://rancher.com/docs/rke/latest/en/installation/" rel="nofollow">Kubernetes distribution and command-line tool</a>) on Jenkins Server.</p>
</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="curl -SsL &quot;https://github.com/rancher/rke/releases/download/v1.3.7/rke_linux-amd64&quot; -o &quot;rke_linux-amd64&quot;
sudo mv rke_linux-amd64 /usr/local/bin/rke
chmod +x /usr/local/bin/rke
rke --version"><pre>curl -SsL <span class="pl-s"><span class="pl-pds">"</span>https://github.com/rancher/rke/releases/download/v1.3.7/rke_linux-amd64<span class="pl-pds">"</span></span> -o <span class="pl-s"><span class="pl-pds">"</span>rke_linux-amd64<span class="pl-pds">"</span></span>
sudo mv rke_linux-amd64 /usr/local/bin/rke
chmod +x /usr/local/bin/rke
rke --version</pre></div>
<ul dir="auto">
<li>Create <code>rancher-cluster.yml</code> with following content to configure RKE Kubernetes Cluster and save it under <code>infrastructure</code> folder.</li>
</ul>
<div class="highlight highlight-source-yaml position-relative overflow-auto" data-snippet-clipboard-copy-content="nodes:
  - address: 172.31.82.64
    internal_address: 172.31.82.64
    user: ubuntu
    role:
      - controlplane
      - etcd
      - worker

# ignore_docker_version: true

services:
  etcd:
    snapshot: true
    creation: 6h
    retention: 24h

ssh_key_path: ~/.ssh/davids-test-rancher.key

# Required for external TLS termination with
# ingress-nginx v0.22+
ingress:
  provider: nginx
  options:
    use-forwarded-headers: &quot;true&quot;"><pre><span class="pl-ent">nodes</span>:
  - <span class="pl-ent">address</span>: <span class="pl-s">172.31.82.64</span>
    <span class="pl-ent">internal_address</span>: <span class="pl-s">172.31.82.64</span>
    <span class="pl-ent">user</span>: <span class="pl-s">ubuntu</span>
    <span class="pl-ent">role</span>:
      - <span class="pl-s">controlplane</span>
      - <span class="pl-s">etcd</span>
      - <span class="pl-s">worker</span>

<span class="pl-c"><span class="pl-c">#</span> ignore_docker_version: true</span>

<span class="pl-ent">services</span>:
  <span class="pl-ent">etcd</span>:
    <span class="pl-ent">snapshot</span>: <span class="pl-c1">true</span>
    <span class="pl-ent">creation</span>: <span class="pl-c1">6h</span>
    <span class="pl-ent">retention</span>: <span class="pl-c1">24h</span>

<span class="pl-ent">ssh_key_path</span>: <span class="pl-s">~/.ssh/davids-test-rancher.key</span>

<span class="pl-c"><span class="pl-c">#</span> Required for external TLS termination with</span>
<span class="pl-c"><span class="pl-c">#</span> ingress-nginx v0.22+</span>
<span class="pl-ent">ingress</span>:
  <span class="pl-ent">provider</span>: <span class="pl-s">nginx</span>
  <span class="pl-ent">options</span>:
    <span class="pl-ent">use-forwarded-headers</span>: <span class="pl-s"><span class="pl-pds">"</span>true<span class="pl-pds">"</span></span></pre></div>
<ul dir="auto">
<li>Run <code>rke</code> command to setup RKE Kubernetes cluster on EC2 Rancher instance <em><code>Warning:</code> You should add rule to cluster sec group for Jenkins Server using its <code>IP/32</code> from SSH (22) and TCP(6443) before running <code>rke</code> command, because it is giving connection error.</em></li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="rke up --config ./rancher-cluster.yml"><pre>rke up --config ./rancher-cluster.yml</pre></div>
<ul dir="auto">
<li>Check if the RKE Kubernetes Cluster created successfully.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="mkdir -p ~/.kube
mv ./kube_config_rancher-cluster.yml $HOME/.kube/config
chmod 400 ~/.kube/config
kubectl get nodes
kubectl get pods --all-namespaces"><pre>mkdir -p <span class="pl-k">~</span>/.kube
mv ./kube_config_rancher-cluster.yml <span class="pl-smi">$HOME</span>/.kube/config
chmod 400 <span class="pl-k">~</span>/.kube/config
kubectl get nodes
kubectl get pods --all-namespaces</pre></div>
<ul dir="auto">
<li>If bootstrap pod is not initialized or you forget your admin password you can use the below command to reset your password.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="export KUBECONFIG=~/.kube/config
kubectl --kubeconfig $KUBECONFIG -n cattle-system exec $(kubectl --kubeconfig $KUBECONFIG -n cattle-system get pods -l app=rancher | grep '1/1' | head -1 | awk '{ print $1 }') -- reset-password"><pre><span class="pl-k">export</span> KUBECONFIG=<span class="pl-k">~</span>/.kube/config
kubectl --kubeconfig <span class="pl-smi">$KUBECONFIG</span> -n cattle-system <span class="pl-c1">exec</span> <span class="pl-s"><span class="pl-pds">$(</span>kubectl --kubeconfig <span class="pl-smi">$KUBECONFIG</span> -n cattle-system get pods -l app=rancher <span class="pl-k">|</span> grep <span class="pl-s"><span class="pl-pds">'</span>1/1<span class="pl-pds">'</span></span> <span class="pl-k">|</span> head -1 <span class="pl-k">|</span> awk <span class="pl-s"><span class="pl-pds">'</span>{ print $1 }<span class="pl-pds">'</span></span><span class="pl-pds">)</span></span> -- reset-password</pre></div>
<ul dir="auto">
<li>Commit the change, then push the script to the remote repo.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="git add .
git commit -m 'added rancher setup files'
git push --set-upstream origin feature/msp-22
git checkout release
git merge feature/msp-22
git push origin release"><pre>git add <span class="pl-c1">.</span>
git commit -m <span class="pl-s"><span class="pl-pds">'</span>added rancher setup files<span class="pl-pds">'</span></span>
git push --set-upstream origin feature/msp-22
git checkout release
git merge feature/msp-22
git push origin release</pre></div>
<h2 dir="auto"><a id="user-content-msp-23---install-rancher-app-on-rke-kubernetes-cluster" class="anchor" aria-hidden="true" href="#msp-23---install-rancher-app-on-rke-kubernetes-cluster"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>MSP 23 - Install Rancher App on RKE Kubernetes Cluster</h2>
<ul dir="auto">
<li>Install Helm <a href="https://github.com/helm/helm/releases">version 3+</a> on Jenkins Server. <a href="https://helm.sh/docs/intro/" rel="nofollow">Introduction to Helm</a>. <a href="https://helm.sh/docs/intro/install/" rel="nofollow">Helm Installation</a>.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="curl https://raw.githubusercontent.com/helm/helm/master/scripts/get-helm-3 | bash
helm version"><pre>curl https://raw.githubusercontent.com/helm/helm/master/scripts/get-helm-3 <span class="pl-k">|</span> bash
helm version</pre></div>
<ul dir="auto">
<li>Add helm chart repositories of Rancher.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="helm repo add rancher-latest https://releases.rancher.com/server-charts/latest
helm repo list"><pre>helm repo add rancher-latest https://releases.rancher.com/server-charts/latest
helm repo list</pre></div>
<ul dir="auto">
<li>Create a namespace for Rancher.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="kubectl create namespace cattle-system"><pre>kubectl create namespace cattle-system</pre></div>
<ul dir="auto">
<li>Install Rancher on RKE Kubernetes Cluster using Helm.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="helm install rancher rancher-latest/rancher \
  --namespace cattle-system \
  --set hostname=rancher.clarusway.us \
  --set tls=external \
  --set replicas=1"><pre>helm install rancher rancher-latest/rancher \
  --namespace cattle-system \
  --set hostname=rancher.clarusway.us \
  --set tls=external \
  --set replicas=1</pre></div>
<ul dir="auto">
<li>Check if the Rancher Server is deployed successfully.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="kubectl -n cattle-system get deploy rancher
kubectl -n cattle-system get pods"><pre>kubectl -n cattle-system get deploy rancher
kubectl -n cattle-system get pods</pre></div>
<h2 dir="auto"><a id="user-content-msp-24---prepare-petlinic-kubernetes-yaml-files" class="anchor" aria-hidden="true" href="#msp-24---prepare-petlinic-kubernetes-yaml-files"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>MSP 24 - Prepare Petlinic Kubernetes YAML Files</h2>
<ul dir="auto">
<li>Create <code>feature/msp-24</code> branch from <code>release</code>.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="git checkout release
git branch feature/msp-24
git checkout feature/msp-24"><pre>git checkout release
git branch feature/msp-24
git checkout feature/msp-24</pre></div>
<ul dir="auto">
<li>
<p dir="auto">Create a folder with name of <code>k8s</code> for keeping the deployment files of Petclinic App on Kubernetes cluster.</p>
</li>
<li>
<p dir="auto">Create a <code>docker-compose.yml</code> under <code>k8s</code> folder with the following content as to be used in conversion the k8s files.</p>
</li>
</ul>
<div class="highlight highlight-source-yaml position-relative overflow-auto" data-snippet-clipboard-copy-content="version: '3'
services:
  config-server:
    image: &quot;{{ .Values.IMAGE_TAG_CONFIG_SERVER }}&quot;
    ports:
     - 8888:8888
    labels:
      kompose.image-pull-secret: &quot;regcred&quot;
  discovery-server:
    image: &quot;{{ .Values.IMAGE_TAG_DISCOVERY_SERVER }}&quot;
    ports:
     - 8761:8761
    labels:
      kompose.image-pull-secret: &quot;regcred&quot;
  customers-service:
    image: &quot;{{ .Values.IMAGE_TAG_CUSTOMERS_SERVICE }}&quot;
    deploy:
      replicas: 2
    ports:
    - 8081:8081
    labels:
      kompose.image-pull-secret: &quot;regcred&quot;
  visits-service:
    image: &quot;{{ .Values.IMAGE_TAG_VISITS_SERVICE }}&quot;
    deploy:
      replicas: 2
    ports:
     - 8082:8082
    labels:
      kompose.image-pull-secret: &quot;regcred&quot;
  vets-service:
    image: &quot;{{ .Values.IMAGE_TAG_VETS_SERVICE }}&quot;
    deploy:
      replicas: 2
    ports:
     - 8083:8083
    labels:
      kompose.image-pull-secret: &quot;regcred&quot;
  api-gateway:
    image: &quot;{{ .Values.IMAGE_TAG_API_GATEWAY }}&quot;
    deploy:
      replicas: 1
    ports:
     - 8080:8080
    labels:
      kompose.image-pull-secret: &quot;regcred&quot;
      kompose.service.expose: &quot;{{ .Values.DNS_NAME }}&quot;
      kompose.service.type: &quot;nodeport&quot;
  tracing-server:
    image: openzipkin/zipkin
    environment:
    - JAVA_OPTS=-XX:+UnlockExperimentalVMOptions -Djava.security.egd=file:/dev/./urandom
    ports:
     - 9411:9411
  admin-server:
    image: &quot;{{ .Values.IMAGE_TAG_ADMIN_SERVER }}&quot;
    ports:
     - 9090:9090
    labels:
      kompose.image-pull-secret: &quot;regcred&quot;
  hystrix-dashboard:
    image: &quot;{{ .Values.IMAGE_TAG_HYSTRIX_DASHBOARD }}&quot;
    ports:
     - 7979:7979
    labels:
      kompose.image-pull-secret: &quot;regcred&quot;
  grafana-server:
    image: &quot;{{ .Values.IMAGE_TAG_GRAFANA_SERVICE }}&quot;
    ports:
    - 3000:3000
    labels:
      kompose.image-pull-secret: &quot;regcred&quot;
  prometheus-server:
    image: &quot;{{ .Values.IMAGE_TAG_PROMETHEUS_SERVICE }}&quot;
    ports:
    - 9091:9090
    labels:
      kompose.image-pull-secret: &quot;regcred&quot;

  mysql-server:
    image: mysql:5.7.8
    environment: 
      MYSQL_ROOT_PASSWORD: petclinic
      MYSQL_DATABASE: petclinic
    ports:
    - 3306:3306"><pre><span class="pl-ent">version</span>: <span class="pl-s"><span class="pl-pds">'</span>3<span class="pl-pds">'</span></span>
<span class="pl-ent">services</span>:
  <span class="pl-ent">config-server</span>:
    <span class="pl-ent">image</span>: <span class="pl-s"><span class="pl-pds">"</span>{{ .Values.IMAGE_TAG_CONFIG_SERVER }}<span class="pl-pds">"</span></span>
    <span class="pl-ent">ports</span>:
     - <span class="pl-c1">8888:8888</span>
    <span class="pl-ent">labels</span>:
      <span class="pl-ent">kompose.image-pull-secret</span>: <span class="pl-s"><span class="pl-pds">"</span>regcred<span class="pl-pds">"</span></span>
  <span class="pl-ent">discovery-server</span>:
    <span class="pl-ent">image</span>: <span class="pl-s"><span class="pl-pds">"</span>{{ .Values.IMAGE_TAG_DISCOVERY_SERVER }}<span class="pl-pds">"</span></span>
    <span class="pl-ent">ports</span>:
     - <span class="pl-c1">8761:8761</span>
    <span class="pl-ent">labels</span>:
      <span class="pl-ent">kompose.image-pull-secret</span>: <span class="pl-s"><span class="pl-pds">"</span>regcred<span class="pl-pds">"</span></span>
  <span class="pl-ent">customers-service</span>:
    <span class="pl-ent">image</span>: <span class="pl-s"><span class="pl-pds">"</span>{{ .Values.IMAGE_TAG_CUSTOMERS_SERVICE }}<span class="pl-pds">"</span></span>
    <span class="pl-ent">deploy</span>:
      <span class="pl-ent">replicas</span>: <span class="pl-c1">2</span>
    <span class="pl-ent">ports</span>:
    - <span class="pl-c1">8081:8081</span>
    <span class="pl-ent">labels</span>:
      <span class="pl-ent">kompose.image-pull-secret</span>: <span class="pl-s"><span class="pl-pds">"</span>regcred<span class="pl-pds">"</span></span>
  <span class="pl-ent">visits-service</span>:
    <span class="pl-ent">image</span>: <span class="pl-s"><span class="pl-pds">"</span>{{ .Values.IMAGE_TAG_VISITS_SERVICE }}<span class="pl-pds">"</span></span>
    <span class="pl-ent">deploy</span>:
      <span class="pl-ent">replicas</span>: <span class="pl-c1">2</span>
    <span class="pl-ent">ports</span>:
     - <span class="pl-c1">8082:8082</span>
    <span class="pl-ent">labels</span>:
      <span class="pl-ent">kompose.image-pull-secret</span>: <span class="pl-s"><span class="pl-pds">"</span>regcred<span class="pl-pds">"</span></span>
  <span class="pl-ent">vets-service</span>:
    <span class="pl-ent">image</span>: <span class="pl-s"><span class="pl-pds">"</span>{{ .Values.IMAGE_TAG_VETS_SERVICE }}<span class="pl-pds">"</span></span>
    <span class="pl-ent">deploy</span>:
      <span class="pl-ent">replicas</span>: <span class="pl-c1">2</span>
    <span class="pl-ent">ports</span>:
     - <span class="pl-c1">8083:8083</span>
    <span class="pl-ent">labels</span>:
      <span class="pl-ent">kompose.image-pull-secret</span>: <span class="pl-s"><span class="pl-pds">"</span>regcred<span class="pl-pds">"</span></span>
  <span class="pl-ent">api-gateway</span>:
    <span class="pl-ent">image</span>: <span class="pl-s"><span class="pl-pds">"</span>{{ .Values.IMAGE_TAG_API_GATEWAY }}<span class="pl-pds">"</span></span>
    <span class="pl-ent">deploy</span>:
      <span class="pl-ent">replicas</span>: <span class="pl-c1">1</span>
    <span class="pl-ent">ports</span>:
     - <span class="pl-c1">8080:8080</span>
    <span class="pl-ent">labels</span>:
      <span class="pl-ent">kompose.image-pull-secret</span>: <span class="pl-s"><span class="pl-pds">"</span>regcred<span class="pl-pds">"</span></span>
      <span class="pl-ent">kompose.service.expose</span>: <span class="pl-s"><span class="pl-pds">"</span>{{ .Values.DNS_NAME }}<span class="pl-pds">"</span></span>
      <span class="pl-ent">kompose.service.type</span>: <span class="pl-s"><span class="pl-pds">"</span>nodeport<span class="pl-pds">"</span></span>
  <span class="pl-ent">tracing-server</span>:
    <span class="pl-ent">image</span>: <span class="pl-s">openzipkin/zipkin</span>
    <span class="pl-ent">environment</span>:
    - <span class="pl-s">JAVA_OPTS=-XX:+UnlockExperimentalVMOptions -Djava.security.egd=file:/dev/./urandom</span>
    <span class="pl-ent">ports</span>:
     - <span class="pl-c1">9411:9411</span>
  <span class="pl-ent">admin-server</span>:
    <span class="pl-ent">image</span>: <span class="pl-s"><span class="pl-pds">"</span>{{ .Values.IMAGE_TAG_ADMIN_SERVER }}<span class="pl-pds">"</span></span>
    <span class="pl-ent">ports</span>:
     - <span class="pl-c1">9090:9090</span>
    <span class="pl-ent">labels</span>:
      <span class="pl-ent">kompose.image-pull-secret</span>: <span class="pl-s"><span class="pl-pds">"</span>regcred<span class="pl-pds">"</span></span>
  <span class="pl-ent">hystrix-dashboard</span>:
    <span class="pl-ent">image</span>: <span class="pl-s"><span class="pl-pds">"</span>{{ .Values.IMAGE_TAG_HYSTRIX_DASHBOARD }}<span class="pl-pds">"</span></span>
    <span class="pl-ent">ports</span>:
     - <span class="pl-c1">7979:7979</span>
    <span class="pl-ent">labels</span>:
      <span class="pl-ent">kompose.image-pull-secret</span>: <span class="pl-s"><span class="pl-pds">"</span>regcred<span class="pl-pds">"</span></span>
  <span class="pl-ent">grafana-server</span>:
    <span class="pl-ent">image</span>: <span class="pl-s"><span class="pl-pds">"</span>{{ .Values.IMAGE_TAG_GRAFANA_SERVICE }}<span class="pl-pds">"</span></span>
    <span class="pl-ent">ports</span>:
    - <span class="pl-c1">3000:3000</span>
    <span class="pl-ent">labels</span>:
      <span class="pl-ent">kompose.image-pull-secret</span>: <span class="pl-s"><span class="pl-pds">"</span>regcred<span class="pl-pds">"</span></span>
  <span class="pl-ent">prometheus-server</span>:
    <span class="pl-ent">image</span>: <span class="pl-s"><span class="pl-pds">"</span>{{ .Values.IMAGE_TAG_PROMETHEUS_SERVICE }}<span class="pl-pds">"</span></span>
    <span class="pl-ent">ports</span>:
    - <span class="pl-c1">9091:9090</span>
    <span class="pl-ent">labels</span>:
      <span class="pl-ent">kompose.image-pull-secret</span>: <span class="pl-s"><span class="pl-pds">"</span>regcred<span class="pl-pds">"</span></span>

  <span class="pl-ent">mysql-server</span>:
    <span class="pl-ent">image</span>: <span class="pl-s">mysql:5.7.8</span>
    <span class="pl-ent">environment</span>: 
      <span class="pl-ent">MYSQL_ROOT_PASSWORD</span>: <span class="pl-s">petclinic</span>
      <span class="pl-ent">MYSQL_DATABASE</span>: <span class="pl-s">petclinic</span>
    <span class="pl-ent">ports</span>:
    - <span class="pl-c1">3306:3306</span></pre></div>
<ul dir="auto">
<li>Install <a href="https://kompose.io/installation/" rel="nofollow">conversion tool</a> named <code>Kompose</code> on your Jenkins Server. <a href="https://kompose.io/user-guide/#user-guide" rel="nofollow">User Guide</a></li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="curl -L https://github.com/kubernetes/kompose/releases/download/v1.26.1/kompose-linux-amd64 -o kompose
chmod +x kompose
sudo mv ./kompose /usr/local/bin/kompose
kompose version"><pre>curl -L https://github.com/kubernetes/kompose/releases/download/v1.26.1/kompose-linux-amd64 -o kompose
chmod +x kompose
sudo mv ./kompose /usr/local/bin/kompose
kompose version</pre></div>
<ul dir="auto">
<li>Create an helm chart named <code>petclinic_chart</code> under <code>k8s</code> folder.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="cd k8s
helm create petclinic_chart"><pre><span class="pl-c1">cd</span> k8s
helm create petclinic_chart</pre></div>
<ul dir="auto">
<li>Remove all files under the petclinic_chart/templates folder.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="rm -r petclinic_chart/templates/*"><pre>rm -r petclinic_chart/templates/<span class="pl-k">*</span></pre></div>
<ul dir="auto">
<li>Convert the <code>docker-compose.yml</code> into k8s/petclinic_chart/templates objects and save under <code>k8s/petclinic_chart</code> folder.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="kompose convert -f docker-compose.yml -o petclinic_chart/templates"><pre>kompose convert -f docker-compose.yml -o petclinic_chart/templates</pre></div>
<ul dir="auto">
<li>Update deployment files with <code>init-containers</code> to launch microservices in sequence. See <a href="https://kubernetes.io/docs/concepts/workloads/pods/init-containers/" rel="nofollow">Init Containers</a>.</li>
</ul>
<div class="highlight highlight-source-yaml position-relative overflow-auto" data-snippet-clipboard-copy-content="# for discovery server
      initContainers:
      - name: init-config-server
        image: busybox
        command: ['sh', '-c', 'until nc -z config-server:8888; do echo waiting for config-server; sleep 2; done;']
# for all other microservices except config-server and discovery-server
      initContainers:
      - name: init-discovery-server
        image: busybox
        command: ['sh', '-c', 'until nc -z discovery-server:8761; do echo waiting for discovery-server; sleep 2; done;']"><pre><span class="pl-c"><span class="pl-c">#</span> for discovery server</span>
      <span class="pl-ent">initContainers</span>:
      - <span class="pl-ent">name</span>: <span class="pl-s">init-config-server</span>
        <span class="pl-ent">image</span>: <span class="pl-s">busybox</span>
        <span class="pl-ent">command</span>: <span class="pl-s">['sh', '-c', 'until nc -z config-server:8888; do echo waiting for config-server; sleep 2; done;']</span>
<span class="pl-c"><span class="pl-c">#</span> for all other microservices except config-server and discovery-server</span>
      <span class="pl-ent">initContainers</span>:
      - <span class="pl-ent">name</span>: <span class="pl-s">init-discovery-server</span>
        <span class="pl-ent">image</span>: <span class="pl-s">busybox</span>
        <span class="pl-ent">command</span>: <span class="pl-s">['sh', '-c', 'until nc -z discovery-server:8761; do echo waiting for discovery-server; sleep 2; done;']</span></pre></div>
<ul dir="auto">
<li>Update <code>spec.rules.host</code> field of <code>api-gateway-ingress.yaml</code> file as below.</li>
</ul>
<div class="highlight highlight-source-yaml position-relative overflow-auto" data-snippet-clipboard-copy-content="'{{ .Values.DNS_NAME }}'"><pre><span class="pl-s"><span class="pl-pds">'</span>{{ .Values.DNS_NAME }}<span class="pl-pds">'</span></span></pre></div>
<ul dir="auto">
<li>Add <code>k8s/petclinic_chart/values-template.yaml</code> file as below.</li>
</ul>
<div class="highlight highlight-source-yaml position-relative overflow-auto" data-snippet-clipboard-copy-content="IMAGE_TAG_CONFIG_SERVER: &quot;${IMAGE_TAG_CONFIG_SERVER}&quot;
IMAGE_TAG_DISCOVERY_SERVER: &quot;${IMAGE_TAG_DISCOVERY_SERVER}&quot;
IMAGE_TAG_CUSTOMERS_SERVICE: &quot;${IMAGE_TAG_CUSTOMERS_SERVICE}&quot;
IMAGE_TAG_VISITS_SERVICE: &quot;${IMAGE_TAG_VISITS_SERVICE}&quot;
IMAGE_TAG_VETS_SERVICE: &quot;${IMAGE_TAG_VETS_SERVICE}&quot;
IMAGE_TAG_API_GATEWAY: &quot;${IMAGE_TAG_API_GATEWAY}&quot;
IMAGE_TAG_ADMIN_SERVER: &quot;${IMAGE_TAG_ADMIN_SERVER}&quot;
IMAGE_TAG_HYSTRIX_DASHBOARD: &quot;${IMAGE_TAG_HYSTRIX_DASHBOARD}&quot;
IMAGE_TAG_GRAFANA_SERVICE: &quot;${IMAGE_TAG_GRAFANA_SERVICE}&quot;
IMAGE_TAG_PROMETHEUS_SERVICE: &quot;${IMAGE_TAG_PROMETHEUS_SERVICE}&quot;
DNS_NAME: &quot;DNS Name of your application&quot;"><pre><span class="pl-ent">IMAGE_TAG_CONFIG_SERVER</span>: <span class="pl-s"><span class="pl-pds">"</span>${IMAGE_TAG_CONFIG_SERVER}<span class="pl-pds">"</span></span>
<span class="pl-ent">IMAGE_TAG_DISCOVERY_SERVER</span>: <span class="pl-s"><span class="pl-pds">"</span>${IMAGE_TAG_DISCOVERY_SERVER}<span class="pl-pds">"</span></span>
<span class="pl-ent">IMAGE_TAG_CUSTOMERS_SERVICE</span>: <span class="pl-s"><span class="pl-pds">"</span>${IMAGE_TAG_CUSTOMERS_SERVICE}<span class="pl-pds">"</span></span>
<span class="pl-ent">IMAGE_TAG_VISITS_SERVICE</span>: <span class="pl-s"><span class="pl-pds">"</span>${IMAGE_TAG_VISITS_SERVICE}<span class="pl-pds">"</span></span>
<span class="pl-ent">IMAGE_TAG_VETS_SERVICE</span>: <span class="pl-s"><span class="pl-pds">"</span>${IMAGE_TAG_VETS_SERVICE}<span class="pl-pds">"</span></span>
<span class="pl-ent">IMAGE_TAG_API_GATEWAY</span>: <span class="pl-s"><span class="pl-pds">"</span>${IMAGE_TAG_API_GATEWAY}<span class="pl-pds">"</span></span>
<span class="pl-ent">IMAGE_TAG_ADMIN_SERVER</span>: <span class="pl-s"><span class="pl-pds">"</span>${IMAGE_TAG_ADMIN_SERVER}<span class="pl-pds">"</span></span>
<span class="pl-ent">IMAGE_TAG_HYSTRIX_DASHBOARD</span>: <span class="pl-s"><span class="pl-pds">"</span>${IMAGE_TAG_HYSTRIX_DASHBOARD}<span class="pl-pds">"</span></span>
<span class="pl-ent">IMAGE_TAG_GRAFANA_SERVICE</span>: <span class="pl-s"><span class="pl-pds">"</span>${IMAGE_TAG_GRAFANA_SERVICE}<span class="pl-pds">"</span></span>
<span class="pl-ent">IMAGE_TAG_PROMETHEUS_SERVICE</span>: <span class="pl-s"><span class="pl-pds">"</span>${IMAGE_TAG_PROMETHEUS_SERVICE}<span class="pl-pds">"</span></span>
<span class="pl-ent">DNS_NAME</span>: <span class="pl-s"><span class="pl-pds">"</span>DNS Name of your application<span class="pl-pds">"</span></span></pre></div>
<ul dir="auto">
<li>Check if the petclinic_chart working as expected.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="export IMAGE_TAG_CONFIG_SERVER=&quot;testing-image-1&quot;    
export IMAGE_TAG_DISCOVERY_SERVER=&quot;testing-image-2&quot; 
export IMAGE_TAG_CUSTOMERS_SERVICE=&quot;testing-image-3&quot;
export IMAGE_TAG_VISITS_SERVICE=&quot;testing-image-4&quot;   
export IMAGE_TAG_VETS_SERVICE=&quot;testing-image-5&quot;     
export IMAGE_TAG_API_GATEWAY=&quot;testing-image-6&quot;      
export IMAGE_TAG_ADMIN_SERVER=&quot;testing-image-7&quot;     
export IMAGE_TAG_HYSTRIX_DASHBOARD=&quot;testing-image-8&quot;
export IMAGE_TAG_GRAFANA_SERVICE=&quot;testing-image-9&quot;
export IMAGE_TAG_PROMETHEUS_SERVICE=&quot;testing-image-10&quot;
# create values.yaml file from template by updating with environments variables
envsubst &lt; k8s/petclinic_chart/values-template.yaml &gt; k8s/petclinic_chart/values.yaml
# test petclinic_chart
helm install ptest k8s/petclinic_chart/ --namespace dev --debug --dry-run"><pre><span class="pl-k">export</span> IMAGE_TAG_CONFIG_SERVER=<span class="pl-s"><span class="pl-pds">"</span>testing-image-1<span class="pl-pds">"</span></span>    
<span class="pl-k">export</span> IMAGE_TAG_DISCOVERY_SERVER=<span class="pl-s"><span class="pl-pds">"</span>testing-image-2<span class="pl-pds">"</span></span> 
<span class="pl-k">export</span> IMAGE_TAG_CUSTOMERS_SERVICE=<span class="pl-s"><span class="pl-pds">"</span>testing-image-3<span class="pl-pds">"</span></span>
<span class="pl-k">export</span> IMAGE_TAG_VISITS_SERVICE=<span class="pl-s"><span class="pl-pds">"</span>testing-image-4<span class="pl-pds">"</span></span>   
<span class="pl-k">export</span> IMAGE_TAG_VETS_SERVICE=<span class="pl-s"><span class="pl-pds">"</span>testing-image-5<span class="pl-pds">"</span></span>     
<span class="pl-k">export</span> IMAGE_TAG_API_GATEWAY=<span class="pl-s"><span class="pl-pds">"</span>testing-image-6<span class="pl-pds">"</span></span>      
<span class="pl-k">export</span> IMAGE_TAG_ADMIN_SERVER=<span class="pl-s"><span class="pl-pds">"</span>testing-image-7<span class="pl-pds">"</span></span>     
<span class="pl-k">export</span> IMAGE_TAG_HYSTRIX_DASHBOARD=<span class="pl-s"><span class="pl-pds">"</span>testing-image-8<span class="pl-pds">"</span></span>
<span class="pl-k">export</span> IMAGE_TAG_GRAFANA_SERVICE=<span class="pl-s"><span class="pl-pds">"</span>testing-image-9<span class="pl-pds">"</span></span>
<span class="pl-k">export</span> IMAGE_TAG_PROMETHEUS_SERVICE=<span class="pl-s"><span class="pl-pds">"</span>testing-image-10<span class="pl-pds">"</span></span>
<span class="pl-c"><span class="pl-c">#</span> create values.yaml file from template by updating with environments variables</span>
envsubst <span class="pl-k">&lt;</span> k8s/petclinic_chart/values-template.yaml <span class="pl-k">&gt;</span> k8s/petclinic_chart/values.yaml
<span class="pl-c"><span class="pl-c">#</span> test petclinic_chart</span>
helm install ptest k8s/petclinic_chart/ --namespace dev --debug --dry-run</pre></div>
<h3 dir="auto"><a id="user-content-set-up-a-helm-v3-chart-repository-in-amazon-s3" class="anchor" aria-hidden="true" href="#set-up-a-helm-v3-chart-repository-in-amazon-s3"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Set up a Helm v3 chart repository in Amazon S3</h3>
<ul dir="auto">
<li>
<p dir="auto">This pattern helps you to manage Helm v3 charts efficiently by integrating the Helm v3 repository into Amazon Simple Storage Service (Amazon S3) on the Amazon Web Services (AWS) Cloud. (<a href="https://docs.aws.amazon.com/prescriptive-guidance/latest/patterns/set-up-a-helm-v3-chart-repository-in-amazon-s3.html" rel="nofollow">https://docs.aws.amazon.com/prescriptive-guidance/latest/patterns/set-up-a-helm-v3-chart-repository-in-amazon-s3.html</a>)</p>
</li>
<li>
<p dir="auto">Create an S3 bucket for Helm charts. In the bucket, create a folder called stable/myapp. The example in this pattern uses s3://petclinic-helm-charts/stable/myapp as the target chart repository.</p>
</li>
<li>
<p dir="auto">Install the helm-s3 plugin for Amazon S3.</p>
</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="helm plugin install https://github.com/hypnoglow/helm-s3.git"><pre>helm plugin install https://github.com/hypnoglow/helm-s3.git</pre></div>
<ul dir="auto">
<li>Initialize the Amazon S3 Helm repository.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="AWS_REGION=us-east-1 helm s3 init s3://petclinic-helm-charts/stable/myapp "><pre>AWS_REGION=us-east-1 helm s3 init s3://petclinic-helm-charts/stable/myapp </pre></div>
<ul dir="auto">
<li>
<p dir="auto">The command creates an index.yaml file in the target to track all the chart information that is stored at that location.</p>
</li>
<li>
<p dir="auto">Verify that the index.yaml file was created.</p>
</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="aws s3 ls s3://petclinic-helm-charts/stable/myapp/"><pre>aws s3 ls s3://petclinic-helm-charts/stable/myapp/</pre></div>
<ul dir="auto">
<li>Add the Amazon S3 repository to Helm on the client machine.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="AWS_REGION=us-east-1 helm repo add stable-petclinicapp s3://petclinic-helm-charts/stable/myapp/"><pre>AWS_REGION=us-east-1 helm repo add stable-petclinicapp s3://petclinic-helm-charts/stable/myapp/</pre></div>
<ul dir="auto">
<li>Update <code>version</code> field of <code>k8s/petclinic_chart/Chart.yaml</code> file as below for testing.</li>
</ul>
<div class="highlight highlight-source-yaml position-relative overflow-auto" data-snippet-clipboard-copy-content="version: 1.1.1"><pre><span class="pl-ent">version</span>: <span class="pl-s">1.1.1</span></pre></div>
<ul dir="auto">
<li>Package the local Helm chart.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="cd k8s
helm package petclinic_chart/ "><pre><span class="pl-c1">cd</span> k8s
helm package petclinic_chart/ </pre></div>
<ul dir="auto">
<li>Store the local package in the Amazon S3 Helm repository.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="HELM_S3_MODE=3 AWS_REGION=us-east-1 helm s3 push ./petclinic_chart-1.1.1.tgz stable-petclinicapp"><pre>HELM_S3_MODE=3 AWS_REGION=us-east-1 helm s3 push ./petclinic_chart-1.1.1.tgz stable-petclinicapp</pre></div>
<ul dir="auto">
<li>Search for the Helm chart.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="helm search repo stable-petclinicapp"><pre>helm search repo stable-petclinicapp</pre></div>
<ul dir="auto">
<li>You get an output as below.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="NAME                                    CHART VERSION   APP VERSION     DESCRIPTION                
stable-petclinicapp/petclinic_chart     1.1.1           0.1.0           A Helm chart for Kubernetes"><pre>NAME                                    CHART VERSION   APP VERSION     DESCRIPTION                
stable-petclinicapp/petclinic_chart     1.1.1           0.1.0           A Helm chart <span class="pl-k">for</span> Kubernetes</pre></div>
<ul dir="auto">
<li>In Chart.yaml, set the <code>version</code> value to <code>1.1.2</code> in Chart.yaml, and then package the chart, this time changing the version in Chart.yaml to 1.1.2. Version control is ideally achieved through automation by using tools like GitVersion or Jenkins build numbers in a CI/CD pipeline.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="helm package petclinic_chart/"><pre>helm package petclinic_chart/</pre></div>
<ul dir="auto">
<li>Push the new version to the Helm repository in Amazon S3.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="HELM_S3_MODE=3 AWS_REGION=us-east-1 helm s3 push ./petclinic_chart-1.1.2.tgz stable-petclinicapp"><pre>HELM_S3_MODE=3 AWS_REGION=us-east-1 helm s3 push ./petclinic_chart-1.1.2.tgz stable-petclinicapp</pre></div>
<ul dir="auto">
<li>Verify the updated Helm chart.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="helm repo update
helm search repo stable-petclinicapp"><pre>helm repo update
helm search repo stable-petclinicapp</pre></div>
<ul dir="auto">
<li>You get an output as below.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="NAME                                    CHART VERSION   APP VERSION     DESCRIPTION                
stable-petclinicapp/petclinic_chart     1.1.2           0.1.0           A Helm chart for Kubernetes"><pre>NAME                                    CHART VERSION   APP VERSION     DESCRIPTION                
stable-petclinicapp/petclinic_chart     1.1.2           0.1.0           A Helm chart <span class="pl-k">for</span> Kubernetes</pre></div>
<ul dir="auto">
<li>To view all the available versions of a chart execute following command.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="helm search repo stable-petclinicapp --versions"><pre>helm search repo stable-petclinicapp --versions</pre></div>
<ul dir="auto">
<li>Output:</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="NAME                                    CHART VERSION   APP VERSION     DESCRIPTION                
stable-petclinicapp/petclinic_chart     1.1.2           0.1.0           A Helm chart for Kubernetes
stable-petclinicapp/petclinic_chart     1.1.1           0.1.0           A Helm chart for Kubernetes"><pre>NAME                                    CHART VERSION   APP VERSION     DESCRIPTION                
stable-petclinicapp/petclinic_chart     1.1.2           0.1.0           A Helm chart <span class="pl-k">for</span> Kubernetes
stable-petclinicapp/petclinic_chart     1.1.1           0.1.0           A Helm chart <span class="pl-k">for</span> Kubernetes</pre></div>
<ul dir="auto">
<li>Test to installing the chart from the Amazon S3 Helm repository.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="AWS_REGION=us-east-1 helm upgrade --install petclinic-release stable-petclinicapp/petclinic_chart  --version 1.1.2 --namespace dev --debug --dry-run"><pre>AWS_REGION=us-east-1 helm upgrade --install petclinic-release stable-petclinicapp/petclinic_chart  --version 1.1.2 --namespace dev --debug --dry-run</pre></div>
<ul dir="auto">
<li>
<p dir="auto">In Chart.yaml, set the <code>version</code> value to <code>HELM_VERSION</code> in Chart.yaml for automation in jenkins pipeline.</p>
</li>
<li>
<p dir="auto">Commit the change, then push the script to the remote repo.</p>
</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="git add .
git commit -m 'added Configuration YAML Files for Kubernetes Deployment'
git push --set-upstream origin feature/msp-24
git checkout release
git merge feature/msp-24
git push origin release"><pre>git add <span class="pl-c1">.</span>
git commit -m <span class="pl-s"><span class="pl-pds">'</span>added Configuration YAML Files for Kubernetes Deployment<span class="pl-pds">'</span></span>
git push --set-upstream origin feature/msp-24
git checkout release
git merge feature/msp-24
git push origin release</pre></div>
<h2 dir="auto"><a id="user-content-msp-25---create-staging-and-production-environment-with-rancher" class="anchor" aria-hidden="true" href="#msp-25---create-staging-and-production-environment-with-rancher"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>MSP 25 - Create Staging and Production Environment with Rancher</h2>
<ul dir="auto">
<li>
<p dir="auto">To provide access of Rancher to the cloud resources, create a <code>Cloud Credentials</code> for AWS on Rancher and name it as <code>Call-AWS-Training-Account</code>.</p>
</li>
<li>
<p dir="auto">Create a <code>Node Template</code> on Rancher with following configuration for to be used while launching the EC2 instances and name it as <code>Call-AWS-RancherOs-Template</code>.</p>
</li>
</ul>
<div class="snippet-clipboard-content position-relative overflow-auto" data-snippet-clipboard-copy-content="Region            : us-east-1
Security group    : create new sg (rancher-nodes)
Instance Type     : t2.medium
Root Disk Size    : 16 GB
AMI (RancherOS)   : ami-0e8a3347e4c5959bd
SSH User          : rancher
Label             : os=rancheros"><pre lang="text"><code>Region            : us-east-1
Security group    : create new sg (rancher-nodes)
Instance Type     : t2.medium
Root Disk Size    : 16 GB
AMI (RancherOS)   : ami-0e8a3347e4c5959bd
SSH User          : rancher
Label             : os=rancheros
</code></pre></div>
<h2 dir="auto"><a id="user-content-msp-26---prepare-a-staging-pipeline" class="anchor" aria-hidden="true" href="#msp-26---prepare-a-staging-pipeline"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>MSP 26 - Prepare a Staging Pipeline</h2>
<ul dir="auto">
<li>Create <code>feature/msp-26</code> branch from <code>release</code>.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="git checkout release
git branch feature/msp-26
git checkout feature/msp-26"><pre>git checkout release
git branch feature/msp-26
git checkout feature/msp-26</pre></div>
<ul dir="auto">
<li>Create a Kubernetes cluster using Rancher with RKE and new nodes in AWS  and name it as <code>petclinic-cluster-staging</code>.</li>
</ul>
<div class="snippet-clipboard-content position-relative overflow-auto" data-snippet-clipboard-copy-content="Cluster Type      : Amazon EC2
Name Prefix       : petclinic-k8s-instance
Count             : 3
etcd              : checked
Control Plane     : checked
Worker            : checked"><pre lang="text"><code>Cluster Type      : Amazon EC2
Name Prefix       : petclinic-k8s-instance
Count             : 3
etcd              : checked
Control Plane     : checked
Worker            : checked
</code></pre></div>
<ul dir="auto">
<li>
<p dir="auto">Create <code>petclinic-staging-ns</code> namespace on <code>petclinic-cluster-staging</code> with Rancher.</p>
</li>
<li>
<p dir="auto">Create a Jenkins Job and name it as <code>create-ecr-docker-registry-for-petclinic-staging</code> to create Docker Registry for <code>Staging</code> manually on AWS ECR.</p>
</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="PATH=&quot;$PATH:/usr/local/bin&quot;
APP_REPO_NAME=&quot;clarusway-repo/petclinic-app-staging&quot;
AWS_REGION=&quot;us-east-1&quot;

aws ecr create-repository \
  --repository-name ${APP_REPO_NAME} \
  --image-scanning-configuration scanOnPush=false \
  --image-tag-mutability MUTABLE \
  --region ${AWS_REGION}"><pre>PATH=<span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">$PATH</span>:/usr/local/bin<span class="pl-pds">"</span></span>
APP_REPO_NAME=<span class="pl-s"><span class="pl-pds">"</span>clarusway-repo/petclinic-app-staging<span class="pl-pds">"</span></span>
AWS_REGION=<span class="pl-s"><span class="pl-pds">"</span>us-east-1<span class="pl-pds">"</span></span>

aws ecr create-repository \
  --repository-name <span class="pl-smi">${APP_REPO_NAME}</span> \
  --image-scanning-configuration scanOnPush=false \
  --image-tag-mutability MUTABLE \
  --region <span class="pl-smi">${AWS_REGION}</span></pre></div>
<ul dir="auto">
<li>Prepare a script to create ECR tags for the staging docker images and name it as <code>prepare-tags-ecr-for-staging-docker-images.sh</code> and save it under <code>jenkins</code> folder.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="MVN_VERSION=$(. ${WORKSPACE}/spring-petclinic-admin-server/target/maven-archiver/pom.properties &amp;&amp; echo $version)
export IMAGE_TAG_ADMIN_SERVER=&quot;${ECR_REGISTRY}/${APP_REPO_NAME}:admin-server-staging-v${MVN_VERSION}-b${BUILD_NUMBER}&quot;
MVN_VERSION=$(. ${WORKSPACE}/spring-petclinic-api-gateway/target/maven-archiver/pom.properties &amp;&amp; echo $version)
export IMAGE_TAG_API_GATEWAY=&quot;${ECR_REGISTRY}/${APP_REPO_NAME}:api-gateway-staging-v${MVN_VERSION}-b${BUILD_NUMBER}&quot;
MVN_VERSION=$(. ${WORKSPACE}/spring-petclinic-config-server/target/maven-archiver/pom.properties &amp;&amp; echo $version)
export IMAGE_TAG_CONFIG_SERVER=&quot;${ECR_REGISTRY}/${APP_REPO_NAME}:config-server-staging-v${MVN_VERSION}-b${BUILD_NUMBER}&quot;
MVN_VERSION=$(. ${WORKSPACE}/spring-petclinic-customers-service/target/maven-archiver/pom.properties &amp;&amp; echo $version)
export IMAGE_TAG_CUSTOMERS_SERVICE=&quot;${ECR_REGISTRY}/${APP_REPO_NAME}:customers-service-staging-v${MVN_VERSION}-b${BUILD_NUMBER}&quot;
MVN_VERSION=$(. ${WORKSPACE}/spring-petclinic-discovery-server/target/maven-archiver/pom.properties &amp;&amp; echo $version)
export IMAGE_TAG_DISCOVERY_SERVER=&quot;${ECR_REGISTRY}/${APP_REPO_NAME}:discovery-server-staging-v${MVN_VERSION}-b${BUILD_NUMBER}&quot;
MVN_VERSION=$(. ${WORKSPACE}/spring-petclinic-hystrix-dashboard/target/maven-archiver/pom.properties &amp;&amp; echo $version)
export IMAGE_TAG_HYSTRIX_DASHBOARD=&quot;${ECR_REGISTRY}/${APP_REPO_NAME}:hystrix-dashboard-staging-v${MVN_VERSION}-b${BUILD_NUMBER}&quot;
MVN_VERSION=$(. ${WORKSPACE}/spring-petclinic-vets-service/target/maven-archiver/pom.properties &amp;&amp; echo $version)
export IMAGE_TAG_VETS_SERVICE=&quot;${ECR_REGISTRY}/${APP_REPO_NAME}:vets-service-staging-v${MVN_VERSION}-b${BUILD_NUMBER}&quot;
MVN_VERSION=$(. ${WORKSPACE}/spring-petclinic-visits-service/target/maven-archiver/pom.properties &amp;&amp; echo $version)
export IMAGE_TAG_VISITS_SERVICE=&quot;${ECR_REGISTRY}/${APP_REPO_NAME}:visits-service-staging-v${MVN_VERSION}-b${BUILD_NUMBER}&quot;
export IMAGE_TAG_GRAFANA_SERVICE=&quot;${ECR_REGISTRY}/${APP_REPO_NAME}:grafana-service&quot;
export IMAGE_TAG_PROMETHEUS_SERVICE=&quot;${ECR_REGISTRY}/${APP_REPO_NAME}:prometheus-service&quot;"><pre>MVN_VERSION=<span class="pl-s"><span class="pl-pds">$(</span>. <span class="pl-smi">${WORKSPACE}</span>/spring-petclinic-admin-server/target/maven-archiver/pom.properties <span class="pl-k">&amp;&amp;</span> <span class="pl-c1">echo</span> <span class="pl-smi">$version</span><span class="pl-pds">)</span></span>
<span class="pl-k">export</span> IMAGE_TAG_ADMIN_SERVER=<span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${ECR_REGISTRY}</span>/<span class="pl-smi">${APP_REPO_NAME}</span>:admin-server-staging-v<span class="pl-smi">${MVN_VERSION}</span>-b<span class="pl-smi">${BUILD_NUMBER}</span><span class="pl-pds">"</span></span>
MVN_VERSION=<span class="pl-s"><span class="pl-pds">$(</span>. <span class="pl-smi">${WORKSPACE}</span>/spring-petclinic-api-gateway/target/maven-archiver/pom.properties <span class="pl-k">&amp;&amp;</span> <span class="pl-c1">echo</span> <span class="pl-smi">$version</span><span class="pl-pds">)</span></span>
<span class="pl-k">export</span> IMAGE_TAG_API_GATEWAY=<span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${ECR_REGISTRY}</span>/<span class="pl-smi">${APP_REPO_NAME}</span>:api-gateway-staging-v<span class="pl-smi">${MVN_VERSION}</span>-b<span class="pl-smi">${BUILD_NUMBER}</span><span class="pl-pds">"</span></span>
MVN_VERSION=<span class="pl-s"><span class="pl-pds">$(</span>. <span class="pl-smi">${WORKSPACE}</span>/spring-petclinic-config-server/target/maven-archiver/pom.properties <span class="pl-k">&amp;&amp;</span> <span class="pl-c1">echo</span> <span class="pl-smi">$version</span><span class="pl-pds">)</span></span>
<span class="pl-k">export</span> IMAGE_TAG_CONFIG_SERVER=<span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${ECR_REGISTRY}</span>/<span class="pl-smi">${APP_REPO_NAME}</span>:config-server-staging-v<span class="pl-smi">${MVN_VERSION}</span>-b<span class="pl-smi">${BUILD_NUMBER}</span><span class="pl-pds">"</span></span>
MVN_VERSION=<span class="pl-s"><span class="pl-pds">$(</span>. <span class="pl-smi">${WORKSPACE}</span>/spring-petclinic-customers-service/target/maven-archiver/pom.properties <span class="pl-k">&amp;&amp;</span> <span class="pl-c1">echo</span> <span class="pl-smi">$version</span><span class="pl-pds">)</span></span>
<span class="pl-k">export</span> IMAGE_TAG_CUSTOMERS_SERVICE=<span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${ECR_REGISTRY}</span>/<span class="pl-smi">${APP_REPO_NAME}</span>:customers-service-staging-v<span class="pl-smi">${MVN_VERSION}</span>-b<span class="pl-smi">${BUILD_NUMBER}</span><span class="pl-pds">"</span></span>
MVN_VERSION=<span class="pl-s"><span class="pl-pds">$(</span>. <span class="pl-smi">${WORKSPACE}</span>/spring-petclinic-discovery-server/target/maven-archiver/pom.properties <span class="pl-k">&amp;&amp;</span> <span class="pl-c1">echo</span> <span class="pl-smi">$version</span><span class="pl-pds">)</span></span>
<span class="pl-k">export</span> IMAGE_TAG_DISCOVERY_SERVER=<span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${ECR_REGISTRY}</span>/<span class="pl-smi">${APP_REPO_NAME}</span>:discovery-server-staging-v<span class="pl-smi">${MVN_VERSION}</span>-b<span class="pl-smi">${BUILD_NUMBER}</span><span class="pl-pds">"</span></span>
MVN_VERSION=<span class="pl-s"><span class="pl-pds">$(</span>. <span class="pl-smi">${WORKSPACE}</span>/spring-petclinic-hystrix-dashboard/target/maven-archiver/pom.properties <span class="pl-k">&amp;&amp;</span> <span class="pl-c1">echo</span> <span class="pl-smi">$version</span><span class="pl-pds">)</span></span>
<span class="pl-k">export</span> IMAGE_TAG_HYSTRIX_DASHBOARD=<span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${ECR_REGISTRY}</span>/<span class="pl-smi">${APP_REPO_NAME}</span>:hystrix-dashboard-staging-v<span class="pl-smi">${MVN_VERSION}</span>-b<span class="pl-smi">${BUILD_NUMBER}</span><span class="pl-pds">"</span></span>
MVN_VERSION=<span class="pl-s"><span class="pl-pds">$(</span>. <span class="pl-smi">${WORKSPACE}</span>/spring-petclinic-vets-service/target/maven-archiver/pom.properties <span class="pl-k">&amp;&amp;</span> <span class="pl-c1">echo</span> <span class="pl-smi">$version</span><span class="pl-pds">)</span></span>
<span class="pl-k">export</span> IMAGE_TAG_VETS_SERVICE=<span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${ECR_REGISTRY}</span>/<span class="pl-smi">${APP_REPO_NAME}</span>:vets-service-staging-v<span class="pl-smi">${MVN_VERSION}</span>-b<span class="pl-smi">${BUILD_NUMBER}</span><span class="pl-pds">"</span></span>
MVN_VERSION=<span class="pl-s"><span class="pl-pds">$(</span>. <span class="pl-smi">${WORKSPACE}</span>/spring-petclinic-visits-service/target/maven-archiver/pom.properties <span class="pl-k">&amp;&amp;</span> <span class="pl-c1">echo</span> <span class="pl-smi">$version</span><span class="pl-pds">)</span></span>
<span class="pl-k">export</span> IMAGE_TAG_VISITS_SERVICE=<span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${ECR_REGISTRY}</span>/<span class="pl-smi">${APP_REPO_NAME}</span>:visits-service-staging-v<span class="pl-smi">${MVN_VERSION}</span>-b<span class="pl-smi">${BUILD_NUMBER}</span><span class="pl-pds">"</span></span>
<span class="pl-k">export</span> IMAGE_TAG_GRAFANA_SERVICE=<span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${ECR_REGISTRY}</span>/<span class="pl-smi">${APP_REPO_NAME}</span>:grafana-service<span class="pl-pds">"</span></span>
<span class="pl-k">export</span> IMAGE_TAG_PROMETHEUS_SERVICE=<span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${ECR_REGISTRY}</span>/<span class="pl-smi">${APP_REPO_NAME}</span>:prometheus-service<span class="pl-pds">"</span></span></pre></div>
<ul dir="auto">
<li>Prepare a script to build the staging docker images tagged for ECR registry and name it as <code>build-staging-docker-images-for-ecr.sh</code> and save it under <code>jenkins</code> folder.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="docker build --force-rm -t &quot;${IMAGE_TAG_ADMIN_SERVER}&quot; &quot;${WORKSPACE}/spring-petclinic-admin-server&quot;
docker build --force-rm -t &quot;${IMAGE_TAG_API_GATEWAY}&quot; &quot;${WORKSPACE}/spring-petclinic-api-gateway&quot;
docker build --force-rm -t &quot;${IMAGE_TAG_CONFIG_SERVER}&quot; &quot;${WORKSPACE}/spring-petclinic-config-server&quot;
docker build --force-rm -t &quot;${IMAGE_TAG_CUSTOMERS_SERVICE}&quot; &quot;${WORKSPACE}/spring-petclinic-customers-service&quot;
docker build --force-rm -t &quot;${IMAGE_TAG_DISCOVERY_SERVER}&quot; &quot;${WORKSPACE}/spring-petclinic-discovery-server&quot;
docker build --force-rm -t &quot;${IMAGE_TAG_HYSTRIX_DASHBOARD}&quot; &quot;${WORKSPACE}/spring-petclinic-hystrix-dashboard&quot;
docker build --force-rm -t &quot;${IMAGE_TAG_VETS_SERVICE}&quot; &quot;${WORKSPACE}/spring-petclinic-vets-service&quot;
docker build --force-rm -t &quot;${IMAGE_TAG_VISITS_SERVICE}&quot; &quot;${WORKSPACE}/spring-petclinic-visits-service&quot;
docker build --force-rm -t &quot;${IMAGE_TAG_GRAFANA_SERVICE}&quot; &quot;${WORKSPACE}/docker/grafana&quot;
docker build --force-rm -t &quot;${IMAGE_TAG_PROMETHEUS_SERVICE}&quot; &quot;${WORKSPACE}/docker/prometheus&quot;"><pre>docker build --force-rm -t <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${IMAGE_TAG_ADMIN_SERVER}</span><span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${WORKSPACE}</span>/spring-petclinic-admin-server<span class="pl-pds">"</span></span>
docker build --force-rm -t <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${IMAGE_TAG_API_GATEWAY}</span><span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${WORKSPACE}</span>/spring-petclinic-api-gateway<span class="pl-pds">"</span></span>
docker build --force-rm -t <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${IMAGE_TAG_CONFIG_SERVER}</span><span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${WORKSPACE}</span>/spring-petclinic-config-server<span class="pl-pds">"</span></span>
docker build --force-rm -t <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${IMAGE_TAG_CUSTOMERS_SERVICE}</span><span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${WORKSPACE}</span>/spring-petclinic-customers-service<span class="pl-pds">"</span></span>
docker build --force-rm -t <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${IMAGE_TAG_DISCOVERY_SERVER}</span><span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${WORKSPACE}</span>/spring-petclinic-discovery-server<span class="pl-pds">"</span></span>
docker build --force-rm -t <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${IMAGE_TAG_HYSTRIX_DASHBOARD}</span><span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${WORKSPACE}</span>/spring-petclinic-hystrix-dashboard<span class="pl-pds">"</span></span>
docker build --force-rm -t <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${IMAGE_TAG_VETS_SERVICE}</span><span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${WORKSPACE}</span>/spring-petclinic-vets-service<span class="pl-pds">"</span></span>
docker build --force-rm -t <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${IMAGE_TAG_VISITS_SERVICE}</span><span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${WORKSPACE}</span>/spring-petclinic-visits-service<span class="pl-pds">"</span></span>
docker build --force-rm -t <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${IMAGE_TAG_GRAFANA_SERVICE}</span><span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${WORKSPACE}</span>/docker/grafana<span class="pl-pds">"</span></span>
docker build --force-rm -t <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${IMAGE_TAG_PROMETHEUS_SERVICE}</span><span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${WORKSPACE}</span>/docker/prometheus<span class="pl-pds">"</span></span></pre></div>
<ul dir="auto">
<li>Prepare a script to push the staging docker images to the ECR repo and name it as <code>push-staging-docker-images-to-ecr.sh</code> and save it under <code>jenkins</code> folder.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="aws ecr get-login-password --region ${AWS_REGION} | docker login --username AWS --password-stdin ${ECR_REGISTRY}
docker push &quot;${IMAGE_TAG_ADMIN_SERVER}&quot;
docker push &quot;${IMAGE_TAG_API_GATEWAY}&quot;
docker push &quot;${IMAGE_TAG_CONFIG_SERVER}&quot;
docker push &quot;${IMAGE_TAG_CUSTOMERS_SERVICE}&quot;
docker push &quot;${IMAGE_TAG_DISCOVERY_SERVER}&quot;
docker push &quot;${IMAGE_TAG_HYSTRIX_DASHBOARD}&quot;
docker push &quot;${IMAGE_TAG_VETS_SERVICE}&quot;
docker push &quot;${IMAGE_TAG_VISITS_SERVICE}&quot;
docker push &quot;${IMAGE_TAG_GRAFANA_SERVICE}&quot;
docker push &quot;${IMAGE_TAG_PROMETHEUS_SERVICE}&quot;"><pre>aws ecr get-login-password --region <span class="pl-smi">${AWS_REGION}</span> <span class="pl-k">|</span> docker login --username AWS --password-stdin <span class="pl-smi">${ECR_REGISTRY}</span>
docker push <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${IMAGE_TAG_ADMIN_SERVER}</span><span class="pl-pds">"</span></span>
docker push <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${IMAGE_TAG_API_GATEWAY}</span><span class="pl-pds">"</span></span>
docker push <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${IMAGE_TAG_CONFIG_SERVER}</span><span class="pl-pds">"</span></span>
docker push <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${IMAGE_TAG_CUSTOMERS_SERVICE}</span><span class="pl-pds">"</span></span>
docker push <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${IMAGE_TAG_DISCOVERY_SERVER}</span><span class="pl-pds">"</span></span>
docker push <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${IMAGE_TAG_HYSTRIX_DASHBOARD}</span><span class="pl-pds">"</span></span>
docker push <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${IMAGE_TAG_VETS_SERVICE}</span><span class="pl-pds">"</span></span>
docker push <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${IMAGE_TAG_VISITS_SERVICE}</span><span class="pl-pds">"</span></span>
docker push <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${IMAGE_TAG_GRAFANA_SERVICE}</span><span class="pl-pds">"</span></span>
docker push <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${IMAGE_TAG_PROMETHEUS_SERVICE}</span><span class="pl-pds">"</span></span></pre></div>
<ul dir="auto">
<li>Install <code>Rancher CLI</code> on Jenkins Server.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="curl -SsL &quot;https://github.com/rancher/cli/releases/download/v2.6.0/rancher-linux-amd64-v2.6.0.tar.gz&quot; -o &quot;rancher-cli.tar.gz&quot;
tar -zxvf rancher-cli.tar.gz
sudo mv ./rancher-v2.6.0/rancher /usr/local/bin/rancher
chmod +x /usr/local/bin/rancher
rancher --version"><pre>curl -SsL <span class="pl-s"><span class="pl-pds">"</span>https://github.com/rancher/cli/releases/download/v2.6.0/rancher-linux-amd64-v2.6.0.tar.gz<span class="pl-pds">"</span></span> -o <span class="pl-s"><span class="pl-pds">"</span>rancher-cli.tar.gz<span class="pl-pds">"</span></span>
tar -zxvf rancher-cli.tar.gz
sudo mv ./rancher-v2.6.0/rancher /usr/local/bin/rancher
chmod +x /usr/local/bin/rancher
rancher --version</pre></div>
<ul dir="auto">
<li>
<p dir="auto">Create Rancher API Key <a href="https://rancher.com/docs/rancher/v2.x/en/user-settings/api-keys/#creating-an-api-key" rel="nofollow">Rancher API Key</a> to enable access to the <code>Rancher</code> server. Take note, <code>Access Key (username)</code> and <code>Secret Key (password)</code>.</p>
</li>
<li>
<p dir="auto">Create a credentials with kind of <code>Username with password</code> on Jenkins Server using the <code>Rancher API Key</code>.</p>
<ul dir="auto">
<li>
<p dir="auto">On jenkins server, select Manage Jenkins --&gt; Manage Credentials --&gt; Jenkins --&gt;   Global credentials (unrestricted) --&gt; Add Credentials.</p>
</li>
<li>
<p dir="auto">Paste <code>Access Key (username)</code> to Username field and <code>Secret Key (password)</code> to Password field.</p>
</li>
<li>
<p dir="auto">Define an id like <code>rancher-petclinic-credentials</code>.</p>
</li>
</ul>
</li>
<li>
<p dir="auto">On some systems we need to install Helm S3 plugin as Jenkins user to be able to use S3 with pipeline script.</p>
</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="sudo su -s /bin/bash jenkins
export PATH=$PATH:/usr/local/bin
helm version
helm plugin install https://github.com/hypnoglow/helm-s3.git"><pre>sudo su -s /bin/bash jenkins
<span class="pl-k">export</span> PATH=<span class="pl-smi">$PATH</span>:/usr/local/bin
helm version
helm plugin install https://github.com/hypnoglow/helm-s3.git</pre></div>
<ul dir="auto">
<li>
<p dir="auto">Create a Staging Pipeline on Jenkins with name of <code>petclinic-staging</code> with following script and configure a <code>cron job</code> to trigger the pipeline every Sundays at midnight (<code>59 23 * * 0</code>) on <code>release</code> branch. <code>Petclinic staging pipeline</code> should be deployed on permanent staging-environment on <code>petclinic-cluster</code> Kubernetes cluster under <code>petclinic-staging-ns</code> namespace.</p>
</li>
<li>
<p dir="auto">Prepare a Jenkinsfile for <code>petclinic-staging</code> pipeline and save it as <code>jenkinsfile-petclinic-staging</code> under <code>jenkins</code> folder.</p>
</li>
</ul>
<div class="highlight highlight-source-groovy position-relative overflow-auto" data-snippet-clipboard-copy-content="pipeline {
    agent any
    environment {
        PATH=sh(script:&quot;echo $PATH:/usr/local/bin&quot;, returnStdout:true).trim()
        APP_NAME=&quot;petclinic&quot;
        APP_REPO_NAME=&quot;clarusway-repo/petclinic-app-staging&quot;
        AWS_ACCOUNT_ID=sh(script:'export PATH=&quot;$PATH:/usr/local/bin&quot; &amp;&amp; aws sts get-caller-identity --query Account --output text', returnStdout:true).trim()
        AWS_REGION=&quot;us-east-1&quot;
        ECR_REGISTRY=&quot;${AWS_ACCOUNT_ID}.dkr.ecr.${AWS_REGION}.amazonaws.com&quot;
        RANCHER_URL=&quot;https://rancher.clarusway.us&quot;
        // Get the project-id from Rancher UI (petclinic-cluster-staging namespace, View in API, copy projectId )
        RANCHER_CONTEXT=&quot;petclinic-cluster:project-id&quot; 
       //First part of projectID
        CLUSTERID=&quot;petclinic-cluster&quot;
        RANCHER_CREDS=credentials('rancher-petclinic-credentials')
    }
    stages {
        stage('Package Application') {
            steps {
                echo 'Packaging the app into jars with maven'
                sh &quot;. ./jenkins/package-with-maven-container.sh&quot;
            }
        }
        stage('Prepare Tags for Staging Docker Images') {
            steps {
                echo 'Preparing Tags for Staging Docker Images'
                script {
                    MVN_VERSION=sh(script:'. ${WORKSPACE}/spring-petclinic-admin-server/target/maven-archiver/pom.properties &amp;&amp; echo $version', returnStdout:true).trim()
                    env.IMAGE_TAG_ADMIN_SERVER=&quot;${ECR_REGISTRY}/${APP_REPO_NAME}:admin-server-staging-v${MVN_VERSION}-b${BUILD_NUMBER}&quot;
                    MVN_VERSION=sh(script:'. ${WORKSPACE}/spring-petclinic-api-gateway/target/maven-archiver/pom.properties &amp;&amp; echo $version', returnStdout:true).trim()
                    env.IMAGE_TAG_API_GATEWAY=&quot;${ECR_REGISTRY}/${APP_REPO_NAME}:api-gateway-staging-v${MVN_VERSION}-b${BUILD_NUMBER}&quot;
                    MVN_VERSION=sh(script:'. ${WORKSPACE}/spring-petclinic-config-server/target/maven-archiver/pom.properties &amp;&amp; echo $version', returnStdout:true).trim()
                    env.IMAGE_TAG_CONFIG_SERVER=&quot;${ECR_REGISTRY}/${APP_REPO_NAME}:config-server-staging-v${MVN_VERSION}-b${BUILD_NUMBER}&quot;
                    MVN_VERSION=sh(script:'. ${WORKSPACE}/spring-petclinic-customers-service/target/maven-archiver/pom.properties &amp;&amp; echo $version', returnStdout:true).trim()
                    env.IMAGE_TAG_CUSTOMERS_SERVICE=&quot;${ECR_REGISTRY}/${APP_REPO_NAME}:customers-service-staging-v${MVN_VERSION}-b${BUILD_NUMBER}&quot;
                    MVN_VERSION=sh(script:'. ${WORKSPACE}/spring-petclinic-discovery-server/target/maven-archiver/pom.properties &amp;&amp; echo $version', returnStdout:true).trim()
                    env.IMAGE_TAG_DISCOVERY_SERVER=&quot;${ECR_REGISTRY}/${APP_REPO_NAME}:discovery-server-staging-v${MVN_VERSION}-b${BUILD_NUMBER}&quot;
                    MVN_VERSION=sh(script:'. ${WORKSPACE}/spring-petclinic-hystrix-dashboard/target/maven-archiver/pom.properties &amp;&amp; echo $version', returnStdout:true).trim()
                    env.IMAGE_TAG_HYSTRIX_DASHBOARD=&quot;${ECR_REGISTRY}/${APP_REPO_NAME}:hystrix-dashboard-staging-v${MVN_VERSION}-b${BUILD_NUMBER}&quot;
                    MVN_VERSION=sh(script:'. ${WORKSPACE}/spring-petclinic-vets-service/target/maven-archiver/pom.properties &amp;&amp; echo $version', returnStdout:true).trim()
                    env.IMAGE_TAG_VETS_SERVICE=&quot;${ECR_REGISTRY}/${APP_REPO_NAME}:vets-service-staging-v${MVN_VERSION}-b${BUILD_NUMBER}&quot;
                    MVN_VERSION=sh(script:'. ${WORKSPACE}/spring-petclinic-visits-service/target/maven-archiver/pom.properties &amp;&amp; echo $version', returnStdout:true).trim()
                    env.IMAGE_TAG_VISITS_SERVICE=&quot;${ECR_REGISTRY}/${APP_REPO_NAME}:visits-service-staging-v${MVN_VERSION}-b${BUILD_NUMBER}&quot;
                    env.IMAGE_TAG_GRAFANA_SERVICE=&quot;${ECR_REGISTRY}/${APP_REPO_NAME}:grafana-service&quot;
                    env.IMAGE_TAG_PROMETHEUS_SERVICE=&quot;${ECR_REGISTRY}/${APP_REPO_NAME}:prometheus-service&quot;
                }
            }
        }
        stage('Build App Staging Docker Images') {
            steps {
                echo 'Building App Staging Images'
                sh &quot;. ./jenkins/build-staging-docker-images-for-ecr.sh&quot;
                sh 'docker image ls'
            }
        }
        stage('Push Images to ECR Repo') {
            steps {
                echo &quot;Pushing ${APP_NAME} App Images to ECR Repo&quot;
                sh &quot;. ./jenkins/push-staging-docker-images-to-ecr.sh&quot;
            }
        }
        stage('Deploy App on Petclinic Kubernetes Cluster'){
            steps {
                echo 'Deploying App on K8s Cluster'
                sh &quot;rancher login $RANCHER_URL --context $RANCHER_CONTEXT --token $RANCHER_CREDS_USR:$RANCHER_CREDS_PSW&quot;
                sh &quot;envsubst &lt; k8s/petclinic_chart/values-template.yaml &gt; k8s/petclinic_chart/values.yaml&quot;
                sh &quot;sed -i s/HELM_VERSION/${BUILD_NUMBER}/ k8s/petclinic_chart/Chart.yaml&quot;
                sh &quot;rancher kubectl delete secret regcred -n petclinic-staging-ns || true&quot;
                sh &quot;&quot;&quot;
                rancher kubectl create secret generic regcred -n petclinic-staging-ns \
                --from-file=.dockerconfigjson=$JENKINS_HOME/.docker/config.json \
                --type=kubernetes.io/dockerconfigjson
                &quot;&quot;&quot;
                sh &quot;rm -f k8s/config&quot;
                sh &quot;rancher cluster kf $CLUSTERID &gt; k8s/config&quot;
                sh &quot;chmod 400 k8s/config&quot;
                sh &quot;helm repo add stable-petclinic s3://petclinic-helm-charts/stable/myapp/&quot;
                sh &quot;helm package k8s/petclinic_chart&quot;
                sh &quot;helm s3 push petclinic_chart-${BUILD_NUMBER}.tgz stable-petclinic&quot;
                sh &quot;helm repo update&quot;
                sh &quot;AWS_REGION=$AWS_REGION helm upgrade --install petclinic-app-release stable-petclinic/petclinic_chart --version ${BUILD_NUMBER} --namespace petclinic-staging-ns --kubeconfig k8s/config&quot;
            }
        }
    }
    post {
        always {
            echo 'Deleting all local images'
            sh 'docker image prune -af'
        }
    }
}"><pre>pipeline {
    agent any
    environment {
        <span class="pl-c1">PATH</span><span class="pl-k">=</span>sh(<span class="pl-c1">script</span>:<span class="pl-s"><span class="pl-pds">"</span>echo <span class="pl-smi">$P<span class="pl-smi">ATH</span></span>:/usr/local/bin<span class="pl-pds">"</span></span>, <span class="pl-c1">returnStdout</span>:<span class="pl-c1">true</span>)<span class="pl-k">.</span>trim()
        <span class="pl-c1">APP_NAME</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>petclinic<span class="pl-pds">"</span></span>
        <span class="pl-c1">APP_REPO_NAME</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>clarusway-repo/petclinic-app-staging<span class="pl-pds">"</span></span>
        <span class="pl-c1">AWS_ACCOUNT_ID</span><span class="pl-k">=</span>sh(<span class="pl-c1">script</span>:<span class="pl-s"><span class="pl-pds">'</span>export PATH="$PATH:/usr/local/bin" &amp;&amp; aws sts get-caller-identity --query Account --output text<span class="pl-pds">'</span></span>, <span class="pl-c1">returnStdout</span>:<span class="pl-c1">true</span>)<span class="pl-k">.</span>trim()
        <span class="pl-c1">AWS_REGION</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>us-east-1<span class="pl-pds">"</span></span>
        <span class="pl-c1">ECR_REGISTRY</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span><span class="pl-s1"><span class="pl-pse">${</span>AWS_ACCOUNT_ID<span class="pl-pse">}</span></span>.dkr.ecr.<span class="pl-s1"><span class="pl-pse">${</span>AWS_REGION<span class="pl-pse">}</span></span>.amazonaws.com<span class="pl-pds">"</span></span>
        <span class="pl-c1">RANCHER_URL</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>https://rancher.clarusway.us<span class="pl-pds">"</span></span>
        <span class="pl-c"><span class="pl-c">//</span> Get the project-id from Rancher UI (petclinic-cluster-staging namespace, View in API, copy projectId )</span>
        <span class="pl-c1">RANCHER_CONTEXT</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>petclinic-cluster:project-id<span class="pl-pds">"</span></span> 
       <span class="pl-c"><span class="pl-c">//</span>First part of projectID</span>
        <span class="pl-c1">CLUSTERID</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>petclinic-cluster<span class="pl-pds">"</span></span>
        <span class="pl-c1">RANCHER_CREDS</span><span class="pl-k">=</span>credentials(<span class="pl-s"><span class="pl-pds">'</span>rancher-petclinic-credentials<span class="pl-pds">'</span></span>)
    }
    stages {
        stage(<span class="pl-s"><span class="pl-pds">'</span>Package Application<span class="pl-pds">'</span></span>) {
            steps {
                echo <span class="pl-s"><span class="pl-pds">'</span>Packaging the app into jars with maven<span class="pl-pds">'</span></span>
                sh <span class="pl-s"><span class="pl-pds">"</span>. ./jenkins/package-with-maven-container.sh<span class="pl-pds">"</span></span>
            }
        }
        stage(<span class="pl-s"><span class="pl-pds">'</span>Prepare Tags for Staging Docker Images<span class="pl-pds">'</span></span>) {
            steps {
                echo <span class="pl-s"><span class="pl-pds">'</span>Preparing Tags for Staging Docker Images<span class="pl-pds">'</span></span>
                script {
                    <span class="pl-c1">MVN_VERSION</span><span class="pl-k">=</span>sh(<span class="pl-c1">script</span>:<span class="pl-s"><span class="pl-pds">'</span>. ${WORKSPACE}/spring-petclinic-admin-server/target/maven-archiver/pom.properties &amp;&amp; echo $version<span class="pl-pds">'</span></span>, <span class="pl-c1">returnStdout</span>:<span class="pl-c1">true</span>)<span class="pl-k">.</span>trim()
                    env<span class="pl-k">.</span><span class="pl-c1">IMAGE_TAG_ADMIN_SERVER</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span><span class="pl-s1"><span class="pl-pse">${</span>ECR_REGISTRY<span class="pl-pse">}</span></span>/<span class="pl-s1"><span class="pl-pse">${</span>APP_REPO_NAME<span class="pl-pse">}</span></span>:admin-server-staging-v<span class="pl-s1"><span class="pl-pse">${</span>MVN_VERSION<span class="pl-pse">}</span></span>-b<span class="pl-s1"><span class="pl-pse">${</span>BUILD_NUMBER<span class="pl-pse">}</span></span><span class="pl-pds">"</span></span>
                    <span class="pl-c1">MVN_VERSION</span><span class="pl-k">=</span>sh(<span class="pl-c1">script</span>:<span class="pl-s"><span class="pl-pds">'</span>. ${WORKSPACE}/spring-petclinic-api-gateway/target/maven-archiver/pom.properties &amp;&amp; echo $version<span class="pl-pds">'</span></span>, <span class="pl-c1">returnStdout</span>:<span class="pl-c1">true</span>)<span class="pl-k">.</span>trim()
                    env<span class="pl-k">.</span><span class="pl-c1">IMAGE_TAG_API_GATEWAY</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span><span class="pl-s1"><span class="pl-pse">${</span>ECR_REGISTRY<span class="pl-pse">}</span></span>/<span class="pl-s1"><span class="pl-pse">${</span>APP_REPO_NAME<span class="pl-pse">}</span></span>:api-gateway-staging-v<span class="pl-s1"><span class="pl-pse">${</span>MVN_VERSION<span class="pl-pse">}</span></span>-b<span class="pl-s1"><span class="pl-pse">${</span>BUILD_NUMBER<span class="pl-pse">}</span></span><span class="pl-pds">"</span></span>
                    <span class="pl-c1">MVN_VERSION</span><span class="pl-k">=</span>sh(<span class="pl-c1">script</span>:<span class="pl-s"><span class="pl-pds">'</span>. ${WORKSPACE}/spring-petclinic-config-server/target/maven-archiver/pom.properties &amp;&amp; echo $version<span class="pl-pds">'</span></span>, <span class="pl-c1">returnStdout</span>:<span class="pl-c1">true</span>)<span class="pl-k">.</span>trim()
                    env<span class="pl-k">.</span><span class="pl-c1">IMAGE_TAG_CONFIG_SERVER</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span><span class="pl-s1"><span class="pl-pse">${</span>ECR_REGISTRY<span class="pl-pse">}</span></span>/<span class="pl-s1"><span class="pl-pse">${</span>APP_REPO_NAME<span class="pl-pse">}</span></span>:config-server-staging-v<span class="pl-s1"><span class="pl-pse">${</span>MVN_VERSION<span class="pl-pse">}</span></span>-b<span class="pl-s1"><span class="pl-pse">${</span>BUILD_NUMBER<span class="pl-pse">}</span></span><span class="pl-pds">"</span></span>
                    <span class="pl-c1">MVN_VERSION</span><span class="pl-k">=</span>sh(<span class="pl-c1">script</span>:<span class="pl-s"><span class="pl-pds">'</span>. ${WORKSPACE}/spring-petclinic-customers-service/target/maven-archiver/pom.properties &amp;&amp; echo $version<span class="pl-pds">'</span></span>, <span class="pl-c1">returnStdout</span>:<span class="pl-c1">true</span>)<span class="pl-k">.</span>trim()
                    env<span class="pl-k">.</span><span class="pl-c1">IMAGE_TAG_CUSTOMERS_SERVICE</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span><span class="pl-s1"><span class="pl-pse">${</span>ECR_REGISTRY<span class="pl-pse">}</span></span>/<span class="pl-s1"><span class="pl-pse">${</span>APP_REPO_NAME<span class="pl-pse">}</span></span>:customers-service-staging-v<span class="pl-s1"><span class="pl-pse">${</span>MVN_VERSION<span class="pl-pse">}</span></span>-b<span class="pl-s1"><span class="pl-pse">${</span>BUILD_NUMBER<span class="pl-pse">}</span></span><span class="pl-pds">"</span></span>
                    <span class="pl-c1">MVN_VERSION</span><span class="pl-k">=</span>sh(<span class="pl-c1">script</span>:<span class="pl-s"><span class="pl-pds">'</span>. ${WORKSPACE}/spring-petclinic-discovery-server/target/maven-archiver/pom.properties &amp;&amp; echo $version<span class="pl-pds">'</span></span>, <span class="pl-c1">returnStdout</span>:<span class="pl-c1">true</span>)<span class="pl-k">.</span>trim()
                    env<span class="pl-k">.</span><span class="pl-c1">IMAGE_TAG_DISCOVERY_SERVER</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span><span class="pl-s1"><span class="pl-pse">${</span>ECR_REGISTRY<span class="pl-pse">}</span></span>/<span class="pl-s1"><span class="pl-pse">${</span>APP_REPO_NAME<span class="pl-pse">}</span></span>:discovery-server-staging-v<span class="pl-s1"><span class="pl-pse">${</span>MVN_VERSION<span class="pl-pse">}</span></span>-b<span class="pl-s1"><span class="pl-pse">${</span>BUILD_NUMBER<span class="pl-pse">}</span></span><span class="pl-pds">"</span></span>
                    <span class="pl-c1">MVN_VERSION</span><span class="pl-k">=</span>sh(<span class="pl-c1">script</span>:<span class="pl-s"><span class="pl-pds">'</span>. ${WORKSPACE}/spring-petclinic-hystrix-dashboard/target/maven-archiver/pom.properties &amp;&amp; echo $version<span class="pl-pds">'</span></span>, <span class="pl-c1">returnStdout</span>:<span class="pl-c1">true</span>)<span class="pl-k">.</span>trim()
                    env<span class="pl-k">.</span><span class="pl-c1">IMAGE_TAG_HYSTRIX_DASHBOARD</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span><span class="pl-s1"><span class="pl-pse">${</span>ECR_REGISTRY<span class="pl-pse">}</span></span>/<span class="pl-s1"><span class="pl-pse">${</span>APP_REPO_NAME<span class="pl-pse">}</span></span>:hystrix-dashboard-staging-v<span class="pl-s1"><span class="pl-pse">${</span>MVN_VERSION<span class="pl-pse">}</span></span>-b<span class="pl-s1"><span class="pl-pse">${</span>BUILD_NUMBER<span class="pl-pse">}</span></span><span class="pl-pds">"</span></span>
                    <span class="pl-c1">MVN_VERSION</span><span class="pl-k">=</span>sh(<span class="pl-c1">script</span>:<span class="pl-s"><span class="pl-pds">'</span>. ${WORKSPACE}/spring-petclinic-vets-service/target/maven-archiver/pom.properties &amp;&amp; echo $version<span class="pl-pds">'</span></span>, <span class="pl-c1">returnStdout</span>:<span class="pl-c1">true</span>)<span class="pl-k">.</span>trim()
                    env<span class="pl-k">.</span><span class="pl-c1">IMAGE_TAG_VETS_SERVICE</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span><span class="pl-s1"><span class="pl-pse">${</span>ECR_REGISTRY<span class="pl-pse">}</span></span>/<span class="pl-s1"><span class="pl-pse">${</span>APP_REPO_NAME<span class="pl-pse">}</span></span>:vets-service-staging-v<span class="pl-s1"><span class="pl-pse">${</span>MVN_VERSION<span class="pl-pse">}</span></span>-b<span class="pl-s1"><span class="pl-pse">${</span>BUILD_NUMBER<span class="pl-pse">}</span></span><span class="pl-pds">"</span></span>
                    <span class="pl-c1">MVN_VERSION</span><span class="pl-k">=</span>sh(<span class="pl-c1">script</span>:<span class="pl-s"><span class="pl-pds">'</span>. ${WORKSPACE}/spring-petclinic-visits-service/target/maven-archiver/pom.properties &amp;&amp; echo $version<span class="pl-pds">'</span></span>, <span class="pl-c1">returnStdout</span>:<span class="pl-c1">true</span>)<span class="pl-k">.</span>trim()
                    env<span class="pl-k">.</span><span class="pl-c1">IMAGE_TAG_VISITS_SERVICE</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span><span class="pl-s1"><span class="pl-pse">${</span>ECR_REGISTRY<span class="pl-pse">}</span></span>/<span class="pl-s1"><span class="pl-pse">${</span>APP_REPO_NAME<span class="pl-pse">}</span></span>:visits-service-staging-v<span class="pl-s1"><span class="pl-pse">${</span>MVN_VERSION<span class="pl-pse">}</span></span>-b<span class="pl-s1"><span class="pl-pse">${</span>BUILD_NUMBER<span class="pl-pse">}</span></span><span class="pl-pds">"</span></span>
                    env<span class="pl-k">.</span><span class="pl-c1">IMAGE_TAG_GRAFANA_SERVICE</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span><span class="pl-s1"><span class="pl-pse">${</span>ECR_REGISTRY<span class="pl-pse">}</span></span>/<span class="pl-s1"><span class="pl-pse">${</span>APP_REPO_NAME<span class="pl-pse">}</span></span>:grafana-service<span class="pl-pds">"</span></span>
                    env<span class="pl-k">.</span><span class="pl-c1">IMAGE_TAG_PROMETHEUS_SERVICE</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span><span class="pl-s1"><span class="pl-pse">${</span>ECR_REGISTRY<span class="pl-pse">}</span></span>/<span class="pl-s1"><span class="pl-pse">${</span>APP_REPO_NAME<span class="pl-pse">}</span></span>:prometheus-service<span class="pl-pds">"</span></span>
                }
            }
        }
        stage(<span class="pl-s"><span class="pl-pds">'</span>Build App Staging Docker Images<span class="pl-pds">'</span></span>) {
            steps {
                echo <span class="pl-s"><span class="pl-pds">'</span>Building App Staging Images<span class="pl-pds">'</span></span>
                sh <span class="pl-s"><span class="pl-pds">"</span>. ./jenkins/build-staging-docker-images-for-ecr.sh<span class="pl-pds">"</span></span>
                sh <span class="pl-s"><span class="pl-pds">'</span>docker image ls<span class="pl-pds">'</span></span>
            }
        }
        stage(<span class="pl-s"><span class="pl-pds">'</span>Push Images to ECR Repo<span class="pl-pds">'</span></span>) {
            steps {
                echo <span class="pl-s"><span class="pl-pds">"</span>Pushing <span class="pl-s1"><span class="pl-pse">${</span>APP_NAME<span class="pl-pse">}</span></span> App Images to ECR Repo<span class="pl-pds">"</span></span>
                sh <span class="pl-s"><span class="pl-pds">"</span>. ./jenkins/push-staging-docker-images-to-ecr.sh<span class="pl-pds">"</span></span>
            }
        }
        stage(<span class="pl-s"><span class="pl-pds">'</span>Deploy App on Petclinic Kubernetes Cluster<span class="pl-pds">'</span></span>){
            steps {
                echo <span class="pl-s"><span class="pl-pds">'</span>Deploying App on K8s Cluster<span class="pl-pds">'</span></span>
                sh <span class="pl-s"><span class="pl-pds">"</span>rancher login <span class="pl-smi">$R<span class="pl-smi">ANCHER_URL</span></span> --context <span class="pl-smi">$R<span class="pl-smi">ANCHER_CONTEXT</span></span> --token <span class="pl-smi">$R<span class="pl-smi">ANCHER_CREDS_USR</span></span>:<span class="pl-smi">$R<span class="pl-smi">ANCHER_CREDS_PSW</span></span><span class="pl-pds">"</span></span>
                sh <span class="pl-s"><span class="pl-pds">"</span>envsubst &lt; k8s/petclinic_chart/values-template.yaml &gt; k8s/petclinic_chart/values.yaml<span class="pl-pds">"</span></span>
                sh <span class="pl-s"><span class="pl-pds">"</span>sed -i s/HELM_VERSION/<span class="pl-s1"><span class="pl-pse">${</span>BUILD_NUMBER<span class="pl-pse">}</span></span>/ k8s/petclinic_chart/Chart.yaml<span class="pl-pds">"</span></span>
                sh <span class="pl-s"><span class="pl-pds">"</span>rancher kubectl delete secret regcred -n petclinic-staging-ns || true<span class="pl-pds">"</span></span>
                sh <span class="pl-s"><span class="pl-pds">"""</span></span>
<span class="pl-s">                rancher kubectl create secret generic regcred -n petclinic-staging-ns \</span>
<span class="pl-s">                --from-file=.dockerconfigjson=<span class="pl-smi">$J<span class="pl-smi">ENKINS_HOME</span></span>/.docker/config.json \</span>
<span class="pl-s">                --type=kubernetes.io/dockerconfigjson</span>
<span class="pl-s">                <span class="pl-pds">"""</span></span>
                sh <span class="pl-s"><span class="pl-pds">"</span>rm -f k8s/config<span class="pl-pds">"</span></span>
                sh <span class="pl-s"><span class="pl-pds">"</span>rancher cluster kf <span class="pl-smi">$C<span class="pl-smi">LUSTERID</span></span> &gt; k8s/config<span class="pl-pds">"</span></span>
                sh <span class="pl-s"><span class="pl-pds">"</span>chmod 400 k8s/config<span class="pl-pds">"</span></span>
                sh <span class="pl-s"><span class="pl-pds">"</span>helm repo add stable-petclinic s3://petclinic-helm-charts/stable/myapp/<span class="pl-pds">"</span></span>
                sh <span class="pl-s"><span class="pl-pds">"</span>helm package k8s/petclinic_chart<span class="pl-pds">"</span></span>
                sh <span class="pl-s"><span class="pl-pds">"</span>helm s3 push petclinic_chart-<span class="pl-s1"><span class="pl-pse">${</span>BUILD_NUMBER<span class="pl-pse">}</span></span>.tgz stable-petclinic<span class="pl-pds">"</span></span>
                sh <span class="pl-s"><span class="pl-pds">"</span>helm repo update<span class="pl-pds">"</span></span>
                sh <span class="pl-s"><span class="pl-pds">"</span>AWS_REGION=<span class="pl-smi">$A<span class="pl-smi">WS_REGION</span></span> helm upgrade --install petclinic-app-release stable-petclinic/petclinic_chart --version <span class="pl-s1"><span class="pl-pse">${</span>BUILD_NUMBER<span class="pl-pse">}</span></span> --namespace petclinic-staging-ns --kubeconfig k8s/config<span class="pl-pds">"</span></span>
            }
        }
    }
    post {
        always {
            echo <span class="pl-s"><span class="pl-pds">'</span>Deleting all local images<span class="pl-pds">'</span></span>
            sh <span class="pl-s"><span class="pl-pds">'</span>docker image prune -af<span class="pl-pds">'</span></span>
        }
    }
}</pre></div>
<ul dir="auto">
<li>
<p dir="auto">Create an <code>A</code> record of <code>staging-petclinic.clarusway.us</code> in your hosted zone (in our case <code>clarusway.us</code>) using AWS Route 53 domain registrar and bind it to your <code>petclinic cluster</code>.</p>
</li>
<li>
<p dir="auto">Commit the change, then push the script to the remote repo.</p>
</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="git add .
git commit -m 'added jenkinsfile petclinic-staging for release branch'
git push --set-upstream origin feature/msp-26
git checkout release
git merge feature/msp-26
git push origin release"><pre>git add <span class="pl-c1">.</span>
git commit -m <span class="pl-s"><span class="pl-pds">'</span>added jenkinsfile petclinic-staging for release branch<span class="pl-pds">'</span></span>
git push --set-upstream origin feature/msp-26
git checkout release
git merge feature/msp-26
git push origin release</pre></div>
<h2 dir="auto"><a id="user-content-msp-27---prepare-a-production-pipeline" class="anchor" aria-hidden="true" href="#msp-27---prepare-a-production-pipeline"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>MSP 27 - Prepare a Production Pipeline</h2>
<ul dir="auto">
<li>Create <code>feature/msp-27</code> branch from <code>release</code>.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="git checkout release
git branch feature/msp-27
git checkout feature/msp-27"><pre>git checkout release
git branch feature/msp-27
git checkout feature/msp-27</pre></div>
<ul dir="auto">
<li>Create a Kubernetes cluster using Rancher with RKE and new nodes in AWS (on one EC2 instance only) and name it as <code>petclinic-cluster</code>.</li>
</ul>
<div class="snippet-clipboard-content position-relative overflow-auto" data-snippet-clipboard-copy-content="Cluster Type      : Amazon EC2
Name Prefix       : petclinic-k8s-instance
Count             : 3
etcd              : checked
Control Plane     : checked
Worker            : checked"><pre lang="text"><code>Cluster Type      : Amazon EC2
Name Prefix       : petclinic-k8s-instance
Count             : 3
etcd              : checked
Control Plane     : checked
Worker            : checked
</code></pre></div>
<ul dir="auto">
<li>
<p dir="auto">Create <code>petclinic-prod-ns</code> namespace on <code>petclinic-cluster</code> with Rancher.</p>
</li>
<li>
<p dir="auto">Create a Jenkins Job and name it as <code>create-ecr-docker-registry-for-petclinic-prod</code> to create Docker Registry for <code>Production</code> manually on AWS ECR.</p>
</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="PATH=&quot;$PATH:/usr/local/bin&quot;
APP_REPO_NAME=&quot;clarusway-repo/petclinic-app-prod&quot;
AWS_REGION=&quot;us-east-1&quot;

aws ecr create-repository \
  --repository-name ${APP_REPO_NAME} \
  --image-scanning-configuration scanOnPush=false \
  --image-tag-mutability MUTABLE \
  --region ${AWS_REGION}"><pre>PATH=<span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">$PATH</span>:/usr/local/bin<span class="pl-pds">"</span></span>
APP_REPO_NAME=<span class="pl-s"><span class="pl-pds">"</span>clarusway-repo/petclinic-app-prod<span class="pl-pds">"</span></span>
AWS_REGION=<span class="pl-s"><span class="pl-pds">"</span>us-east-1<span class="pl-pds">"</span></span>

aws ecr create-repository \
  --repository-name <span class="pl-smi">${APP_REPO_NAME}</span> \
  --image-scanning-configuration scanOnPush=false \
  --image-tag-mutability MUTABLE \
  --region <span class="pl-smi">${AWS_REGION}</span></pre></div>
<ul dir="auto">
<li>Prepare a script to create ECR tags for the production docker images and name it as <code>prepare-tags-ecr-for-prod-docker-images.sh</code> and save it under <code>jenkins</code> folder.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="MVN_VERSION=$(. ${WORKSPACE}/spring-petclinic-admin-server/target/maven-archiver/pom.properties &amp;&amp; echo $version)
export IMAGE_TAG_ADMIN_SERVER=&quot;${ECR_REGISTRY}/${APP_REPO_NAME}:admin-server-v${MVN_VERSION}-b${BUILD_NUMBER}&quot;
MVN_VERSION=$(. ${WORKSPACE}/spring-petclinic-api-gateway/target/maven-archiver/pom.properties &amp;&amp; echo $version)
export IMAGE_TAG_API_GATEWAY=&quot;${ECR_REGISTRY}/${APP_REPO_NAME}:api-gateway-v${MVN_VERSION}-b${BUILD_NUMBER}&quot;
MVN_VERSION=$(. ${WORKSPACE}/spring-petclinic-config-server/target/maven-archiver/pom.properties &amp;&amp; echo $version)
export IMAGE_TAG_CONFIG_SERVER=&quot;${ECR_REGISTRY}/${APP_REPO_NAME}:config-server-v${MVN_VERSION}-b${BUILD_NUMBER}&quot;
MVN_VERSION=$(. ${WORKSPACE}/spring-petclinic-customers-service/target/maven-archiver/pom.properties &amp;&amp; echo $version)
export IMAGE_TAG_CUSTOMERS_SERVICE=&quot;${ECR_REGISTRY}/${APP_REPO_NAME}:customers-service-v${MVN_VERSION}-b${BUILD_NUMBER}&quot;
MVN_VERSION=$(. ${WORKSPACE}/spring-petclinic-discovery-server/target/maven-archiver/pom.properties &amp;&amp; echo $version)
export IMAGE_TAG_DISCOVERY_SERVER=&quot;${ECR_REGISTRY}/${APP_REPO_NAME}:discovery-server-v${MVN_VERSION}-b${BUILD_NUMBER}&quot;
MVN_VERSION=$(. ${WORKSPACE}/spring-petclinic-hystrix-dashboard/target/maven-archiver/pom.properties &amp;&amp; echo $version)
export IMAGE_TAG_HYSTRIX_DASHBOARD=&quot;${ECR_REGISTRY}/${APP_REPO_NAME}:hystrix-dashboard-v${MVN_VERSION}-b${BUILD_NUMBER}&quot;
MVN_VERSION=$(. ${WORKSPACE}/spring-petclinic-vets-service/target/maven-archiver/pom.properties &amp;&amp; echo $version)
export IMAGE_TAG_VETS_SERVICE=&quot;${ECR_REGISTRY}/${APP_REPO_NAME}:vets-service-v${MVN_VERSION}-b${BUILD_NUMBER}&quot;
MVN_VERSION=$(. ${WORKSPACE}/spring-petclinic-visits-service/target/maven-archiver/pom.properties &amp;&amp; echo $version)
export IMAGE_TAG_VISITS_SERVICE=&quot;${ECR_REGISTRY}/${APP_REPO_NAME}:visits-service-v${MVN_VERSION}-b${BUILD_NUMBER}&quot;
export IMAGE_TAG_GRAFANA_SERVICE=&quot;${ECR_REGISTRY}/${APP_REPO_NAME}:grafana-service&quot;
export IMAGE_TAG_PROMETHEUS_SERVICE=&quot;${ECR_REGISTRY}/${APP_REPO_NAME}:prometheus-service&quot;"><pre>MVN_VERSION=<span class="pl-s"><span class="pl-pds">$(</span>. <span class="pl-smi">${WORKSPACE}</span>/spring-petclinic-admin-server/target/maven-archiver/pom.properties <span class="pl-k">&amp;&amp;</span> <span class="pl-c1">echo</span> <span class="pl-smi">$version</span><span class="pl-pds">)</span></span>
<span class="pl-k">export</span> IMAGE_TAG_ADMIN_SERVER=<span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${ECR_REGISTRY}</span>/<span class="pl-smi">${APP_REPO_NAME}</span>:admin-server-v<span class="pl-smi">${MVN_VERSION}</span>-b<span class="pl-smi">${BUILD_NUMBER}</span><span class="pl-pds">"</span></span>
MVN_VERSION=<span class="pl-s"><span class="pl-pds">$(</span>. <span class="pl-smi">${WORKSPACE}</span>/spring-petclinic-api-gateway/target/maven-archiver/pom.properties <span class="pl-k">&amp;&amp;</span> <span class="pl-c1">echo</span> <span class="pl-smi">$version</span><span class="pl-pds">)</span></span>
<span class="pl-k">export</span> IMAGE_TAG_API_GATEWAY=<span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${ECR_REGISTRY}</span>/<span class="pl-smi">${APP_REPO_NAME}</span>:api-gateway-v<span class="pl-smi">${MVN_VERSION}</span>-b<span class="pl-smi">${BUILD_NUMBER}</span><span class="pl-pds">"</span></span>
MVN_VERSION=<span class="pl-s"><span class="pl-pds">$(</span>. <span class="pl-smi">${WORKSPACE}</span>/spring-petclinic-config-server/target/maven-archiver/pom.properties <span class="pl-k">&amp;&amp;</span> <span class="pl-c1">echo</span> <span class="pl-smi">$version</span><span class="pl-pds">)</span></span>
<span class="pl-k">export</span> IMAGE_TAG_CONFIG_SERVER=<span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${ECR_REGISTRY}</span>/<span class="pl-smi">${APP_REPO_NAME}</span>:config-server-v<span class="pl-smi">${MVN_VERSION}</span>-b<span class="pl-smi">${BUILD_NUMBER}</span><span class="pl-pds">"</span></span>
MVN_VERSION=<span class="pl-s"><span class="pl-pds">$(</span>. <span class="pl-smi">${WORKSPACE}</span>/spring-petclinic-customers-service/target/maven-archiver/pom.properties <span class="pl-k">&amp;&amp;</span> <span class="pl-c1">echo</span> <span class="pl-smi">$version</span><span class="pl-pds">)</span></span>
<span class="pl-k">export</span> IMAGE_TAG_CUSTOMERS_SERVICE=<span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${ECR_REGISTRY}</span>/<span class="pl-smi">${APP_REPO_NAME}</span>:customers-service-v<span class="pl-smi">${MVN_VERSION}</span>-b<span class="pl-smi">${BUILD_NUMBER}</span><span class="pl-pds">"</span></span>
MVN_VERSION=<span class="pl-s"><span class="pl-pds">$(</span>. <span class="pl-smi">${WORKSPACE}</span>/spring-petclinic-discovery-server/target/maven-archiver/pom.properties <span class="pl-k">&amp;&amp;</span> <span class="pl-c1">echo</span> <span class="pl-smi">$version</span><span class="pl-pds">)</span></span>
<span class="pl-k">export</span> IMAGE_TAG_DISCOVERY_SERVER=<span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${ECR_REGISTRY}</span>/<span class="pl-smi">${APP_REPO_NAME}</span>:discovery-server-v<span class="pl-smi">${MVN_VERSION}</span>-b<span class="pl-smi">${BUILD_NUMBER}</span><span class="pl-pds">"</span></span>
MVN_VERSION=<span class="pl-s"><span class="pl-pds">$(</span>. <span class="pl-smi">${WORKSPACE}</span>/spring-petclinic-hystrix-dashboard/target/maven-archiver/pom.properties <span class="pl-k">&amp;&amp;</span> <span class="pl-c1">echo</span> <span class="pl-smi">$version</span><span class="pl-pds">)</span></span>
<span class="pl-k">export</span> IMAGE_TAG_HYSTRIX_DASHBOARD=<span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${ECR_REGISTRY}</span>/<span class="pl-smi">${APP_REPO_NAME}</span>:hystrix-dashboard-v<span class="pl-smi">${MVN_VERSION}</span>-b<span class="pl-smi">${BUILD_NUMBER}</span><span class="pl-pds">"</span></span>
MVN_VERSION=<span class="pl-s"><span class="pl-pds">$(</span>. <span class="pl-smi">${WORKSPACE}</span>/spring-petclinic-vets-service/target/maven-archiver/pom.properties <span class="pl-k">&amp;&amp;</span> <span class="pl-c1">echo</span> <span class="pl-smi">$version</span><span class="pl-pds">)</span></span>
<span class="pl-k">export</span> IMAGE_TAG_VETS_SERVICE=<span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${ECR_REGISTRY}</span>/<span class="pl-smi">${APP_REPO_NAME}</span>:vets-service-v<span class="pl-smi">${MVN_VERSION}</span>-b<span class="pl-smi">${BUILD_NUMBER}</span><span class="pl-pds">"</span></span>
MVN_VERSION=<span class="pl-s"><span class="pl-pds">$(</span>. <span class="pl-smi">${WORKSPACE}</span>/spring-petclinic-visits-service/target/maven-archiver/pom.properties <span class="pl-k">&amp;&amp;</span> <span class="pl-c1">echo</span> <span class="pl-smi">$version</span><span class="pl-pds">)</span></span>
<span class="pl-k">export</span> IMAGE_TAG_VISITS_SERVICE=<span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${ECR_REGISTRY}</span>/<span class="pl-smi">${APP_REPO_NAME}</span>:visits-service-v<span class="pl-smi">${MVN_VERSION}</span>-b<span class="pl-smi">${BUILD_NUMBER}</span><span class="pl-pds">"</span></span>
<span class="pl-k">export</span> IMAGE_TAG_GRAFANA_SERVICE=<span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${ECR_REGISTRY}</span>/<span class="pl-smi">${APP_REPO_NAME}</span>:grafana-service<span class="pl-pds">"</span></span>
<span class="pl-k">export</span> IMAGE_TAG_PROMETHEUS_SERVICE=<span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${ECR_REGISTRY}</span>/<span class="pl-smi">${APP_REPO_NAME}</span>:prometheus-service<span class="pl-pds">"</span></span></pre></div>
<ul dir="auto">
<li>Prepare a script to build the production docker images tagged for ECR registry and name it as <code>build-prod-docker-images-for-ecr.sh</code> and save it under <code>jenkins</code> folder.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="docker build --force-rm -t &quot;${IMAGE_TAG_ADMIN_SERVER}&quot; &quot;${WORKSPACE}/spring-petclinic-admin-server&quot;
docker build --force-rm -t &quot;${IMAGE_TAG_API_GATEWAY}&quot; &quot;${WORKSPACE}/spring-petclinic-api-gateway&quot;
docker build --force-rm -t &quot;${IMAGE_TAG_CONFIG_SERVER}&quot; &quot;${WORKSPACE}/spring-petclinic-config-server&quot;
docker build --force-rm -t &quot;${IMAGE_TAG_CUSTOMERS_SERVICE}&quot; &quot;${WORKSPACE}/spring-petclinic-customers-service&quot;
docker build --force-rm -t &quot;${IMAGE_TAG_DISCOVERY_SERVER}&quot; &quot;${WORKSPACE}/spring-petclinic-discovery-server&quot;
docker build --force-rm -t &quot;${IMAGE_TAG_HYSTRIX_DASHBOARD}&quot; &quot;${WORKSPACE}/spring-petclinic-hystrix-dashboard&quot;
docker build --force-rm -t &quot;${IMAGE_TAG_VETS_SERVICE}&quot; &quot;${WORKSPACE}/spring-petclinic-vets-service&quot;
docker build --force-rm -t &quot;${IMAGE_TAG_VISITS_SERVICE}&quot; &quot;${WORKSPACE}/spring-petclinic-visits-service&quot;
docker build --force-rm -t &quot;${IMAGE_TAG_GRAFANA_SERVICE}&quot; &quot;${WORKSPACE}/docker/grafana&quot;
docker build --force-rm -t &quot;${IMAGE_TAG_PROMETHEUS_SERVICE}&quot; &quot;${WORKSPACE}/docker/prometheus&quot;"><pre>docker build --force-rm -t <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${IMAGE_TAG_ADMIN_SERVER}</span><span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${WORKSPACE}</span>/spring-petclinic-admin-server<span class="pl-pds">"</span></span>
docker build --force-rm -t <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${IMAGE_TAG_API_GATEWAY}</span><span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${WORKSPACE}</span>/spring-petclinic-api-gateway<span class="pl-pds">"</span></span>
docker build --force-rm -t <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${IMAGE_TAG_CONFIG_SERVER}</span><span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${WORKSPACE}</span>/spring-petclinic-config-server<span class="pl-pds">"</span></span>
docker build --force-rm -t <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${IMAGE_TAG_CUSTOMERS_SERVICE}</span><span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${WORKSPACE}</span>/spring-petclinic-customers-service<span class="pl-pds">"</span></span>
docker build --force-rm -t <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${IMAGE_TAG_DISCOVERY_SERVER}</span><span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${WORKSPACE}</span>/spring-petclinic-discovery-server<span class="pl-pds">"</span></span>
docker build --force-rm -t <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${IMAGE_TAG_HYSTRIX_DASHBOARD}</span><span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${WORKSPACE}</span>/spring-petclinic-hystrix-dashboard<span class="pl-pds">"</span></span>
docker build --force-rm -t <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${IMAGE_TAG_VETS_SERVICE}</span><span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${WORKSPACE}</span>/spring-petclinic-vets-service<span class="pl-pds">"</span></span>
docker build --force-rm -t <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${IMAGE_TAG_VISITS_SERVICE}</span><span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${WORKSPACE}</span>/spring-petclinic-visits-service<span class="pl-pds">"</span></span>
docker build --force-rm -t <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${IMAGE_TAG_GRAFANA_SERVICE}</span><span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${WORKSPACE}</span>/docker/grafana<span class="pl-pds">"</span></span>
docker build --force-rm -t <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${IMAGE_TAG_PROMETHEUS_SERVICE}</span><span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${WORKSPACE}</span>/docker/prometheus<span class="pl-pds">"</span></span></pre></div>
<ul dir="auto">
<li>Prepare a script to push the production docker images to the ECR repo and name it as <code>push-prod-docker-images-to-ecr.sh</code> and save it under <code>jenkins</code> folder.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="aws ecr get-login-password --region ${AWS_REGION} | docker login --username AWS --password-stdin ${ECR_REGISTRY}
docker push &quot;${IMAGE_TAG_ADMIN_SERVER}&quot;
docker push &quot;${IMAGE_TAG_API_GATEWAY}&quot;
docker push &quot;${IMAGE_TAG_CONFIG_SERVER}&quot;
docker push &quot;${IMAGE_TAG_CUSTOMERS_SERVICE}&quot;
docker push &quot;${IMAGE_TAG_DISCOVERY_SERVER}&quot;
docker push &quot;${IMAGE_TAG_HYSTRIX_DASHBOARD}&quot;
docker push &quot;${IMAGE_TAG_VETS_SERVICE}&quot;
docker push &quot;${IMAGE_TAG_VISITS_SERVICE}&quot;
docker push &quot;${IMAGE_TAG_GRAFANA_SERVICE}&quot;
docker push &quot;${IMAGE_TAG_PROMETHEUS_SERVICE}&quot;"><pre>aws ecr get-login-password --region <span class="pl-smi">${AWS_REGION}</span> <span class="pl-k">|</span> docker login --username AWS --password-stdin <span class="pl-smi">${ECR_REGISTRY}</span>
docker push <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${IMAGE_TAG_ADMIN_SERVER}</span><span class="pl-pds">"</span></span>
docker push <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${IMAGE_TAG_API_GATEWAY}</span><span class="pl-pds">"</span></span>
docker push <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${IMAGE_TAG_CONFIG_SERVER}</span><span class="pl-pds">"</span></span>
docker push <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${IMAGE_TAG_CUSTOMERS_SERVICE}</span><span class="pl-pds">"</span></span>
docker push <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${IMAGE_TAG_DISCOVERY_SERVER}</span><span class="pl-pds">"</span></span>
docker push <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${IMAGE_TAG_HYSTRIX_DASHBOARD}</span><span class="pl-pds">"</span></span>
docker push <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${IMAGE_TAG_VETS_SERVICE}</span><span class="pl-pds">"</span></span>
docker push <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${IMAGE_TAG_VISITS_SERVICE}</span><span class="pl-pds">"</span></span>
docker push <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${IMAGE_TAG_GRAFANA_SERVICE}</span><span class="pl-pds">"</span></span>
docker push <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${IMAGE_TAG_PROMETHEUS_SERVICE}</span><span class="pl-pds">"</span></span></pre></div>
<ul dir="auto">
<li>
<p dir="auto">At this stage, we will use Amazon RDS instead of mysql pod and service. Create a mysql database on AWS RDS.</p>
<ul dir="auto">
<li>Engine options: MySQL</li>
<li>Version : 5.7.30</li>
<li>Templates: Free tier</li>
<li>DB instance identifier: petclinic</li>
<li>Master username: root</li>
<li>Master password: petclinic</li>
<li>Public access: Yes</li>
<li>Initial database name: petclinic</li>
</ul>
</li>
<li>
<p dir="auto">Delete mysql-server-deployment.yaml file from k8s/petclinic_chart/templates folder.</p>
</li>
<li>
<p dir="auto">Update k8s/petclinic_chart/templates/mysql-server-service.yaml as below.</p>
</li>
</ul>
<div class="highlight highlight-source-yaml position-relative overflow-auto" data-snippet-clipboard-copy-content="apiVersion: v1
kind: Service
metadata:
  annotations:
    kompose.cmd: kompose convert -f docker-compose-local-db.yml
    kompose.version: 1.26.1 (a9d05d509)
  labels:
    io.kompose.service: mysql-server
  name: mysql-server
spec:
  type: ExternalName
  externalName: petclinic.cbanmzptkrzf.us-east-1.rds.amazonaws.com # Change this line with the endpoint of your RDS."><pre><span class="pl-ent">apiVersion</span>: <span class="pl-c1">v1</span>
<span class="pl-ent">kind</span>: <span class="pl-s">Service</span>
<span class="pl-ent">metadata</span>:
  <span class="pl-ent">annotations</span>:
    <span class="pl-ent">kompose.cmd</span>: <span class="pl-s">kompose convert -f docker-compose-local-db.yml</span>
    <span class="pl-ent">kompose.version</span>: <span class="pl-s">1.26.1 (a9d05d509)</span>
  <span class="pl-ent">labels</span>:
    <span class="pl-ent">io.kompose.service</span>: <span class="pl-s">mysql-server</span>
  <span class="pl-ent">name</span>: <span class="pl-s">mysql-server</span>
<span class="pl-ent">spec</span>:
  <span class="pl-ent">type</span>: <span class="pl-s">ExternalName</span>
  <span class="pl-ent">externalName</span>: <span class="pl-s">petclinic.cbanmzptkrzf.us-east-1.rds.amazonaws.com </span><span class="pl-c"><span class="pl-c">#</span> Change this line with the endpoint of your RDS.</span></pre></div>
<ul dir="auto">
<li>
<p dir="auto">Create a <code>Production Pipeline</code> on Jenkins with name of <code>petclinic-prod</code> with following script and configure a <code>github-webhook</code> to trigger the pipeline every <code>commit</code> on <code>main</code> branch. <code>Petclinic production pipeline</code> should be deployed on permanent prod-environment on <code>petclinic-cluster</code> Kubernetes cluster under <code>petclinic-prod-ns</code> namespace.</p>
</li>
<li>
<p dir="auto">Prepare a Jenkinsfile for <code>petclinic-prod</code> pipeline and save it as <code>jenkinsfile-petclinic-prod</code> under <code>jenkins</code> folder.</p>
</li>
</ul>
<div class="highlight highlight-source-groovy position-relative overflow-auto" data-snippet-clipboard-copy-content="pipeline {
    agent any
    environment {
        PATH=sh(script:&quot;echo $PATH:/usr/local/bin&quot;, returnStdout:true).trim()
        APP_NAME=&quot;petclinic&quot;
        APP_REPO_NAME=&quot;clarusway-repo/petclinic-app-prod&quot;
        AWS_ACCOUNT_ID=sh(script:'export PATH=&quot;$PATH:/usr/local/bin&quot; &amp;&amp; aws sts get-caller-identity --query Account --output text', returnStdout:true).trim()
        AWS_REGION=&quot;us-east-1&quot;
        ECR_REGISTRY=&quot;${AWS_ACCOUNT_ID}.dkr.ecr.${AWS_REGION}.amazonaws.com&quot;
        RANCHER_URL=&quot;https://rancher.clarusway.us&quot;
        // Get the project-id from Rancher UI (petclinic-cluster-staging namespace, View in API, copy projectId )
        RANCHER_CONTEXT=&quot;petclinic-cluster:project-id&quot; 
       //First part of projectID
        CLUSTERID=&quot;petclinic-cluster&quot;
        RANCHER_CREDS=credentials('rancher-petclinic-credentials')
    }
    stages {
        stage('Package Application') {
            steps {
                echo 'Packaging the app into jars with maven'
                sh &quot;. ./jenkins/package-with-maven-container.sh&quot;
            }
        }
        stage('Prepare Tags for Production Docker Images') {
            steps {
                echo 'Preparing Tags for Production Docker Images'
                script {
                    MVN_VERSION=sh(script:'. ${WORKSPACE}/spring-petclinic-admin-server/target/maven-archiver/pom.properties &amp;&amp; echo $version', returnStdout:true).trim()
                    env.IMAGE_TAG_ADMIN_SERVER=&quot;${ECR_REGISTRY}/${APP_REPO_NAME}:admin-server-v${MVN_VERSION}-b${BUILD_NUMBER}&quot;
                    MVN_VERSION=sh(script:'. ${WORKSPACE}/spring-petclinic-api-gateway/target/maven-archiver/pom.properties &amp;&amp; echo $version', returnStdout:true).trim()
                    env.IMAGE_TAG_API_GATEWAY=&quot;${ECR_REGISTRY}/${APP_REPO_NAME}:api-gateway-v${MVN_VERSION}-b${BUILD_NUMBER}&quot;
                    MVN_VERSION=sh(script:'. ${WORKSPACE}/spring-petclinic-config-server/target/maven-archiver/pom.properties &amp;&amp; echo $version', returnStdout:true).trim()
                    env.IMAGE_TAG_CONFIG_SERVER=&quot;${ECR_REGISTRY}/${APP_REPO_NAME}:config-server-v${MVN_VERSION}-b${BUILD_NUMBER}&quot;
                    MVN_VERSION=sh(script:'. ${WORKSPACE}/spring-petclinic-customers-service/target/maven-archiver/pom.properties &amp;&amp; echo $version', returnStdout:true).trim()
                    env.IMAGE_TAG_CUSTOMERS_SERVICE=&quot;${ECR_REGISTRY}/${APP_REPO_NAME}:customers-service-v${MVN_VERSION}-b${BUILD_NUMBER}&quot;
                    MVN_VERSION=sh(script:'. ${WORKSPACE}/spring-petclinic-discovery-server/target/maven-archiver/pom.properties &amp;&amp; echo $version', returnStdout:true).trim()
                    env.IMAGE_TAG_DISCOVERY_SERVER=&quot;${ECR_REGISTRY}/${APP_REPO_NAME}:discovery-server-v${MVN_VERSION}-b${BUILD_NUMBER}&quot;
                    MVN_VERSION=sh(script:'. ${WORKSPACE}/spring-petclinic-hystrix-dashboard/target/maven-archiver/pom.properties &amp;&amp; echo $version', returnStdout:true).trim()
                    env.IMAGE_TAG_HYSTRIX_DASHBOARD=&quot;${ECR_REGISTRY}/${APP_REPO_NAME}:hystrix-dashboard-v${MVN_VERSION}-b${BUILD_NUMBER}&quot;
                    MVN_VERSION=sh(script:'. ${WORKSPACE}/spring-petclinic-vets-service/target/maven-archiver/pom.properties &amp;&amp; echo $version', returnStdout:true).trim()
                    env.IMAGE_TAG_VETS_SERVICE=&quot;${ECR_REGISTRY}/${APP_REPO_NAME}:vets-service-v${MVN_VERSION}-b${BUILD_NUMBER}&quot;
                    MVN_VERSION=sh(script:'. ${WORKSPACE}/spring-petclinic-visits-service/target/maven-archiver/pom.properties &amp;&amp; echo $version', returnStdout:true).trim()
                    env.IMAGE_TAG_VISITS_SERVICE=&quot;${ECR_REGISTRY}/${APP_REPO_NAME}:visits-service-v${MVN_VERSION}-b${BUILD_NUMBER}&quot;
                    env.IMAGE_TAG_GRAFANA_SERVICE=&quot;${ECR_REGISTRY}/${APP_REPO_NAME}:grafana-service&quot;
                    env.IMAGE_TAG_PROMETHEUS_SERVICE=&quot;${ECR_REGISTRY}/${APP_REPO_NAME}:prometheus-service&quot;
                }
            }
        }
        stage('Build App Production Docker Images') {
            steps {
                echo 'Building App Production Images'
                sh &quot;. ./jenkins/build-prod-docker-images-for-ecr.sh&quot;
                sh 'docker image ls'
            }
        }
        stage('Push Images to ECR Repo') {
            steps {
                echo &quot;Pushing ${APP_NAME} App Images to ECR Repo&quot;
                sh &quot;. ./jenkins/push-prod-docker-images-to-ecr.sh&quot;
            }
        }
        stage('Deploy App on Petclinic Kubernetes Cluster'){
            steps {
                echo 'Deploying App on K8s Cluster'
                sh &quot;rancher login $RANCHER_URL --context $RANCHER_CONTEXT --token $RANCHER_CREDS_USR:$RANCHER_CREDS_PSW&quot;
                sh &quot;envsubst &lt; k8s/petclinic_chart/values-template.yaml &gt; k8s/petclinic_chart/values.yaml&quot;
                sh &quot;sed -i s/HELM_VERSION/${BUILD_NUMBER}/ k8s/petclinic_chart/Chart.yaml&quot;
                sh &quot;rancher kubectl delete secret regcred -n petclinic-prod-ns || true&quot;
                sh &quot;&quot;&quot;
                rancher kubectl create secret generic regcred -n petclinic-prod-ns \
                --from-file=.dockerconfigjson=$JENKINS_HOME/.docker/config.json \
                --type=kubernetes.io/dockerconfigjson
                &quot;&quot;&quot;
                sh &quot;rm -f k8s/config&quot;
                sh &quot;rancher cluster kf $CLUSTERID &gt; k8s/config&quot;
                sh &quot;chmod 400 k8s/config&quot;
                sh &quot;helm repo add stable-petclinic s3://petclinic-helm-charts/stable/myapp/&quot;
                sh &quot;helm package k8s/petclinic_chart&quot;
                sh &quot;helm s3 push petclinic_chart-${BUILD_NUMBER}.tgz stable-petclinic&quot;
                sh &quot;helm repo update&quot;
                sh &quot;AWS_REGION=$AWS_REGION helm upgrade --install petclinic-app-release stable-petclinic/petclinic_chart --version ${BUILD_NUMBER} --namespace petclinic-prod-ns --kubeconfig k8s/config&quot;
            }
        }
    }
    post {
        always {
            echo 'Deleting all local images'
            sh 'docker image prune -af'
        }
    }
}"><pre>pipeline {
    agent any
    environment {
        <span class="pl-c1">PATH</span><span class="pl-k">=</span>sh(<span class="pl-c1">script</span>:<span class="pl-s"><span class="pl-pds">"</span>echo <span class="pl-smi">$P<span class="pl-smi">ATH</span></span>:/usr/local/bin<span class="pl-pds">"</span></span>, <span class="pl-c1">returnStdout</span>:<span class="pl-c1">true</span>)<span class="pl-k">.</span>trim()
        <span class="pl-c1">APP_NAME</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>petclinic<span class="pl-pds">"</span></span>
        <span class="pl-c1">APP_REPO_NAME</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>clarusway-repo/petclinic-app-prod<span class="pl-pds">"</span></span>
        <span class="pl-c1">AWS_ACCOUNT_ID</span><span class="pl-k">=</span>sh(<span class="pl-c1">script</span>:<span class="pl-s"><span class="pl-pds">'</span>export PATH="$PATH:/usr/local/bin" &amp;&amp; aws sts get-caller-identity --query Account --output text<span class="pl-pds">'</span></span>, <span class="pl-c1">returnStdout</span>:<span class="pl-c1">true</span>)<span class="pl-k">.</span>trim()
        <span class="pl-c1">AWS_REGION</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>us-east-1<span class="pl-pds">"</span></span>
        <span class="pl-c1">ECR_REGISTRY</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span><span class="pl-s1"><span class="pl-pse">${</span>AWS_ACCOUNT_ID<span class="pl-pse">}</span></span>.dkr.ecr.<span class="pl-s1"><span class="pl-pse">${</span>AWS_REGION<span class="pl-pse">}</span></span>.amazonaws.com<span class="pl-pds">"</span></span>
        <span class="pl-c1">RANCHER_URL</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>https://rancher.clarusway.us<span class="pl-pds">"</span></span>
        <span class="pl-c"><span class="pl-c">//</span> Get the project-id from Rancher UI (petclinic-cluster-staging namespace, View in API, copy projectId )</span>
        <span class="pl-c1">RANCHER_CONTEXT</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>petclinic-cluster:project-id<span class="pl-pds">"</span></span> 
       <span class="pl-c"><span class="pl-c">//</span>First part of projectID</span>
        <span class="pl-c1">CLUSTERID</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>petclinic-cluster<span class="pl-pds">"</span></span>
        <span class="pl-c1">RANCHER_CREDS</span><span class="pl-k">=</span>credentials(<span class="pl-s"><span class="pl-pds">'</span>rancher-petclinic-credentials<span class="pl-pds">'</span></span>)
    }
    stages {
        stage(<span class="pl-s"><span class="pl-pds">'</span>Package Application<span class="pl-pds">'</span></span>) {
            steps {
                echo <span class="pl-s"><span class="pl-pds">'</span>Packaging the app into jars with maven<span class="pl-pds">'</span></span>
                sh <span class="pl-s"><span class="pl-pds">"</span>. ./jenkins/package-with-maven-container.sh<span class="pl-pds">"</span></span>
            }
        }
        stage(<span class="pl-s"><span class="pl-pds">'</span>Prepare Tags for Production Docker Images<span class="pl-pds">'</span></span>) {
            steps {
                echo <span class="pl-s"><span class="pl-pds">'</span>Preparing Tags for Production Docker Images<span class="pl-pds">'</span></span>
                script {
                    <span class="pl-c1">MVN_VERSION</span><span class="pl-k">=</span>sh(<span class="pl-c1">script</span>:<span class="pl-s"><span class="pl-pds">'</span>. ${WORKSPACE}/spring-petclinic-admin-server/target/maven-archiver/pom.properties &amp;&amp; echo $version<span class="pl-pds">'</span></span>, <span class="pl-c1">returnStdout</span>:<span class="pl-c1">true</span>)<span class="pl-k">.</span>trim()
                    env<span class="pl-k">.</span><span class="pl-c1">IMAGE_TAG_ADMIN_SERVER</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span><span class="pl-s1"><span class="pl-pse">${</span>ECR_REGISTRY<span class="pl-pse">}</span></span>/<span class="pl-s1"><span class="pl-pse">${</span>APP_REPO_NAME<span class="pl-pse">}</span></span>:admin-server-v<span class="pl-s1"><span class="pl-pse">${</span>MVN_VERSION<span class="pl-pse">}</span></span>-b<span class="pl-s1"><span class="pl-pse">${</span>BUILD_NUMBER<span class="pl-pse">}</span></span><span class="pl-pds">"</span></span>
                    <span class="pl-c1">MVN_VERSION</span><span class="pl-k">=</span>sh(<span class="pl-c1">script</span>:<span class="pl-s"><span class="pl-pds">'</span>. ${WORKSPACE}/spring-petclinic-api-gateway/target/maven-archiver/pom.properties &amp;&amp; echo $version<span class="pl-pds">'</span></span>, <span class="pl-c1">returnStdout</span>:<span class="pl-c1">true</span>)<span class="pl-k">.</span>trim()
                    env<span class="pl-k">.</span><span class="pl-c1">IMAGE_TAG_API_GATEWAY</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span><span class="pl-s1"><span class="pl-pse">${</span>ECR_REGISTRY<span class="pl-pse">}</span></span>/<span class="pl-s1"><span class="pl-pse">${</span>APP_REPO_NAME<span class="pl-pse">}</span></span>:api-gateway-v<span class="pl-s1"><span class="pl-pse">${</span>MVN_VERSION<span class="pl-pse">}</span></span>-b<span class="pl-s1"><span class="pl-pse">${</span>BUILD_NUMBER<span class="pl-pse">}</span></span><span class="pl-pds">"</span></span>
                    <span class="pl-c1">MVN_VERSION</span><span class="pl-k">=</span>sh(<span class="pl-c1">script</span>:<span class="pl-s"><span class="pl-pds">'</span>. ${WORKSPACE}/spring-petclinic-config-server/target/maven-archiver/pom.properties &amp;&amp; echo $version<span class="pl-pds">'</span></span>, <span class="pl-c1">returnStdout</span>:<span class="pl-c1">true</span>)<span class="pl-k">.</span>trim()
                    env<span class="pl-k">.</span><span class="pl-c1">IMAGE_TAG_CONFIG_SERVER</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span><span class="pl-s1"><span class="pl-pse">${</span>ECR_REGISTRY<span class="pl-pse">}</span></span>/<span class="pl-s1"><span class="pl-pse">${</span>APP_REPO_NAME<span class="pl-pse">}</span></span>:config-server-v<span class="pl-s1"><span class="pl-pse">${</span>MVN_VERSION<span class="pl-pse">}</span></span>-b<span class="pl-s1"><span class="pl-pse">${</span>BUILD_NUMBER<span class="pl-pse">}</span></span><span class="pl-pds">"</span></span>
                    <span class="pl-c1">MVN_VERSION</span><span class="pl-k">=</span>sh(<span class="pl-c1">script</span>:<span class="pl-s"><span class="pl-pds">'</span>. ${WORKSPACE}/spring-petclinic-customers-service/target/maven-archiver/pom.properties &amp;&amp; echo $version<span class="pl-pds">'</span></span>, <span class="pl-c1">returnStdout</span>:<span class="pl-c1">true</span>)<span class="pl-k">.</span>trim()
                    env<span class="pl-k">.</span><span class="pl-c1">IMAGE_TAG_CUSTOMERS_SERVICE</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span><span class="pl-s1"><span class="pl-pse">${</span>ECR_REGISTRY<span class="pl-pse">}</span></span>/<span class="pl-s1"><span class="pl-pse">${</span>APP_REPO_NAME<span class="pl-pse">}</span></span>:customers-service-v<span class="pl-s1"><span class="pl-pse">${</span>MVN_VERSION<span class="pl-pse">}</span></span>-b<span class="pl-s1"><span class="pl-pse">${</span>BUILD_NUMBER<span class="pl-pse">}</span></span><span class="pl-pds">"</span></span>
                    <span class="pl-c1">MVN_VERSION</span><span class="pl-k">=</span>sh(<span class="pl-c1">script</span>:<span class="pl-s"><span class="pl-pds">'</span>. ${WORKSPACE}/spring-petclinic-discovery-server/target/maven-archiver/pom.properties &amp;&amp; echo $version<span class="pl-pds">'</span></span>, <span class="pl-c1">returnStdout</span>:<span class="pl-c1">true</span>)<span class="pl-k">.</span>trim()
                    env<span class="pl-k">.</span><span class="pl-c1">IMAGE_TAG_DISCOVERY_SERVER</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span><span class="pl-s1"><span class="pl-pse">${</span>ECR_REGISTRY<span class="pl-pse">}</span></span>/<span class="pl-s1"><span class="pl-pse">${</span>APP_REPO_NAME<span class="pl-pse">}</span></span>:discovery-server-v<span class="pl-s1"><span class="pl-pse">${</span>MVN_VERSION<span class="pl-pse">}</span></span>-b<span class="pl-s1"><span class="pl-pse">${</span>BUILD_NUMBER<span class="pl-pse">}</span></span><span class="pl-pds">"</span></span>
                    <span class="pl-c1">MVN_VERSION</span><span class="pl-k">=</span>sh(<span class="pl-c1">script</span>:<span class="pl-s"><span class="pl-pds">'</span>. ${WORKSPACE}/spring-petclinic-hystrix-dashboard/target/maven-archiver/pom.properties &amp;&amp; echo $version<span class="pl-pds">'</span></span>, <span class="pl-c1">returnStdout</span>:<span class="pl-c1">true</span>)<span class="pl-k">.</span>trim()
                    env<span class="pl-k">.</span><span class="pl-c1">IMAGE_TAG_HYSTRIX_DASHBOARD</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span><span class="pl-s1"><span class="pl-pse">${</span>ECR_REGISTRY<span class="pl-pse">}</span></span>/<span class="pl-s1"><span class="pl-pse">${</span>APP_REPO_NAME<span class="pl-pse">}</span></span>:hystrix-dashboard-v<span class="pl-s1"><span class="pl-pse">${</span>MVN_VERSION<span class="pl-pse">}</span></span>-b<span class="pl-s1"><span class="pl-pse">${</span>BUILD_NUMBER<span class="pl-pse">}</span></span><span class="pl-pds">"</span></span>
                    <span class="pl-c1">MVN_VERSION</span><span class="pl-k">=</span>sh(<span class="pl-c1">script</span>:<span class="pl-s"><span class="pl-pds">'</span>. ${WORKSPACE}/spring-petclinic-vets-service/target/maven-archiver/pom.properties &amp;&amp; echo $version<span class="pl-pds">'</span></span>, <span class="pl-c1">returnStdout</span>:<span class="pl-c1">true</span>)<span class="pl-k">.</span>trim()
                    env<span class="pl-k">.</span><span class="pl-c1">IMAGE_TAG_VETS_SERVICE</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span><span class="pl-s1"><span class="pl-pse">${</span>ECR_REGISTRY<span class="pl-pse">}</span></span>/<span class="pl-s1"><span class="pl-pse">${</span>APP_REPO_NAME<span class="pl-pse">}</span></span>:vets-service-v<span class="pl-s1"><span class="pl-pse">${</span>MVN_VERSION<span class="pl-pse">}</span></span>-b<span class="pl-s1"><span class="pl-pse">${</span>BUILD_NUMBER<span class="pl-pse">}</span></span><span class="pl-pds">"</span></span>
                    <span class="pl-c1">MVN_VERSION</span><span class="pl-k">=</span>sh(<span class="pl-c1">script</span>:<span class="pl-s"><span class="pl-pds">'</span>. ${WORKSPACE}/spring-petclinic-visits-service/target/maven-archiver/pom.properties &amp;&amp; echo $version<span class="pl-pds">'</span></span>, <span class="pl-c1">returnStdout</span>:<span class="pl-c1">true</span>)<span class="pl-k">.</span>trim()
                    env<span class="pl-k">.</span><span class="pl-c1">IMAGE_TAG_VISITS_SERVICE</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span><span class="pl-s1"><span class="pl-pse">${</span>ECR_REGISTRY<span class="pl-pse">}</span></span>/<span class="pl-s1"><span class="pl-pse">${</span>APP_REPO_NAME<span class="pl-pse">}</span></span>:visits-service-v<span class="pl-s1"><span class="pl-pse">${</span>MVN_VERSION<span class="pl-pse">}</span></span>-b<span class="pl-s1"><span class="pl-pse">${</span>BUILD_NUMBER<span class="pl-pse">}</span></span><span class="pl-pds">"</span></span>
                    env<span class="pl-k">.</span><span class="pl-c1">IMAGE_TAG_GRAFANA_SERVICE</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span><span class="pl-s1"><span class="pl-pse">${</span>ECR_REGISTRY<span class="pl-pse">}</span></span>/<span class="pl-s1"><span class="pl-pse">${</span>APP_REPO_NAME<span class="pl-pse">}</span></span>:grafana-service<span class="pl-pds">"</span></span>
                    env<span class="pl-k">.</span><span class="pl-c1">IMAGE_TAG_PROMETHEUS_SERVICE</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span><span class="pl-s1"><span class="pl-pse">${</span>ECR_REGISTRY<span class="pl-pse">}</span></span>/<span class="pl-s1"><span class="pl-pse">${</span>APP_REPO_NAME<span class="pl-pse">}</span></span>:prometheus-service<span class="pl-pds">"</span></span>
                }
            }
        }
        stage(<span class="pl-s"><span class="pl-pds">'</span>Build App Production Docker Images<span class="pl-pds">'</span></span>) {
            steps {
                echo <span class="pl-s"><span class="pl-pds">'</span>Building App Production Images<span class="pl-pds">'</span></span>
                sh <span class="pl-s"><span class="pl-pds">"</span>. ./jenkins/build-prod-docker-images-for-ecr.sh<span class="pl-pds">"</span></span>
                sh <span class="pl-s"><span class="pl-pds">'</span>docker image ls<span class="pl-pds">'</span></span>
            }
        }
        stage(<span class="pl-s"><span class="pl-pds">'</span>Push Images to ECR Repo<span class="pl-pds">'</span></span>) {
            steps {
                echo <span class="pl-s"><span class="pl-pds">"</span>Pushing <span class="pl-s1"><span class="pl-pse">${</span>APP_NAME<span class="pl-pse">}</span></span> App Images to ECR Repo<span class="pl-pds">"</span></span>
                sh <span class="pl-s"><span class="pl-pds">"</span>. ./jenkins/push-prod-docker-images-to-ecr.sh<span class="pl-pds">"</span></span>
            }
        }
        stage(<span class="pl-s"><span class="pl-pds">'</span>Deploy App on Petclinic Kubernetes Cluster<span class="pl-pds">'</span></span>){
            steps {
                echo <span class="pl-s"><span class="pl-pds">'</span>Deploying App on K8s Cluster<span class="pl-pds">'</span></span>
                sh <span class="pl-s"><span class="pl-pds">"</span>rancher login <span class="pl-smi">$R<span class="pl-smi">ANCHER_URL</span></span> --context <span class="pl-smi">$R<span class="pl-smi">ANCHER_CONTEXT</span></span> --token <span class="pl-smi">$R<span class="pl-smi">ANCHER_CREDS_USR</span></span>:<span class="pl-smi">$R<span class="pl-smi">ANCHER_CREDS_PSW</span></span><span class="pl-pds">"</span></span>
                sh <span class="pl-s"><span class="pl-pds">"</span>envsubst &lt; k8s/petclinic_chart/values-template.yaml &gt; k8s/petclinic_chart/values.yaml<span class="pl-pds">"</span></span>
                sh <span class="pl-s"><span class="pl-pds">"</span>sed -i s/HELM_VERSION/<span class="pl-s1"><span class="pl-pse">${</span>BUILD_NUMBER<span class="pl-pse">}</span></span>/ k8s/petclinic_chart/Chart.yaml<span class="pl-pds">"</span></span>
                sh <span class="pl-s"><span class="pl-pds">"</span>rancher kubectl delete secret regcred -n petclinic-prod-ns || true<span class="pl-pds">"</span></span>
                sh <span class="pl-s"><span class="pl-pds">"""</span></span>
<span class="pl-s">                rancher kubectl create secret generic regcred -n petclinic-prod-ns \</span>
<span class="pl-s">                --from-file=.dockerconfigjson=<span class="pl-smi">$J<span class="pl-smi">ENKINS_HOME</span></span>/.docker/config.json \</span>
<span class="pl-s">                --type=kubernetes.io/dockerconfigjson</span>
<span class="pl-s">                <span class="pl-pds">"""</span></span>
                sh <span class="pl-s"><span class="pl-pds">"</span>rm -f k8s/config<span class="pl-pds">"</span></span>
                sh <span class="pl-s"><span class="pl-pds">"</span>rancher cluster kf <span class="pl-smi">$C<span class="pl-smi">LUSTERID</span></span> &gt; k8s/config<span class="pl-pds">"</span></span>
                sh <span class="pl-s"><span class="pl-pds">"</span>chmod 400 k8s/config<span class="pl-pds">"</span></span>
                sh <span class="pl-s"><span class="pl-pds">"</span>helm repo add stable-petclinic s3://petclinic-helm-charts/stable/myapp/<span class="pl-pds">"</span></span>
                sh <span class="pl-s"><span class="pl-pds">"</span>helm package k8s/petclinic_chart<span class="pl-pds">"</span></span>
                sh <span class="pl-s"><span class="pl-pds">"</span>helm s3 push petclinic_chart-<span class="pl-s1"><span class="pl-pse">${</span>BUILD_NUMBER<span class="pl-pse">}</span></span>.tgz stable-petclinic<span class="pl-pds">"</span></span>
                sh <span class="pl-s"><span class="pl-pds">"</span>helm repo update<span class="pl-pds">"</span></span>
                sh <span class="pl-s"><span class="pl-pds">"</span>AWS_REGION=<span class="pl-smi">$A<span class="pl-smi">WS_REGION</span></span> helm upgrade --install petclinic-app-release stable-petclinic/petclinic_chart --version <span class="pl-s1"><span class="pl-pse">${</span>BUILD_NUMBER<span class="pl-pse">}</span></span> --namespace petclinic-prod-ns --kubeconfig k8s/config<span class="pl-pds">"</span></span>
            }
        }
    }
    post {
        always {
            echo <span class="pl-s"><span class="pl-pds">'</span>Deleting all local images<span class="pl-pds">'</span></span>
            sh <span class="pl-s"><span class="pl-pds">'</span>docker image prune -af<span class="pl-pds">'</span></span>
        }
    }
}</pre></div>
<ul dir="auto">
<li>Commit the change, then push the script to the remote repo.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="git add .
git commit -m 'added jenkinsfile petclinic-production for main branch'
git push --set-upstream origin feature/msp-27
git checkout release
git merge feature/msp-27
git push origin release"><pre>git add <span class="pl-c1">.</span>
git commit -m <span class="pl-s"><span class="pl-pds">'</span>added jenkinsfile petclinic-production for main branch<span class="pl-pds">'</span></span>
git push --set-upstream origin feature/msp-27
git checkout release
git merge feature/msp-27
git push origin release</pre></div>
<ul dir="auto">
<li>Merge <code>release</code> into <code>main</code> branch to build and deploy the app on <code>Production environment</code> with pipeline.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="git checkout main
git merge release
git push origin main"><pre>git checkout main
git merge release
git push origin main</pre></div>
<h2 dir="auto"><a id="user-content-msp-28---setting-domain-name-and-tls-for-production-pipeline-with-route-53" class="anchor" aria-hidden="true" href="#msp-28---setting-domain-name-and-tls-for-production-pipeline-with-route-53"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>MSP 28 - Setting Domain Name and TLS for Production Pipeline with Route 53</h2>
<ul dir="auto">
<li>Create <code>feature/msp-28</code> branch from <code>main</code>.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="git checkout main
git branch feature/msp-28
git checkout feature/msp-28"><pre>git checkout main
git branch feature/msp-28
git checkout feature/msp-28</pre></div>
<ul dir="auto">
<li>
<p dir="auto">Create an <code>A</code> record of <code>petclinic.clarusway.us</code> in your hosted zone (in our case <code>clarusway.us</code>) using AWS Route 53 domain registrar and bind it to your <code>petclinic cluster</code>.</p>
</li>
<li>
<p dir="auto">Configure TLS(SSL) certificate for <code>petclinic.clarusway.us</code> using <code>cert-manager</code> on petclinic K8s cluster with the following steps.</p>
</li>
<li>
<p dir="auto">Log into Jenkins Server and configure the <code>kubectl</code> to connect to petclinic cluster by getting the <code>Kubeconfig</code> file from Rancher and save it as <code>$HOME/.kube/config</code> or set <code>KUBECONFIG</code> environment variable.</p>
</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="#create petclinic-config file under home folder(/home/ec2-user).
nano petclinic-config
# paste the content of kubeconfig file and save it.
chmod 400 petclinic-config
export KUBECONFIG=/home/ec2-user/.kube/petclinic-config
# test the kubectl with petclinic namespaces
kubectl get ns"><pre><span class="pl-c"><span class="pl-c">#</span>create petclinic-config file under home folder(/home/ec2-user).</span>
nano petclinic-config
<span class="pl-c"><span class="pl-c">#</span> paste the content of kubeconfig file and save it.</span>
chmod 400 petclinic-config
<span class="pl-k">export</span> KUBECONFIG=/home/ec2-user/.kube/petclinic-config
<span class="pl-c"><span class="pl-c">#</span> test the kubectl with petclinic namespaces</span>
kubectl get ns</pre></div>
<ul dir="auto">
<li>
<p dir="auto">Install the <code>cert-manager</code> on petclinic cluster. See <a href="https://cert-manager.io/docs/" rel="nofollow">Cert-Manager info</a>.</p>
<ul dir="auto">
<li>Create the namespace for cert-manager</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="  kubectl create namespace cert-manager"><pre>  kubectl create namespace cert-manager</pre></div>
<ul dir="auto">
<li>Add the Jetstack Helm repository.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="helm repo add jetstack https://charts.jetstack.io"><pre>helm repo add jetstack https://charts.jetstack.io</pre></div>
<ul dir="auto">
<li>Update your local Helm chart repository.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="helm repo update"><pre>helm repo update</pre></div>
<ul dir="auto">
<li>Install the <code>Custom Resource Definition</code> resources separately</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="kubectl apply -f https://github.com/jetstack/cert-manager/releases/download/v1.7.1/cert-manager.crds.yaml"><pre>kubectl apply -f https://github.com/jetstack/cert-manager/releases/download/v1.7.1/cert-manager.crds.yaml</pre></div>
<ul dir="auto">
<li>Install the cert-manager Helm chart</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="helm install \
cert-manager jetstack/cert-manager \
--namespace cert-manager \
--version v1.7.1"><pre>helm install \
cert-manager jetstack/cert-manager \
--namespace cert-manager \
--version v1.7.1</pre></div>
<ul dir="auto">
<li>Verify that the cert-manager is deployed correctly.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="kubectl get pods --namespace cert-manager -o wide"><pre>kubectl get pods --namespace cert-manager -o wide</pre></div>
</li>
<li>
<p dir="auto">Create <code>ClusterIssuer</code> with name of <code>tls-cluster-issuer-prod.yml</code> for the production certificate through <code>Let's Encrypt ACME</code> (Automated Certificate Management Environment) with following content by importing YAML file on Ranhcer and save it under <code>k8s</code> folder. <em>Note that certificate will only be created after annotating and updating the <code>Ingress</code> resource.</em></p>
</li>
</ul>
<div class="highlight highlight-source-yaml position-relative overflow-auto" data-snippet-clipboard-copy-content="apiVersion: cert-manager.io/v1
kind: ClusterIssuer
metadata:
  name: letsencrypt-prod
  namespace: cert-manager
spec:
  acme:
    # The ACME server URL
    server: https://acme-v02.api.letsencrypt.org/directory
    # Email address used for ACME registration
    email: callahan@clarusway.com
    # Name of a secret used to store the ACME account private key
    privateKeySecretRef:
      name: letsencrypt-prod
    # Enable the HTTP-01 challenge provider
    solvers:
    - http01:
        ingress:
          class: nginx"><pre><span class="pl-ent">apiVersion</span>: <span class="pl-s">cert-manager.io/v1</span>
<span class="pl-ent">kind</span>: <span class="pl-s">ClusterIssuer</span>
<span class="pl-ent">metadata</span>:
  <span class="pl-ent">name</span>: <span class="pl-s">letsencrypt-prod</span>
  <span class="pl-ent">namespace</span>: <span class="pl-s">cert-manager</span>
<span class="pl-ent">spec</span>:
  <span class="pl-ent">acme</span>:
    <span class="pl-c"><span class="pl-c">#</span> The ACME server URL</span>
    <span class="pl-ent">server</span>: <span class="pl-s">https://acme-v02.api.letsencrypt.org/directory</span>
    <span class="pl-c"><span class="pl-c">#</span> Email address used for ACME registration</span>
    <span class="pl-ent">email</span>: <span class="pl-s">callahan@clarusway.com</span>
    <span class="pl-c"><span class="pl-c">#</span> Name of a secret used to store the ACME account private key</span>
    <span class="pl-ent">privateKeySecretRef</span>:
      <span class="pl-ent">name</span>: <span class="pl-s">letsencrypt-prod</span>
    <span class="pl-c"><span class="pl-c">#</span> Enable the HTTP-01 challenge provider</span>
    <span class="pl-ent">solvers</span>:
    - <span class="pl-ent">http01</span>:
        <span class="pl-ent">ingress</span>:
          <span class="pl-ent">class</span>: <span class="pl-s">nginx</span></pre></div>
<ul dir="auto">
<li>Check if <code>ClusterIssuer</code> resource is created.</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="kubectl apply -f k8s/tls-cluster-issuer-prod.yml
kubectl get clusterissuers letsencrypt-prod -n cert-manager -o wide"><pre>kubectl apply -f k8s/tls-cluster-issuer-prod.yml
kubectl get clusterissuers letsencrypt-prod -n cert-manager -o wide</pre></div>
<ul dir="auto">
<li>Issue production Let’s Encrypt Certificate by annotating and adding the <code>api-gateway</code> ingress resource with following through Rancher.</li>
</ul>
<div class="highlight highlight-source-yaml position-relative overflow-auto" data-snippet-clipboard-copy-content="metadata:
  name: api-gateway
  annotations:
    cert-manager.io/cluster-issuer: &quot;letsencrypt-prod&quot;
spec:
  tls:
  - hosts:
    - petclinic.clarusway.us
    secretName: petclinic-tls"><pre><span class="pl-ent">metadata</span>:
  <span class="pl-ent">name</span>: <span class="pl-s">api-gateway</span>
  <span class="pl-ent">annotations</span>:
    <span class="pl-ent">cert-manager.io/cluster-issuer</span>: <span class="pl-s"><span class="pl-pds">"</span>letsencrypt-prod<span class="pl-pds">"</span></span>
<span class="pl-ent">spec</span>:
  <span class="pl-ent">tls</span>:
  - <span class="pl-ent">hosts</span>:
    - <span class="pl-s">petclinic.clarusway.us</span>
    <span class="pl-ent">secretName</span>: <span class="pl-s">petclinic-tls</span></pre></div>
<ul dir="auto">
<li>
<p dir="auto">Check and verify that the TLS(SSL) certificate created and successfully issued to <code>petclinic.clarusway.us</code> by checking URL of <code>https://petclinic.clarusway.us</code></p>
</li>
<li>
<p dir="auto">Commit the change, then push the tls script to the remote repo.</p>
</li>
</ul>
<div class="highlight highlight-source-shell position-relative overflow-auto" data-snippet-clipboard-copy-content="git add .
git commit -m 'added tls scripts for petclinic-production'
git push --set-upstream origin feature/msp-28
git checkout main
git merge feature/msp-28
git push origin main"><pre>git add <span class="pl-c1">.</span>
git commit -m <span class="pl-s"><span class="pl-pds">'</span>added tls scripts for petclinic-production<span class="pl-pds">'</span></span>
git push --set-upstream origin feature/msp-28
git checkout main
git merge feature/msp-28
git push origin main</pre></div>
<ul dir="auto">
<li>Run the <code>Production Pipeline</code> <code>petclinic-prod</code> on Jenkins manually to examine the petclinic application.</li>
</ul>
<h2 dir="auto"><a id="user-content-msp-29---monitoring-with-prometheus-and-grafana" class="anchor" aria-hidden="true" href="#msp-29---monitoring-with-prometheus-and-grafana"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>MSP 29 - Monitoring with Prometheus and Grafana</h2>
<ul dir="auto">
<li>
<p dir="auto">Change the port of Prometheus Service to <code>9090</code>, so that Grafana can scrape the data.</p>
</li>
<li>
<p dir="auto">Create a Kubernetes <code>NodePort</code> Service for Prometheus Server on Rancher to expose it.</p>
</li>
<li>
<p dir="auto">Create a Kubernetes <code>NodePort</code> Service for Grafana Server on Rancher to expose it.</p>
</li>
</ul>
</article>
  </div>

    </div>

  </readme-toc>

  

  <details class="details-reset details-overlay details-overlay-dark" id="jumpto-line-details-dialog">
    <summary data-hotkey="l" aria-label="Jump to line"></summary>
    <details-dialog class="Box Box--overlay d-flex flex-column anim-fade-in fast linejump" aria-label="Jump to line">
      <!-- '"` --><!-- </textarea></xmp> --></option></form><form class="js-jump-to-line-form Box-body d-flex" data-turbo="false" action="" accept-charset="UTF-8" method="get">
        <input class="form-control flex-auto mr-3 linejump-input js-jump-to-line-field" type="text" placeholder="Jump to line&hellip;" aria-label="Jump to line" autofocus>
        <button data-close-dialog="" type="submit" data-view-component="true" class="btn">  Go
</button>
</form>    </details-dialog>
  </details>

    <div class="Popover anim-scale-in js-tagsearch-popover"
     hidden
     data-tagsearch-url="/adursunoglu16/petclinic-microservice-private/find-definition"
     data-tagsearch-ref="main"
     data-tagsearch-code-nav-context="BLOB_VIEW">
  <div class="Popover-message Popover-message--large Popover-message--top-left TagsearchPopover mt-1 mb-4 mx-auto Box color-shadow-large">
    <div class="TagsearchPopover-content js-tagsearch-popover-content overflow-auto" style="will-change:transform;">
    </div>
  </div>
</div>


</div>

  </div>


</div>

    </main>
  </div>

  </div>

          <footer class="footer width-full container-xl p-responsive" role="contentinfo">


  <div class="position-relative d-flex flex-items-center pb-2 f6 color-fg-muted border-top color-border-muted flex-column-reverse flex-lg-row flex-wrap flex-lg-nowrap mt-6 pt-6">
    <ul class="list-style-none d-flex flex-wrap col-0 col-lg-2 flex-justify-start flex-lg-justify-between mb-2 mb-lg-0">
      <li class="mt-2 mt-lg-0 d-flex flex-items-center">
        <a aria-label="Homepage" title="GitHub" class="footer-octicon mr-2" href="https://github.com">
          <svg aria-hidden="true" height="24" viewBox="0 0 16 16" version="1.1" width="24" data-view-component="true" class="octicon octicon-mark-github">
    <path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path>
</svg>
</a>        <span>
        &copy; 2022 GitHub, Inc.
        </span>
      </li>
    </ul>
    <ul class="list-style-none d-flex flex-wrap col-12 col-lg-8 flex-justify-center flex-lg-justify-between mb-2 mb-lg-0">
        <li class="mr-3 mr-lg-0"><a href="https://docs.github.com/en/github/site-policy/github-terms-of-service" data-analytics-event="{&quot;category&quot;:&quot;Footer&quot;,&quot;action&quot;:&quot;go to terms&quot;,&quot;label&quot;:&quot;text:terms&quot;}">Terms</a></li>
        <li class="mr-3 mr-lg-0"><a href="https://docs.github.com/en/github/site-policy/github-privacy-statement" data-analytics-event="{&quot;category&quot;:&quot;Footer&quot;,&quot;action&quot;:&quot;go to privacy&quot;,&quot;label&quot;:&quot;text:privacy&quot;}">Privacy</a></li>
        <li class="mr-3 mr-lg-0"><a data-analytics-event="{&quot;category&quot;:&quot;Footer&quot;,&quot;action&quot;:&quot;go to security&quot;,&quot;label&quot;:&quot;text:security&quot;}" href="https://github.com/security">Security</a></li>
        <li class="mr-3 mr-lg-0"><a href="https://www.githubstatus.com/" data-analytics-event="{&quot;category&quot;:&quot;Footer&quot;,&quot;action&quot;:&quot;go to status&quot;,&quot;label&quot;:&quot;text:status&quot;}">Status</a></li>
        <li class="mr-3 mr-lg-0"><a data-ga-click="Footer, go to help, text:Docs" href="https://docs.github.com">Docs</a></li>
        <li class="mr-3 mr-lg-0"><a href="https://support.github.com?tags=dotcom-footer" data-analytics-event="{&quot;category&quot;:&quot;Footer&quot;,&quot;action&quot;:&quot;go to contact&quot;,&quot;label&quot;:&quot;text:contact&quot;}">Contact GitHub</a></li>
        <li class="mr-3 mr-lg-0"><a href="https://github.com/pricing" data-analytics-event="{&quot;category&quot;:&quot;Footer&quot;,&quot;action&quot;:&quot;go to Pricing&quot;,&quot;label&quot;:&quot;text:Pricing&quot;}">Pricing</a></li>
      <li class="mr-3 mr-lg-0"><a href="https://docs.github.com" data-analytics-event="{&quot;category&quot;:&quot;Footer&quot;,&quot;action&quot;:&quot;go to api&quot;,&quot;label&quot;:&quot;text:api&quot;}">API</a></li>
      <li class="mr-3 mr-lg-0"><a href="https://services.github.com" data-analytics-event="{&quot;category&quot;:&quot;Footer&quot;,&quot;action&quot;:&quot;go to training&quot;,&quot;label&quot;:&quot;text:training&quot;}">Training</a></li>
        <li class="mr-3 mr-lg-0"><a href="https://github.blog" data-analytics-event="{&quot;category&quot;:&quot;Footer&quot;,&quot;action&quot;:&quot;go to blog&quot;,&quot;label&quot;:&quot;text:blog&quot;}">Blog</a></li>
        <li><a data-ga-click="Footer, go to about, text:about" href="https://github.com/about">About</a></li>
    </ul>
  </div>
  <div class="d-flex flex-justify-center pb-6">
    <span class="f6 color-fg-muted"></span>
  </div>
</footer>




  <div id="ajax-error-message" class="ajax-error-message flash flash-error" hidden>
    <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-alert">
    <path fill-rule="evenodd" d="M8.22 1.754a.25.25 0 00-.44 0L1.698 13.132a.25.25 0 00.22.368h12.164a.25.25 0 00.22-.368L8.22 1.754zm-1.763-.707c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0114.082 15H1.918a1.75 1.75 0 01-1.543-2.575L6.457 1.047zM9 11a1 1 0 11-2 0 1 1 0 012 0zm-.25-5.25a.75.75 0 00-1.5 0v2.5a.75.75 0 001.5 0v-2.5z"></path>
</svg>
    <button type="button" class="flash-close js-ajax-error-dismiss" aria-label="Dismiss error">
      <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-x">
    <path fill-rule="evenodd" d="M3.72 3.72a.75.75 0 011.06 0L8 6.94l3.22-3.22a.75.75 0 111.06 1.06L9.06 8l3.22 3.22a.75.75 0 11-1.06 1.06L8 9.06l-3.22 3.22a.75.75 0 01-1.06-1.06L6.94 8 3.72 4.78a.75.75 0 010-1.06z"></path>
</svg>
    </button>
    You can’t perform that action at this time.
  </div>

  <div class="js-stale-session-flash flash flash-warn flash-banner" hidden
    >
    <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-alert">
    <path fill-rule="evenodd" d="M8.22 1.754a.25.25 0 00-.44 0L1.698 13.132a.25.25 0 00.22.368h12.164a.25.25 0 00.22-.368L8.22 1.754zm-1.763-.707c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0114.082 15H1.918a1.75 1.75 0 01-1.543-2.575L6.457 1.047zM9 11a1 1 0 11-2 0 1 1 0 012 0zm-.25-5.25a.75.75 0 00-1.5 0v2.5a.75.75 0 001.5 0v-2.5z"></path>
</svg>
    <span class="js-stale-session-flash-signed-in" hidden>You signed in with another tab or window. <a href="">Reload</a> to refresh your session.</span>
    <span class="js-stale-session-flash-signed-out" hidden>You signed out in another tab or window. <a href="">Reload</a> to refresh your session.</span>
  </div>
    <template id="site-details-dialog">
  <details class="details-reset details-overlay details-overlay-dark lh-default color-fg-default hx_rsm" open>
    <summary role="button" aria-label="Close dialog"></summary>
    <details-dialog class="Box Box--overlay d-flex flex-column anim-fade-in fast hx_rsm-dialog hx_rsm-modal">
      <button class="Box-btn-octicon m-0 btn-octicon position-absolute right-0 top-0" type="button" aria-label="Close dialog" data-close-dialog>
        <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-x">
    <path fill-rule="evenodd" d="M3.72 3.72a.75.75 0 011.06 0L8 6.94l3.22-3.22a.75.75 0 111.06 1.06L9.06 8l3.22 3.22a.75.75 0 11-1.06 1.06L8 9.06l-3.22 3.22a.75.75 0 01-1.06-1.06L6.94 8 3.72 4.78a.75.75 0 010-1.06z"></path>
</svg>
      </button>
      <div class="octocat-spinner my-6 js-details-dialog-spinner"></div>
    </details-dialog>
  </details>
</template>

    <div class="Popover js-hovercard-content position-absolute" style="display: none; outline: none;" tabindex="0">
  <div class="Popover-message Popover-message--bottom-left Popover-message--large Box color-shadow-large" style="width:360px;">
  </div>
</div>

    <template id="snippet-clipboard-copy-button">
  <div class="zeroclipboard-container position-absolute right-0 top-0">
    <clipboard-copy aria-label="Copy" class="ClipboardButton btn js-clipboard-copy m-2 p-0 tooltipped-no-delay" data-copy-feedback="Copied!" data-tooltip-direction="w">
      <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-copy js-clipboard-copy-icon m-2">
    <path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path>
</svg>
      <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-check js-clipboard-check-icon color-fg-success d-none m-2">
    <path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path>
</svg>
    </clipboard-copy>
  </div>
</template>


    <style>
      .user-mention[href$="/EmreYsrc"] {
        color: var(--color-user-mention-fg);
        background-color: var(--color-user-mention-bg);
        border-radius: 2px;
        margin-left: -2px;
        margin-right: -2px;
        padding: 0 2px;
      }
    </style>


  </body>
</html>

